"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[915],{4296:(e,t,l)=>{l.r(t),l.d(t,{default:()=>Ge});var s=l(3927),a=l(6553),n=l(6569),i=l(5206),r=l(6051),o=l(2751),d=l(5043),c=l(3795),u=l(579);const p=e=>{let{children:t,plantCode:l}=e;return(0,u.jsx)(c.SD,{routeName:"Plant Dashboard",errorContext:{plantCode:l,feature:"plant-workflow-management",level:"plant"},children:t})};var m=l(8463),h=l(8143),g=l(3310),f=l(2058),x=l(5444),y=l(9073),v=l(6399),b=l(7419),j=l(1645),A=l(8354);const{Search:C}=x.A,{Option:w}=a.A,S=d.memo(e=>{let{searchText:t,statusFilter:l,completionFilter:s,onSearchTextChange:n,onStatusFilterChange:o,onCompletionFilterChange:c,onClearFilters:p,onApplyPreset:x,onSaveFilters:S,filterPresets:P,filterSummary:k}=e;const N=(0,d.useCallback)(e=>{n&&n(e)},[n]),I=(0,d.useCallback)(e=>{o&&o(e)},[o]),q=(0,d.useCallback)(e=>{c&&c(e)},[c]),F=(0,d.useCallback)(()=>{p&&p()},[p]),T=(0,d.useCallback)(e=>{x&&x(e)},[x]),E=(0,d.useCallback)(()=>{S&&S()},[S]);return(0,u.jsxs)(y.A,{title:(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)(m.A,{}),(0,u.jsx)("span",{children:"Filters"}),(null===k||void 0===k?void 0:k.hasActiveFilters)&&(0,u.jsxs)(v.A,{color:"blue",style:{marginLeft:8},children:[k.activeFilters.length," active"]})]}),size:"small",style:{marginBottom:16},extra:(0,u.jsxs)(r.A,{children:[S&&(0,u.jsx)(i.Ay,{size:"small",icon:(0,u.jsx)(h.A,{}),onClick:E,disabled:!(null!==k&&void 0!==k&&k.hasActiveFilters),children:"Save"}),(0,u.jsx)(i.Ay,{size:"small",icon:(0,u.jsx)(g.A,{}),onClick:F,disabled:!(null!==k&&void 0!==k&&k.hasActiveFilters),children:"Clear All"})]}),children:[(0,u.jsxs)(b.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,u.jsxs)(j.A,{xs:24,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Search Materials"}),(0,u.jsx)(C,{placeholder:"Search by Material Code or Plant",value:t,onChange:e=>N(e.target.value),style:{width:"100%"},allowClear:!0,enterButton:(0,u.jsx)(f.A,{})})]}),(0,u.jsxs)(j.A,{xs:12,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Status Filter"}),(0,u.jsxs)(a.A,{placeholder:"Filter by Status",value:l,onChange:I,style:{width:"100%"},allowClear:!0,children:[(0,u.jsx)(w,{value:"all",children:"All Statuses"}),(0,u.jsx)(w,{value:"DRAFT",children:"Draft"}),(0,u.jsx)(w,{value:"IN_PROGRESS",children:"In Progress"}),(0,u.jsx)(w,{value:"COMPLETED",children:"Completed"}),(0,u.jsx)(w,{value:"SUBMITTED",children:"Submitted"})]})]}),(0,u.jsxs)(j.A,{xs:12,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Completion Filter"}),(0,u.jsxs)(a.A,{placeholder:"Filter by Completion",value:s,onChange:q,style:{width:"100%"},allowClear:!0,children:[(0,u.jsx)(w,{value:"all",children:"All Progress"}),(0,u.jsx)(w,{value:"not-started",children:"Not Started (0%)"}),(0,u.jsx)(w,{value:"in-progress",children:"In Progress (1-99%)"}),(0,u.jsx)(w,{value:"completed",children:"Completed (100%)"})]})]})]}),P&&P.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(A.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)("span",{style:{fontSize:"12px",fontWeight:"500",color:"#666"},children:"Quick Filters:"})}),(0,u.jsx)(r.A,{wrap:!0,children:P.map(e=>(0,u.jsx)(i.Ay,{size:"small",type:"default",onClick:()=>T(e.name),style:{fontSize:"12px"},children:e.name},e.name))})]}),(null===k||void 0===k?void 0:k.hasActiveFilters)&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(A.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)("span",{style:{fontSize:"12px",fontWeight:"500",color:"#666"},children:"Active Filters:"})}),(0,u.jsx)(r.A,{wrap:!0,children:k.activeFilters.map((e,t)=>(0,u.jsx)(v.A,{color:"blue",style:{fontSize:"11px"},children:e},t))}),(0,u.jsxs)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:["Showing ",k.totalFiltered," of ",k.totalOriginal," workflows"]})]}),!(null!==k&&void 0!==k&&k.hasActiveFilters)&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(A.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#999",textAlign:"center"},children:"No filters applied - showing all workflows"})]})]})});S.displayName="FilterPanel",S.defaultProps={searchText:"",statusFilter:"all",completionFilter:"all",onSearchTextChange:null,onStatusFilterChange:null,onCompletionFilterChange:null,onClearFilters:null,onApplyPreset:null,onSaveFilters:null,filterPresets:[],filterSummary:null};const P=S;var k=l(119),N=l(9470),I=l(6237),q=l(1199),F=l(2261),T=l(6612),E=l(7692);const D=d.memo(e=>{let{dashboardStats:t,loading:l,error:s,currentPlant:a,onRefresh:n}=e;const i=(0,d.useMemo)(()=>e=>e>=80?"#52c41a":e>=60?"#1890ff":e>=40?"#faad14":e>=20?"#fa8c16":"#ff4d4f",[]),r=(0,d.useMemo)(()=>{const{totalWorkflows:e,completedCount:l,inProgressCount:s,draftCount:a}=t;return 0===e?{completionRate:0,inProgressRate:0,draftRate:0}:{completionRate:Math.round(l/e*100),inProgressRate:Math.round(s/e*100),draftRate:Math.round(a/e*100)}},[t]),o=(0,d.useMemo)(()=>e=>({total:"#1890ff",inProgress:"#fa8c16",completed:"#52c41a",average:"#52c41a"}[e]||"#1890ff"),[]);return s?(0,u.jsx)(F.A,{message:"Dashboard Error",description:`Failed to load dashboard data: ${s}`,type:"error",showIcon:!0,style:{marginBottom:24},action:n&&(0,u.jsx)("button",{onClick:n,style:{border:"none",background:"none",color:"#1890ff",cursor:"pointer"},children:"Retry"})}):(0,u.jsxs)("div",{style:{marginBottom:24},children:[(0,u.jsxs)(b.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,u.jsx)(j.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(y.A,{loading:l,children:(0,u.jsx)(T.A,{title:"Total Materials",value:t.totalWorkflows||0,prefix:(0,u.jsx)(k.A,{}),valueStyle:{color:o("total")}})})}),(0,u.jsx)(j.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(y.A,{loading:l,children:(0,u.jsx)(T.A,{title:"In Progress",value:t.inProgressCount||0,prefix:(0,u.jsx)(N.A,{}),valueStyle:{color:o("inProgress")}})})}),(0,u.jsx)(j.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(y.A,{loading:l,children:(0,u.jsx)(T.A,{title:"Completed",value:t.completedCount||0,prefix:(0,u.jsx)(I.A,{}),valueStyle:{color:o("completed")}})})}),(0,u.jsx)(j.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(y.A,{loading:l,children:(0,u.jsx)(T.A,{title:"Average Progress",value:t.averageCompletion||0,suffix:"%",prefix:(0,u.jsx)(q.A,{}),valueStyle:{color:o("average")}})})})]}),(0,u.jsxs)(b.A,{gutter:[16,16],children:[(0,u.jsx)(j.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(y.A,{title:"Completion Rate",loading:l,size:"small",children:[(0,u.jsx)(E.A,{type:"circle",percent:r.completionRate,strokeColor:i(r.completionRate),format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.completedCount," of ",t.totalWorkflows," completed"]})]})}),(0,u.jsx)(j.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(y.A,{title:"In Progress Rate",loading:l,size:"small",children:[(0,u.jsx)(E.A,{type:"circle",percent:r.inProgressRate,strokeColor:"#fa8c16",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.inProgressCount," workflows active"]})]})}),(0,u.jsx)(j.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(y.A,{title:"Draft Rate",loading:l,size:"small",children:[(0,u.jsx)(E.A,{type:"circle",percent:r.draftRate,strokeColor:"#ff4d4f",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.draftCount," not started"]})]})})]}),a&&(0,u.jsx)(F.A,{message:`Plant Dashboard - ${a}`,description:"Overview of all assigned materials and their completion status for the selected plant.",type:"info",showIcon:!0,style:{marginTop:16}})]})});D.displayName="PlantDashboard",D.defaultProps={loading:!1,error:null,currentPlant:null,onRefresh:null};const z=D;var R=l(8174),M=l(6191),_=l(3217),L=l(2868);const O=d.memo(e=>{let{workflows:t,loading:l,onStartQuestionnaire:s,onViewWorkflow:a,onRefresh:n}=e;const o=(0,d.useCallback)(e=>({DRAFT:"default",IN_PROGRESS:"processing",COMPLETED:"success",SUBMITTED:"success"}[e]||"default"),[]),c=(0,d.useCallback)(e=>100===e?"#52c41a":e>=75?"#1890ff":e>=50?"#faad14":e>=25?"#fa8c16":"#ff4d4f",[]),p=(0,d.useCallback)(e=>{if(!e)return 0;const t=new Date,l=new Date(e),s=Math.abs(t-l);return Math.ceil(s/864e5)},[]),m=(0,d.useCallback)(e=>{s&&s(e)},[s]),h=(0,d.useCallback)(e=>{a?a(e):console.log("View workflow:",e.id)},[a]),g=(0,d.useMemo)(()=>[{title:"Material Code",dataIndex:"materialCode",key:"materialCode",width:140,sorter:(e,t)=>e.materialCode.localeCompare(t.materialCode),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:l,confirm:s,clearFilters:a}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(x.A,{placeholder:"Search Material Code",value:l[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(r.A,{children:[(0,u.jsx)(i.Ay,{type:"primary",onClick:()=>s(),icon:(0,u.jsx)(f.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(i.Ay,{onClick:()=>a(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(f.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>t.materialCode.toLowerCase().includes(e.toLowerCase()),render:(e,t)=>(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold"},children:e}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:t.materialName||t.itemDescription||"Material Name"})]})},{title:"Plant Code",dataIndex:"plantCode",key:"plantCode",width:120,sorter:(e,t)=>(e.plantCode||"").localeCompare(t.plantCode||""),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:l,confirm:s,clearFilters:a}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(x.A,{placeholder:"Search Plant Code",value:l[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(r.A,{children:[(0,u.jsx)(i.Ay,{type:"primary",onClick:()=>s(),icon:(0,u.jsx)(f.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(i.Ay,{onClick:()=>a(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(f.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>(t.plantCode||"").toLowerCase().includes(e.toLowerCase()),render:e=>(0,u.jsx)(v.A,{color:"blue",style:{fontWeight:"bold"},children:e||"N/A"})},{title:"Status",dataIndex:"completionStatus",key:"completionStatus",width:120,filters:[{text:"Draft",value:"DRAFT"},{text:"In Progress",value:"IN_PROGRESS"},{text:"Completed",value:"COMPLETED"},{text:"Submitted",value:"SUBMITTED"}],onFilter:(e,t)=>t.completionStatus===e,render:e=>(0,u.jsx)(v.A,{color:o(e),children:e.replace("_"," ")})},{title:"Progress",key:"progress",width:150,sorter:(e,t)=>e.completionPercentage-t.completionPercentage,render:(e,t)=>{const l=t.completionPercentage||0;return(0,u.jsxs)("div",{children:[(0,u.jsx)(E.A,{percent:l,size:"small",strokeColor:c(l),format:()=>`${l}%`}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:2},children:[t.completedFields||0," / ",t.totalFields||0," fields"]})]})}},{title:"Days Pending",key:"daysPending",width:100,sorter:(e,t)=>p(e.lastModified)-p(t.lastModified),render:(e,t)=>{const l=p(t.lastModified);return(0,u.jsx)("span",{style:{color:l>3?"#ff4d4f":"inherit"},children:l})}},{title:"Open Queries",dataIndex:"openQueries",key:"openQueries",width:100,sorter:(e,t)=>(e.openQueries||0)-(t.openQueries||0),render:e=>e>0?(0,u.jsx)(v.A,{color:"red",children:e}):(0,u.jsx)(v.A,{color:"green",children:"0"})},{title:"Actions",key:"actions",width:150,render:(e,t)=>(0,u.jsxs)(r.A,{children:[(0,u.jsx)(i.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(R.A,{}),onClick:()=>m(t),disabled:t.isSubmitted,children:t.completionPercentage>0?"Continue":"Start"}),(0,u.jsx)(i.Ay,{size:"small",icon:(0,u.jsx)(M.A,{}),onClick:()=>h(t),children:"View"})]})}],[o,c,p,m,h]),y=(0,d.useCallback)(e=>p(e.lastModified)>3?"overdue-row":"",[p]),b=(0,d.useMemo)(()=>({pageSize:L.Bq.DEFAULT_PAGE_SIZE,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} materials`,pageSizeOptions:["10","20","50","100"]}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(_.A,{dataSource:t,columns:g,loading:l,rowKey:"id",pagination:b,rowClassName:y,scroll:{x:1200},size:"small",bordered:!0,title:()=>(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("span",{style:{fontWeight:"bold"},children:["Assigned Materials (",t.length,")"]}),n&&(0,u.jsx)(i.Ay,{onClick:n,loading:l,size:"small",children:"Refresh"})]})}),(0,u.jsx)("style",{children:"\n        .overdue-row {\n          background-color: #fff2f0;\n        }\n        .overdue-row:hover {\n          background-color: #ffebe6 !important;\n        }\n        .ant-table-tbody > tr.overdue-row > td {\n          border-bottom: 1px solid #ffccc7;\n        }\n      "})]})});O.displayName="WorkflowTable",O.defaultProps={loading:!1,onStartQuestionnaire:null,onViewWorkflow:null,onRefresh:null};const Q=O;var B=l(6091),U=l(1334),W=l(1814),$=l(9760),V=l(2115),Y=l(3382),G=l(4524),H=l(6886),J=l(3357),K=l(7302),X=l(1306),Z=l(2878),ee=l(6840),te=l(1919),le=l(5920),se=l(8600),ae=l(6502),ne=l(9098),ie=l(349),re=l(6651),oe=l(6603),de=l(2513),ce=l(1686),ue=l(5964),pe=l(7490),me=l(8677),he=l(6263),ge=l(2428),fe=l(3661),xe=l(9394),ye=l(4786),ve=l(8818),be=l(1210),je=l(5240),Ae=l(9330),Ce=l(7326),we=l(691);const{Panel:Se}=Ce.A,{Text:Pe}=s.A,ke=e=>{let{workflowData:t}=e;const[l,s]=(0,d.useState)(!1),[a,o]=(0,d.useState)([]),[c,p]=(0,d.useState)(["basic","workflow","jvc-data"]),m=(0,d.useCallback)(async()=>{try{if(s(!0),null!==t&&void 0!==t&&t.projectCode&&null!==t&&void 0!==t&&t.materialCode){const e=await xe.S.getReusableDocuments(t.projectCode,t.materialCode);o(e||[])}else{const e=await xe.S.getWorkflowDocuments(t.id);o(e||[])}}catch(e){console.error("Failed to load JVC documents:",e),o([])}finally{s(!1)}},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode]);(0,d.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&m()},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode,m]);const h=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";if(!t)return(0,u.jsx)(y.A,{title:"Material Context",style:{height:"fit-content"},children:(0,u.jsx)(F.A,{message:"No Material Data",description:"Material context will appear here once a workflow is selected.",type:"info",showIcon:!0})});const g=(e=>{if(!e)return 0;const t=new Date,l=new Date(e),s=Math.abs(t-l);return Math.ceil(s/864e5)})(t.lastModified),f=g>3;return(0,u.jsxs)(y.A,{title:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(ye.A,{}),"Material Context",f&&(0,u.jsx)(pe.A,{status:"error",text:`${g} days`})]}),style:{height:"fit-content",position:"sticky",top:24},size:"small",children:[(0,u.jsxs)(Ce.A,{activeKey:c,onChange:p,ghost:!0,size:"small",children:[(0,u.jsx)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(B.A,{}),(0,u.jsx)("strong",{children:"Basic Information"})]}),children:(0,u.jsxs)(we.A,{column:1,size:"small",children:[(0,u.jsx)(we.A.Item,{label:"Material Code",children:(0,u.jsx)(Pe,{strong:!0,children:t.materialCode})}),(0,u.jsx)(we.A.Item,{label:"Material Name",children:t.materialName||"Not specified"}),(0,u.jsx)(we.A.Item,{label:"Assigned Plant",children:(0,u.jsx)(v.A,{color:"blue",children:t.assignedPlant})}),(0,u.jsx)(we.A.Item,{label:"Initiated By",children:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(ve.A,{}),t.initiatedBy]})}),(0,u.jsx)(we.A.Item,{label:"Created",children:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(be.A,{}),h(t.createdAt)]})})]})},"basic"),(0,u.jsx)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(ve.A,{}),(0,u.jsx)("strong",{children:"Workflow Status"}),f&&(0,u.jsx)(je.A,{style:{color:"#ff4d4f"}})]}),children:(0,u.jsxs)(r.A,{direction:"vertical",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,children:"Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(v.A,{color:(x=t.state,{JVC_PENDING:"blue",PLANT_PENDING:"orange",CQS_PENDING:"purple",TECH_PENDING:"cyan",COMPLETED:"green"}[x]||"default"),children:(e=>({JVC_PENDING:"JVC Pending",PLANT_PENDING:"Plant Pending",CQS_PENDING:"CQS Pending",TECH_PENDING:"Tech Pending",COMPLETED:"Completed"}[e]||e))(t.state)})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,children:"Time in Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(Pe,{style:{color:f?"#ff4d4f":"inherit"},children:[g," day",1!==g?"s":"",f&&" (Overdue)"]})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,children:"Last Modified:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(Pe,{type:"secondary",children:h(t.lastModified)})})]}),t.totalQueries>0&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,children:"Queries:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(r.A,{children:[(0,u.jsxs)(v.A,{color:"red",children:[t.openQueries||0," Open"]}),(0,u.jsxs)(v.A,{color:"green",children:[(t.totalQueries||0)-(t.openQueries||0)," Resolved"]})]})})]}),void 0!==t.completionPercentage&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,children:"Completion Progress:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(E.A,{percent:t.completionPercentage,size:"small",status:100===t.completionPercentage?"success":"active"})})]})]})},"workflow"),(0,u.jsx)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(B.A,{}),(0,u.jsx)("strong",{children:"JVC Documents"}),(0,u.jsx)(pe.A,{count:a.length,size:"small"})]}),children:l?(0,u.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,u.jsx)(ce.A,{size:"small"})}):a.length>0?(0,u.jsx)(r.A,{direction:"vertical",style:{width:"100%"},children:a.map((e,t)=>{var l;return(0,u.jsxs)(y.A,{size:"small",style:{marginBottom:8},styles:{body:{padding:"8px 12px"}},children:[(0,u.jsx)("div",{style:{marginBottom:4},children:(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"12px"},children:e.originalFileName||e.fileName||`Document ${t+1}`})}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)(Pe,{type:"secondary",style:{fontSize:"11px"},children:e.sourceDescription||`${e.documentSource||"Document"} \u2022 ${(null===(l=e.fileType)||void 0===l?void 0:l.toUpperCase())||"File"} \u2022 ${e.fileSize?`${(e.fileSize/1024/1024).toFixed(1)} MB`:"Unknown size"} \u2022 Uploaded by ${e.uploadedBy||"Unknown"}`})}),(0,u.jsx)("div",{style:{textAlign:"right"},children:(0,u.jsx)(re.A,{title:"Download document",children:(0,u.jsx)(i.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(Ae.A,{}),onClick:()=>(async(e,t)=>{try{console.log("Downloading document:",{documentId:e,filename:t});const l=await xe.S.downloadDocument(e);console.log("Download blob received:",l);const s=window.URL.createObjectURL(l),a=document.createElement("a");a.href=s,a.download=t||`document_${e}`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),n.Ay.success(`Downloaded ${t||"document"}`)}catch(l){console.error("Failed to download document:",l),n.Ay.error(`Failed to download document: ${l.message||"Unknown error"}`)}})(e.id,e.originalFileName||e.fileName),children:"Download"})})})]},e.id||t)})}):(0,u.jsx)(F.A,{message:"No Documents",description:"No documents have been provided by the JVC team for this material.",type:"info",showIcon:!0,size:"small"})},"documents"),(0,u.jsxs)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(ye.A,{}),(0,u.jsx)("strong",{children:"JVC Material Data"}),(0,u.jsx)(re.A,{title:"Information provided by JVC team for questionnaire completion",children:(0,u.jsx)(ye.A,{style:{fontSize:"12px",color:"#1890ff"}})})]}),children:[(0,u.jsxs)(we.A,{column:1,size:"small",children:[(0,u.jsx)(we.A.Item,{label:"Material Category",children:(0,u.jsx)(v.A,{color:"blue",children:t.materialCategory||"Not specified"})}),(0,u.jsx)(we.A.Item,{label:"Supplier Information",children:(0,u.jsxs)(r.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Supplier Name:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierName||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Supplier Code:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierCode||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Contact Info:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierContact||"Not provided"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Purchase Information",children:(0,u.jsxs)(r.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Purchase Order:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.purchaseOrder||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Quantity Ordered:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.quantityOrdered||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Expected Delivery:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedDelivery?h(t.expectedDelivery):"Not specified"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Usage & Application",children:(0,u.jsxs)(r.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Expected Usage:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedUsage||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Application Area:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.applicationArea||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Process Requirements:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.processRequirements||"Standard processing"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Regulatory Requirements",children:(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",fontSize:"12px"},children:t.regulatoryRequirements||"Standard compliance required"})}),(0,u.jsx)(we.A.Item,{label:"Special Instructions",children:t.specialInstructions?(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px"},children:t.specialInstructions}):(0,u.jsx)(Pe,{type:"secondary",style:{fontSize:"12px"},children:"None"})}),(0,u.jsx)(we.A.Item,{label:"Priority & Impact",children:(0,u.jsxs)(r.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Urgency Level:"}),(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsx)(v.A,{color:"HIGH"===t.urgencyLevel?"red":"MEDIUM"===t.urgencyLevel?"orange":"green",children:t.urgencyLevel||"NORMAL"})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Business Impact:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.businessImpact||"Standard processing"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"11px"},children:"Cost Center:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.costCenter||"Not specified"})]})]})})]}),t.jvcNotes&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"12px"},children:"JVC Notes:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:t.jvcNotes})]}),t.knownProperties&&Object.keys(t.knownProperties).length>0&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Pe,{strong:!0,style:{fontSize:"12px"},children:"Known Properties:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f0f5ff",border:"1px solid #adc6ff",borderRadius:"4px",fontSize:"11px"},children:Object.entries(t.knownProperties).map(e=>{let[t,l]=e;return(0,u.jsxs)("div",{style:{marginBottom:2},children:[(0,u.jsxs)("strong",{children:[t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),":"]})," ",l]},t)})})]}),(0,u.jsx)(A.A,{style:{margin:"12px 0 8px 0"}}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:[(0,u.jsx)(Pe,{strong:!0,children:"For Plant Team Reference:"}),(0,u.jsxs)("ul",{style:{margin:"4px 0 0 16px",padding:0},children:[(0,u.jsx)("li",{children:"Review all JVC-provided information before starting questionnaire"}),(0,u.jsx)("li",{children:"Use this context when raising queries to other teams"}),(0,u.jsx)("li",{children:"Reference material ID and supplier details in communications"}),(0,u.jsx)("li",{children:"Contact JVC team for clarification on any provided data"}),(0,u.jsx)("li",{children:"Consider regulatory requirements when completing safety sections"})]})]})]},"jvc-data"),t.specifications&&(0,u.jsx)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(ye.A,{}),(0,u.jsx)("strong",{children:"Technical Specifications"})]}),children:(0,u.jsx)(we.A,{column:1,size:"small",children:Object.entries(t.specifications).map(e=>{let[t,l]=e;return(0,u.jsx)(we.A.Item,{label:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),children:"object"===typeof l?JSON.stringify(l):String(l)},t)})})},"specifications"),t.safetyNotes&&(0,u.jsx)(Se,{header:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(je.A,{}),(0,u.jsx)("strong",{children:"Safety Notes"})]}),children:(0,u.jsx)(F.A,{message:"Important Safety Information",description:t.safetyNotes,type:"warning",showIcon:!0,size:"small"})},"safety")]}),(0,u.jsx)(A.A,{style:{margin:"12px 0"}})]});var x};var Ne=l(6833),Ie=l(7933),qe=l(6274);const{TextArea:Fe}=x.A,{Option:Te}=a.A,Ee=e=>{let{open:t,visible:l,onCancel:s,onSubmit:c,workflowId:p,fieldContext:m}=e;const[h]=ne.A.useForm(),[g,f]=(0,d.useState)(!1),[x,y]=(0,d.useState)([]),[b,j]=(0,d.useState)(null);console.log("QueryRaisingModal props:",{open:t,visible:l,workflowId:p,fieldContext:m});const C=()=>{h.resetFields(),y([]),j(null),s()},w=e=>({LOW:"green",MEDIUM:"blue",HIGH:"orange",URGENT:"red"}[e]||"default");return(0,u.jsxs)(o.A,{title:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(Z.A,{}),"Raise Query"]}),open:t||l,onCancel:C,footer:b?[(0,u.jsx)(i.Ay,{type:"primary",onClick:()=>{const e=x.length>0?` with ${x.length} document(s) attached`:"";n.Ay.success(`Query completed${e}`),h.resetFields(),y([]);const t={id:b,documents:x};j(null),f(!1),c&&c(t)},children:"Done"},"done")]:[(0,u.jsx)(i.Ay,{onClick:C,children:"Cancel"},"cancel"),(0,u.jsx)(i.Ay,{type:"primary",loading:g,onClick:()=>h.submit(),children:"Create Query"},"submit")],width:600,destroyOnClose:!0,children:[m&&(0,u.jsx)(F.A,{message:"Field Context",description:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Step:"})," ",m.stepTitle]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Field:"})," ",m.label]}),m.placeholder&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Expected:"})," ",m.placeholder]})]}),type:"info",icon:(0,u.jsx)(ye.A,{}),style:{marginBottom:16}}),(0,u.jsxs)(qe.Ay,{form:h,layout:"vertical",onFinish:async e=>{try{f(!0);const t={question:e.question,assignedTeam:e.assignedTeam,priorityLevel:e.priority||"MEDIUM",fieldName:null===m||void 0===m?void 0:m.name,stepNumber:null===m||void 0===m?void 0:m.stepNumber,queryCategory:"GENERAL"},l=await fe.B.createQuery(p,t);j(l.id),n.Ay.success("Query created successfully! You can now attach documents if needed.")}catch(t){console.error("Failed to create query:",t),n.Ay.error("Failed to raise query. Please try again."),f(!1)}},initialValues:{priority:"MEDIUM",fieldContext:null===m||void 0===m?void 0:m.label},componentName:"QueryRaisingModal",enableSecurityLogging:!0,disabled:null!==b,children:[m&&(0,u.jsx)(F.A,{message:"Recommended Team",description:(e=>{var t,l;if(!e||!e.name)return null;const s=e.name.toLowerCase(),a=(null===(t=e.stepTitle)||void 0===t?void 0:t.toLowerCase())||"",n=(null===(l=e.label)||void 0===l?void 0:l.toLowerCase())||"";let i=0;["hazard","safety","precautionary","environmental","toxic","corrosive","flammable","classification","ghs","signal","statement"].forEach(e=>{(s.includes(e)||a.includes(e)||n.includes(e))&&(i+=1)});let r=0;["physical","boiling","melting","technical","properties","temperature","state","color","odor","specification"].forEach(e=>{(s.includes(e)||a.includes(e)||n.includes(e))&&(r+=1)});let o=0;["material","supplier","cas","basic","information","name","identification","type"].forEach(e=>{(s.includes(e)||a.includes(e)||n.includes(e))&&(o+=1)});const d=Math.max(i,r,o);let c="CQS",p="Medium";0===d?p="Low":d>=3&&(p="High"),i===d?c="CQS":r===d?c="TECH":o===d&&(c="JVC");return(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{marginBottom:8},children:[(0,u.jsxs)("strong",{style:{color:"High"===p?"#52c41a":"Medium"===p?"#1890ff":"#faad14"},children:[c," Team"]})," ","is recommended (",p," confidence)"]}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:8},children:{CQS:"Chemical Quality & Safety team - handles safety data, hazard classifications, and regulatory compliance",TECH:"Technical team - handles technical specifications, physical properties, and process-related questions",JVC:"JVC team - handles material identification, supplier information, and general material questions"}[c]}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#999"},children:['Based on field: "',(0,u.jsx)("em",{children:e.label}),'" in step: "',(0,u.jsx)("em",{children:e.stepTitle}),'"']}),"Low"===p&&(0,u.jsx)("div",{style:{fontSize:"11px",color:"#fa8c16",marginTop:4},children:"\ud83d\udca1 Consider the nature of your question when selecting the team"})]})})(m),type:"info",style:{marginBottom:16},showIcon:!0}),(0,u.jsx)(ne.A.Item,{name:"assignedTeam",label:"Assign to Team",rules:[{required:!0,message:"Please select a team to assign this query to"}],help:"Choose the most appropriate team based on your question type. Consider the field context and question nature.",children:(0,u.jsxs)(a.A,{placeholder:"Select team to handle this query",size:"large",showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.children.props.children[0].props.children.toLowerCase().indexOf(e.toLowerCase())>=0,children:[(0,u.jsx)(Te,{value:"CQS",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#722ed1"},children:"CQS Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Safety data, hazard classifications, regulatory compliance"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Safety measures, hazard statements, environmental impact"})]})}),(0,u.jsx)(Te,{value:"TECH",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#13c2c2"},children:"Technical Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Technical specs, physical properties, processes"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Physical properties, technical specifications, processes"})]})}),(0,u.jsx)(Te,{value:"JVC",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#1890ff"},children:"JVC Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Material identification, supplier info, general questions"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Material details, supplier information, general clarifications"})]})})]})}),(0,u.jsx)(qe.lE,{name:"fieldContext",label:"Field Context",help:"Specify which field or section this query relates to",validationType:"text",children:(0,u.jsx)(qe.eS,{placeholder:"e.g., Material Name, Safety Classification, Storage Conditions",prefix:(0,u.jsx)(ye.A,{}),validationType:"text",componentName:"QueryRaisingModal",fieldName:"fieldContext"})}),(0,u.jsx)(ne.A.Item,{name:"priority",label:"Priority Level",help:"Select the urgency level for this query",children:(0,u.jsx)(oe.Ay.Group,{children:(0,u.jsxs)(r.A,{direction:"vertical",children:[(0,u.jsxs)(oe.Ay,{value:"LOW",children:[(0,u.jsx)(v.A,{color:w("LOW"),children:"LOW"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"General information, non-blocking"})]}),(0,u.jsxs)(oe.Ay,{value:"MEDIUM",children:[(0,u.jsx)(v.A,{color:w("MEDIUM"),children:"MEDIUM"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Standard clarification needed"})]}),(0,u.jsxs)(oe.Ay,{value:"HIGH",children:[(0,u.jsx)(v.A,{color:w("HIGH"),children:"HIGH"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Important for completion"})]}),(0,u.jsxs)(oe.Ay,{value:"URGENT",children:[(0,u.jsx)(v.A,{color:w("URGENT"),children:"URGENT"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Blocking progress, needs immediate attention"})]})]})})}),(0,u.jsx)(A.A,{}),(0,u.jsx)(qe.lE,{name:"question",label:"Your Question",validationType:"richtext",help:"Be specific and provide context to help the assigned team understand your question",children:(0,u.jsx)(qe.wS,{rows:6,placeholder:"Describe your question in detail. Include:\n\u2022 What specific information you need\n\u2022 Why you need this information\n\u2022 Any relevant context or background\n\u2022 What you've already tried or researched",showCount:!0,maxLength:1e3,validationType:"richtext",componentName:"QueryRaisingModal",fieldName:"question"})}),b?(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsx)(F.A,{message:"Query Created Successfully!",description:"Your query has been created. You can now attach supporting documents if needed, or click 'Done' to finish.",type:"success",showIcon:!0,style:{marginBottom:16}}),(0,u.jsx)(Ie.A,{queryId:b,context:"query",onUploadComplete:e=>{y(t=>[...t,...e]),n.Ay.success(`${e.length} document(s) uploaded successfully`)},maxFiles:5,disabled:!1})]}):(0,u.jsx)(Ce.A,{size:"small",ghost:!0,items:[{key:"documents",label:(0,u.jsxs)(r.A,{children:[(0,u.jsx)(Ne.A,{}),(0,u.jsx)("span",{children:"Supporting Documents"}),(0,u.jsx)(v.A,{color:"blue",children:"Available after query creation"})]}),children:(0,u.jsx)(F.A,{message:"Document Attachment",description:"After creating your query, you'll be able to attach supporting documents to provide additional context. Documents help the assigned team better understand your question.",type:"info",showIcon:!0})}]}),(0,u.jsx)(A.A,{}),(0,u.jsx)(F.A,{message:"Query Guidelines",description:(0,u.jsxs)("ul",{style:{margin:0,paddingLeft:20},children:[(0,u.jsx)("li",{children:"Be specific and clear in your question"}),(0,u.jsx)("li",{children:"Include relevant context and background information"}),(0,u.jsx)("li",{children:"Mention any documentation or resources you've already checked"}),(0,u.jsx)("li",{children:"For urgent queries, explain why immediate attention is needed"}),(0,u.jsx)("li",{children:"Use appropriate technical terminology when relevant"})]}),type:"info",showIcon:!0,icon:(0,u.jsx)(N.A,{})})]})]})},{TextArea:De}=x.A,{Option:ze}=a.A,{Text:Re,Title:Me,Paragraph:_e}=s.A,Le=e=>{let{workflowId:t,onComplete:l,onSaveDraft:s}=e;const[c]=ne.A.useForm(),[p,m]=(0,d.useState)(0),[g,f]=(0,d.useState)(!0),[A,C]=(0,d.useState)(!1),[w,S]=(0,d.useState)(!1),[P,k]=(0,d.useState)(null),[q,T]=(0,d.useState)({}),[D,z]=(0,d.useState)(new Set),[R,M]=(0,d.useState)(!1),[_,O]=(0,d.useState)(null),[Q,ye]=(0,d.useState)([]),[ve,be]=(0,d.useState)(!0),[je,Ae]=(0,d.useState)(!navigator.onLine),[Ce,we]=(0,d.useState)(!1),[Se,Pe]=(0,d.useState)(!1),[Ne,Ie]=(0,d.useState)(0),{isMobile:qe}=(()=>{const[e,t]=(0,d.useState)({isMobile:window.innerWidth<=L.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>L.EW.MOBILE_BREAKPOINT&&window.innerWidth<=L.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>L.EW.TABLET_BREAKPOINT});return(0,d.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=L.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>L.EW.MOBILE_BREAKPOINT&&window.innerWidth<=L.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>L.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),[Fe,Te]=(0,d.useState)([]),[Le,Oe]=(0,d.useState)(!0),[Qe,Be]=(0,d.useState)({}),[Ue,We]=(0,d.useState)({}),$e={General:(0,u.jsx)(B.A,{}),Physical:(0,u.jsx)(U.A,{}),"Flammability and Explosivity":(0,u.jsx)(W.A,{}),Toxicity:(0,u.jsx)($.A,{}),"Storage and Handling":(0,u.jsx)(V.A,{}),PPE:(0,u.jsx)($.A,{}),"First Aid":(0,u.jsx)(Y.A,{}),Statutory:(0,u.jsx)(V.A,{}),Others:(0,u.jsx)(G.A,{}),Safety:(0,u.jsx)($.A,{}),Environmental:(0,u.jsx)(H.A,{}),Quality:(0,u.jsx)(J.A,{})},Ve=(0,d.useCallback)(async()=>{try{if(Oe(!0),null===P||void 0===P||!P.materialCode||null===P||void 0===P||!P.assignedPlant)return console.warn("Missing required data for template loading:",{materialCode:null===P||void 0===P?void 0:P.materialCode,assignedPlant:null===P||void 0===P?void 0:P.assignedPlant}),void Te(Ye());console.log("Loading questionnaire template for:",{materialCode:P.materialCode,plantCode:P.assignedPlant});const l=await xe.S.getQuestionnaireTemplate({materialCode:P.materialCode,plantCode:P.assignedPlant,templateType:"PLANT_QUESTIONNAIRE"});if(console.log("Received template:",l),!l||!l.steps||!Array.isArray(l.steps))throw console.error("Invalid template structure:",l),new Error("Invalid template structure received from backend");const s=l.steps.map(e=>({...e,title:e.title||e.stepTitle||`Step ${e.stepNumber||"Unknown"}`,description:e.description||"",fields:(e.fields||[]).map(e=>({...e,isCqsAutoPopulated:e.cqsAutoPopulated||e.isCqsAutoPopulated||!1,cqsValue:e.cqsAutoPopulated||e.isCqsAutoPopulated?"Pending IMP":null,disabled:e.cqsAutoPopulated||e.isCqsAutoPopulated||e.disabled||!1,placeholder:e.cqsAutoPopulated||e.isCqsAutoPopulated?"Auto-populated by CQS (Pending Implementation)":e.placeholder}))}));console.log("Processed steps:",s),Te(s);try{const e=await xe.S.getCqsData({materialCode:null===P||void 0===P?void 0:P.materialCode,plantCode:null===P||void 0===P?void 0:P.assignedPlant});Be(e.data||{});const t={};Object.entries(e.data||{}).forEach(e=>{let[l,s]=e;s&&"Pending IMP"!==s&&(t[l]=s)}),Object.keys(t).length>0&&(T(e=>({...e,...t})),c.setFieldsValue(t))}catch(e){console.error("Failed to load CQS data:",e)}try{const e=await xe.S.getOrCreatePlantSpecificData({plantCode:null===P||void 0===P?void 0:P.assignedPlant,materialCode:null===P||void 0===P?void 0:P.materialCode,workflowId:t});We(e||{}),null!==e&&void 0!==e&&e.plantInputs&&(T(t=>({...t,...e.plantInputs})),c.setFieldsValue(e.plantInputs))}catch(e){console.error("Failed to load plant-specific data:",e)}}catch(e){console.error("Failed to load questionnaire template:",e),n.Ay.error(`Failed to load questionnaire template: ${e.message}`),console.log("Using fallback template"),Te(Ye())}finally{Oe(!1)}},[P,t,c]),Ye=()=>[{title:"General",description:"General information about MSDS availability and completeness",fields:[{name:"msds_available",label:"Is 16 Section MSDS of the raw material available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"missing_info",label:"Which information in any one of the 16 sections is not available in full?",type:"textarea",required:!1,placeholder:"Describe missing information"},{name:"sourcing_asked",label:"Has the identified missing / more information required from the supplier asked thru Sourcing?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"cas_available",label:"Is CAS number of the raw material based on the pure substance available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"mixture_ingredients",label:"For mixtures, are ingredients of mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"composition_percentage",label:"Is % age composition substances in the mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage_1",label:"Is the total %age of all substances in the mixture equal to 100?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage",label:"If not what is the % of substances not available?",type:"textarea",required:!1,placeholder:"Provide details about percentage composition"}]},{title:"Physical",description:"Physical properties and handling requirements",fields:[{name:"is_corrosive",label:"Is the material corrosive?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"corrosive_storage",label:"Does the plant have acid and alkali proof storage facilities to store a corrosive raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"highly_toxic",label:"Is the material highly toxic?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"toxic_powder_handling",label:"Does the plant have facilities to handle fine powder of highly toxic raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"crushing_facilities",label:"Does the plant have facilities to crush the stone like solid raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"heating_facilities",label:"Does the plant have facilities to heat/melt the raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"paste_preparation",label:"Does the plant have facilities to prepare paste of raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Flammability and Explosivity",description:"Flammability, explosivity and fire safety measures",fields:[{name:"flash_point_65",label:"Is Flash point of the raw material given and less than or equal to 65 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"petroleum_class",label:"Is the raw material is to be catgorised as ClassC / Class B / Class A substance as per Petroleum Act / Rules?",type:"select",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"class_a",label:"Class A"},{value:"class_b",label:"Class B"},{value:"class_c",label:"Class C"},{value:"na",label:"N/A"}]},{name:"storage_license",label:"Does all the plants have the capacity and license to store the raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"ccoe_license",label:"If no, has the plant applied for CCoE license and by when expected to receive the license?",type:"textarea",required:!1,placeholder:"Provide details about CCoE license application"},{name:"flash_point_21",label:"Is Flash point of the raw material given is less than 21 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"flammable_infrastructure",label:"If yes, does plant have infrastructure to comply State Factories Rule for handling 'Flammable liquids'?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Toxicity",description:"Toxicity assessment and exposure control",fields:[{name:"ld50_oral",label:"Is LD 50 (oral) value available and higher than the threshold limit of 200 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"ld50_dermal",label:"Is LD 50 (Dermal) value available and higher than 1000 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"lc50_inhalation",label:"Is LC50 Inhalation value available and higher than 10 mg/L?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"exposure_minimization",label:"If no, in any of the above three cases (where avaialble) then does the plant have facilities and /or procedure to minmise the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe exposure minimization procedures"},{name:"carcinogenic",label:"Is the RM a suspect Carcinogenic?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"carcinogenic_control",label:"If yes, plant has adequate facilities and /or procedure to minimse the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe carcinogenic exposure control measures"}]},{title:"Storage and Handling",description:"Storage and handling procedures",fields:[{name:"storage_conditions_stores",label:"Are any storage conditions required and available in the plant stores?",type:"textarea",required:!1,placeholder:"Describe storage conditions in plant stores"},{name:"storage_conditions_floor",label:"Are any storage conditions required and available in the shop floor?",type:"textarea",required:!1,placeholder:"Describe storage conditions on shop floor"},{name:"closed_loop_required",label:"Does it require closed loop handling system during charging?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"work_permit_available",label:"Does the plant have required Work permit and /or WI/SOP to handle the raw material adequately?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"procedures_details",label:"If, yes specify the procedures",type:"textarea",required:!1,placeholder:"Specify the procedures and work permits"}]},{title:"PPE",description:"Personal protective equipment requirements",fields:[{name:"recommended_ppe",label:"Recommended specific PPEs based on MSDS",type:"textarea",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)"},{name:"ppe_in_use",label:"Are recommended PPE as per MSDS to handle the RM is already in use at the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"partial",label:"Partially"}]},{name:"ppe_procurement_date",label:"If no, by when the plant can procure the require PPE?",type:"input",required:!1,placeholder:"Enter expected procurement date"}]},{title:"First Aid",description:"First aid measures and emergency response",fields:[{name:"is_poisonous",label:"Is the raw material poisonous as per the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"antidote_specified",label:"Is the name of antidote required to counter the impact of the material given in the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_available",label:"Is the above specified antidote available in the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_source",label:"If the specified antidote is not available then what is source and who will obtain the antidote in the plant?",type:"textarea",required:!1,placeholder:"Describe antidote source and procurement plan"},{name:"first_aid_capability",label:"Does the plant has capability to provide the first aid mentioned in the MSDS with the existing control measures?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]}]},{title:"Statutory",description:"Statutory compliance and regulatory requirements",fields:[{name:"cmvr_listed",label:"Is the RM or any of its ingredient listed in Table 3 of Rule 137 (CMVR)",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"msihc_listed",label:"Is the RM or any of its ingredient listed in part II of Schedule I of MSIHC Rule",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"factories_act_listed",label:"Is the RM or any of its ingredients listed in Schedule II of Factories Act",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"permissible_concentration",label:"With the current infrastructure, is the concentration of RM / ingredients listed in Schedule II of Factories Act within permissible concentrations as per Factories Act in the work area.",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"monitoring_details",label:"Mention details of work area monitoring results and describe infrastructure used for handling",type:"textarea",required:!1,placeholder:"Provide monitoring details and infrastructure description"}]},{title:"Others",description:"Additional inputs and gap analysis",fields:[{name:"plant_inputs_required",label:"Inputs required from plants based on the above assessment?",type:"textarea",required:!1,placeholder:"Describe inputs required from plants"},{name:"gaps_identified",label:"Gaps identified vis-\xe0-vis existing controls / protocols",type:"textarea",required:!1,placeholder:"Identify gaps in existing controls and protocols"},{name:"additional_input_1",label:"Additional Input 1",type:"textarea",required:!1,placeholder:"Additional input field 1"},{name:"additional_input_2",label:"Additional Input 2",type:"textarea",required:!1,placeholder:"Additional input field 2"}]}],Ge=(0,d.useCallback)(()=>{p<Fe.length-1&&m(p+1)},[p,Fe.length]),He=(0,d.useCallback)(()=>{p>0&&m(p-1)},[p]),Je=(0,d.useCallback)(e=>{e>=0&&e<Fe.length&&m(e)},[Fe.length]),Ke=(0,d.useCallback)(()=>{if(!Fe||0===Fe.length||!c)return 0;let e=0,t=0;try{const l=c.getFieldsValue(),s={...q,...l};Fe.forEach((l,a)=>{const n=l.fields||[];e+=n.length;const i=n.filter(e=>{const t=s[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=i.length});return e>0?Math.round(t/e*100):0}catch(l){return console.error("Error calculating overall completion:",l),0}},[Fe,q,c]),Xe=(0,d.useCallback)(()=>{if(!Fe||0===Fe.length||!c)return{total:0,populated:0};let e=0,t=0;try{const l=c.getFieldsValue(),s={...q,...l};return Fe.forEach(l=>{const a=l.fields||[];e+=a.length;const n=a.filter(e=>{const t=s[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=n.length}),{total:e,populated:t}}catch(l){return console.error("Error calculating total fields populated:",l),{total:0,populated:0}}},[Fe,q,c]),Ze=(0,d.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{C(!0);const i=c.getFieldsValue(),r={...q,...i},o={};Object.entries(r).forEach(e=>{let[t,l]=e;null!==l&&void 0!==l&&""!==l&&(o[t]=l)});const d=`plant_questionnaire_draft_${t}`,u={formData:o,currentStep:p,timestamp:Date.now(),completedSteps:Array.from(D),version:"2.0",materialCode:null===P||void 0===P?void 0:P.materialCode,materialName:null===P||void 0===P?void 0:P.materialName,assignedPlant:null===P||void 0===P?void 0:P.assignedPlant,lastSyncAttempt:Date.now(),syncStatus:je?"pending":"synced",totalFields:Object.keys(o).length,completionPercentage:Ke(),sessionId:Date.now()};try{localStorage.setItem(d,JSON.stringify(u))}catch(l){console.warn("Failed to save draft to local storage:",l)}if(je)we(!0),e||n.Ay.info("Draft saved locally. Will sync when online.");else try{const l={plantCode:null===P||void 0===P?void 0:P.assignedPlant,materialCode:null===P||void 0===P?void 0:P.materialCode,responses:r,currentStep:p,completedSteps:Array.from(D),modifiedBy:"current_user"};await xe.S.saveDraftPlantResponses(t,l),e||n.Ay.success("Draft saved successfully")}catch(a){console.error("Failed to save draft to server:",a),we(!0),e||n.Ay.warning("Draft saved locally. Will sync when connection is restored.")}T(r),s&&s(r)}catch(i){console.error("Failed to save draft:",i),e||n.Ay.error("Failed to save draft. Please try again.")}finally{C(!1)}},[c,q,t,s,p,D,je,P,Ke]);(0,d.useEffect)(()=>{const e=()=>{Ae(!1),ie.Ay.success({message:"Connection Restored",description:"You are back online. Syncing your changes...",icon:(0,u.jsx)(K.A,{style:{color:"#52c41a"}}),duration:3}),Ce&&(Ze(!0),we(!1))},t=()=>{Ae(!0),ie.Ay.warning({message:"Connection Lost",description:"You are offline. Changes will be saved locally and synced when connection is restored.",icon:(0,u.jsx)(X.A,{style:{color:"#fa8c16"}}),duration:5})};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[Ce,Ze]),(0,d.useEffect)(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),Ze()),(e.ctrlKey||e.metaKey)&&"ArrowRight"===e.key&&(e.preventDefault(),p<Fe.length-1&&Ge()),(e.ctrlKey||e.metaKey)&&"ArrowLeft"===e.key&&(e.preventDefault(),p>0&&He()),"F1"===e.key&&(e.preventDefault(),o.A.info({title:"Keyboard Shortcuts",content:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + S:"})," Save draft"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2192:"})," Next step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2190:"})," Previous step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Tab:"})," Navigate between fields"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Enter:"})," Submit form or proceed"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Esc:"})," Close modals"]})]})}))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[p,Fe.length,Ge,He,Ze]);const et=(0,d.useCallback)(async()=>{try{f(!0);const e=await xe.S.getWorkflow(t);k(e);const l={};if(e.materialName&&(l.materialName=e.materialName),e.responses&&e.responses.length>0){const t={...l},s=new Set;e.responses.forEach(e=>{t[e.fieldName]=e.fieldValue,s.add(e.stepNumber)}),T(t),z(s),c.setFieldsValue(t)}else T(l),c.setFieldsValue(l)}catch(e){console.error("Failed to load workflow data:",e),n.Ay.error("Failed to load workflow data")}finally{f(!1)}},[t,c]),tt=(0,d.useCallback)(async()=>{try{const e=await fe.B.getQueriesByWorkflow(t);ye(e)}catch(e){console.error("Failed to load queries:",e)}},[t]);(0,d.useEffect)(()=>{t&&(et(),tt())},[t,et,tt]),(0,d.useEffect)(()=>{P&&P.materialCode&&P.assignedPlant&&Ve()},[P,Ve]),(0,d.useEffect)(()=>{if(ve&&Object.keys(q).length>0){const e=setTimeout(()=>{Ze(!0)},L.aZ.INTERVAL);return()=>clearTimeout(e)}},[q,ve,Ze]),(0,d.useEffect)(()=>{if(Fe.length>0){const e=new Set,t=c.getFieldsValue(),l={...q,...t};Fe.forEach((t,s)=>{const a=t.fields||[],n=a.filter(e=>e.required),i=n.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});if(n.length>0)i.length===n.length&&e.add(s);else{const t=a.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});(a.length>0?t.length/a.length*100:0)>=50&&e.add(s)}}),z(e)}},[q,Fe,c]);(0,d.useEffect)(()=>{t&&!P&&(()=>{try{const e=`plant_questionnaire_draft_${t}`,l=localStorage.getItem(e);if(l){const t=JSON.parse(l),s=t.timestamp,a=Date.now();if(a-s<6048e5)if(t.formData&&"object"===typeof t.formData){const e={};Object.entries(t.formData).forEach(t=>{let[l,s]=t;null!==s&&void 0!==s&&""!==s&&(e[l]=s)}),T(t=>({...t,...e})),c.setFieldsValue(e),"number"===typeof t.currentStep&&t.currentStep>=0&&t.currentStep<Fe.length&&m(t.currentStep),Array.isArray(t.completedSteps)&&z(new Set(t.completedSteps)),"pending"===t.syncStatus&&we(!0);const l=Object.keys(e).length,n=Math.round((a-s)/36e5);ie.Ay.success({message:"Draft Recovered",description:`${l} fields restored from ${n} hours ago. Your progress has been preserved.`,duration:6,placement:"topRight"})}else localStorage.removeItem(e),ie.Ay.warning({message:"Draft Recovery Failed",description:"Previous draft data was corrupted and has been cleared.",duration:4});else{localStorage.removeItem(e);const t=Math.round((a-s)/864e5);ie.Ay.info({message:"Old Draft Cleared",description:`Draft from ${t} days ago was automatically removed.`,duration:3})}}}catch(e){console.error("Failed to recover draft data:",e);try{localStorage.removeItem(`plant_questionnaire_draft_${t}`),ie.Ay.error({message:"Draft Recovery Error",description:"Failed to recover previous draft. Starting fresh.",duration:4})}catch(l){console.error("Failed to remove corrupted draft:",l)}}})()},[t,P,c,Fe.length]);const lt=(0,d.useCallback)(e=>{if(!Fe[e]||!Fe[e].fields)return{total:0,required:0,optional:0,completed:0,requiredCompleted:0,optionalCompleted:0,isComplete:!1,hasOpenQueries:!1,hasResolvedQueries:!1,openQueriesCount:0,resolvedQueriesCount:0,completionPercentage:0,requiredCompletionPercentage:0};const t=Fe[e].fields,l=t.filter(e=>e.required),s=t.filter(e=>!e.required),a=c.getFieldsValue(),n={...q,...a},i=l.filter(e=>{const t=n[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),r=s.filter(e=>{const t=n[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),o=Q.filter(t=>t.stepNumber===e),d=o.filter(e=>"OPEN"===e.status),u=o.filter(e=>"RESOLVED"===e.status);return{total:t.length,required:l.length,optional:s.length,completed:i.length+r.length,requiredCompleted:i.length,optionalCompleted:r.length,isComplete:l.length>0?i.length===l.length:t.length>0&&(i.length+r.length)/t.length>=.5,hasOpenQueries:d.length>0,hasResolvedQueries:u.length>0,openQueriesCount:d.length,resolvedQueriesCount:u.length,completionPercentage:t.length>0?Math.round((i.length+r.length)/t.length*100):100,requiredCompletionPercentage:l.length>0?Math.round(i.length/l.length*100):100}},[Fe,q,c,Q]),st=e=>{console.log("handleRaiseQuery called with fieldName:",e);const t=Fe[p].fields.find(t=>t.name===e),l=q[e]||c.getFieldValue(e);console.log("Found field:",t),console.log("Current value:",l),O({...t,stepNumber:p,stepTitle:Fe[p].title,currentValue:l,materialContext:{materialCode:null===P||void 0===P?void 0:P.materialCode,materialName:null===P||void 0===P?void 0:P.materialName,materialType:q.materialType||(null===P||void 0===P?void 0:P.materialType),supplierName:q.supplierName||(null===P||void 0===P?void 0:P.supplierName)}}),console.log("Setting queryModalVisible to true"),M(!0)},at=(0,d.useCallback)(e=>{setTimeout(()=>{const t=document.querySelector(`[data-field-name="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),t.style.transition="background-color 0.3s ease",t.style.backgroundColor="#f6ffed",setTimeout(()=>{t.style.backgroundColor=""},2e3))},100)},[]);(0,d.useEffect)(()=>{if(Q.length>0){const e=Q.filter(e=>e.stepNumber===p&&"RESOLVED"===e.status&&!e.hasBeenViewed);if(e.length>0){const t=e.sort((e,t)=>new Date(t.resolvedAt)-new Date(e.resolvedAt))[0];at(t.fieldName),ie.Ay.success({message:"Query Resolved",description:`Your query about "${t.fieldName}" has been resolved. Check the field for the response.`,duration:5,placement:"topRight"})}}},[Q,p,at]);const nt=async()=>{const e=Fe.flatMap(e=>e.fields.filter(e=>e.required).map(e=>e.name));await c.validateFields(e);const s=c.getFieldsValue(),a=Ke();if(a<80){if(!await new Promise(e=>{o.A.confirm({title:"Incomplete Questionnaire",content:`Your questionnaire is only ${a}% complete. Are you sure you want to submit?`,okText:"Submit",cancelText:"Continue Editing",onOk:()=>e(!0),onCancel:()=>e(!1)})}))return}const i={plantCode:null===P||void 0===P?void 0:P.assignedPlant,materialCode:null===P||void 0===P?void 0:P.materialCode,responses:s,completionPercentage:a,submittedBy:"current_user",totalQueries:Q.length,openQueries:Q.filter(e=>"OPEN"===e.status).length};await xe.S.submitPlantQuestionnaire(t,i);try{localStorage.removeItem(`plant_questionnaire_draft_${t}`)}catch(r){console.warn("Failed to clear draft data:",r)}n.Ay.success("Questionnaire submitted successfully"),l&&l(s)},it=e=>{var t,l,s;const n=Q.filter(t=>t.fieldName===e.name&&t.stepNumber===p),o=n.some(e=>"OPEN"===e.status),d=n.some(e=>"RESOLVED"===e.status),c=n.find(e=>"RESOLVED"===e.status),m=q[e.name]&&""!==q[e.name],h=(0,u.jsxs)("div",{className:"modern-field-label",children:[(0,u.jsxs)(r.A,{align:"center",children:[e.label,e.required&&(0,u.jsx)("span",{style:{color:"#ef4444"},children:"*"}),e.isCqsAutoPopulated&&(0,u.jsx)("span",{className:"cqs-badge",children:"CQS"}),m&&(0,u.jsx)(re.A,{title:"Field completed",children:(0,u.jsx)(I.A,{style:{color:"#10b981",fontSize:"14px"}})})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"4px"},children:[(0,u.jsx)(i.Ay,{type:"text",size:"small",icon:(0,u.jsx)(Z.A,{}),onClick:()=>st(e.name),style:{color:"#667eea",padding:"2px 6px",height:"auto",fontSize:"12px"},children:"Query"}),o&&(0,u.jsx)(v.A,{color:"red",size:"small",children:"Query Open"}),d&&!o&&(0,u.jsx)(v.A,{color:"green",size:"small",children:"Query Resolved"})]})]}),g=(e=>{const t=[];switch(e.required&&t.push({required:!0,message:`${e.label} is required for MSDS completion`}),e.name){case"casNumber":t.push({pattern:/^\d{1,7}-\d{2}-\d$/,message:"Please enter a valid CAS number format (e.g., 64-17-5). If unknown, raise a query to the Technical team."});break;case"boilingPoint":case"meltingPoint":t.push({pattern:/^-?\d+(\.\d+)?$/,message:"Please enter a valid temperature in Celsius (e.g., 100.5 or -10)"});break;case"materialName":t.push({min:2,message:"Material name must be at least 2 characters"}),t.push({max:200,message:"Material name cannot exceed 200 characters"});break;case"supplierName":t.push({min:2,message:"Supplier name must be at least 2 characters"}),t.push({max:100,message:"Supplier name cannot exceed 100 characters"});break;case"missing_info":case"exposure_minimization":case"carcinogenic_control":case"storage_conditions_stores":case"storage_conditions_floor":case"procedures_details":case"antidote_source":case"monitoring_details":case"plant_inputs_required":case"gaps_identified":case"additional_input_1":case"additional_input_2":t.push({min:10,message:`${e.label} must be at least 10 characters for regulatory compliance`}),t.push({max:2e3,message:`${e.label} cannot exceed 2000 characters`})}return t})(e),f=c?(0,u.jsxs)("div",{style:{marginTop:8,padding:"12px 16px",background:"linear-gradient(135deg, #f0fdf4, #dcfce7)",border:"1px solid #bbf7d0",borderRadius:"8px",fontSize:"12px"},children:[(0,u.jsx)("div",{style:{marginBottom:6},children:(0,u.jsx)(Re,{strong:!0,style:{color:"#059669"},children:"Query Response:"})}),(0,u.jsx)("div",{style:{marginBottom:6,color:"#374151"},children:c.response}),(0,u.jsxs)("div",{style:{fontSize:"10px",color:"#6b7280"},children:["Resolved by ",c.resolvedBy," on"," ",new Date(c.resolvedAt).toLocaleDateString()]})]}):(e=>({msds_available:"Material Safety Data Sheet with all 16 sections as per regulatory requirements",cas_available:"Chemical Abstracts Service number - unique identifier for chemical substances",is_corrosive:"Corrosive materials can cause damage to skin, eyes, and respiratory system",highly_toxic:"Materials with high toxicity require special handling and safety measures",flash_point_65:"Flash point indicates fire hazard - materials with flash point \u226465\xb0C are flammable",petroleum_class:"Classification under Petroleum Act determines storage and handling requirements",ld50_oral:"Lethal Dose 50 (oral) - dose that kills 50% of test animals when ingested",ld50_dermal:"Lethal Dose 50 (dermal) - dose that kills 50% of test animals through skin contact",lc50_inhalation:"Lethal Concentration 50 (inhalation) - concentration that kills 50% through inhalation",carcinogenic:"Materials suspected to cause cancer require enhanced safety protocols",recommended_ppe:"Personal Protective Equipment recommendations based on material hazards",is_poisonous:"Poisonous materials require specific antidotes and first aid procedures",cmvr_listed:"Chemical Manufacture and Verification Rules listing affects regulatory compliance",msihc_listed:"Manufacture, Storage and Import of Hazardous Chemical Rules listing",factories_act_listed:"Factories Act Schedule II listing requires workplace monitoring"}[e.name]||e.help))(e),y={name:e.name,label:h,rules:g,help:f,"data-field-name":e.name},b={className:"modern-input",disabled:e.disabled||e.isCqsAutoPopulated,placeholder:e.placeholder||`Enter ${e.label.toLowerCase()}`};switch(e.type){case"input":default:return(0,u.jsx)(ne.A.Item,{...y,children:(0,u.jsx)(x.A,{...b})});case"textarea":return(0,u.jsx)(ne.A.Item,{...y,children:(0,u.jsx)(De,{...b,rows:4,autoSize:{minRows:3,maxRows:6}})});case"select":return(0,u.jsx)(ne.A.Item,{...y,children:(0,u.jsx)(a.A,{...b,placeholder:`Select ${e.label.toLowerCase()}`,showSearch:!0,optionFilterProp:"children",children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,u.jsx)(ze,{value:e.value,children:e.label},e.value))})});case"radio":return(0,u.jsx)(ne.A.Item,{...y,children:(0,u.jsx)(oe.Ay.Group,{className:"modern-radio-group",disabled:e.disabled||e.isCqsAutoPopulated,children:(0,u.jsx)(r.A,{direction:"vertical",size:"small",children:null===(l=e.options)||void 0===l?void 0:l.map(e=>(0,u.jsx)(oe.Ay,{value:e.value,children:e.label},e.value))})})});case"checkbox":return(0,u.jsx)(ne.A.Item,{...y,valuePropName:"checked",children:(0,u.jsx)(de.A.Group,{className:"modern-checkbox-group",disabled:e.disabled||e.isCqsAutoPopulated,children:(0,u.jsx)(r.A,{direction:"vertical",size:"small",children:null===(s=e.options)||void 0===s?void 0:s.map(e=>(0,u.jsx)(de.A,{value:e.value,children:e.label},e.value))})})})}};if(g)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(B.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Questionnaire"}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your workflow data..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ce.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"30%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!P)return(0,u.jsx)(F.A,{message:"Workflow Not Found",description:"The requested workflow could not be loaded.",type:"error",showIcon:!0});if(Le)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(U.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Template"}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your plant-specific questionnaire template..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ce.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"60%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!Fe||0===Fe.length)return(0,u.jsx)(F.A,{message:"Template Not Available",description:"The questionnaire template could not be loaded. Please try refreshing the page.",type:"error",showIcon:!0,action:(0,u.jsx)(i.Ay,{size:"small",onClick:()=>window.location.reload(),children:"Refresh"})});const rt=Fe[p]||{title:"Loading...",description:"",fields:[]};return(0,u.jsxs)("div",{className:"plant-questionnaire-container",children:[(0,u.jsx)("div",{className:"plant-questionnaire-header",children:(0,u.jsxs)("div",{className:"plant-questionnaire-header-content",children:[(0,u.jsxs)("div",{className:"plant-questionnaire-title",children:[(0,u.jsx)(ue.A,{size:40,style:{background:"linear-gradient(135deg, #667eea, #764ba2)"},children:(0,u.jsx)(ee.A,{})}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Plant Questionnaire"}),(0,u.jsxs)(Re,{type:"secondary",style:{fontSize:"14px"},children:[null===P||void 0===P?void 0:P.materialCode," \u2022 ",null===P||void 0===P?void 0:P.assignedPlant]})]})]}),(0,u.jsxs)("div",{className:"plant-questionnaire-stats",children:[(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ke()},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("defs",{children:(0,u.jsxs)("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#4f46e5"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#7c3aed"})]})}),(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"30",cy:"30",r:"26"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"30",cy:"30",r:"26"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"600",color:"#1e293b"},children:[Ke(),"%"]})]}),(0,u.jsx)("div",{style:{textAlign:"center",marginTop:8},children:(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b"},children:"Overall Progress"})})]}),(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,u.jsx)(pe.A,{count:Q.filter(e=>"OPEN"===e.status).length,style:{backgroundColor:Q.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"},children:(0,u.jsx)(ue.A,{icon:(0,u.jsx)(Z.A,{}),style:{backgroundColor:Q.filter(e=>"OPEN"===e.status).length>0?"#fef2f2":"#f0fdf4",color:Q.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"}})})}),(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b",display:"block",textAlign:"center"},children:"Open Queries"})]}),(0,u.jsx)("div",{className:"modern-stats-card",children:(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsxs)("div",{className:"modern-completion-badge "+(Ke()>=80?"high":Ke()>=50?"medium":"low"),children:["Step ",p+1,"/",Fe.length]}),(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b",display:"block",marginTop:4},children:"Current Step"})]})}),(0,u.jsxs)(r.A,{children:[(0,u.jsx)(i.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(h.A,{}),onClick:()=>Ze(),loading:A,children:"Save Draft"}),qe&&(0,u.jsx)(i.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(te.A,{}),onClick:()=>Pe(!0),children:"Steps"})]})]})]})}),(0,u.jsxs)("div",{className:"plant-questionnaire-main",children:[!qe&&(0,u.jsxs)("div",{className:"plant-questionnaire-sidebar",children:[(0,u.jsxs)(y.A,{className:"modern-steps-card",children:[(0,u.jsxs)("div",{className:"modern-steps-header",children:[(0,u.jsx)(Me,{level:4,style:{margin:0,color:"#1e293b"},children:"Questionnaire Steps"}),(0,u.jsxs)(Re,{type:"secondary",style:{fontSize:"12px"},children:[D.size," of ",Fe.length," steps completed"]}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"11px",display:"block",marginTop:2},children:(()=>{const e=Xe();return`${e.populated} of ${e.total} fields populated`})()})]}),(0,u.jsx)("div",{className:"modern-steps-list",children:Fe.map((e,t)=>{const l=lt(t),s=Q.some(e=>e.stepNumber===t&&"OPEN"===e.status),a=t===p,n=l.isComplete;return(0,u.jsxs)("div",{className:`modern-step-item ${a?"active":""} ${n?"completed":""}`,onClick:()=>Je(t),children:[(0,u.jsx)("div",{className:"step-completion-ring "+(n?"completed":""),style:{"--completion-angle":l.requiredCompleted/Math.max(l.required,1)*360+"deg",background:a?"#4f46e5":n?"#10b981":"#f1f5f9",color:a||n?"white":"#64748b"},children:n?(0,u.jsx)(I.A,{}):s?(0,u.jsx)(N.A,{}):$e[e.title]||(0,u.jsx)(B.A,{})}),(0,u.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,u.jsx)("div",{style:{fontWeight:a?600:400,color:"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:2},children:[l.completed,"/",l.total," fields (",l.requiredCompleted,"/",l.required," required)",s&&(0,u.jsxs)(v.A,{color:"red",size:"small",style:{marginLeft:4},children:[Q.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})]},t)})})]}),(0,u.jsx)("div",{style:{marginTop:16},children:(0,u.jsx)(ke,{workflowData:P})})]}),(0,u.jsx)("div",{className:"plant-questionnaire-content",children:(0,u.jsxs)(y.A,{className:"modern-form-card",children:[(0,u.jsxs)("div",{className:"modern-form-header",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Me,{level:2,style:{margin:0,color:"white"},children:rt.title}),(0,u.jsx)(_e,{style:{margin:"8px 0 0 0",color:"rgba(255, 255, 255, 0.8)"},children:rt.description})]}),(0,u.jsxs)("div",{className:"modern-progress-container",children:[(0,u.jsx)(E.A,{className:"modern-progress",percent:(()=>{const e=lt(p);return e.required>0?Math.round(e.requiredCompleted/e.required*100):100})(),showInfo:!1,strokeColor:"rgba(255, 255, 255, 0.9)",trailColor:"rgba(255, 255, 255, 0.2)"}),(0,u.jsxs)(Re,{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"12px"},children:["Step Progress:"," ",(()=>{const e=lt(p);return`${e.requiredCompleted}/${e.required} required fields`})()]})]})]}),je&&(0,u.jsx)(F.A,{className:"modern-alert modern-alert-warning",message:"Offline Mode",description:"You are currently offline. Changes will be saved locally and synced when connection is restored.",type:"warning",showIcon:!0,style:{margin:"16px 32px"},closable:!0}),(0,u.jsx)("div",{className:"modern-form-content "+(p%2===0?"slide-in-from-right":"slide-in-from-left"),children:(0,u.jsx)(ne.A,{form:c,layout:"vertical",onValuesChange:(e,t)=>{T(e=>({...e,...t})),we(!0),Ie(e=>e+1),setTimeout(()=>{if(Fe.length>0){const e=new Set;Fe.forEach((l,s)=>{const a=l.fields||[],n=a.filter(e=>e.required),i=n.filter(e=>{const l=t[e.name];return Array.isArray(l)?l.length>0:l&&""!==l&&null!==l&&void 0!==l});if(n.length>0)i.length===n.length&&e.add(s);else{const l=a.filter(e=>{const l=t[e.name];return Array.isArray(l)?l.length>0:l&&""!==l&&null!==l&&void 0!==l});(a.length>0?l.length/a.length*100:0)>=50&&e.add(s)}}),z(e)}},100)},children:(0,u.jsx)(b.A,{gutter:[24,24],children:(rt.fields||[]).map((e,t)=>(0,u.jsx)(j.A,{xs:24,sm:"textarea"===e.type?24:12,md:"textarea"===e.type?24:12,children:(0,u.jsx)("div",{className:`modern-field-group ${e.required?"required":""} ${e.isCqsAutoPopulated?"cqs-populated":""} fade-in-up`,style:{animationDelay:.1*t+"s"},children:(0,u.jsxs)("div",{className:"modern-field-header",children:[(0,u.jsx)("div",{style:{flex:1},children:it(e)}),(0,u.jsxs)("div",{className:"modern-field-actions",children:[(0,u.jsx)(re.A,{title:"Raise Query",children:(0,u.jsx)("button",{className:"modern-query-button",onClick:()=>st(e.name),children:(0,u.jsx)(Z.A,{})})}),e.isCqsAutoPopulated&&(0,u.jsx)(re.A,{title:"CQS Auto-populated",children:(0,u.jsx)("div",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"500"},children:"CQS"})})]})]})})},e.name))})})}),(0,u.jsxs)("div",{className:"modern-navigation",children:[(0,u.jsx)(i.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(le.A,{}),onClick:He,disabled:0===p,style:{opacity:0===p?.5:1,cursor:0===p?"not-allowed":"pointer"},children:"Previous"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Step Progress"}),(0,u.jsxs)(Re,{style:{fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:[p+1," of ",Fe.length]})]}),Ce&&(0,u.jsx)("div",{style:{padding:"4px 8px",background:"#fef3c7",border:"1px solid #fde68a",borderRadius:"6px",fontSize:"11px",color:"#92400e"},children:"Unsaved changes"}),p===Fe.length-1?(0,u.jsx)(i.Ay,{className:"modern-btn modern-btn-primary "+(100===Ke()?"pulse-glow":""),onClick:async()=>{try{S(!0);const e=Q.filter(e=>"OPEN"===e.status);if(e.length>0)return void o.A.confirm({title:"Open Queries Detected",content:`You have ${e.length} open queries. Are you sure you want to submit the questionnaire? It's recommended to resolve all queries before submission.`,okText:"Submit Anyway",cancelText:"Cancel",onOk:()=>nt()});await nt()}catch(e){console.error("Failed to submit questionnaire:",e),400===e.status?n.Ay.error("Please complete all required fields before submitting"):401===e.status?n.Ay.error("Session expired. Please log in again."):n.Ay.error("Failed to submit questionnaire. Please try again.")}finally{S(!1)}},loading:w,size:"large",style:{minWidth:"160px"},children:w?"Submitting...":"Submit Questionnaire"}):(0,u.jsx)(i.Ay,{className:"modern-btn modern-btn-primary",icon:(0,u.jsx)(se.A,{}),onClick:Ge,style:{minWidth:"120px"},children:"Next Step"})]})]})]})})]}),(0,u.jsx)(me.A,{className:"modern-drawer",title:"Questionnaire Steps",placement:"left",onClose:()=>Pe(!1),open:Se,width:320,children:(0,u.jsx)("div",{className:"modern-timeline",children:(0,u.jsx)(he.A,{children:Fe.map((e,t)=>{const l=lt(t),s=Q.some(e=>e.stepNumber===t&&"OPEN"===e.status),a=t===p,n=l.isComplete;return(0,u.jsx)(he.A.Item,{color:n?"#10b981":a?"#667eea":"#cbd5e1",dot:n?(0,u.jsx)(I.A,{style:{color:"#10b981"}}):s?(0,u.jsx)(N.A,{style:{color:"#ef4444"}}):$e[e.title]||(0,u.jsx)(B.A,{}),children:(0,u.jsxs)("div",{onClick:()=>{Je(t),Pe(!1)},style:{cursor:"pointer",padding:"8px 0"},children:[(0,u.jsx)(Re,{strong:a,style:{color:a?"#667eea":"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:4},children:[l.completed,"/",l.total," fields completed (",l.requiredCompleted,"/",l.required," required)",s&&(0,u.jsxs)(v.A,{color:"red",size:"small",style:{marginLeft:4},children:[Q.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})},t)})})})}),!qe&&(0,u.jsxs)("div",{className:"modern-floating-indicator",children:[(0,u.jsx)("div",{style:{textAlign:"center",marginBottom:12},children:(0,u.jsx)(Re,{strong:!0,style:{color:"#1e293b",fontSize:"14px"},children:"Questionnaire Progress"})}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ke(),width:"40px",height:"40px"},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"20",cy:"20",r:"16"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"20",cy:"20",r:"16"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"600",color:"#1e293b"},children:[Ke(),"%"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#1e293b",fontWeight:"500"},children:[D.size," of ",Fe.length," steps"]}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#64748b"},children:(()=>{const e=Xe();return`${e.populated}/${e.total} fields`})()}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#64748b"},children:[Q.filter(e=>"OPEN"===e.status).length," open queries"]})]})]}),(0,u.jsx)("div",{style:{height:"2px",background:"#e2e8f0",borderRadius:"1px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:`${Ke()}%`,background:"linear-gradient(135deg, #4f46e5, #7c3aed)",transition:"width 0.5s ease"}})})]}),(0,u.jsx)("div",{className:"modern-floating-actions",children:(0,u.jsxs)(ge.A.Group,{trigger:"hover",type:"primary",style:{right:24},icon:(0,u.jsx)(G.A,{}),children:[(0,u.jsx)(ge.A,{icon:(0,u.jsx)(h.A,{}),tooltip:"Save Draft",onClick:()=>Ze()}),(0,u.jsx)(ge.A,{icon:(0,u.jsx)(ee.A,{}),tooltip:"Summary",onClick:()=>{const e=Fe.map((e,t)=>{const l=lt(t),s=Q.filter(e=>e.stepNumber===t);return{step:t+1,title:e.title,completed:l.requiredCompleted,required:l.required,percentage:l.required>0?Math.round(l.requiredCompleted/l.required*100):100,openQueries:s.filter(e=>"OPEN"===e.status).length,resolvedQueries:s.filter(e=>"RESOLVED"===e.status).length}});o.A.info({title:"Questionnaire Summary",width:600,content:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{marginBottom:16},children:(0,u.jsxs)(Re,{strong:!0,children:["Overall Progress: ",Ke(),"%"]})}),e.map(e=>(0,u.jsxs)("div",{style:{marginBottom:12,padding:"12px 16px",background:100===e.percentage?"linear-gradient(135deg, #f0fdf4, #dcfce7)":"linear-gradient(135deg, #fffbeb, #fef3c7)",border:"1px solid "+(100===e.percentage?"#bbf7d0":"#fde68a"),borderRadius:"8px"},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)(Re,{strong:!0,children:["Step ",e.step,": ",e.title]}),(0,u.jsxs)(v.A,{color:100===e.percentage?"green":"orange",children:[e.percentage,"%"]})]}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:[e.completed,"/",e.required," required fields completed",e.openQueries>0&&(0,u.jsxs)("span",{style:{color:"#ef4444",marginLeft:8},children:["\u2022 ",e.openQueries," open queries"]}),e.resolvedQueries>0&&(0,u.jsxs)("span",{style:{color:"#10b981",marginLeft:8},children:["\u2022 ",e.resolvedQueries," resolved queries"]})]})]},e.step))]})})}}),(0,u.jsx)(ge.A,{icon:ve?(0,u.jsx)(ae.A,{}):(0,u.jsx)(X.A,{}),tooltip:ve?"Auto-save ON":"Auto-save OFF",onClick:()=>be(!ve)})]})}),(0,u.jsx)(Ee,{open:R,onCancel:()=>{M(!1),O(null)},onSubmit:e=>{M(!1),O(null),tt(),n.Ay.success("Query raised successfully")},workflowId:t,fieldContext:_})]})};var Oe=l(5423),Qe=l(3719);var Be=l(5123),Ue=l(5475);var We=l(9799),$e=l(8348);const{Title:Ve}=s.A,{Option:Ye}=a.A,Ge=()=>{const[e,t]=(0,d.useState)(null),[l,s]=(0,d.useState)(!1),[c,m]=(0,d.useState)(null),[h,g]=(0,d.useState)(null),[f,x]=(0,d.useState)([]),{isPlantUser:y,isAdmin:v,userPlants:b,primaryPlant:j,filterByPlantAccess:A}=(0,Be.hm)(),{workflows:C,loading:w,error:S,dashboardStats:k,refreshWorkflows:N}=((e,t)=>{const[l,s]=(0,d.useState)([]),[a,i]=(0,d.useState)(!0),[r,o]=(0,d.useState)(null),[c,u]=(0,d.useState)({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),p=(0,d.useCallback)(()=>{const e=localStorage.getItem("userPlant"),t=localStorage.getItem("username");return console.log("Plant detection:",{storedPlant:e,storedUser:t,localStorage:Object.keys(localStorage)}),e||"1102"},[]),m=(0,d.useCallback)(async t=>{try{i(!0),o(null);const n=e||p();if(!n)return console.warn("No plant code available for loading workflows"),s([]),void u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0});let r;console.log("Loading workflows for plant:",n);let d=[];try{r=await xe.S.getPlantDashboardData(n,{signal:t}),console.log("Received dashboard data:",r),d=r.workflows.filter(e=>e.plantCode===n).map(e=>({id:e.workflowId,materialCode:e.materialCode,plantCode:e.plantCode,currentState:e.isSubmitted?L.Fv.COMPLETED:L.sB.PLANT_PENDING,completionStatus:e.completionStatus,completionPercentage:e.completionPercentage||0,totalFields:e.totalFields||0,completedFields:e.completedFields||0,requiredFields:e.requiredFields||0,completedRequiredFields:e.completedRequiredFields||0,lastModified:e.lastModified,submittedAt:e.submittedAt,submittedBy:e.submittedBy,isSubmitted:e.isSubmitted,isCompleted:e.isCompleted,openQueries:0,assignedPlant:e.plantCode,materialName:e.materialName,itemDescription:e.itemDescription}))}catch(l){console.warn("Failed to load plant-specific data, falling back to regular workflows:",l);try{const e=await xe.S.getWorkflowsByPlant(n,{signal:t});console.log("Fallback: Loaded plant workflows:",e),d=e.filter(e=>(e.plantCode||e.assignedPlant)===n).map(e=>({id:e.id,materialCode:e.materialCode,plantCode:e.plantCode||e.assignedPlant,currentState:e.currentState||e.state,completionStatus:"DRAFT",completionPercentage:0,totalFields:87,completedFields:0,requiredFields:50,completedRequiredFields:0,lastModified:e.lastModified,submittedAt:null,submittedBy:null,isSubmitted:!1,isCompleted:!1,openQueries:e.openQueries||0,assignedPlant:e.plantCode||e.assignedPlant,materialName:e.materialName,itemDescription:e.itemDescription})),console.log("Fallback: Processed workflows:",d)}catch(a){console.error("Fallback also failed:",a),d=[]}r={totalWorkflows:d.length,completedCount:0,inProgressCount:0,draftCount:d.length,averageCompletion:0}}s(d),u({totalWorkflows:r.totalWorkflows||0,completedCount:r.completedCount||0,inProgressCount:r.inProgressCount||0,draftCount:r.draftCount||0,averageCompletion:r.averageCompletion||0,completedToday:0})}catch(r){console.error("Failed to load plant workflows:",r),o(r.message),n.Ay.error("Failed to load workflows"),s([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0})}finally{i(!1)}},[e,p]),h=(0,d.useCallback)(async()=>{const e=new AbortController;await m(e.signal)},[m]);return(0,d.useEffect)(()=>{const l=new AbortController;return(async()=>{if(t&&e)try{await m(l.signal)}catch(r){l.signal.aborted||console.error("Error loading plant workflows:",r)}else s([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),i(!1)})(),()=>{l.abort()}},[t,e,m]),{workflows:l,loading:a,error:r,dashboardStats:c,loadPlantWorkflows:m,refreshWorkflows:h}})(c,h),{filteredWorkflows:I,searchText:q,statusFilter:F,completionFilter:T,updateSearchText:E,updateStatusFilter:D,updateCompletionFilter:R,clearAllFilters:M,applyPreset:_,saveFilters:O,filterPresets:B,filterSummary:U}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const[t,l]=(0,Ue.ok)(),[s,a]=(0,d.useState)(t.get("search")||""),[n,i]=(0,d.useState)(t.get("status")||"all"),[r,o]=(0,d.useState)(t.get("completion")||"all"),c=(0,d.useMemo)(()=>{let t=[...e];if(s){const e=s.toLowerCase();t=t.filter(t=>{var l,s,a,n;return(null===(l=t.materialCode)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(s=t.plantCode)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(a=t.materialName)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(n=t.itemDescription)||void 0===n?void 0:n.toLowerCase().includes(e))})}return"all"!==n&&(t=t.filter(e=>e.completionStatus===n)),"all"!==r&&(r===L.lX.COMPLETED?t=t.filter(e=>100===e.completionPercentage):r===L.lX.IN_PROGRESS?t=t.filter(e=>e.completionPercentage>0&&e.completionPercentage<100):r===L.lX.NOT_STARTED&&(t=t.filter(e=>0===e.completionPercentage))),t},[e,s,n,r]),u=(0,d.useCallback)(e=>{a(e)},[]),p=(0,d.useCallback)(e=>{i(e)},[]),m=(0,d.useCallback)(e=>{o(e)},[]),h=(0,d.useCallback)(()=>{a(""),i("all"),o("all")},[]),g=(0,d.useCallback)(e=>{void 0!==e.searchText&&a(e.searchText),void 0!==e.statusFilter&&i(e.statusFilter),void 0!==e.completionFilter&&o(e.completionFilter)},[]),f=(0,d.useMemo)(()=>[{name:"All Workflows",filters:{searchText:"",statusFilter:"all",completionFilter:"all"}},{name:"In Progress",filters:{searchText:"",statusFilter:"IN_PROGRESS",completionFilter:"in-progress"}},{name:"Completed",filters:{searchText:"",statusFilter:"COMPLETED",completionFilter:"completed"}},{name:"Not Started",filters:{searchText:"",statusFilter:"DRAFT",completionFilter:"not-started"}},{name:"Overdue",filters:{searchText:"",statusFilter:"all",completionFilter:"all"}}],[]),x=(0,d.useCallback)(e=>{const t=f.find(t=>t.name===e);t&&g(t.filters)},[f,g]),y=(0,d.useMemo)(()=>{const t=[];return s&&t.push(`Search: "${s}"`),"all"!==n&&t.push(`Status: ${n.replace("_"," ")}`),"all"!==r&&t.push(`Completion: ${r.replace("-"," ")}`),{activeFilters:t,hasActiveFilters:t.length>0,totalFiltered:c.length,totalOriginal:e.length}},[s,n,r,c.length,e.length]),v=(0,d.useCallback)(()=>{const e={searchText:s,statusFilter:n,completionFilter:r};localStorage.setItem("workflowFilters",JSON.stringify(e))},[s,n,r]),b=(0,d.useCallback)(()=>{try{const e=localStorage.getItem("workflowFilters");if(e){const t=JSON.parse(e);g(t)}}catch(S){console.warn("Failed to load saved filters:",S)}},[g]);return(0,d.useEffect)(()=>{const e=new URLSearchParams;s&&e.set("search",s),"all"!==n&&e.set("status",n),"all"!==r&&e.set("completion",r),l(e,{replace:!0})},[s,n,r,l]),{searchText:s,statusFilter:n,completionFilter:r,filteredWorkflows:c,updateSearchText:u,updateStatusFilter:p,updateCompletionFilter:m,clearAllFilters:h,applyFilters:g,filterPresets:f,applyPreset:x,saveFilters:v,loadSavedFilters:b,filterSummary:y}}(C);(0,d.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await W(e.signal)}catch(S){e.signal.aborted||console.error("Error loading user plant data:",S)}})(),()=>{e.abort()}},[]);const W=async e=>{try{if(!(0,Qe.wR)())return console.warn("User is not authenticated"),void n.Ay.error("You are not logged in. Please log in to access the plant dashboard.");const t=(0,Qe.HW)();if(!t)return console.warn("No current user found"),void n.Ay.error("Unable to identify current user. Please log in again.");console.log("Loading plant data for user:",t);const[l,s]=await Promise.all([$e.E.getUserPlantAssignments(t,{signal:e}),We.B.getAllLocations({signal:e})]);console.log("User plant data received:",l),console.log("Assigned plants:",null===l||void 0===l?void 0:l.assignedPlants),console.log("Primary plant:",null===l||void 0===l?void 0:l.primaryPlant),g(l);const a=l.primaryPlant||l.assignedPlants&&l.assignedPlants[0];if(a&&l.assignedPlants&&l.assignedPlants.includes(a))m(a),localStorage.setItem("userPlant",a),console.log("Set current plant to primary/effective plant:",a);else if(l.assignedPlants&&l.assignedPlants.length>0){const e=l.assignedPlants[0];m(e),localStorage.setItem("userPlant",e),console.log("Set current plant to first assigned plant:",e)}if(l.assignedPlants&&l.assignedPlants.length>0){const e=l.assignedPlants.map(e=>{const t=s.find(t=>t.locationCode===e),a=e===l.primaryPlant;return{value:e,label:t?`${e} - ${t.description}${a?" (Primary)":""}`:`${e}${a?" (Primary)":""}`}});x(e),console.log("Available plants set:",e)}}catch(S){console.error("Failed to load user plant data:",S),g({assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}),x([]),m(null),n.Ay.error("Unable to load plant assignments. Please contact administrator to assign plants to your user.")}},$=(0,d.useCallback)(e=>{!h||h.assignedPlants.includes(e)?(localStorage.setItem("userPlant",e),m(e),n.Ay.success(`Switched to plant: ${e}`)):n.Ay.error(`You are not assigned to plant: ${e}`)},[h]),V=(0,d.useCallback)(e=>{t(e),s(!0)},[]),Y=(0,d.useCallback)(e=>{s(!1),t(null),N(),n.Ay.success("Questionnaire completed successfully!")},[N]),G=(0,d.useCallback)(e=>{n.Ay.success("Draft saved successfully")},[]);return(0,Qe.wR)()?null===h?(0,u.jsx)(Oe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ve,{level:3,children:"Loading Plant Assignments..."}),(0,u.jsx)("p",{children:"Please wait while we load your plant assignments."})]})}):!h||h.assignedPlants&&0!==h.assignedPlants.length?(0,u.jsx)(Oe.yE,{children:(0,u.jsx)(p,{plantCode:c,children:(0,u.jsxs)("div",{style:{padding:24},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[(0,u.jsx)(Ve,{level:2,style:{margin:0},children:"Plant Dashboard"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)("span",{style:{fontSize:"14px",fontWeight:"500"},children:"Plant:"}),(0,u.jsx)(a.A,{value:c,onChange:$,style:{width:250},size:"small",disabled:!h||f.length<=1,showSearch:!0,filterOption:(e,t)=>{var l;return null===t||void 0===t||null===(l=t.children)||void 0===l?void 0:l.toLowerCase().includes(e.toLowerCase())},placeholder:"Select assigned plant",children:f.map(e=>(0,u.jsx)(Ye,{value:e.value,children:e.label},e.value))})]}),(0,u.jsx)(r.A,{children:(0,u.jsx)(i.Ay,{onClick:N,loading:w,children:"Refresh Data"})})]})]}),c?(0,u.jsx)(z,{dashboardStats:k,loading:w,error:S,currentPlant:c,onRefresh:N}):(0,u.jsxs)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:[(0,u.jsx)(Ve,{level:4,children:"Select a Plant"}),(0,u.jsx)("p",{children:"Please select a plant from the dropdown above to view the dashboard and assigned materials."})]}),c&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(P,{searchText:q,statusFilter:F,completionFilter:T,onSearchTextChange:E,onStatusFilterChange:D,onCompletionFilterChange:R,onClearFilters:M,onApplyPreset:_,onSaveFilters:O,filterPresets:B,filterSummary:U}),(0,u.jsx)(Q,{workflows:I,loading:w,onStartQuestionnaire:V,onRefresh:N})]}),(0,u.jsx)(o.A,{title:`Material Questionnaire - ${null===e||void 0===e?void 0:e.materialCode}`,open:l,onCancel:()=>{s(!1),t(null)},footer:null,width:"95%",style:{top:20},destroyOnClose:!0,children:e&&(0,u.jsx)(Le,{workflowId:e.id,onComplete:Y,onSaveDraft:G})})]})})}):(0,u.jsx)(Oe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ve,{level:3,children:"No Plant Assignments"}),(0,u.jsx)("p",{children:"You are not assigned to any plants. Please contact your administrator to assign plants to your user account."}),(0,u.jsxs)("div",{style:{marginTop:16,padding:16,background:"#f5f5f5",borderRadius:4},children:[(0,u.jsx)("p",{children:(0,u.jsx)("strong",{children:"Debug Info:"})}),(0,u.jsxs)("p",{children:["Current User: ",(0,Qe.HW)()]}),(0,u.jsxs)("p",{children:["Is Authenticated: ",(0,Qe.wR)().toString()]}),(0,u.jsxs)("p",{children:["User Plant Data: ",JSON.stringify(h,null,2)]}),(0,u.jsxs)(r.A,{children:[(0,u.jsx)(i.Ay,{onClick:()=>{console.log("Current user:",(0,Qe.HW)()),console.log("User plant data:",h),console.log("Available plants:",f),W()},children:"Debug & Retry"}),(0,u.jsx)(i.Ay,{type:"primary",onClick:async()=>{try{const e=(0,Qe.HW)();if(!e)return void n.Ay.error("No current user found");const t="1102",l=[t];await $e.E.updateUserPlantAssignments(e,{assignedPlants:l,primaryPlant:t}),n.Ay.success("Plant assignments fixed! Please refresh the page or log out and log back in."),await W()}catch(S){console.error("Failed to assign plants:",S),403===S.status?n.Ay.error("You need admin permissions to assign plants. Please ask an administrator to assign plants to your user account."):n.Ay.error(`Failed to assign plants: ${S.message}`)}},children:"Fix Plant Assignments (Admin Required)"}),(0,u.jsx)(i.Ay,{onClick:()=>{n.Ay.info("Logging out to refresh token..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/qrmfg/login"},children:"Logout & Re-login"})]})]})]})}):(0,u.jsx)(Oe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ve,{level:3,children:"Authentication Required"}),(0,u.jsx)("p",{children:"You need to be logged in to access the plant dashboard."}),(0,u.jsx)(i.Ay,{type:"primary",onClick:()=>window.location.href="/qrmfg/login",children:"Go to Login"})]})})}},5123:(e,t,l)=>{l.d(t,{hm:()=>i});var s=l(5043),a=l(3719),n=l(4642);const i=()=>{const[e,t]=(0,s.useState)(null),[l,i]=(0,s.useState)(!0),[r,o]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{if(!(0,a.wR)())return t(null),void i(!1);try{i(!0),o(null);const e=await n.A.getUserAccessSummary();t(e)}catch(e){console.warn("Failed to load access summary, using fallback:",e),o(e);const l=n.A.getFallbackAccessSummary();t(l)}finally{i(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);const c=(0,s.useCallback)(async e=>{try{return await n.A.hasScreenAccess(e)}catch(r){return console.warn("Screen access check failed, using fallback:",r),n.A.getFallbackScreenAccess(e)}},[]),u=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await n.A.hasDataAccess(e,t)}catch(r){return console.warn("Data access check failed, using fallback:",r),n.A.getFallbackDataAccess(e,t)}},[]),p=(0,s.useCallback)(async function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await n.A.hasPlantDataAccess(e,t,l)}catch(r){return console.warn("Plant data access check failed, using fallback:",r),n.A.getFallbackPlantDataAccess(e,t,l)}},[]),m=(0,s.useCallback)(async function(e,t,l){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{return await n.A.makeAccessDecision(e,t,l,s)}catch(r){return console.warn("Access decision failed, using fallback:",r),n.A.getFallbackAccessDecision(e,t,l,s)}},[]),h=(0,s.useCallback)((e,t)=>n.A.filterDataByPlantAccess(e,t),[]);return{loading:l,error:r,isAuthenticated:(0,a.wR)(),currentUser:(0,a.HW)(),primaryRole:(0,a.Jv)(),userPlants:(0,a.nT)(),primaryPlant:(0,a.bN)(),isAdmin:(0,a.qc)(),isJvcUser:(0,a.bV)(),isCqsUser:(0,a.po)(),isTechUser:(0,a.C9)(),isPlantUser:(0,a.X9)(),isViewer:(0,a.Z$)(),accessSummary:e,hasRole:e=>(0,a.hf)(e),hasAnyRole:e=>e.some(e=>(0,a.hf)(e)),hasAllRoles:e=>e.every(e=>(0,a.hf)(e)),checkScreenAccess:c,checkDataAccess:u,checkPlantDataAccess:p,makeAccessDecision:m,filterByPlantAccess:h,refresh:d}}},6274:(e,t,l)=>{l.d(t,{Ay:()=>h,eS:()=>c,lE:()=>m,wS:()=>u});var s=l(9098),a=l(5444),n=l(6569),i=l(5043),r=l(599),o=l(579);const{TextArea:d}=a.A,c=i.memo(e=>{let{value:t,onChange:l,validationType:s="text",componentName:d="SecureInput",fieldName:c="input",onValidationChange:u,...p}=e;const{validateInput:m}=(0,r.j8)(),[h,g]=(0,i.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,i.useCallback)(e=>{const t=e.target.value,a=m(t,s);g(a),a.wasModified&&(r.qp.logXSSAttempt(t,a.sanitizedValue,d,c),n.Ay.warning("Input was sanitized for security reasons")),l&&l({...e,target:{...e.target,value:a.sanitizedValue}}),u&&u(a)},[l,s,d,c,u,m]);return(0,o.jsx)(a.A,{...p,value:t,onChange:f,status:h.isValid?"":"error",title:h.errors.join(", ")})}),u=i.memo(e=>{let{value:t,onChange:l,validationType:s="richtext",componentName:a="SecureTextArea",fieldName:c="textarea",onValidationChange:u,...p}=e;const{validateInput:m}=(0,r.j8)(),[h,g]=(0,i.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,i.useCallback)(e=>{const t=e.target.value,i=m(t,s);g(i),i.wasModified&&(r.qp.logXSSAttempt(t,i.sanitizedValue,a,c),n.Ay.warning("Input was sanitized for security reasons")),l&&l({...e,target:{...e.target,value:i.sanitizedValue}}),u&&u(i)},[l,s,a,c,u,m]);return(0,o.jsx)(d,{...p,value:t,onChange:f,status:h.isValid?"":"error",title:h.errors.join(", ")})}),p=i.memo(e=>{let{children:t,onFinish:l,componentName:a="SecureForm",enableSecurityLogging:d=!0,...c}=e;const[u,p]=(0,i.useState)([]),m=(0,i.useCallback)(async e=>{try{const t={},s=[];Object.keys(e).forEach(l=>{const a=e[l];if("string"===typeof a){const e=r.SR.sanitizeText(a);t[l]=e,e!==a&&s.push({field:l,originalValue:a.substring(0,50),sanitizedValue:e.substring(0,50)})}else t[l]=a}),s.length>0&&d&&(s.forEach(e=>{r.qp.logXSSAttempt(e.originalValue,e.sanitizedValue,a,e.field)}),n.Ay.warning(`${s.length} field(s) were sanitized for security`)),l&&await l(t)}catch(t){throw console.error("SecureForm submission error:",t),n.Ay.error("Form submission failed"),t}},[l,a,d]);return(0,i.useEffect)(()=>{if(d){const e=r.qp.getRecentEvents();p(e.slice(-10))}},[d]),(0,o.jsxs)(s.A,{...c,onFinish:m,validateTrigger:["onChange","onBlur"],children:[t,!1]})}),m=i.memo(e=>{let{children:t,validationType:l="text",name:a,rules:n=[],...d}=e;const c=i.useMemo(()=>{let e=[];switch(l){case"username":e=r.PT.username;break;case"email":e=r.PT.email;break;case"password":e=r.PT.password;break;case"projectCode":e=r.PT.projectCode;break;case"materialCode":e=r.PT.materialCode;break;case"plantCode":e=r.PT.plantCode;break;case"text":e=r.PT.text(!1,0,255);break;case"richtext":e=r.PT.richText(!1,0,1e3);break;default:e=[]}return[...e,...n]},[l,n]);return(0,o.jsx)(s.A.Item,{...d,name:a,rules:c,children:t})});c.displayName="SecureInput",u.displayName="SecureTextArea",p.displayName="SecureForm",m.displayName="SecureFormItem";const h=p},8348:(e,t,l)=>{l.d(t,{E:()=>n});var s=l(6649),a=l(3719);const n={getUserPlantAssignments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(console.log("Getting plant assignments for user:",e),console.log("Is authenticated:",(0,a.wR)()),!(0,a.wR)())return console.warn("User is not authenticated, cannot get plant assignments"),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1};const o=(0,a.gf)();if(console.log("Retrieved token:",o?"Token found":"No token found"),o)try{const e=await s.default.post("/auth/validate",{token:o},t);if(console.log("Token validation response:",e),console.log("Plant codes in token:",e.plantCodes),console.log("Primary plant in token:",e.primaryPlant),console.log("Is plant user:",e.isPlantUser),e.valid){if(e.plantCodes&&e.plantCodes.length>0)return console.log("Plant assignments from token:",e),{assignedPlants:e.plantCodes||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||e.plantCodes&&e.plantCodes[0]||null,isPlantUser:e.isPlantUser||!1};if(e.primaryPlant&&e.isPlantUser)return console.log("User has primary plant but empty plantCodes, using primary plant as assigned plant:",e.primaryPlant),{assignedPlants:[e.primaryPlant],primaryPlant:e.primaryPlant,effectivePlant:e.primaryPlant,isPlantUser:e.isPlantUser||!1};console.log("Token is valid but no plant data found in token")}}catch(n){console.warn("Failed to validate token for plant assignments:",n)}const d=["userData","qrmfg_user_data","user_info"];for(const e of d){const t=localStorage.getItem(e)||sessionStorage.getItem(e);if(t)try{const e=JSON.parse(t);if(e.plantCodes||e.assignedPlants)return console.log("Plant assignments from stored data:",e),{assignedPlants:e.plantCodes||e.assignedPlants||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||(e.plantCodes||e.assignedPlants)&&(e.plantCodes||e.assignedPlants)[0]||null,isPlantUser:e.isPlantUser||!1}}catch(i){console.warn(`Failed to parse stored user data from ${e}:`,i)}}try{const n=(0,a.gf)(),i=await s.default.post("/auth/validate",{token:n},t);if(i.valid&&i.isAdmin){var l;console.log("User appears to be admin, trying admin endpoints...");const a=null===(l=(await s.default.get("/admin/users",t)).users)||void 0===l?void 0:l.find(t=>t.username===e);if(a&&a.assignedPlants)return console.log("Admin endpoint: Using user details for plant assignments:",a),{assignedPlants:a.assignedPlants||[],primaryPlant:a.primaryPlant||null,effectivePlant:a.primaryPlant||a.assignedPlants&&a.assignedPlants[0]||null,isPlantUser:a.assignedPlants&&a.assignedPlants.length>0||!1}}}catch(r){console.warn("Admin endpoints not accessible (expected for non-admin users):",r.message)}return console.warn("No plant assignment data available for user:",e),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}catch(o){return console.error("Error getting user plant assignments:",o),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}},updateUserPlantAssignments:(e,t)=>s.default.put(`/admin/users/${encodeURIComponent(e)}/plants`,t),checkUserPlantAssignment:(e,t)=>s.default.get(`/admin/users/${encodeURIComponent(e)}/plants/${encodeURIComponent(t)}/check`),getUserById:e=>s.default.get(`/admin/users/${e}`),getAllUsers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.default.get("/admin/users",{cacheTTL:3e5,...e})},getAllUsersRealTime:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.default.get("/admin/users",{useCache:!1,...e})}}},9799:(e,t,l)=>{l.d(t,{B:()=>a});var s=l(6649);const a={getAllLocations:async()=>{try{return await s.default.get("/master-data/locations")}catch(e){console.warn("Main locations endpoint failed, trying fallback:",e);try{return await s.default.get("/master-data/locations/fallback")}catch(t){console.warn("Fallback endpoint failed, trying simple endpoint:",t);try{return await s.default.get("/simple-locations")}catch(l){throw console.error("All locations endpoints failed:",l),l}}}},getLocationByCode:e=>s.default.get(`/master-data/locations/${encodeURIComponent(e)}`),searchLocations:e=>s.default.get(`/master-data/locations/search?term=${encodeURIComponent(e)}`),createLocation:e=>s.default.post("/master-data/locations",e),updateLocation:(e,t)=>s.default.put(`/master-data/locations/${encodeURIComponent(e)}`,t),deleteLocation:e=>s.default.delete(`/master-data/locations/${encodeURIComponent(e)}`),getAllProjectItems:()=>s.default.get("/master-data/project-items"),getItemsByProject:e=>s.default.get(`/master-data/project-items/projects/${encodeURIComponent(e)}`),getProjectsByItem:e=>s.default.get(`/master-data/project-items/items/${encodeURIComponent(e)}`),getAllProjectCodes:()=>s.default.get("/master-data/project-codes"),getAllItemCodes:()=>s.default.get("/master-data/item-codes"),getItemCodesByProject:e=>s.default.get(`/master-data/project-codes/${encodeURIComponent(e)}/items`),testLocationMaster:()=>s.default.get("/master-data/locations/test"),testSimpleLocation:()=>s.default.get("/simple-locations/test"),diagnosticLocationMaster:()=>s.default.get("/master-data/locations/diagnostic"),getSimpleLocationCount:()=>s.default.get("/simple-locations/count")}}}]);
//# sourceMappingURL=915.c6820239.chunk.js.map