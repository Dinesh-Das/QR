"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[426],{5426:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ee});var s=o(6237),l=o(617),n=o(5337),r=o(119),a=o(3117),i=o(9470),d=o(3889),c=o(3927),u=o(8918),m=o(6569),p=o(6399),h=o(8354),f=o(6051),x=o(5206),w=o(7419),g=o(1645),y=o(9073),j=o(3217),A=o(6612),C=o(2261),v=o(5043),k=o(6649),S=o(3357),b=o(1765),D=o(1334),I=o(6011),$=o(1175),R=o(9330),P=o(6091),F=o(4228),E=o(6553),W=o(9098),T=o(2751),z=o(691),U=o(7490),O=o(4522),M=o(2513),L=o(2868);const B=(e,t,o,s)=>{if(!s)throw new Error("workflowId is required for document upload");return k.default.upload("/documents/upload",e,{projectCode:t,materialCode:o,workflowId:s.toString()})},N=function(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return k.default.get(`/documents/reusable?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}&enhanced=${o}`)},q=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"WORKFLOW";const s=new URLSearchParams;return s.append("contextType",o),s.append("workflowId",t.toString()),console.log("=== DOCUMENT REUSE API CALL ==="),console.log("Context Type:",o),console.log("Workflow ID:",t),console.log("Document IDs:",e),console.log("URL:",`/documents/reuse?${s.toString()}`),k.default.post(`/documents/reuse?${s.toString()}`,{workflowId:t,documentIds:e})},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=`/documents/${e}/download${t?`?workflowId=${t}`:""}`;return k.default.download(o)},Q=e=>k.default.get(`/documents/workflow/${e}`),V=e=>{const t=L.rb.MAX_UPLOAD_SIZE;return{isValidType:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type),isValidSize:e.size<=t,type:e.type,size:e.size}},G=async()=>{try{return(await k.default.get("/master-data/project-codes")).map(e=>({value:e,label:e,code:e,name:e}))}catch(e){return console.error("Error fetching projects:",e),[]}},J=async e=>{try{return(await k.default.get(`/master-data/project-codes/${encodeURIComponent(e)}/items`)).map(e=>({value:e,label:e,code:e,name:e}))}catch(t){return console.error("Error fetching materials for project:",e,t),[]}},K=async()=>{try{const e=await k.default.get("/projects/plants");if(e&&e.length>0)return e.map(e=>({value:e.code||e.id,label:`${e.code||e.id} - ${e.name}`,code:e.code||e.id,name:e.name,id:e.id||e.code}));return(await k.default.get("/master-data/locations")).map(e=>({value:e.locationCode,label:`${e.locationCode} - ${e.description}`,code:e.locationCode,name:e.description,id:e.locationCode}))}catch(e){return console.error("Error fetching plants:",e),[]}};var X=o(4733),H=o(9677),Y=o(7692),Z=o(599),ee=o(579);const{Dragger:te}=H.A,oe=v.memo(e=>{let{fileList:t=[],onChange:o,maxFiles:s=10,maxSizeMB:l=25,allowedTypes:n=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain"],allowedExtensions:r=[".pdf",".doc",".docx",".xls",".xlsx",".txt"],componentName:a="SecureFileUpload",enableMalwareScan:i=!0,showSecurityInfo:d=!0,...c}=e;const[u,h]=(0,v.useState)(new Set),[f,x]=(0,v.useState)([]),w=(0,v.useCallback)(e=>{const t={isValid:!0,errors:[],warnings:[]},o=Z.PT.file.validateType(e,n);o.isValid||(t.isValid=!1,t.errors.push(o.message));const s=Z.PT.file.validateSize(e,l);s.isValid||(t.isValid=!1,t.errors.push(s.message));const a=Z.PT.file.validateFilename(e.name);a.isValid||(t.isValid=!1,t.errors.push(a.message));const i=e.name.toLowerCase().substring(e.name.lastIndexOf("."));r.includes(i)||(t.isValid=!1,t.errors.push(`File extension ${i} is not allowed`));const d=Z.SR.sanitizeFilename(e.name);d!==e.name&&(t.warnings.push("Filename was sanitized for security"),e.name=d),e.name.length>255&&(t.isValid=!1,t.errors.push("Filename is too long"));return[/\.exe$/i,/\.bat$/i,/\.cmd$/i,/\.scr$/i,/\.vbs$/i,/\.js$/i,/\.jar$/i,/\.com$/i,/\.pif$/i].some(t=>t.test(e.name))&&(t.isValid=!1,t.errors.push("File type is potentially dangerous")),t},[n,r,l]),g=(0,v.useCallback)(async e=>i?new Promise(t=>{setTimeout(()=>{const o=![0===e.size,e.name.includes(".."),e.name.toLowerCase().includes("virus"),e.name.toLowerCase().includes("malware"),e.name.toLowerCase().includes("trojan")].some(e=>e);t({isClean:o,scanTime:2e3*Math.random()+500,threats:o?[]:["Suspicious file pattern detected"]})},1e3*Math.random()+500)}):{isClean:!0},[i]),y=(0,v.useCallback)(async e=>{const{file:t,onSuccess:o,onError:s}=e;try{const e=w(t);if(!e.isValid){const o=e.errors.join(", ");return Z.qp.logFileUploadEvent(t.name,Z.SR.sanitizeFilename(t.name),t.type,t.size,!1),void s(new Error(o))}e.warnings.length>0&&e.warnings.forEach(e=>m.Ay.warning(e));const l=await g(t);if(!l.isClean){const e=`Security scan failed: ${l.threats.join(", ")}`;return x(e=>[...e,{type:"MALWARE_DETECTED",filename:t.name,threats:l.threats,timestamp:(new Date).toISOString()}]),void s(new Error(e))}Z.qp.logFileUploadEvent(t.name,Z.SR.sanitizeFilename(t.name),t.type,t.size,!0),o(t)}catch(l){s(l)}},[w,g]),j=(0,v.useCallback)(e=>{let t=[...e.fileList];t.length>s&&(m.Ay.warning(`Maximum ${s} files allowed`),t=t.slice(0,s)),t=t.map(e=>{if(e.originFileObj){const t=w(e.originFileObj);t.isValid?u.has(e.uid)&&(e.status="uploading"):(e.status="error",e.response=t.errors.join(", "))}return e}),o&&o({fileList:t})},[s,w,u,o]),A=(0,v.useCallback)(e=>{const t=w(e);return!!t.isValid||(m.Ay.error(`File validation failed: ${t.errors.join(", ")}`),!1)},[w]),k=(0,v.useMemo)(()=>{if(!d)return null;const e=t.filter(e=>"done"===e.status).length,o=t.filter(e=>"error"===e.status).length,s=t.filter(e=>"uploading"===e.status).length;return(0,ee.jsxs)("div",{style:{marginTop:16},children:[(0,ee.jsx)(C.A,{message:"File Upload Security",description:(0,ee.jsxs)("div",{children:[(0,ee.jsx)("p",{children:(0,ee.jsx)("strong",{children:"Security Features:"})}),(0,ee.jsxs)("ul",{style:{marginBottom:8},children:[(0,ee.jsxs)("li",{children:["File type validation (",r.join(", "),")"]}),(0,ee.jsxs)("li",{children:["File size limit: ",l,"MB per file"]}),(0,ee.jsx)("li",{children:"Filename sanitization"}),i&&(0,ee.jsx)("li",{children:"Malware scanning simulation"}),(0,ee.jsx)("li",{children:"Security audit logging"})]}),(0,ee.jsxs)("p",{children:[(0,ee.jsx)("strong",{children:"Status:"})," ",e," valid, ",o," errors, ",s," uploading"]})]}),type:"info",showIcon:!0,icon:(0,ee.jsx)(F.A,{})}),f.length>0&&(0,ee.jsx)(C.A,{message:"Security Alerts",description:(0,ee.jsx)(O.A,{size:"small",dataSource:f.slice(-3),renderItem:e=>(0,ee.jsxs)(O.A.Item,{children:[(0,ee.jsx)(p.A,{color:"red",children:e.type}),e.filename,": ",e.threats.join(", ")]})}),type:"warning",showIcon:!0,style:{marginTop:8}})]})},[d,t,r,l,i,f]);return(0,ee.jsxs)("div",{children:[(0,ee.jsxs)(te,{...c,fileList:t,onChange:j,customRequest:y,beforeUpload:A,multiple:!0,showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0,showDownloadIcon:!1},children:[(0,ee.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ee.jsx)(X.A,{})}),(0,ee.jsx)("p",{className:"ant-upload-text",children:"Click or drag files to this area to upload"}),(0,ee.jsxs)("p",{className:"ant-upload-hint",children:["Support for ",r.join(", ")," files up to ",l,"MB each. Maximum ",s," files allowed."]})]}),t.length>0&&(0,ee.jsx)("div",{style:{marginTop:16},children:(0,ee.jsx)(O.A,{size:"small",header:(0,ee.jsxs)("div",{children:[(0,ee.jsx)(P.A,{})," Uploaded Files (",t.length,")"]}),bordered:!0,dataSource:t,renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[u.has(e.uid)&&(0,ee.jsxs)("div",{children:[(0,ee.jsx)(Y.A,{type:"circle",size:20,percent:e.percent||0,showInfo:!1}),(0,ee.jsx)("span",{style:{marginLeft:8},children:"Scanning..."})]},"scanning")].filter(Boolean),children:(0,ee.jsx)(O.A.Item.Meta,{avatar:(0,ee.jsx)(P.A,{style:{color:"done"===e.status?"#52c41a":"error"===e.status?"#ff4d4f":"#1890ff"}}),title:e.name,description:(0,ee.jsxs)("div",{children:[(0,ee.jsxs)("span",{children:["Size: ",(e.size/1024/1024).toFixed(2)," MB"]}),"error"===e.status&&(0,ee.jsx)(p.A,{color:"red",style:{marginLeft:8},children:e.response||"Upload failed"}),"done"===e.status&&(0,ee.jsx)(p.A,{color:"green",style:{marginLeft:8},children:"Secure"}),u.has(e.uid)&&(0,ee.jsx)(p.A,{color:"blue",style:{marginLeft:8},children:"Scanning"})]})})})})}),k]})});oe.displayName="SecureFileUpload";const se=oe,{Option:le}=E.A,{Title:ne,Text:re}=c.A,ae=e=>{let{onSubmit:t,loading:o}=e;const[s]=W.A.useForm(),[l,n]=(0,v.useState)([]),[r,a]=(0,v.useState)([]),[i,d]=(0,v.useState)([]),[c,u]=(0,v.useState)([]),[h,j]=(0,v.useState)([]),[k,L]=(0,v.useState)([]),[B,q]=(0,v.useState)(!1),[Q,X]=(0,v.useState)({projects:!1,materials:!1,plants:!1,reusableDocuments:!1});(0,v.useEffect)(()=>{const e=new AbortController,t=async e=>{try{H("projects",!0);const t=await G({signal:e});null!==e&&void 0!==e&&e.aborted||n(t||[])}catch(t){null!==e&&void 0!==e&&e.aborted||(console.error("Error loading projects:",t),m.Ay.error("Failed to load projects"))}finally{null!==e&&void 0!==e&&e.aborted||H("projects",!1)}},o=async e=>{try{H("plants",!0);const t=await K({signal:e});null!==e&&void 0!==e&&e.aborted||d(t||[])}catch(t){null!==e&&void 0!==e&&e.aborted||(console.error("Error loading plants:",t),m.Ay.error("Failed to load plants"))}finally{null!==e&&void 0!==e&&e.aborted||H("plants",!1)}};return(async()=>{try{await Promise.all([t(e.signal),o(e.signal)])}catch(s){e.signal.aborted||console.error("Error loading initial data:",s)}})(),()=>{e.abort()}},[]);const H=(e,t)=>{X(o=>({...o,[e]:t}))},Y=async(e,t)=>{try{H("reusableDocuments",!0);const o=await N(e,t,!0);o&&o.length>0?(j(o),q(!0),L(o.map(e=>e.id))):(j([]),q(!1),L([]))}catch(o){console.error("Error checking for reusable documents:",o),m.Ay.warning("Unable to check for reusable documents. You can still upload new documents.")}finally{H("reusableDocuments",!1)}},Z=()=>{s.resetFields(),u([]),j([]),L([]),q(!1),a([])};return(0,ee.jsxs)(y.A,{children:[(0,ee.jsx)("div",{style:{marginBottom:24},children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(F.A,{}),(0,ee.jsx)(ne,{level:4,style:{margin:0},children:"Material Extension Form"})]})}),(0,ee.jsxs)(W.A,{form:s,layout:"vertical",onFinish:async e=>{try{const o=c.filter(e=>"done"===e.status).length+k.length;if(!e.projectCode||!e.materialCode||!e.plantCodes||0===e.plantCodes.length)return void m.Ay.error("Please fill in all required fields");if(0===o)return void m.Ay.error("Please upload at least one document or select reusable documents");T.A.confirm({title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(S.A,{style:{color:"#1890ff"}}),(0,ee.jsx)("span",{children:"Confirm Material Extension Submission"})]}),width:800,style:{top:80},bodyStyle:{minHeight:"450px",padding:"24px"},content:(0,ee.jsxs)("div",{children:[(0,ee.jsx)(C.A,{message:"Ready to Submit Material Extension",description:"Please review the details below before creating the workflow.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsxs)(z.A,{bordered:!0,size:"small",column:2,children:[(0,ee.jsx)(z.A.Item,{label:"Project Code",span:1,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(b.A,{style:{color:"#1890ff"}}),(0,ee.jsx)(re,{strong:!0,children:e.projectCode})]})}),(0,ee.jsx)(z.A.Item,{label:"Material Code",span:1,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(D.A,{style:{color:"#52c41a"}}),(0,ee.jsx)(re,{code:!0,children:e.materialCode})]})}),(0,ee.jsx)(z.A.Item,{label:"Plant Codes",span:1,children:(0,ee.jsxs)(f.A,{wrap:!0,children:[(0,ee.jsx)(I.A,{style:{color:"#fa8c16"}}),e.plantCodes.map(e=>(0,ee.jsx)(p.A,{color:"orange",children:e},e))]})}),(0,ee.jsx)(z.A.Item,{label:"Documents Summary",span:2,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)($.A,{style:{color:"#13c2c2"}}),(0,ee.jsx)(U.A,{count:o,style:{backgroundColor:o>0?"#52c41a":"#d9d9d9"}}),(0,ee.jsxs)(re,{style:{marginLeft:8},children:[o," file",1!==o?"s":""," (",c.filter(e=>"done"===e.status).length," new,"," ",k.length," reused)"]})]})})]}),o>0&&(0,ee.jsxs)("div",{style:{marginTop:20},children:[c.filter(e=>"done"===e.status).length>0&&(0,ee.jsxs)("div",{style:{marginBottom:16},children:[(0,ee.jsxs)(re,{strong:!0,style:{color:"#1890ff",marginBottom:8,display:"block"},children:["\ud83d\udcce New Documents (",c.filter(e=>"done"===e.status).length,")"]}),(0,ee.jsx)(O.A,{size:"small",bordered:!0,dataSource:c.filter(e=>"done"===e.status),renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[(0,ee.jsx)(x.Ay,{type:"link",size:"small",icon:(0,ee.jsx)(R.A,{}),onClick:()=>{const t=URL.createObjectURL(e.originFileObj||e),o=document.createElement("a");o.href=t,o.download=e.name,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)},children:"Download"},"download")],children:(0,ee.jsx)(O.A.Item.Meta,{avatar:(0,ee.jsx)(P.A,{style:{color:"#52c41a"}}),title:e.name,description:`Size: ${(e.size/1024/1024).toFixed(2)} MB`})})})]}),k.length>0&&(0,ee.jsxs)("div",{children:[(0,ee.jsxs)(re,{strong:!0,style:{color:"#fa8c16",marginBottom:8,display:"block"},children:["\ud83d\udd04 Reused Documents (",k.length,")"]}),(0,ee.jsx)(O.A,{size:"small",bordered:!0,dataSource:h.filter(e=>k.includes(e.id)),renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[(0,ee.jsx)(x.Ay,{type:"link",size:"small",icon:(0,ee.jsx)(R.A,{}),onClick:async()=>{try{const t=await _(e.id),o=window.URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=e.originalFileName||`document_${e.id}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),m.Ay.success(`Downloaded ${e.originalFileName}`)}catch(t){console.error("Error downloading document:",t),m.Ay.error("Failed to download document")}},children:"Download"},"download")],children:(0,ee.jsx)(O.A.Item.Meta,{avatar:(0,ee.jsx)(P.A,{style:{color:"#fa8c16"}}),title:e.originalFileName,description:(0,ee.jsxs)(f.A,{split:(0,ee.jsx)("span",{style:{color:"#d9d9d9"},children:"|"}),children:[(0,ee.jsxs)(re,{type:"secondary",children:["Size: ",(e.fileSize/1024/1024).toFixed(2)," MB"]}),(0,ee.jsxs)(re,{type:"secondary",children:["From: ",e.projectCode,"/",e.materialCode]}),(0,ee.jsx)(p.A,{color:"orange",size:"small",children:"Reused"})]})})})})]})]})]}),onOk:()=>new Promise(async(s,l)=>{const n={...e,uploadedFiles:c.filter(e=>"done"===e.status),reusedDocuments:k,metadata:{totalDocuments:o,newDocuments:c.filter(e=>"done"===e.status).length,reusedDocuments:k.length,submittedAt:(new Date).toISOString(),formVersion:"3.0-simplified"}};try{const o=await t(n);var r;if(o&&o.isSmartExtension)return T.A.info({title:(0,ee.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,ee.jsx)(S.A,{style:{color:"#1890ff",fontSize:"20px"}}),(0,ee.jsx)("span",{children:"Smart Plant Extension Results"})]}),width:900,style:{top:50},bodyStyle:{maxHeight:"70vh",overflowY:"auto",padding:"24px"},content:(0,ee.jsxs)("div",{style:{padding:"16px 0"},children:[(0,ee.jsx)(C.A,{message:o.message,type:o.success?"success":"warning",showIcon:!0,style:{marginBottom:20}}),(0,ee.jsx)(y.A,{title:"Extension Summary",size:"small",style:{marginBottom:20},children:(0,ee.jsxs)(w.A,{gutter:16,children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Total Requested",value:o.summary.totalRequested})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Newly Created",value:o.summary.created,valueStyle:{color:"#3f8600"}})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Duplicates Skipped",value:o.summary.skipped,valueStyle:{color:"#faad14"}})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Failed",value:o.summary.failed,valueStyle:{color:"#cf1322"}})})]})}),o.createdWorkflows&&o.createdWorkflows.length>0&&(0,ee.jsx)(y.A,{title:"\u2705 Newly Created Workflows",size:"small",style:{marginBottom:20},children:(0,ee.jsx)(O.A,{dataSource:o.createdWorkflows,renderItem:e=>(0,ee.jsx)(O.A.Item,{children:(0,ee.jsx)(O.A.Item.Meta,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsxs)(p.A,{color:"green",children:["Plant: ",e.plantCode]}),(0,ee.jsxs)(p.A,{color:"blue",children:["ID: ",e.id]}),(0,ee.jsxs)(p.A,{color:"orange",children:["State: ",e.state]})]}),description:`Created: ${new Date(e.createdAt).toLocaleString()}`})})})}),o.duplicateWorkflows&&o.duplicateWorkflows.length>0&&(0,ee.jsxs)(y.A,{title:"\u26a0\ufe0f Duplicate Workflows (Already Exist)",size:"small",style:{marginBottom:20},children:[(0,ee.jsx)(C.A,{message:"These workflows were not created because they already exist",type:"warning",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsx)(O.A,{dataSource:o.duplicateWorkflows,renderItem:e=>(0,ee.jsx)(O.A.Item,{children:(0,ee.jsx)(O.A.Item.Meta,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsxs)(p.A,{color:"orange",children:["Plant: ",e.plantCode]}),(0,ee.jsxs)(p.A,{color:"blue",children:["ID: ",e.id]}),(0,ee.jsxs)(p.A,{color:"purple",children:["State: ",e.state]})]}),description:`Existing workflow created: ${new Date(e.createdAt).toLocaleString()}`})})})]}),o.details&&o.details.documentReuse&&o.details.documentReuse.totalReusedDocuments>0&&(0,ee.jsxs)(y.A,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)($.A,{style:{color:"#13c2c2"}}),(0,ee.jsx)("span",{children:"\ud83d\udcce Document Reuse Information"}),(0,ee.jsx)(U.A,{count:o.details.documentReuse.totalReusedDocuments,style:{backgroundColor:"#52c41a"}})]}),size:"small",style:{marginBottom:20},children:[(0,ee.jsx)(C.A,{message:`${o.details.documentReuse.totalReusedDocuments} documents automatically reused across ${o.summary.created} workflow(s)`,description:(0,ee.jsxs)("div",{children:[(0,ee.jsxs)("div",{style:{marginBottom:8},children:[(0,ee.jsx)("strong",{children:"Strategy:"})," ",o.details.documentReuse.reuseStrategy||"Automatic"]}),o.details.documentReuse.sourceDescription&&(0,ee.jsxs)("div",{style:{marginBottom:8},children:[(0,ee.jsx)("strong",{children:"Sources:"})," ",o.details.documentReuse.sourceDescription]}),o.details.documentReuse.statistics&&(0,ee.jsxs)("div",{children:[(0,ee.jsx)("strong",{children:"Document Sources:"})," ",o.details.documentReuse.statistics.workflowDocuments>0&&`${o.details.documentReuse.statistics.workflowDocuments} from workflows`,o.details.documentReuse.statistics.queryDocuments>0&&`${o.details.documentReuse.statistics.workflowDocuments>0?", ":""}${o.details.documentReuse.statistics.queryDocuments} from queries`,o.details.documentReuse.statistics.responseDocuments>0&&`${o.details.documentReuse.statistics.workflowDocuments>0||o.details.documentReuse.statistics.queryDocuments>0?", ":""}${o.details.documentReuse.statistics.responseDocuments} from responses`]})]}),type:"success",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsx)(O.A,{dataSource:o.details.documentReuse.reusedDocuments||[],renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[(0,ee.jsx)(x.Ay,{type:"link",size:"small",icon:(0,ee.jsx)(R.A,{}),onClick:async()=>{try{const t=await _(e.id),o=window.URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=e.originalFileName||`document_${e.id}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),m.Ay.success(`Downloaded ${e.originalFileName}`)}catch(t){console.error("Error downloading document:",t),m.Ay.error("Failed to download document")}},children:"Download"},"download")],children:(0,ee.jsx)(O.A.Item.Meta,{avatar:(0,ee.jsxs)("div",{style:{position:"relative"},children:[(0,ee.jsx)(P.A,{style:{color:"WORKFLOW"===e.documentSource?"#1890ff":"QUERY"===e.documentSource?"#fa8c16":"#722ed1",fontSize:"16px"}}),e.isReused&&(0,ee.jsx)(U.A,{count:"R",style:{backgroundColor:"#52c41a",fontSize:"10px",height:"16px",minWidth:"16px",lineHeight:"16px",position:"absolute",top:"-8px",right:"-8px"}})]}),title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)("span",{children:e.originalFileName}),e.documentSource&&(0,ee.jsx)(p.A,{color:"WORKFLOW"===e.documentSource?"blue":"QUERY"===e.documentSource?"orange":"purple",size:"small",children:"WORKFLOW"===e.documentSource?"Workflow":"QUERY"===e.documentSource?"Query":"Response"}),e.isReused&&(0,ee.jsxs)(p.A,{color:"green",size:"small",children:["Reused ",e.reuseCount>1?`(${e.reuseCount}x)`:""]})]}),description:(0,ee.jsxs)(f.A,{split:(0,ee.jsx)("span",{style:{color:"#d9d9d9"},children:"|"}),children:[(0,ee.jsxs)(re,{type:"secondary",children:["Size: ",((e.fileSize||0)/1024/1024).toFixed(2)," MB"]}),e.projectCode&&e.materialCode&&(0,ee.jsxs)(re,{type:"secondary",children:["From: ",e.projectCode,"/",e.materialCode]}),e.sourceDescription&&(0,ee.jsx)(re,{type:"secondary",children:e.sourceDescription}),e.uploadedBy&&(0,ee.jsxs)(re,{type:"secondary",children:["By: ",e.uploadedBy]})]})})})}),o.details.documentReuse.statistics&&(0,ee.jsx)("div",{style:{marginTop:16,padding:"12px",backgroundColor:"#f6ffed",borderRadius:"6px"},children:(0,ee.jsxs)(w.A,{gutter:16,children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Unique Documents",value:o.details.documentReuse.statistics.totalUniqueDocuments||o.details.documentReuse.totalReusedDocuments,valueStyle:{fontSize:"16px"}})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Per Workflow",value:o.details.documentReuse.documentsPerWorkflow||0,valueStyle:{fontSize:"16px"}})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Workflows with Docs",value:o.details.documentReuse.statistics.workflowsWithReusedDocuments||o.summary.created,valueStyle:{fontSize:"16px"}})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(A.A,{title:"Total Attachments",value:o.details.documentReuse.totalReusedDocuments,valueStyle:{fontSize:"16px",color:"#52c41a"}})})]})})]}),o.failedPlants&&o.failedPlants.length>0&&(0,ee.jsxs)(y.A,{title:"\u274c Failed Extensions",size:"small",style:{marginBottom:20},children:[(0,ee.jsx)(C.A,{message:"These plant extensions failed due to errors",type:"error",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsx)(O.A,{dataSource:o.failedPlants,renderItem:e=>(0,ee.jsx)(O.A.Item,{children:(0,ee.jsxs)(p.A,{color:"red",children:["Plant: ",e]})})})]}),(0,ee.jsxs)(z.A,{title:"Request Parameters",bordered:!0,size:"small",column:2,style:{marginTop:20},children:[(0,ee.jsx)(z.A.Item,{label:"Project Code",span:1,children:(0,ee.jsx)(p.A,{color:"blue",children:e.projectCode})}),(0,ee.jsx)(z.A.Item,{label:"Material Code",span:1,children:(0,ee.jsx)(p.A,{color:"green",children:e.materialCode})}),(0,ee.jsx)(z.A.Item,{label:"Plant Codes",span:2,children:(0,ee.jsx)(f.A,{wrap:!0,children:e.plantCodes.map(e=>(0,ee.jsx)(p.A,{color:"orange",children:e},e))})})]}),o.duplicateWorkflows&&o.duplicateWorkflows.length>0&&o.duplicateWorkflows[0]&&(0,ee.jsxs)(z.A,{title:"Existing Workflow Details",bordered:!0,size:"small",column:2,style:{marginBottom:20},children:[(0,ee.jsx)(z.A.Item,{label:"Workflow ID",span:1,children:(0,ee.jsxs)(p.A,{color:"red",children:["#",o.duplicateWorkflows[0].id]})}),(0,ee.jsx)(z.A.Item,{label:"Current State",span:1,children:(0,ee.jsx)(p.A,{color:"processing",children:(null===(r=o.duplicateWorkflows[0].state)||void 0===r?void 0:r.replace("_"," "))||"PENDING"})}),(0,ee.jsx)(z.A.Item,{label:"Created Date",span:1,children:o.duplicateWorkflows[0].createdAt?new Date(o.duplicateWorkflows[0].createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}),(0,ee.jsx)(z.A.Item,{label:"Initiated By",span:1,children:o.duplicateWorkflows[0].initiatedBy||"Unknown"}),o.duplicateWorkflows[0].documentCount>0&&(0,ee.jsxs)(z.A.Item,{label:"Documents",span:2,children:[(0,ee.jsx)(U.A,{count:o.duplicateWorkflows[0].documentCount,style:{backgroundColor:"#52c41a"}}),(0,ee.jsx)("span",{style:{marginLeft:8},children:"files attached"})]})]}),(0,ee.jsx)(C.A,{message:"Next Steps",description:(0,ee.jsxs)("div",{children:[(0,ee.jsxs)("p",{style:{margin:"8px 0"},children:["\u2022 Check the ",(0,ee.jsx)("strong",{children:'"Pending Extensions"'})," tab to view the existing workflow",o.duplicateWorkflows&&o.duplicateWorkflows.length>1?"s":""]}),(0,ee.jsx)("p",{style:{margin:"8px 0"},children:"\u2022 Use different parameters if you need to create a new workflow"}),(0,ee.jsxs)("p",{style:{margin:"8px 0"},children:["\u2022 Contact the workflow initiator if you need to modify the existing workflow",o.duplicateWorkflows&&o.duplicateWorkflows.length>1?"s":""]})]}),type:"info",showIcon:!0})]}),okText:"Got It",okButtonProps:{size:"large",type:"primary"},onOk:()=>{Z()}}),void s();Z(),s()}catch(a){console.error("Form submission failed:",a),l(a)}})})}catch(o){console.error("Error submitting form:",o),m.Ay.error("Failed to create material extension. Please try again.")}},size:"large",children:[(0,ee.jsxs)(w.A,{gutter:[16,16],children:[(0,ee.jsx)(g.A,{xs:24,sm:12,children:(0,ee.jsx)(W.A.Item,{label:"Project Code",name:"projectCode",rules:[{required:!0,message:"Please select a project code"}],children:(0,ee.jsx)(E.A,{placeholder:"Select project code",showSearch:!0,loading:Q.projects,onChange:async e=>{try{if(H("materials",!0),a([]),e){const t=await J(e);a(t||[])}j([]),L([]),q(!1)}catch(t){console.error("Error loading materials:",t),m.Ay.error("Failed to load materials. Please try again.")}finally{H("materials",!1)}},filterOption:(e,t)=>t.children.toLowerCase().indexOf(e.toLowerCase())>=0,children:l.map(e=>(0,ee.jsx)(le,{value:e.value,children:e.label||e.value},e.value))})})}),(0,ee.jsx)(g.A,{xs:24,sm:12,children:(0,ee.jsx)(W.A.Item,{label:"Material Code",name:"materialCode",rules:[{required:!0,message:"Please select a material code"}],children:(0,ee.jsx)(E.A,{placeholder:"Select material code",showSearch:!0,loading:Q.materials,onChange:async e=>{const t=s.getFieldValue("projectCode");t&&e&&await Y(t,e)},disabled:0===r.length,filterOption:(e,t)=>t.children.toLowerCase().indexOf(e.toLowerCase())>=0,children:r.map(e=>(0,ee.jsx)(le,{value:e.value,children:e.label||e.value},e.value))})})}),(0,ee.jsx)(g.A,{xs:24,sm:12,children:(0,ee.jsx)(W.A.Item,{label:"Plant Codes",name:"plantCodes",rules:[{required:!0,message:"Please select at least one plant code"}],children:(0,ee.jsx)(E.A,{mode:"multiple",placeholder:"Select plant codes",showSearch:!0,loading:Q.plants,allowClear:!0,maxTagCount:"responsive",filterOption:(e,t)=>t.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:"100%"},children:i.map(e=>(0,ee.jsx)(le,{value:e.value,children:e.label||e.value},e.value))})})})]}),B&&(0,ee.jsxs)(y.A,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(P.A,{style:{color:"#1890ff"}}),(0,ee.jsx)("span",{children:"Reusable Documents Found"}),(0,ee.jsx)(U.A,{count:h.length,style:{backgroundColor:"#52c41a"}})]}),style:{marginBottom:16},size:"small",children:[(0,ee.jsx)(C.A,{message:`Found ${h.length} reusable document(s)`,description:"These documents are automatically selected. Uncheck any you don't want to reuse.",type:"success",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsx)(M.A.Group,{value:k,onChange:L,style:{width:"100%"},children:(0,ee.jsx)(O.A,{size:"small",dataSource:h,renderItem:e=>(0,ee.jsx)(O.A.Item,{children:(0,ee.jsx)(M.A,{value:e.id,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(P.A,{style:{color:"#1890ff"}}),(0,ee.jsx)("span",{children:e.originalFileName}),(0,ee.jsxs)(re,{type:"secondary",children:["(",(e.fileSize/1024/1024).toFixed(2),"MB)"]})]})})})})})]}),(0,ee.jsx)(W.A.Item,{label:"Upload Documents",help:"Upload PDF, Word, or Excel files (max 25MB each). At least one document is required.",children:(0,ee.jsx)(se,{fileList:c,onChange:e=>{let{fileList:t}=e;const o=t.map(e=>{if(e.originFileObj){const t=V(e.originFileObj);t.isValidType?t.isValidSize?(e.status="done",e.percent=100):(e.status="error",e.response=`File size exceeds 25MB limit (${(e.originFileObj.size/1024/1024).toFixed(2)}MB).`):(e.status="error",e.response="Invalid file type. Only PDF, Word, and Excel files are allowed."),e.size=e.originFileObj.size,e.type=e.originFileObj.type,e.lastModified=e.originFileObj.lastModified}return e});u(o);const s=o.filter(e=>"error"===e.status).length;s>0&&m.Ay.warning(`${s} file(s) have validation errors. Please check file types and sizes.`)},maxFiles:10,maxSizeMB:25,componentName:"MaterialExtensionForm",enableMalwareScan:!0,showSecurityInfo:!0,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],allowedExtensions:[".pdf",".doc",".docx",".xls",".xlsx"]})}),(0,ee.jsx)(W.A.Item,{style:{marginTop:24},children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(x.Ay,{type:"primary",htmlType:"submit",loading:o,size:"large",icon:(0,ee.jsx)(S.A,{}),children:"Create Material Extension"}),(0,ee.jsx)(x.Ay,{onClick:Z,size:"large",children:"Reset Form"})]})})]})]})};var ie=o(6191),de=o(4394),ce=o(6989),ue=o(8463),me=o(487),pe=o(5444),he=o(6651),fe=o(9394),xe=o(1966);const{Text:we,Title:ge}=c.A,{Dragger:ye}=H.A,je=e=>{let{workflowId:t,projectCode:o,materialCode:l,onDocumentsUploaded:n}=e;const[r,a]=(0,v.useState)([]),[i,d]=(0,v.useState)(!1);return(0,ee.jsx)(y.A,{size:"small",style:{backgroundColor:"#f9f9f9",border:"1px dashed #d9d9d9"},children:(0,ee.jsxs)(f.A,{direction:"vertical",style:{width:"100%"},children:[(0,ee.jsx)(C.A,{message:"No Documents Found",description:"This workflow was initiated without documents. You can upload safety documents now to complete the workflow preparation.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,ee.jsxs)(ge,{level:5,children:[(0,ee.jsx)(X.A,{})," Upload Documents"]}),(0,ee.jsxs)(ye,{multiple:!0,fileList:r,onChange:e=>{let{fileList:t}=e;const o=t.map(e=>{if(e.originFileObj){const t=V(e.originFileObj);t.isValidType?t.isValidSize?(e.status="done",e.percent=100):(e.status="error",e.response=`File size exceeds 25MB limit (${(e.originFileObj.size/1024/1024).toFixed(2)}MB).`):(e.status="error",e.response="Invalid file type. Only PDF, Word, and Excel files are allowed."),e.size=e.originFileObj.size,e.type=e.originFileObj.type,e.lastModified=e.originFileObj.lastModified}return e});a(o);const s=o.filter(e=>"done"===e.status).length,l=o.filter(e=>"error"===e.status).length;l>0?m.Ay.warning(`${l} file(s) have validation errors. Please check file types and sizes.`):s>0&&m.Ay.success(`${s} file(s) ready for upload.`)},beforeUpload:()=>!1,accept:".pdf,.doc,.docx,.xls,.xlsx",style:{marginBottom:16},children:[(0,ee.jsx)("p",{className:"ant-upload-drag-icon",children:(0,ee.jsx)(X.A,{})}),(0,ee.jsx)("p",{className:"ant-upload-text",children:"Click or drag files to this area to upload"}),(0,ee.jsx)("p",{className:"ant-upload-hint",children:"Support for PDF, Word, and Excel files. Maximum file size: 25MB each"})]}),r.length>0&&(0,ee.jsx)(y.A,{size:"small",title:"Selected Files",style:{marginBottom:16},children:(0,ee.jsx)(O.A,{size:"small",dataSource:r,renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[(0,ee.jsx)(x.Ay,{type:"text",danger:!0,icon:(0,ee.jsx)(xe.A,{}),onClick:()=>(e=>{const t=r.filter(t=>t.uid!==e.uid);a(t)})(e),size:"small",children:"Remove"},"remove")],children:(0,ee.jsx)(O.A.Item.Meta,{avatar:"done"===e.status?(0,ee.jsx)(s.A,{style:{color:"#52c41a"}}):(0,ee.jsx)(P.A,{style:{color:"#ff4d4f"}}),title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(we,{strong:"done"===e.status,type:"error"===e.status?"danger":"default",children:e.name}),e.size&&(0,ee.jsxs)(we,{type:"secondary",children:["(",(e.size/1024/1024).toFixed(2)," MB)"]})]}),description:"error"===e.status?(0,ee.jsx)(we,{type:"danger",children:e.response}):(0,ee.jsx)(we,{type:"secondary",children:"Ready for upload"})})})})}),(0,ee.jsx)("div",{style:{textAlign:"center"},children:(0,ee.jsxs)(x.Ay,{type:"primary",icon:(0,ee.jsx)(X.A,{}),onClick:async()=>{const e=r.filter(e=>"done"===e.status);if(0!==e.length)try{d(!0);const s=e.map(e=>e.originFileObj||e);await B(s,o,l,t),m.Ay.success(`Successfully uploaded ${e.length} document(s) to the workflow.`),a([]),n&&n()}catch(s){console.error("Error uploading documents:",s),m.Ay.error("Failed to upload documents. Please try again.")}finally{d(!1)}else m.Ay.error("Please select at least one valid file to upload.")},loading:i,disabled:0===r.filter(e=>"done"===e.status).length,size:"large",children:["Upload ",r.filter(e=>"done"===e.status).length," Document(s)"]})}),(0,ee.jsx)(C.A,{message:"Upload Guidelines",description:(0,ee.jsxs)("ul",{style:{margin:0,paddingLeft:20},children:[(0,ee.jsx)("li",{children:"Only PDF, Word (.doc, .docx), and Excel (.xls, .xlsx) files are allowed"}),(0,ee.jsx)("li",{children:"Maximum file size is 25MB per file"}),(0,ee.jsx)("li",{children:"You can upload multiple files at once"}),(0,ee.jsx)("li",{children:"Files will be associated with this workflow for plant review"})]}),type:"warning",showIcon:!0,size:"small"})]})})},{Text:Ae,Title:Ce}=c.A,{Option:ve}=E.A,{RangePicker:ke}=me.A,{Search:Se}=pe.A,be=e=>{let{onExtendToPlant:t,refreshTrigger:o}=e;const[s,a]=(0,v.useState)([]),[d,c]=(0,v.useState)([]),[u,h]=(0,v.useState)(!1),[A,k]=(0,v.useState)(null),[S,b]=(0,v.useState)(!1),[D,I]=(0,v.useState)([]),[$,R]=(0,v.useState)(!1),[F,W]=(0,v.useState)({search:"",projectCode:"",plantCode:"",materialCode:"",dateRange:null,slaStatus:"",documentCount:"",initiatedBy:""});(0,v.useEffect)(()=>{M()},[o]);const M=async()=>{try{h(!0);const e=await fe.S.getWorkflowsByState("JVC_PENDING");a(e||[])}catch(e){console.error("Error loading pending workflows:",e),m.Ay.error("Failed to load pending workflows")}finally{h(!1)}},L=e=>{const t=new Date(e),o=new Date,s=Math.abs(o-t);return Math.ceil(s/864e5)},B=e=>{const t=L(e);return t>3?{status:"overdue",color:"red",text:"Overdue"}:t>=2?{status:"warning",color:"orange",text:"Warning"}:{status:"normal",color:"green",text:"On Track"}},N=async e=>{try{await t(e),await M()}catch(o){console.error("Error extending workflow:",o)}},q=async e=>{try{k(e),b(!0);const t=await Q(e.id);I(t||[])}catch(t){console.error("Error loading workflow details:",t),m.Ay.error("Failed to load workflow details")}},V=(()=>{const e=s.length,t=s.filter(e=>L(e.createdAt)>3).length,o=s.filter(e=>{const t=L(e.createdAt);return t>=2&&t<=3}).length,l=e-t-o,n=new Set(s.map(e=>e.projectCode)).size,r=new Set(s.map(e=>e.materialCode)).size,a=new Set(s.map(e=>e.plantCode)).size,i=s.reduce((e,t)=>e+(t.documentCount||0),0);return{total:e,overdue:t,warning:o,normal:l,uniqueProjects:n,uniqueMaterials:r,uniquePlants:a,totalDocuments:i,avgDocumentsPerWorkflow:e>0?Math.round(i/e*10)/10:0}})(),G=[...new Set(s.map(e=>e.projectCode))].filter(Boolean),J=[...new Set(s.map(e=>e.materialCode))].filter(Boolean),K=[...new Set(s.map(e=>e.plantCode))].filter(Boolean),X=[...new Set(s.map(e=>e.initiatedBy))].filter(Boolean);(0,v.useEffect)(()=>{let e=[...s];if(F.search){const t=F.search.toLowerCase();e=e.filter(e=>{var o,s,l,n;return(null===(o=e.projectCode)||void 0===o?void 0:o.toLowerCase().includes(t))||(null===(s=e.materialCode)||void 0===s?void 0:s.toLowerCase().includes(t))||(null===(l=e.plantCode)||void 0===l?void 0:l.toLowerCase().includes(t))||(null===(n=e.initiatedBy)||void 0===n?void 0:n.toLowerCase().includes(t))})}if(F.projectCode&&(e=e.filter(e=>e.projectCode===F.projectCode)),F.plantCode&&(e=e.filter(e=>e.plantCode===F.plantCode||e.assignedPlant===F.plantCode)),F.materialCode&&(e=e.filter(e=>e.materialCode===F.materialCode)),F.documentCount&&("with"===F.documentCount?e=e.filter(e=>e.documentCount>0):"without"===F.documentCount&&(e=e.filter(e=>!e.documentCount||0===e.documentCount))),F.initiatedBy&&(e=e.filter(e=>{var t;return null===(t=e.initiatedBy)||void 0===t?void 0:t.toLowerCase().includes(F.initiatedBy.toLowerCase())})),F.dateRange&&2===F.dateRange.length){const[t,o]=F.dateRange;e=e.filter(e=>{const s=new Date(e.createdAt);return s>=t.toDate()&&s<=o.toDate()})}F.slaStatus&&(e=e.filter(e=>{const t=L(e.createdAt);return"overdue"===F.slaStatus?t>3:"warning"===F.slaStatus?t>=2&&t<=3:"normal"!==F.slaStatus||t<2})),c(e)},[s,F]);const H=[{title:"Project Code",dataIndex:"projectCode",key:"projectCode",render:(e,t)=>(0,ee.jsxs)(f.A,{direction:"vertical",size:"small",children:[(0,ee.jsx)(Ae,{strong:!0,children:e||"N/A"}),(0,ee.jsx)(Ae,{type:"secondary",style:{fontSize:"11px"},children:t.projectDescription||"Project Extension"})]}),sorter:(e,t)=>(e.projectCode||"").localeCompare(t.projectCode||""),width:140},{title:"Material Code",dataIndex:"materialCode",key:"materialCode",render:(e,t)=>(0,ee.jsxs)(f.A,{direction:"vertical",size:"small",children:[(0,ee.jsx)(Ae,{code:!0,children:e||"N/A"}),(0,ee.jsx)(Ae,{type:"secondary",style:{fontSize:"11px"},children:t.itemDescription||t.materialDescription||"Material Safety Extension"})]}),sorter:(e,t)=>(e.materialCode||"").localeCompare(t.materialCode||""),width:140},{title:"Plant Code",key:"plantCode",render:(e,t)=>(0,ee.jsx)(Ae,{strong:!0,children:t.plantCode||t.assignedPlant||"N/A"}),sorter:(e,t)=>{const o=e.plantCode||e.assignedPlant||"",s=t.plantCode||t.assignedPlant||"";return o.localeCompare(s)},width:120},{title:"Documents",key:"documentCount",render:(e,t)=>(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(U.A,{count:t.documentCount||0,style:{backgroundColor:t.documentCount>0?"#52c41a":"#ff4d4f"}}),(0,ee.jsx)(Ae,{type:t.documentCount>0?"secondary":"warning",children:t.documentCount>0?"files":"none"}),(!t.documentCount||0===t.documentCount)&&(0,ee.jsx)(he.A,{title:"No documents uploaded. Click 'View Details' to upload documents.",children:(0,ee.jsx)(i.A,{style:{color:"#fa8c16"}})})]}),sorter:(e,t)=>(e.documentCount||0)-(t.documentCount||0)},{title:"Initiated By",dataIndex:"initiatedBy",key:"initiatedBy",render:e=>(0,ee.jsx)(Ae,{children:e||"Unknown"}),sorter:(e,t)=>(e.initiatedBy||"").localeCompare(t.initiatedBy||"")},{title:"Created Date",dataIndex:"createdAt",key:"createdAt",render:e=>(0,ee.jsxs)(f.A,{direction:"vertical",size:"small",children:[(0,ee.jsx)(Ae,{children:new Date(e).toLocaleDateString()}),(0,ee.jsx)(Ae,{type:"secondary",style:{fontSize:"12px"},children:new Date(e).toLocaleTimeString()})]}),sorter:(e,t)=>new Date(e.createdAt)-new Date(t.createdAt)},{title:"Days Pending",key:"daysPending",render:(e,t)=>{const o=L(t.createdAt),s=B(t.createdAt);return(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(U.A,{count:o,style:{backgroundColor:s.color}}),(0,ee.jsxs)(Ae,{type:"overdue"===s.status?"danger":"secondary",children:[o," day",1!==o?"s":""]})]})},sorter:(e,t)=>L(e.createdAt)-L(t.createdAt)},{title:"SLA Status",key:"slaStatus",render:(e,t)=>{const o=B(t.createdAt);return(0,ee.jsx)(p.A,{color:o.color,icon:"overdue"===o.status?(0,ee.jsx)(i.A,{}):(0,ee.jsx)(r.A,{}),children:o.text})}},{title:"Actions",key:"actions",render:(e,t)=>(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(he.A,{title:"View Details",children:(0,ee.jsx)(x.Ay,{type:"text",icon:(0,ee.jsx)(ie.A,{}),onClick:()=>q(t),size:"small"})}),(0,ee.jsx)(x.Ay,{type:"primary",icon:(0,ee.jsx)(de.A,{}),onClick:()=>N(t),size:"small",children:"Send to Plant"})]})}];return(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(y.A,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(Ce,{level:4,style:{margin:0},children:"Pending Extensions"}),(0,ee.jsx)(U.A,{count:d.length,style:{backgroundColor:"#fa8c16"}})]}),extra:(0,ee.jsx)(x.Ay,{icon:(0,ee.jsx)(l.A,{}),onClick:M,loading:u,children:"Refresh"}),children:[(0,ee.jsxs)(w.A,{gutter:16,style:{marginBottom:16},children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:V.total}),(0,ee.jsx)("div",{style:{color:"#666"},children:"Total Pending"}),(0,ee.jsxs)("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:["Avg: ",V.total>0?Math.round(s.reduce((e,t)=>e+L(t.createdAt),0)/V.total*10)/10:0," days"]})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ff4d4f"},children:V.overdue}),(0,ee.jsx)("div",{style:{color:"#666"},children:"Overdue (>3 days)"}),(0,ee.jsxs)("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:[V.total>0?Math.round(V.overdue/V.total*100):0,"% of total"]})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#fa8c16"},children:V.warning}),(0,ee.jsx)("div",{style:{color:"#666"},children:"Warning (2-3 days)"}),(0,ee.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Need attention soon"})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:V.normal}),(0,ee.jsx)("div",{style:{color:"#666"},children:"On Track (<2 days)"}),(0,ee.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"Within SLA"})]})})})]}),(0,ee.jsxs)(y.A,{title:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(ce.A,{}),(0,ee.jsx)("span",{children:"Project & Material Context Overview"})]}),size:"small",style:{marginBottom:16},children:[(0,ee.jsxs)(w.A,{gutter:16,style:{marginBottom:12},children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f"},children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#389e0d"},children:V.uniqueProjects}),(0,ee.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"Unique Projects"}),(0,ee.jsx)("div",{style:{color:"#999",fontSize:"10px"},children:"Across all pending extensions"})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f"},children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#389e0d"},children:V.uniqueMaterials}),(0,ee.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"Unique Materials"}),(0,ee.jsx)("div",{style:{color:"#999",fontSize:"10px"},children:"Material safety extensions"})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f"},children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#389e0d"},children:V.uniquePlants}),(0,ee.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"Target Plants"}),(0,ee.jsx)("div",{style:{color:"#999",fontSize:"10px"},children:"Plant locations involved"})]})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f"},children:(0,ee.jsxs)("div",{style:{textAlign:"center"},children:[(0,ee.jsx)("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#389e0d"},children:V.totalDocuments}),(0,ee.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"Total Documents"}),(0,ee.jsxs)("div",{style:{color:"#999",fontSize:"10px"},children:["Avg: ",V.avgDocumentsPerWorkflow," per workflow"]})]})})})]}),(0,ee.jsx)(C.A,{message:"Enhanced Project/Material Context",description:`This view provides comprehensive filtering and context for ${V.total} pending extensions across ${V.uniqueProjects} projects, ${V.uniqueMaterials} materials, and ${V.uniquePlants} plant locations. Use the filters below to narrow down by specific project codes, material codes, plant locations, or document availability.`,type:"info",showIcon:!0,size:"small"})]}),(0,ee.jsx)(y.A,{size:"small",style:{marginBottom:16,backgroundColor:"#fafafa"},children:(0,ee.jsxs)(w.A,{gutter:16,align:"middle",children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(ue.A,{}),(0,ee.jsx)(Ae,{strong:!0,children:"Enhanced Filtering:"})]})}),(0,ee.jsx)(g.A,{span:18,children:(0,ee.jsx)(Ae,{type:"secondary",children:"Filter by project codes, material codes, plant locations, SLA status, document availability, and creation dates for comprehensive workflow management"})})]})}),(0,ee.jsxs)(w.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(Se,{placeholder:"Search by project, material, plant, or initiator",value:F.search,onChange:e=>W(t=>({...t,search:e.target.value})),allowClear:!0,size:"large"})}),(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsx)(E.A,{placeholder:"Project Code",value:F.projectCode,onChange:e=>W(t=>({...t,projectCode:e})),allowClear:!0,style:{width:"100%"},showSearch:!0,optionFilterProp:"children",children:G.map(e=>(0,ee.jsx)(ve,{value:e,children:e},e))})}),(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsx)(E.A,{placeholder:"Material Code",value:F.materialCode,onChange:e=>W(t=>({...t,materialCode:e})),allowClear:!0,style:{width:"100%"},showSearch:!0,optionFilterProp:"children",children:J.map(e=>(0,ee.jsx)(ve,{value:e,children:e},e))})}),(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsx)(E.A,{placeholder:"Plant Code",value:F.plantCode,onChange:e=>W(t=>({...t,plantCode:e})),allowClear:!0,style:{width:"100%"},children:K.map(e=>(0,ee.jsx)(ve,{value:e,children:e},e))})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(x.Ay,{icon:(0,ee.jsx)(ue.A,{}),onClick:()=>{W({search:"",projectCode:"",plantCode:"",materialCode:"",dateRange:null,slaStatus:"",documentCount:"",initiatedBy:""})},title:"Reset All Filters",style:{width:"100%"},children:"Reset All Filters"})})]}),(0,ee.jsxs)(w.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsxs)(E.A,{placeholder:"SLA Status",value:F.slaStatus,onChange:e=>W(t=>({...t,slaStatus:e})),allowClear:!0,style:{width:"100%"},children:[(0,ee.jsx)(ve,{value:"normal",children:"On Track"}),(0,ee.jsx)(ve,{value:"warning",children:"Warning"}),(0,ee.jsx)(ve,{value:"overdue",children:"Overdue"})]})}),(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsxs)(E.A,{placeholder:"Documents",value:F.documentCount,onChange:e=>W(t=>({...t,documentCount:e})),allowClear:!0,style:{width:"100%"},children:[(0,ee.jsx)(ve,{value:"with",children:"With Documents"}),(0,ee.jsx)(ve,{value:"without",children:"Without Documents"})]})}),(0,ee.jsx)(g.A,{span:4,children:(0,ee.jsx)(E.A,{placeholder:"Initiated By",value:F.initiatedBy,onChange:e=>W(t=>({...t,initiatedBy:e})),allowClear:!0,style:{width:"100%"},showSearch:!0,optionFilterProp:"children",children:X.map(e=>(0,ee.jsx)(ve,{value:e,children:e},e))})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(ke,{value:F.dateRange,onChange:e=>W(t=>({...t,dateRange:e})),style:{width:"100%"},placeholder:["Start Date","End Date"]})}),(0,ee.jsx)(g.A,{span:2,children:(0,ee.jsxs)(Ae,{type:"secondary",style:{lineHeight:"32px",textAlign:"center"},children:["Showing ",d.length," of ",s.length," extensions"]})})]}),(0,ee.jsx)(j.A,{dataSource:d,columns:H,rowKey:"id",loading:u,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},locale:{emptyText:"No pending extensions found"},scroll:{x:1200}})]}),(0,ee.jsx)(T.A,{title:`Workflow Details - ${null===A||void 0===A?void 0:A.projectCode} / ${null===A||void 0===A?void 0:A.materialCode}`,open:S,onCancel:()=>{b(!1),k(null),I([]),R(!1)},width:800,footer:[(0,ee.jsx)(x.Ay,{onClick:()=>{b(!1),k(null),I([]),R(!1)},children:"Close"},"close"),(0,ee.jsx)(x.Ay,{type:"primary",icon:(0,ee.jsx)(de.A,{}),onClick:()=>{N(A),b(!1),k(null),I([]),R(!1)},children:"Extend to Plant"},"extend")],children:A&&(0,ee.jsxs)("div",{children:[(0,ee.jsxs)(z.A,{bordered:!0,size:"small",column:2,children:[(0,ee.jsx)(z.A.Item,{label:"Project Code",children:A.projectCode}),(0,ee.jsx)(z.A.Item,{label:"Material Code",children:A.materialCode}),(0,ee.jsx)(z.A.Item,{label:"Plant Code",children:A.plantCode}),(0,ee.jsx)(z.A.Item,{label:"Initiated By",children:A.initiatedBy}),(0,ee.jsx)(z.A.Item,{label:"Created",children:new Date(A.createdAt).toLocaleDateString()}),(0,ee.jsx)(z.A.Item,{label:"Days Pending",span:2,children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsxs)(Ae,{children:[L(A.createdAt)," days"]}),(0,ee.jsx)(p.A,{color:B(A.createdAt).color,children:B(A.createdAt).text})]})})]}),(0,ee.jsxs)("div",{style:{marginTop:16},children:[(0,ee.jsxs)(w.A,{justify:"space-between",align:"middle",style:{marginBottom:8},children:[(0,ee.jsx)(g.A,{children:(0,ee.jsxs)(Ce,{level:5,style:{margin:0},children:[(0,ee.jsx)(P.A,{})," Documents (",D.length,")"]})}),(0,ee.jsx)(g.A,{children:(0,ee.jsx)(x.Ay,{type:"dashed",icon:(0,ee.jsx)(n.A,{}),size:"small",onClick:()=>R(!$),children:$?"Hide Upload":"Add Documents"})})]}),D.length>0?(0,ee.jsx)(O.A,{size:"small",bordered:!0,dataSource:D,renderItem:e=>(0,ee.jsx)(O.A.Item,{actions:[(0,ee.jsx)(x.Ay,{type:"link",size:"small",onClick:async()=>{try{const t=await _(e.id),o=window.URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=e.originalFileName||`document_${e.id}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),m.Ay.success(`Downloaded ${e.originalFileName}`)}catch(t){console.error("Error downloading document:",t),m.Ay.error("Failed to download document")}},children:"Download"},"download")],children:(0,ee.jsx)(O.A.Item.Meta,{avatar:(0,ee.jsx)(P.A,{}),title:e.originalFileName,description:`Size: ${(e.fileSize/1024/1024).toFixed(2)} MB`})})}):(0,ee.jsx)(C.A,{message:"No documents uploaded",description:"This workflow doesn't have any documents attached yet. Click 'Add Documents' to upload files.",type:"warning",showIcon:!0}),(0===D.length||$)&&(0,ee.jsx)("div",{style:{marginTop:16},children:(0,ee.jsx)(je,{workflowId:null===A||void 0===A?void 0:A.id,projectCode:null===A||void 0===A?void 0:A.projectCode,materialCode:null===A||void 0===A?void 0:A.materialCode,onDocumentsUploaded:()=>{q(A),M(),R(!1)}})})]})]})})]})};var De=o(8365),Ie=o(173),$e=o(5423);const{Title:Re,Text:Pe}=c.A,{TabPane:Fe}=u.A,Ee=()=>{const[e,t]=(0,v.useState)(!1),[o,c]=(0,v.useState)([]),[S,b]=(0,v.useState)(null),[D,I]=(0,v.useState)(!1),[$,R]=(0,v.useState)("initiate"),[P,F]=(0,v.useState)(0),[E]=(0,v.useState)(0),[W,T]=(0,v.useState)({totalQueries:0,openQueries:0,resolvedToday:0,overdueQueries:0,avgResolutionTime:0,highPriorityQueries:0});(0,v.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await Promise.all([z(e.signal),U(e.signal)])}catch(t){e.signal.aborted||console.error("Error loading JVC data:",t)}})(),()=>{e.abort()}},[]);const z=async e=>{try{t(!0);const o=await fe.S.getWorkflowsByState(L.Fv.COMPLETED,{signal:e});null!==e&&void 0!==e&&e.aborted||c(o||[])}catch(o){null!==e&&void 0!==e&&e.aborted||(console.error("Error loading completed workflows:",o),m.Ay.error("Failed to load completed workflows"))}finally{null!==e&&void 0!==e&&e.aborted||t(!1)}},U=async e=>{try{const[t,o,s,l,n]=await Promise.all([k.default.get("/queries/stats/count-open/JVC",{signal:e}).catch(()=>0),k.default.get("/queries/stats/resolved-today",{signal:e}).catch(()=>0),k.default.get("/queries/overdue",{signal:e}).then(e=>Array.isArray(e)?e.filter(e=>e.assignedTeam===L.r0.JVC).length:0).catch(()=>0),k.default.get("/queries/stats/avg-resolution-time/JVC",{signal:e}).catch(()=>0),k.default.get("/queries/high-priority",{signal:e}).then(e=>Array.isArray(e)?e.filter(e=>e.assignedTeam===L.r0.JVC).length:0).catch(()=>0)]);T({totalQueries:(t||0)+(o||0),openQueries:t||0,resolvedToday:o||0,overdueQueries:s||0,avgResolutionTime:l||0,highPriorityQueries:n||0})}catch(t){console.error("Failed to load query stats:",t),T({totalQueries:0,openQueries:0,resolvedToday:0,overdueQueries:0,avgResolutionTime:0,highPriorityQueries:0})}},O=[{title:"Project Code",dataIndex:"projectCode",key:"projectCode",render:e=>(0,ee.jsx)(Pe,{strong:!0,children:e})},{title:"Material Code",dataIndex:"materialCode",key:"materialCode",width:140,render:(e,t)=>(0,ee.jsxs)("div",{children:[(0,ee.jsx)(Pe,{code:!0,style:{fontWeight:"bold"},children:e}),t.itemDescription&&(0,ee.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"2px"},children:t.itemDescription})]})},{title:"Plant Code",dataIndex:"plantCode",key:"plantCode"},{title:"Completed",dataIndex:"lastModified",key:"lastModified",render:e=>new Date(e).toLocaleDateString()},{title:"Status",dataIndex:"state",key:"state",render:()=>(0,ee.jsx)(p.A,{color:"green",icon:(0,ee.jsx)(s.A,{}),children:"Completed"})}];return(0,ee.jsx)($e.kz,{children:(0,ee.jsxs)("div",{style:{padding:24},children:[(0,ee.jsx)(Re,{level:2,children:"JVC Dashboard"}),(0,ee.jsx)(Pe,{type:"secondary",children:"Initiate MSDS workflows and manage material safety documentation process"}),(0,ee.jsx)(h.A,{}),(0,ee.jsxs)(u.A,{activeKey:$,onChange:R,tabBarExtraContent:(0,ee.jsx)(f.A,{children:(0,ee.jsx)(x.Ay,{icon:(0,ee.jsx)(l.A,{}),onClick:()=>{z(),U(),F(e=>e+1)},size:"small",children:"Refresh"})}),children:[(0,ee.jsx)(Fe,{tab:"Initiate Workflow",icon:(0,ee.jsx)(n.A,{}),children:(0,ee.jsxs)(w.A,{gutter:24,children:[(0,ee.jsx)(g.A,{span:18,children:(0,ee.jsx)(ae,{onSubmit:async e=>{try{t(!0);const d=e.plantCodes||[];if(d.length>1){const t={projectCode:e.projectCode,materialCode:e.materialCode,plantCodes:d},o=await fe.S.extendToMultiplePlantsSmartly(t);if(o.details.newlyCreatedWorkflows.length>0){const t=[];for(const s of o.details.newlyCreatedWorkflows)try{if(e.uploadedFiles&&e.uploadedFiles.length>0){const t=e.uploadedFiles.map(e=>e.originFileObj||e);await B(t,e.projectCode,e.materialCode,s.id)}e.reusedDocuments&&e.reusedDocuments.length>0&&await q(e.reusedDocuments,s.id)}catch(i){console.error(`Document operation failed for workflow ${s.id}:`,i),t.push({workflowId:s.id,plantCode:s.plantCode,error:i.message||"Document operation failed"})}if(t.length>0){const e=t.map(e=>e.plantCode).join(", "),o=`Document operations failed for ${t.length} workflow(s) at plant${1!==t.length?"s":""}: ${e}. Workflows were created successfully but documents may need to be uploaded manually.`;console.error("Document operation failures:",t),m.Ay.warning({content:o,duration:12,style:{marginTop:"20vh"}}),t.forEach(e=>{console.error(`Plant ${e.plantCode} (Workflow ${e.workflowId}): ${e.error}`)})}}let s=o.message;if(o.details.documentReuse&&o.details.documentReuse.totalReusedDocuments>0){const e=o.details.documentReuse,t=e.totalReusedDocuments,l=o.details.newlyCreatedWorkflows.length;if(s+=` ${t} document${1!==t?"s":""} ${1===t?"was":"were"} automatically reused across ${l} workflow${1!==l?"s":""}.`,e.statistics){const t=[];e.statistics.workflowDocuments>0&&t.push(`${e.statistics.workflowDocuments} from previous workflows`),e.statistics.queryDocuments>0&&t.push(`${e.statistics.queryDocuments} from queries`),e.statistics.responseDocuments>0&&t.push(`${e.statistics.responseDocuments} from query responses`),t.length>0&&(s+=` Document sources: ${t.join(", ")}.`)}e.reuseStrategy&&(s+=` Reuse strategy: ${e.reuseStrategy}.`),e.sourceDescription&&(s+=` ${e.sourceDescription}`)}else s+=" No existing documents were found for automatic reuse.";if(m.Ay.success({content:s,duration:10,style:{marginTop:"20vh"}}),o.details.documentReuse&&o.details.documentReuse.totalReusedDocuments>5){const e=o.details.documentReuse;setTimeout(()=>{m.Ay.info({content:`Document reuse summary: ${e.totalReusedDocuments} documents were automatically attached to ${o.details.newlyCreatedWorkflows.length} workflows, saving time and ensuring consistency across plants.`,duration:6,style:{marginTop:"20vh"}})},2e3)}return F(e=>e+1),R(L.tS.PENDING),z(),U(),{success:o.success,message:s,summary:o.summary,details:o.details,createdWorkflows:o.details.newlyCreatedWorkflows,duplicateWorkflows:o.details.duplicateWorkflows.existingWorkflows,duplicatePlants:o.details.duplicateWorkflows.plants,failedPlants:o.details.failedPlants,isSmartExtension:!0}}const c=d[0],u=await(async(e,t,o)=>{try{console.log("Checking for existing workflow:",{projectCode:e,materialCode:t,plantCode:o});const s=await fe.S.checkWorkflowExists(e,t,o);return console.log("Check workflow response:",s),s.exists?s.workflow:null}catch(s){return console.error("Error checking for existing workflow:",s),null}})(e.projectCode,e.materialCode,c);if(u)return{isDuplicate:!0,existingWorkflow:u,formData:e,duplicateWorkflows:[{plantCode:c,existingWorkflow:u}]};const p={projectCode:e.projectCode,materialCode:e.materialCode,plantCode:c,initiatedBy:"current-user"},h=await fe.S.createWorkflow(p);let f=!1,x="";try{if(e.uploadedFiles&&e.uploadedFiles.length>0){const t=e.uploadedFiles.map(e=>e.originFileObj||e);await B(t,e.projectCode,e.materialCode,h.id)}e.reusedDocuments&&e.reusedDocuments.length>0&&await q(e.reusedDocuments,h.id)}catch(i){var o,s;console.error("Document operation failed for single workflow:",i),f=!0,x=i.message||"Document operation failed";const t=(null===(o=e.uploadedFiles)||void 0===o?void 0:o.length)||0,l=(null===(s=e.reusedDocuments)||void 0===s?void 0:s.length)||0;let n="";n=t>0&&l>0?"document upload and reuse operations":t>0?"document upload operation":l>0?"document reuse operation":"document operations",m.Ay.warning({content:`Workflow created successfully for ${e.projectCode}/${e.materialCode} at plant ${c}, but ${n} failed: ${x}. Please upload or reuse documents manually from the workflow details page.`,duration:10,style:{marginTop:"20vh"}})}if(!f){var l,n;const t=((null===(l=e.uploadedFiles)||void 0===l?void 0:l.length)||0)+((null===(n=e.reusedDocuments)||void 0===n?void 0:n.length)||0);let o=`Workflow created successfully for ${e.projectCode}/${e.materialCode} at plant ${c}.`;if(t>0){var r,a;const s=(null===(r=e.uploadedFiles)||void 0===r?void 0:r.length)||0,l=(null===(a=e.reusedDocuments)||void 0===a?void 0:a.length)||0;o+=` ${t} document${1!==t?"s":""} ${1===t?"was":"were"} attached`,s>0&&l>0?o+=` (${s} newly uploaded, ${l} reused from existing materials)`:l>0?o+=` (all ${l} reused from existing materials for this project/material combination)`:s>0&&(o+=` (all ${s} newly uploaded)`),o+="."}else o+=" No documents were attached to this workflow.";m.Ay.success({content:o,duration:8,style:{marginTop:"20vh"}})}return F(e=>e+1),R(L.tS.PENDING),z(),U(),{success:!0,message:f?`Workflow created successfully but document operations failed: ${x}. Please upload documents manually.`:`Workflow created successfully for ${e.projectCode}/${e.materialCode} at plant ${c} with all document operations completed.`,createdWorkflows:[h],duplicateWorkflows:[],duplicatePlants:[],failedPlants:[],documentOperationFailed:f,documentErrorMessage:x}}catch(d){console.error("Error initiating workflows:",d);let e="Failed to initiate workflows";return e=d.message?d.message.includes("document")?`Workflow creation failed due to document processing error: ${d.message}`:d.message.includes("duplicate")?`Workflow creation failed due to duplicate detection: ${d.message}`:d.message.includes("permission")||d.message.includes("access")?`Workflow creation failed due to access permissions: ${d.message}`:`Failed to initiate workflows: ${d.message}`:"Failed to initiate workflows. Please check your connection and try again.",m.Ay.error({content:e,duration:8,style:{marginTop:"20vh"}}),{success:!1,error:d.message||"Unknown error occurred",message:e}}finally{t(!1)}},loading:e},E)}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{title:"Quick Stats",children:(0,ee.jsx)("div",{style:{textAlign:"center"},children:(0,ee.jsxs)("div",{style:{marginBottom:16},children:[(0,ee.jsx)(Pe,{type:"secondary",children:"Completed This Month"}),(0,ee.jsx)("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:o.length})]})})})})]})},"initiate"),(0,ee.jsx)(Fe,{tab:"Pending Extensions",icon:(0,ee.jsx)(r.A,{}),children:(0,ee.jsx)(be,{onExtendToPlant:async e=>{try{t(!0),await fe.S.extendWorkflow(e.id,{plantCode:e.plantCode,comment:`Extended to plant ${e.plantCode} for questionnaire completion. Project: ${e.projectCode}, Material: ${e.materialCode}`}),m.Ay.success({content:`Workflow successfully extended to plant ${e.plantCode}. Plant team has been notified to begin questionnaire completion for ${e.projectCode}/${e.materialCode}.`,duration:6}),F(e=>e+1),U()}catch(o){throw console.error("Error extending workflow:",o),m.Ay.error({content:`Failed to extend workflow for ${e.projectCode}/${e.materialCode} to plant ${e.plantCode}. Please try again.`,duration:5}),o}finally{t(!1)}},refreshTrigger:P})},"pending"),(0,ee.jsx)(Fe,{tab:`Completed (${o.length})`,icon:(0,ee.jsx)(s.A,{}),children:(0,ee.jsx)(y.A,{title:"Completed Workflows",children:(0,ee.jsx)(j.A,{dataSource:o,columns:O,rowKey:"id",loading:e,pagination:{pageSize:L.Bq.DEFAULT_PAGE_SIZE},locale:{emptyText:"No completed workflows"}})})},"completed"),(0,ee.jsxs)(Fe,{tab:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(a.A,{}),(0,ee.jsx)("span",{children:"Query Inbox"}),W.openQueries>0&&(0,ee.jsx)("span",{style:{background:"#ff4d4f",color:"white",borderRadius:"10px",padding:"2px 6px",fontSize:"12px"},children:W.openQueries})]}),children:[(0,ee.jsxs)(w.A,{gutter:16,style:{marginBottom:16},children:[(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{children:(0,ee.jsx)(A.A,{title:"Open Queries",value:W.openQueries,prefix:(0,ee.jsx)(a.A,{}),valueStyle:{color:"#cf1322"}})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{children:(0,ee.jsx)(A.A,{title:"Resolved Today",value:W.resolvedToday,prefix:(0,ee.jsx)(s.A,{}),valueStyle:{color:"#3f8600"}})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{children:(0,ee.jsx)(A.A,{title:"Overdue",value:W.overdueQueries,prefix:(0,ee.jsx)(i.A,{}),valueStyle:{color:W.overdueQueries>0?"#cf1322":"#3f8600"}})})}),(0,ee.jsx)(g.A,{span:6,children:(0,ee.jsx)(y.A,{children:(0,ee.jsx)(A.A,{title:"Avg Resolution",value:W.avgResolutionTime,precision:1,suffix:"hrs",prefix:(0,ee.jsx)(r.A,{})})})})]}),W.overdueQueries>0&&(0,ee.jsx)(C.A,{message:`${W.overdueQueries} queries are overdue (>3 days)`,description:"These queries require immediate attention to maintain SLA compliance.",type:"error",showIcon:!0,style:{marginBottom:16},action:(0,ee.jsx)(x.Ay,{size:"small",danger:!0,children:"View Overdue"})}),W.highPriorityQueries>0&&(0,ee.jsx)(C.A,{message:`${W.highPriorityQueries} high priority queries pending`,description:"These queries have been marked as high priority and need urgent resolution.",type:"warning",showIcon:!0,style:{marginBottom:16},action:(0,ee.jsx)(x.Ay,{size:"small",type:"primary",children:"View High Priority"})}),(0,ee.jsx)(Ie.A,{team:"JVC",userRole:"JVC_USER"})]},"queries"),(0,ee.jsx)(Fe,{tab:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(d.A,{}),(0,ee.jsx)("span",{children:"Query History"})]}),children:(0,ee.jsx)(De.A,{})},"history")]})]})})}},9394:(e,t,o)=>{o.d(t,{S:()=>l});var s=o(6649);const l={getDashboardSummary:()=>s.default.get("/dashboard/summary"),getOverdueWorkflows:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return s.default.get(`/workflows/overdue?days=${e}`)},getRecentActivity:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/created?days=${e}`)},getWorkflowCountsByState:()=>s.default.get("/dashboard/counts-by-state"),getWorkflowsByPlant:e=>s.default.get(`/workflows/plant/${encodeURIComponent(e)}`),createWorkflow:e=>s.default.post("/workflows",e),getWorkflow:e=>s.default.get(`/workflows/${e}`),updateWorkflow:(e,t)=>s.default.put(`/workflows/${e}`,t),deleteWorkflow:e=>s.default.delete(`/workflows/${e}`),transitionWorkflowState:(e,t,o)=>s.default.put(`/workflows/${e}/transition`,{newState:t,comment:o}),extendWorkflow:(e,t)=>s.default.put(`/workflows/${e}/extend`,t),completeWorkflow:(e,t)=>s.default.put(`/workflows/${e}/complete`,t),extendToMultiplePlantsSmartly:async e=>{try{const t=await s.default.withRetry(()=>s.default.post("/workflows/extend-to-plants",e),3,1e3);return{...t,documentReuse:t.documentReuse||{totalReusedDocuments:0,reusedDocuments:[],reuseStrategy:"NONE",sourceDescription:"No documents available for reuse"}}}catch(t){throw console.error("[WorkflowAPI] Smart extension failed:",t),{...t,context:"SMART_PLANT_EXTENSION",extensionData:e}}},searchWorkflows:e=>s.default.post("/workflows/search",e),getWorkflowsByState:e=>s.default.get(`/workflows/state/${e}`),getWorkflowsByUser:e=>s.default.get(`/workflows/initiated-by/${encodeURIComponent(e)}`),canTransitionTo:(e,t)=>s.default.get(`/workflows/${e}/can-transition/${t}`),isReadyForCompletion:e=>s.default.get(`/workflows/${e}/ready-for-completion`),checkWorkflowExists:(e,t,o)=>s.default.get(`/workflows/check-exists?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(o)}`),getWorkflowStats:e=>s.default.get(`/workflows/stats?range=${e}`),getCompletionRateByPlant:()=>s.default.get("/workflows/completion-rate-by-plant"),getWorkflowCompletionTrend:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return s.default.get(`/workflows/completion-trend?months=${e}`)},getPendingWorkflows:()=>s.default.get("/workflows/pending"),getWorkflowsWithOpenQueries:()=>s.default.get("/workflows/with-open-queries"),getCountByState:e=>s.default.get(`/workflows/stats/count-by-state/${e}`),getOverdueCount:()=>s.default.get("/workflows/stats/overdue-count"),getWorkflowsWithOpenQueriesCount:()=>s.default.get("/workflows/stats/with-open-queries-count"),getRecentlyCreated:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/created?days=${e}`)},getRecentlyCompleted:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/completed?days=${e}`)},saveDraftResponses:(e,t)=>s.default.post(`/workflows/${e}/draft-responses`,t),getDraftResponses:e=>s.default.get(`/workflows/${e}/draft-responses`),submitQuestionnaire:(e,t)=>s.default.post(`/workflows/${e}/submit-questionnaire`,t),getWorkflowDocuments:e=>s.default.get(`/workflows/${e}/documents`),getAllWorkflowRelatedDocuments:async e=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/${e}/documents/all`),2,500)}catch(t){throw console.error(`[WorkflowAPI] Failed to get all documents for workflow ${e}:`,t),{...t,context:"GET_ALL_WORKFLOW_DOCUMENTS",workflowId:e}}},exportWorkflowDocuments:async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{return await s.default.withRetry(()=>s.default.download(`/workflows/${e}/documents/export?includeQueryDocuments=${t}`),2,1e3)}catch(o){throw console.error(`[WorkflowAPI] Failed to export documents for workflow ${e}:`,o),{...o,context:"EXPORT_WORKFLOW_DOCUMENTS",workflowId:e,includeQueryDocuments:t}}},searchUnifiedDocuments:async e=>{try{return await s.default.withRetry(()=>s.default.post("/documents/search/unified",e),2,500)}catch(t){throw console.error("[WorkflowAPI] Unified document search failed:",t),{...t,context:"UNIFIED_DOCUMENT_SEARCH",searchParams:e}}},getUnifiedDocumentInfo:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/documents/unified-info?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(o){throw console.error(`[WorkflowAPI] Failed to get unified document info for ${e}/${t}:`,o),{...o,context:"GET_UNIFIED_DOCUMENT_INFO",projectCode:e,materialCode:t}}},getReusableDocuments:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/documents/reusable?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(o){throw console.error(`[WorkflowAPI] Failed to get reusable documents for ${e}/${t}:`,o),{...o,context:"GET_REUSABLE_DOCUMENTS",projectCode:e,materialCode:t}}},downloadDocument:async e=>{try{return await s.default.withRetry(()=>s.default.download(`/workflows/documents/${e}/download`),3,1e3)}catch(t){throw console.error(`[WorkflowAPI] Failed to download document ${e}:`,t),{...t,context:"DOWNLOAD_DOCUMENT",documentId:e}}},uploadDocument:async(e,t,o)=>{try{return await s.default.withRetry(()=>s.default.upload(`/workflows/${e}/documents`,t,{metadata:JSON.stringify(o)}),2,1e3)}catch(l){throw console.error(`[WorkflowAPI] Failed to upload document to workflow ${e}:`,l),{...l,context:"UPLOAD_DOCUMENT",workflowId:e,fileName:(null===t||void 0===t?void 0:t.name)||"unknown"}}},uploadMultipleDocuments:async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=[],n=[];for(const a of t)try{const t=await l.uploadDocument(e,a,o);s.push({file:a.name,result:t,success:!0})}catch(r){console.error(`[WorkflowAPI] Failed to upload ${a.name}:`,r),n.push({file:a.name,error:r,success:!1})}return{successful:s,failed:n,totalFiles:t.length,successCount:s.length,failureCount:n.length}},retryDocumentOperation:async function(e,t){let o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;for(let r=1;r<=s;r++)try{switch(e){case"UPLOAD":return await l.uploadDocument(t.workflowId,t.file,t.metadata);case"DOWNLOAD":return await l.downloadDocument(t.documentId);case"GET_DOCUMENTS":return await l.getAllWorkflowRelatedDocuments(t.workflowId);default:throw new Error(`Unknown operation type: ${e}`)}}catch(n){if(o=n,console.warn(`[WorkflowAPI] Retry attempt ${r}/${s} failed for ${e}:`,n),r<s){const e=1e3*Math.pow(2,r);await new Promise(t=>setTimeout(t,e))}}throw{...o,context:"RETRY_OPERATION_FAILED",operationType:e,maxRetries:s,finalAttempt:!0}},updateAllMaterialNamesFromProjectItemMaster:()=>s.default.post("/workflows/update-material-names"),updateMaterialNameFromProjectItemMaster:e=>s.default.post(`/workflows/${e}/update-material-name`),getQuestionnaireTemplate:e=>{let{materialCode:t,plantCode:o,templateType:l="PLANT_QUESTIONNAIRE"}=e;return s.default.get(`/plant-questionnaire/template?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(o)}&templateType=${encodeURIComponent(l)}`)},getCqsData:e=>{let{materialCode:t,plantCode:o}=e;return s.default.get(`/plant-questionnaire/cqs-data?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(o)}`)},getPlantSpecificData:e=>{let{plantCode:t,materialCode:o}=e;return s.default.get(`/plant-questionnaire/plant-data?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(o)}`)},getOrCreatePlantSpecificData:e=>{let{plantCode:t,materialCode:o,workflowId:l}=e;return s.default.post(`/plant-questionnaire/plant-data/init?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(o)}&workflowId=${l}`)},savePlantSpecificData:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SYSTEM";return s.default.post(`/plant-questionnaire/plant-data/save?modifiedBy=${encodeURIComponent(t)}`,e)},saveDraftPlantResponses:(e,t)=>s.default.post(`/plant-questionnaire/draft?workflowId=${e}`,t),submitPlantQuestionnaire:(e,t)=>s.default.post(`/plant-questionnaire/submit?workflowId=${e}`,t),getPlantQuestionnaireStats:e=>{let{plantCode:t,materialCode:o}=e;const l=new URLSearchParams({plantCode:t});return o&&l.append("materialCode",o),s.default.get(`/plant-questionnaire/stats?${l.toString()}`)},getPlantDashboardData:e=>s.default.get(`/plant-questionnaire/dashboard?plantCode=${encodeURIComponent(e)}`),initializeSamplePlantData:e=>s.default.post(`/plant-questionnaire/init-sample-data?plantCode=${encodeURIComponent(e)}`),getDocumentReuseStats:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/documents/reuse-stats?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(o){throw console.error(`[WorkflowAPI] Failed to get document reuse stats for ${e}/${t}:`,o),{...o,context:"GET_DOCUMENT_REUSE_STATS",projectCode:e,materialCode:t}}},validateDocumentReuse:async(e,t,o)=>{try{return await s.default.withRetry(()=>s.default.post("/workflows/documents/validate-reuse",{projectCode:e,materialCode:t,plantCodes:o}),2,500)}catch(l){throw console.error(`[WorkflowAPI] Failed to validate document reuse for ${e}/${t}:`,l),{...l,context:"VALIDATE_DOCUMENT_REUSE",projectCode:e,materialCode:t,plantCodes:o}}},getDocumentAuditLog:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const o=new URLSearchParams(t).toString();return await s.default.withRetry(()=>s.default.get(`/workflows/${e}/documents/audit-log?${o}`),2,500)}catch(o){throw console.error(`[WorkflowAPI] Failed to get document audit log for workflow ${e}:`,o),{...o,context:"GET_DOCUMENT_AUDIT_LOG",workflowId:e,options:t}}},handleDocumentError:(e,t)=>{const o={originalError:e,operation:t,timestamp:(new Date).toISOString(),userMessage:"An error occurred with document operation",technicalMessage:e.message,recoveryActions:[],retryable:!1};switch(e.context){case"UPLOAD_DOCUMENT":o.userMessage="Failed to upload document. Please check file size and format.",o.recoveryActions=["Verify file is under 25MB","Check file format is supported (PDF, DOCX, XLSX, JPG, PNG)","Try uploading again","Contact support if problem persists"],o.retryable=!0;break;case"DOWNLOAD_DOCUMENT":o.userMessage="Failed to download document. Please try again.",o.recoveryActions=["Check your internet connection","Try downloading again","Contact support if document is corrupted"],o.retryable=!0;break;case"GET_ALL_WORKFLOW_DOCUMENTS":o.userMessage="Failed to load workflow documents.",o.recoveryActions=["Refresh the page","Check your internet connection","Contact support if problem persists"],o.retryable=!0;break;case"SMART_PLANT_EXTENSION":o.userMessage="Failed to extend workflow to plants. Some documents may not have been reused.",o.recoveryActions=["Check if workflows were created successfully","Manually upload documents if needed","Try the extension again","Contact support for assistance"],o.retryable=!0;break;case"UNIFIED_DOCUMENT_SEARCH":o.userMessage="Document search failed. Please try again.",o.recoveryActions=["Simplify your search terms","Try searching again","Use individual document lists instead"],o.retryable=!0;break;default:"NETWORK"===e.type?(o.userMessage="Network error occurred. Please check your connection.",o.retryable=!0):"TIMEOUT"===e.type?(o.userMessage="Operation timed out. Please try again.",o.retryable=!0):413===e.status?(o.userMessage="File is too large. Please use a smaller file.",o.retryable=!1):415===e.status&&(o.userMessage="File type not supported. Please use PDF, DOCX, XLSX, JPG, or PNG.",o.retryable=!1)}return o}}}}]);
//# sourceMappingURL=426.f55c6599.chunk.js.map