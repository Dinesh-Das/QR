"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[664],{2868:(e,t,l)=>{l.d(t,{aZ:()=>u,lX:()=>h,rb:()=>i,Bq:()=>x,fz:()=>n,cS:()=>a,pZ:()=>d,tS:()=>p,r0:()=>c,EW:()=>s,sB:()=>o,Fv:()=>r});const s={MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:1024,PAGE_SIZE:10,DEBOUNCE_DELAY:300},r={INITIATED:"INITIATED",IN_PROGRESS:"IN_PROGRESS",PENDING_REVIEW:"PENDING_REVIEW",APPROVED:"APPROVED",REJECTED:"REJECTED",COMPLETED:"COMPLETED"},n={LOW:"LOW",MEDIUM:"MEDIUM",HIGH:"HIGH",URGENT:"URGENT",CRITICAL:"CRITICAL"},i=(r.INITIATED,r.IN_PROGRESS,r.PENDING_REVIEW,r.APPROVED,r.REJECTED,r.COMPLETED,n.LOW,n.MEDIUM,n.HIGH,n.URGENT,n.CRITICAL,{MAX_UPLOAD_SIZE:26214400,BYTES_PER_KB:1024,BYTES_PER_MB:1048576,BYTES_PER_GB:1073741824}),o={JVC_PENDING:"JVC_PENDING",PLANT_PENDING:"PLANT_PENDING",CQS_PENDING:"CQS_PENDING",TECH_PENDING:"TECH_PENDING",DRAFT:"DRAFT",IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED"},a={OPEN:"OPEN",RESOLVED:"RESOLVED",CLOSED:"CLOSED"},d={ACTIVE:["OPEN"],INACTIVE:["RESOLVED","CLOSED"]},c={CQS:"CQS",TECH:"TECH",JVC:"JVC",PLANT:"PLANT"},u={INTERVAL:4e4,DEBOUNCE_DELAY:15e3},x={DEFAULT_PAGE_SIZE:10,SMALL_PAGE_SIZE:5,LARGE_PAGE_SIZE:15,SHOW_SIZE_CHANGER:!0,SHOW_QUICK_JUMPER:!0},h={ALL:"all",COMPLETED:"completed",IN_PROGRESS:"in-progress",NOT_STARTED:"not-started"},p={INITIATE:"initiate",PENDING:"pending",COMPLETED:"completed",QUERIES:"queries",HISTORY:"history"}},3661:(e,t,l)=>{l.d(t,{B:()=>r});var s=l(6649);const r={createQuery:(e,t)=>s.default.post(`/queries/workflow/${e}`,t),getQuery:e=>s.default.get(`/queries/${e}`),updateQuery:(e,t)=>s.default.put(`/queries/${e}`,t),deleteQuery:e=>s.default.delete(`/queries/${e}`),resolveQuery:(e,t)=>s.default.post(`/queries/${e}/resolve`,t),reopenQuery:(e,t)=>s.default.post(`/queries/${e}/reopen`,{reason:t}),assignQuery:(e,t)=>s.default.post(`/queries/${e}/assign`,t),reassignQuery:(e,t,l)=>s.default.put(`/queries/${e}/assign`,{team:t,reason:l}),getAllQueries:()=>s.default.get("/queries"),getQueriesByWorkflow:e=>s.default.get(`/queries/workflow/${e}`),getQueriesByTeam:e=>s.default.get(`/queries/team/${e}`),getQueriesByStatus:e=>s.default.get(`/queries/status/${e}`),getQueriesByUser:e=>s.default.get("/queries/my-raised"),searchQueries:e=>{const t=new URLSearchParams(e).toString();return s.default.get(`/queries/search?${t}`)},getQueryStats:e=>s.default.get(`/queries/recent?days=${e}`),getQueryCountsByTeam:e=>s.default.get(`/queries/stats/count-open/${e}`),getAvgResolutionTimeByTeam:e=>s.default.get(`/queries/stats/avg-resolution-time/${e}`),getOverdueQueries:function(){return s.default.get("/queries/overdue")},getOverdueQueriesCountByTeam:e=>s.default.get(`/queries/stats/overdue-count/${e}`),getQueriesResolvedTodayByTeam:e=>s.default.get(`/queries/stats/resolved-today/${e}`),getQuerySLAStatus:e=>s.default.get(`/queries/${e}/is-overdue`),getQueriesNearingSLA:function(){return s.default.get("/queries/needing-attention")},addQueryComment:(e,t)=>s.default.post(`/queries/${e}/comments`,{comment:t}),getQueryComments:e=>s.default.get(`/queries/${e}/comments`),updateQueryPriority:(e,t)=>s.default.put(`/queries/${e}/priority`,{priority:t}),escalateQuery:(e,t)=>s.default.put(`/queries/${e}/priority`,{priorityLevel:"HIGH"}),uploadQueryDocuments:(e,t)=>s.default.upload(`/queries/${e}/documents`,t),uploadResponseDocuments:(e,t,l)=>s.default.upload(`/queries/${e}/responses/${t}/documents`,l),getQueryDocuments:e=>s.default.get(`/queries/${e}/documents`),downloadQueryDocument:(e,t)=>s.default.download(`/queries/${e}/documents/${t}/download`),deleteQueryDocument:(e,t)=>s.default.delete(`/queries/${e}/documents/${t}`),closeQuery:(e,t)=>s.default.post(`/queries/${e}/close`,{reason:t}),canPlantEditForm:e=>s.default.get(`/queries/workflow/${e}/can-edit`),getQueryStatusSummary:e=>s.default.get(`/queries/workflow/${e}/status-summary`)}},4664:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var s=l(6091),r=l(617),n=l(8463),i=l(6840),o=l(2878),a=l(4786),d=l(8918),c=l(3927),u=l(6553),x=l(487),h=l(6569),p=l(6399),g=l(6051),f=l(5206),m=l(7419),y=l(1645),j=l(9073),A=l(3217),E=l(2751),v=l(7490),C=l(691),b=l(5043),w=l(3216),S=l(6649),I=l(3722),P=l(119),T=l(6237),R=l(5337),N=l(5444),D=l(9098),O=l(9472),k=l(2868),L=l(3661),B=l(579);const{TabPane:Q}=d.A,{TextArea:_}=N.A,{Option:q}=u.A,{Text:z}=c.A,M=e=>{let{workflowId:t,userRole:l}=e;const[s,i]=(0,b.useState)(!1),[o,a]=(0,b.useState)({all:[],open:[],resolved:[],myQueries:[]}),[c,x]=(0,b.useState)({all:[],open:[],resolved:[],myQueries:[]}),[h,A]=(0,b.useState)(!1),[C,w]=(0,b.useState)(!1),[S,M]=(0,b.useState)(null),[W]=D.A.useForm(),[G]=D.A.useForm(),{isMobile:$}=(()=>{const[e,t]=(0,b.useState)({isMobile:window.innerWidth<=k.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>k.EW.MOBILE_BREAKPOINT&&window.innerWidth<=k.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>k.EW.TABLET_BREAKPOINT});return(0,b.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=k.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>k.EW.MOBILE_BREAKPOINT&&window.innerWidth<=k.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>k.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),[H,V]=(0,b.useState)({team:"all",status:"all",priority:"all",dateRange:"all",materialCode:"",projectCode:"",plantCode:""});(0,b.useEffect)(()=>{const e=new AbortController;return(async()=>{try{i(!0);const t=await L.B.getAllQueries({signal:e.signal});if(!e.signal.aborted){const e={all:t,open:t.filter(e=>k.pZ.ACTIVE.includes(e.status)),resolved:t.filter(e=>k.pZ.INACTIVE.includes(e.status)),myQueries:t.filter(e=>e.createdBy===U())};a(e),x(e)}}catch(t){e.signal.aborted||console.error("Failed to load queries:",t)}finally{e.signal.aborted||i(!1)}})(),()=>{e.abort()}},[]);const F=(0,b.useCallback)(async e=>{try{i(!0);const t=await L.B.getAllQueries({signal:e});if(null===e||void 0===e||!e.aborted){const e={all:t,open:t.filter(e=>k.pZ.ACTIVE.includes(e.status)),resolved:t.filter(e=>k.pZ.INACTIVE.includes(e.status)),myQueries:t.filter(e=>e.createdBy===U())};a(e),x(e)}}catch(t){null!==e&&void 0!==e&&e.aborted||console.error("Failed to load queries:",t)}finally{null!==e&&void 0!==e&&e.aborted||i(!1)}},[]),U=()=>localStorage.getItem("username")||"current_user",J=e=>{e.status;return(0,B.jsx)(j.A,{size:"small",style:{marginBottom:16,border:"1px solid #f0f0f0",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:(0,B.jsxs)("div",{children:[(0,B.jsx)("div",{style:{marginBottom:12},children:(0,B.jsxs)(g.A,{wrap:!0,children:[(0,B.jsxs)(z,{strong:!0,style:{fontSize:"16px"},children:["Query #",e.id]}),(0,B.jsx)(p.A,{color:(r=e.status,{OPEN:"red",RESOLVED:"green",CLOSED:"gray"}[r]||"default"),children:e.status}),(0,B.jsx)(p.A,{color:(s=e.assignedTeam,{CQS:"blue",TECH:"purple",JVC:"orange",PLANT:"green"}[s]||"default"),children:e.assignedTeam}),e.priorityLevel&&(0,B.jsx)(p.A,{color:(l=e.priorityLevel,{LOW:"blue",MEDIUM:"orange",HIGH:"red",URGENT:"purple"}[l]||"default"),children:e.priorityLevel})]})}),(0,B.jsx)("div",{style:{marginBottom:12,padding:"8px",background:"#fafafa",borderRadius:"4px"},children:(0,B.jsxs)(m.A,{gutter:16,children:[e.materialCode&&(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)(z,{strong:!0,style:{color:"#1890ff"},children:"Material:"}),(0,B.jsx)("div",{style:{fontSize:"14px"},children:e.materialCode}),e.materialName&&(0,B.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:e.materialName})]}),e.projectCode&&(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)(z,{strong:!0,style:{color:"#1890ff"},children:"Project:"}),(0,B.jsx)("div",{style:{fontSize:"14px"},children:e.projectCode})]}),e.assignedPlant&&(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)(z,{strong:!0,style:{color:"#1890ff"},children:"Plant:"}),(0,B.jsx)("div",{style:{fontSize:"14px"},children:e.assignedPlant})]})]})}),e.originalQuestion&&(0,B.jsxs)("div",{style:{marginBottom:12,padding:"8px",background:"#f6ffed",borderRadius:"4px",border:"1px solid #b7eb8f"},children:[(0,B.jsx)(z,{strong:!0,style:{color:"#52c41a"},children:"Original Questionnaire Question:"}),(0,B.jsx)("div",{style:{fontSize:"14px",fontStyle:"italic",marginTop:"4px"},children:e.originalQuestion})]}),(0,B.jsxs)("div",{style:{marginBottom:12,padding:"8px",background:"#fff7e6",borderRadius:"4px",border:"1px solid #ffd591"},children:[(0,B.jsx)(z,{strong:!0,style:{color:"#fa8c16"},children:"Query Text (What was asked):"}),(0,B.jsx)("div",{style:{fontSize:"14px",marginTop:"4px",whiteSpace:"pre-wrap"},children:e.question||"No query text available"})]}),(0,B.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:12},children:(0,B.jsxs)(m.A,{gutter:16,children:[(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)(I.A,{})," ",(0,B.jsx)("strong",{children:"Raised by:"})," ",e.raisedBy]}),(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)(P.A,{})," ",(0,B.jsx)("strong",{children:"Created:"})," ",e.createdAt&&new Date(e.createdAt).toLocaleString()]}),(0,B.jsxs)(y.A,{span:8,children:[(0,B.jsx)("strong",{children:"Days open:"})," ",(0,B.jsx)("span",{style:{color:(t=e.daysOpen||0,t>=7?"#ff4d4f":t>=3?"#faad14":"#52c41a")},children:e.daysOpen||0})]})]})}),e.response&&(0,B.jsxs)("div",{style:{marginTop:12,padding:"12px",background:"#f0f9ff",borderRadius:"6px",borderLeft:"4px solid #1890ff"},children:[(0,B.jsx)("div",{style:{marginBottom:8},children:(0,B.jsx)(z,{strong:!0,style:{fontSize:"15px",color:"#1890ff"},children:"Resolution:"})}),(0,B.jsx)("div",{style:{marginBottom:8,fontSize:"14px",whiteSpace:"pre-wrap"},children:e.response}),(0,B.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:(0,B.jsxs)(m.A,{gutter:16,children:[(0,B.jsxs)(y.A,{span:12,children:[(0,B.jsx)(I.A,{})," ",(0,B.jsx)("strong",{children:"Resolved by:"})," ",e.resolvedBy]}),(0,B.jsxs)(y.A,{span:12,children:[(0,B.jsx)(P.A,{})," ",(0,B.jsx)("strong",{children:"Resolved on:"})," ",e.resolvedAt&&new Date(e.resolvedAt).toLocaleString()]})]})})]}),(0,B.jsx)("div",{style:{marginTop:12,textAlign:"right"},children:(0,B.jsxs)(g.A,{children:[e.status===k.cS.OPEN&&K(e)&&(0,B.jsx)(f.Ay,{size:"small",type:"primary",icon:(0,B.jsx)(T.A,{}),onClick:()=>{M(e),w(!0)},children:"Resolve"}),k.pZ.INACTIVE.includes(e.status)&&(0,B.jsx)(f.Ay,{size:"small",type:"link",onClick:()=>{M(e),w(!0)},children:"View Details"})]})}),e.queryCategory&&(0,B.jsxs)("div",{style:{marginTop:8},children:[(0,B.jsx)(z,{strong:!0,style:{fontSize:"12px",color:"#722ed1"},children:"Category: "}),(0,B.jsx)(p.A,{color:"purple",children:e.queryCategory})]})]})},e.id);var t,l,s,r},Y=(0,b.useCallback)(()=>{const e=e=>e.filter(e=>{var t,l;if("all"!==H.team&&e.assignedTeam!==H.team)return!1;if("all"!==H.status&&e.status!==H.status)return!1;if("all"!==H.priority&&e.priorityLevel!==H.priority)return!1;if(H.materialCode&&(null===(t=e.materialCode)||void 0===t||!t.toLowerCase().includes(H.materialCode.toLowerCase())))return!1;if(H.projectCode&&e.projectCode&&!e.projectCode.toLowerCase().includes(H.projectCode.toLowerCase()))return!1;if(H.plantCode&&(null===(l=e.assignedPlant)||void 0===l||!l.toLowerCase().includes(H.plantCode.toLowerCase())))return!1;if("all"!==H.dateRange){const t=new Date(e.createdAt),l=new Date;let s;switch(H.dateRange){case"today":s=new Date(l.getFullYear(),l.getMonth(),l.getDate());break;case"week":s=new Date(l.getTime()-6048e5);break;case"month":s=new Date(l.getFullYear(),l.getMonth(),1);break;case"3months":s=new Date(l.getFullYear(),l.getMonth()-3,1);break;default:return!0}if(t<s)return!1}return!0});x({all:e(o.all),open:e(o.open),resolved:e(o.resolved),myQueries:e(o.myQueries)})},[o,H]);(0,b.useEffect)(()=>{Y()},[o,H,Y]);const K=e=>e.assignedTeam===l||"ADMIN"===l,Z=e=>e.length>0?e.length:null;return(0,B.jsxs)(j.A,{title:"Queries",extra:(0,B.jsxs)(g.A,{children:[(0,B.jsx)(f.Ay,{icon:(0,B.jsx)(r.A,{}),onClick:()=>{const e=new AbortController;F(e.signal)},children:"Refresh"}),[k.r0.PLANT,k.r0.JVC].includes(l)&&(0,B.jsx)(f.Ay,{type:"primary",icon:(0,B.jsx)(R.A,{}),onClick:()=>A(!0),children:"Raise Query"})]}),children:[(0,B.jsx)(j.A,{size:"small",style:{marginBottom:16,background:"#fafafa"},children:(0,B.jsxs)(m.A,{gutter:[16,8],align:"middle",children:[(0,B.jsx)(y.A,{xs:24,sm:6,md:4,children:(0,B.jsxs)(u.A,{placeholder:"Team",value:H.team,onChange:e=>V({...H,team:e}),style:{width:"100%"},size:"small",children:[(0,B.jsx)(u.A.Option,{value:"all",children:"All Teams"}),(0,B.jsx)(u.A.Option,{value:"CQS",children:"CQS"}),(0,B.jsx)(u.A.Option,{value:"TECH",children:"TECH"}),(0,B.jsx)(u.A.Option,{value:"JVC",children:"JVC"}),(0,B.jsx)(u.A.Option,{value:"PLANT",children:"PLANT"})]})}),(0,B.jsx)(y.A,{xs:24,sm:6,md:4,children:(0,B.jsxs)(u.A,{placeholder:"Status",value:H.status,onChange:e=>V({...H,status:e}),style:{width:"100%"},size:"small",children:[(0,B.jsx)(u.A.Option,{value:"all",children:"All Status"}),(0,B.jsx)(u.A.Option,{value:"OPEN",children:"Open"}),(0,B.jsx)(u.A.Option,{value:"RESOLVED",children:"Resolved"}),(0,B.jsx)(u.A.Option,{value:"CLOSED",children:"Closed"})]})}),(0,B.jsx)(y.A,{xs:24,sm:6,md:4,children:(0,B.jsxs)(u.A,{placeholder:"Priority",value:H.priority,onChange:e=>V({...H,priority:e}),style:{width:"100%"},size:"small",children:[(0,B.jsx)(u.A.Option,{value:"all",children:"All Priority"}),(0,B.jsx)(u.A.Option,{value:"LOW",children:"Low"}),(0,B.jsx)(u.A.Option,{value:"MEDIUM",children:"Medium"}),(0,B.jsx)(u.A.Option,{value:"HIGH",children:"High"}),(0,B.jsx)(u.A.Option,{value:"URGENT",children:"Urgent"})]})}),(0,B.jsx)(y.A,{xs:24,sm:6,md:4,children:(0,B.jsxs)(u.A,{placeholder:"Date Range",value:H.dateRange,onChange:e=>V({...H,dateRange:e}),style:{width:"100%"},size:"small",children:[(0,B.jsx)(u.A.Option,{value:"all",children:"All Time"}),(0,B.jsx)(u.A.Option,{value:"today",children:"Today"}),(0,B.jsx)(u.A.Option,{value:"week",children:"Past Week"}),(0,B.jsx)(u.A.Option,{value:"month",children:"Past Month"}),(0,B.jsx)(u.A.Option,{value:"3months",children:"Past 3 Months"})]})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:4,children:(0,B.jsx)(N.A,{placeholder:"Material Code",value:H.materialCode,onChange:e=>V({...H,materialCode:e.target.value}),size:"small"})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:4,children:(0,B.jsx)(N.A,{placeholder:"Project Code",value:H.projectCode,onChange:e=>V({...H,projectCode:e.target.value}),size:"small"})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:4,children:(0,B.jsx)(N.A,{placeholder:"Plant Code",value:H.plantCode,onChange:e=>V({...H,plantCode:e.target.value}),size:"small"})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:4,children:(0,B.jsx)(f.Ay,{icon:(0,B.jsx)(n.A,{}),onClick:()=>V({team:"all",status:"all",priority:"all",dateRange:"all",materialCode:"",projectCode:"",plantCode:""}),size:"small",children:"Clear"})})]})}),(0,B.jsxs)(d.A,{defaultActiveKey:"all",className:$?"query-widget-mobile":"",size:$?"small":"default",children:[(0,B.jsx)(Q,{tab:(0,B.jsx)(v.A,{count:Z(c.all),size:"small",children:(0,B.jsx)("span",{children:"All Queries"})}),children:c.all.length>0?(0,B.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:c.all.map(e=>J(e))}):(0,B.jsx)(O.A,{description:"No queries found"})},"all"),(0,B.jsx)(Q,{tab:(0,B.jsx)(v.A,{count:Z(c.open),size:"small",children:(0,B.jsx)("span",{style:{color:"#ff4d4f"},children:"Open"})}),children:c.open.length>0?(0,B.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:c.open.map(e=>J(e))}):(0,B.jsx)(O.A,{description:"No open queries found"})},"open"),(0,B.jsx)(Q,{tab:(0,B.jsx)(v.A,{count:Z(c.resolved),size:"small",children:(0,B.jsx)("span",{style:{color:"#52c41a"},children:"Resolved"})}),children:c.resolved.length>0?(0,B.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:c.resolved.map(e=>J(e))}):(0,B.jsx)(O.A,{description:"No resolved queries found"})},"resolved"),(0,B.jsx)(Q,{tab:(0,B.jsx)(v.A,{count:Z(c.myQueries),size:"small",children:(0,B.jsx)("span",{children:"My Queries"})}),children:c.myQueries.length>0?(0,B.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:c.myQueries.map(e=>J(e))}):(0,B.jsx)(O.A,{description:"No queries raised by you found"})},"my")]}),(0,B.jsx)(E.A,{title:"Raise New Query",open:h,onCancel:()=>{A(!1),W.resetFields()},onOk:()=>W.submit(),width:600,children:(0,B.jsxs)(D.A,{form:W,layout:"vertical",onFinish:async e=>{try{await L.B.createQuery({workflowId:t,...e,createdBy:U()}),A(!1),W.resetFields(),F()}catch(l){console.error("Failed to create query:",l)}},children:[(0,B.jsx)(D.A.Item,{name:"assignedTeam",label:"Assign to Team",rules:[{required:!0,message:"Please select a team"}],children:(0,B.jsxs)(u.A,{placeholder:"Select team",children:[(0,B.jsx)(q,{value:"CQS",children:"CQS Team"}),(0,B.jsx)(q,{value:"TECH",children:"Tech Team"}),(0,B.jsx)(q,{value:"JVC",children:"JVC Team"})]})}),(0,B.jsx)(D.A.Item,{name:"fieldContext",label:"Field Context",help:"Which field or section is this query about?",children:(0,B.jsx)(N.A,{placeholder:"e.g., Material Name, Safety Data, etc."})}),(0,B.jsx)(D.A.Item,{name:"question",label:"Question",rules:[{required:!0,message:"Please enter your question"}],children:(0,B.jsx)(_,{rows:4,placeholder:"Describe your question or issue in detail..."})}),(0,B.jsx)(D.A.Item,{name:"priority",label:"Priority",initialValue:"MEDIUM",children:(0,B.jsxs)(u.A,{children:[(0,B.jsx)(q,{value:"LOW",children:"Low"}),(0,B.jsx)(q,{value:"MEDIUM",children:"Medium"}),(0,B.jsx)(q,{value:"HIGH",children:"High"}),(0,B.jsx)(q,{value:"URGENT",children:"Urgent"})]})})]})}),(0,B.jsx)(E.A,{title:`Resolve Query #${null===S||void 0===S?void 0:S.id}`,open:C,onCancel:()=>{w(!1),G.resetFields(),M(null)},onOk:()=>G.submit(),width:600,children:S&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("div",{style:{marginBottom:16,padding:12,background:"#f5f5f5",borderRadius:4},children:[(0,B.jsx)("strong",{children:"Question:"})," ",S.question,S.fieldContext&&(0,B.jsxs)("div",{children:[(0,B.jsx)("strong",{children:"Field Context:"})," ",S.fieldContext]})]}),(0,B.jsx)(D.A,{form:G,layout:"vertical",onFinish:async e=>{try{await L.B.resolveQuery(S.id,{resolution:e.resolution,resolvedBy:U()}),w(!1),G.resetFields(),M(null),F()}catch(t){console.error("Failed to resolve query:",t)}},children:(0,B.jsx)(D.A.Item,{name:"resolution",label:"Resolution",rules:[{required:!0,message:"Please provide a resolution"}],children:(0,B.jsx)(_,{rows:6,placeholder:"Provide detailed resolution or answer to the query..."})})})]})})]})};var W=l(3719),G=l(6174);const{TabPane:$}=d.A,{Title:H,Text:V}=c.A,{Option:F}=u.A,{RangePicker:U}=x.A,J=()=>{(0,w.Zp)();const[e,t]=(0,b.useState)("dashboard"),[l,c]=(0,b.useState)(null),[x,I]=(0,b.useState)(null),[P,T]=(0,b.useState)(!1),[R,N]=(0,b.useState)(!1),[D,O]=(0,b.useState)(null),[L,Q]=(0,b.useState)([]),[_,q]=(0,b.useState)([]),[z,J]=(0,b.useState)(!1),[Y,K]=(0,b.useState)("all_time"),[Z,X]=(0,b.useState)(null),ee=(0,W.HW)(),te=(0,W.uG)();console.log("WorkflowPage - currentUser:",ee),console.log("WorkflowPage - userRole:",te);const le=(0,b.useCallback)((e,t,l)=>{const s=Array.isArray(e)?e:[],r=new Date;let n;switch(t){case"all_time":default:return void q(s);case"current_month":n=new Date(r.getFullYear(),r.getMonth(),1);break;case"past_3_months":n=new Date(r.getFullYear(),r.getMonth()-3,1);break;case"past_6_months":n=new Date(r.getFullYear(),r.getMonth()-6,1);break;case"past_12_months":n=new Date(r.getFullYear(),r.getMonth()-12,1);break;case"custom":if(l&&2===l.length){n=l[0].toDate();const e=l[1].toDate(),t=s.filter(t=>{const l=new Date(t.createdAt);return l>=n&&l<=e});return void q(t)}}if(n){const e=s.filter(e=>new Date(e.createdAt)>=n);q(e)}else q(s)},[]),se=(0,b.useCallback)(async e=>{J(!0);try{const t=await S.default.get("/workflows",{signal:e});if(null===e||void 0===e||!e.aborted){const e=Array.isArray(t)?t:[];Q(e),le(e,Y,Z)}}catch(t){null!==e&&void 0!==e&&e.aborted||(console.error("Error fetching workflows:",t),h.Ay.error("Failed to fetch workflows"),Q([]),q([]))}finally{null!==e&&void 0!==e&&e.aborted||J(!1)}},[Y,Z,le]),re=e=>{K(e),"custom"!==e&&X(null),le(L,e,Z)},ne=e=>{X(e),e&&2===e.length&&le(L,"custom",e)};(0,b.useEffect)(()=>{const e=new AbortController;return se(e.signal),()=>{e.abort()}},[se]),(0,b.useEffect)(()=>{L.length>0&&le(L,Y,Z)},[Y,Z,L,le]);const ie=e=>{O(e),N(!0)},oe=async e=>{try{const t=await S.default.get(`/workflows/${e}/excel-report`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([t])),s=document.createElement("a");s.href=l,s.download=`QRMFG_Report_Workflow_${e}.xlsx`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(l),document.body.removeChild(s),h.Ay.success("Excel report downloaded successfully")}catch(t){h.Ay.error("Failed to download Excel report")}},ae=()=>{T(!1),I(null)},de=[{title:"ID",dataIndex:"id",key:"id",width:80,render:e=>(0,B.jsxs)(V,{style:{fontFamily:"monospace",fontSize:"13px",fontWeight:600,color:"#495057",padding:"4px 8px",background:"#f8f9fa",borderRadius:"4px",border:"1px solid #e9ecef"},children:["#",e]})},{title:"Project",dataIndex:"projectCode",key:"projectCode",width:80,render:e=>(0,B.jsx)(V,{strong:!0,children:e})},{title:"Material",dataIndex:"materialCode",key:"materialCode",width:90,render:e=>(0,B.jsx)(V,{strong:!0,children:e})},{title:"Description",dataIndex:"materialName",key:"materialName",width:100,ellipsis:!0,render:e=>e||"No description"},{title:"Plant",dataIndex:"assignedPlant",key:"assignedPlant",width:70,render:e=>(0,B.jsx)(p.A,{color:"green",children:e})},{title:"Status",dataIndex:"state",key:"state",width:100,render:e=>{const t={JVC_PENDING:{color:"orange",text:"JVC"},PLANT_PENDING:{color:"blue",text:"Plant"},CQS_PENDING:{color:"purple",text:"CQS"},TECH_PENDING:{color:"cyan",text:"Tech"},[k.Fv.COMPLETED]:{color:"green",text:"Done"}}[e]||{color:"default",text:e};return(0,B.jsx)(p.A,{color:t.color,children:t.text})}},{title:"Start Date",dataIndex:"createdAt",key:"createdAt",width:90,render:e=>e?new Date(e).toLocaleDateString("en-GB"):"N/A"},{title:"Actions",key:"actions",width:180,render:(e,t)=>(0,B.jsxs)(g.A,{size:"small",children:[(0,B.jsx)(f.Ay,{size:"small",icon:(0,B.jsx)(s.A,{}),onClick:()=>ie(t.id),title:"Open Questionnaire",children:"Quest."}),(0,B.jsx)(f.Ay,{size:"small",type:"default",style:{backgroundColor:"#52c41a",borderColor:"#52c41a",color:"white"},onClick:()=>oe(t.id),title:"Download Excel Report",children:"Excel"})]})}];return(0,B.jsxs)("div",{style:{padding:"0",background:"#f5f5f5",minHeight:"100vh"},children:[(0,B.jsx)("div",{style:{background:"#fff",borderBottom:"1px solid #e8e9ea",padding:"24px 40px",marginBottom:"0"},children:(0,B.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,B.jsx)("div",{children:(0,B.jsx)(H,{level:2,style:{color:"#1a1a1a",margin:0,fontWeight:600,fontSize:"24px"},children:"Workflow Management"})}),(0,B.jsx)("div",{style:{textAlign:"right",padding:"12px 20px",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:(0,B.jsxs)(V,{style:{color:"#495057",fontSize:"14px",fontWeight:500},children:[ee," (",te,")"]})})]})}),(0,B.jsx)("div",{style:{background:"#fff",borderBottom:"1px solid #e8e9ea",marginBottom:"24px"},children:(0,B.jsxs)(d.A,{activeKey:e,onChange:e=>{t(e)},size:"large",style:{margin:0},tabBarStyle:{margin:0,padding:"0 24px",background:"transparent",borderBottom:"none"},children:[(0,B.jsx)($,{tab:(0,B.jsxs)("span",{children:[(0,B.jsx)(i.A,{}),"Dashboard"]}),children:(()=>{const e={total:(t=_).length,completed:t.filter(e=>e.state===k.Fv.COMPLETED).length,jvcPending:t.filter(e=>"JVC_PENDING"===e.state).length,plantPending:t.filter(e=>"PLANT_PENDING"===e.state).length,cqsPending:t.filter(e=>"CQS_PENDING"===e.state).length,techPending:t.filter(e=>"TECH_PENDING"===e.state).length,overdue:t.filter(e=>(e.daysPending||0)>7).length};var t;return(0,B.jsxs)("div",{children:[(0,B.jsxs)("div",{style:{marginBottom:24},children:[(0,B.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:(0,B.jsx)(f.Ay,{icon:(0,B.jsx)(r.A,{}),onClick:()=>{const e=new AbortController;se(e.signal)},loading:z,type:"default",children:"Refresh"})}),(0,B.jsx)("div",{style:{padding:"16px 24px",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef",marginBottom:"24px"},children:(0,B.jsxs)(g.A,{align:"center",children:[(0,B.jsx)(n.A,{style:{color:"#495057"}}),(0,B.jsx)(V,{style:{color:"#495057",fontSize:"14px",fontWeight:500},children:"Filter by:"}),(0,B.jsxs)(u.A,{value:Y,onChange:re,size:"middle",style:{width:160},children:[(0,B.jsx)(F,{value:"all_time",children:"All Time"}),(0,B.jsx)(F,{value:"current_month",children:"Current Month"}),(0,B.jsx)(F,{value:"past_3_months",children:"Past 3 Months"}),(0,B.jsx)(F,{value:"past_6_months",children:"Past 6 Months"}),(0,B.jsx)(F,{value:"past_12_months",children:"Past 12 Months"}),(0,B.jsx)(F,{value:"custom",children:"Custom Range"})]}),"custom"===Y&&(0,B.jsx)(U,{value:Z,onChange:ne,size:"middle",style:{width:260}})]})})]}),(0,B.jsx)("div",{style:{marginBottom:"32px"},children:(0,B.jsxs)(m.A,{gutter:[20,16],children:[(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #e8e9ea",boxShadow:"none",background:"#ffffff"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#1a1a1a"},children:e.total}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#666",fontWeight:500},children:"Total Projects"})]})})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #d4edda",boxShadow:"none",background:"#f8fff9"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#28a745"},children:e.completed}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#155724",fontWeight:500},children:"Completed"})]})})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #f5c6cb",boxShadow:"none",background:"#fdf2f2"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#dc3545"},children:e.jvcPending}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#721c24",fontWeight:500},children:"JVC Pending"})]})})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #bee5eb",boxShadow:"none",background:"#f1f9fa"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#17a2b8"},children:e.plantPending}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#0c5460",fontWeight:500},children:"Plant Pending"})]})})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #d1ecf1",boxShadow:"none",background:"#f8f9fa"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#6c757d"},children:e.cqsPending}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500},children:"CQS Pending"})]})})}),(0,B.jsx)(y.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,B.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #ffeaa7",boxShadow:"none",background:"#fffbf0"},bodyStyle:{padding:"24px 20px"},children:(0,B.jsxs)("div",{style:{textAlign:"center"},children:[(0,B.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#fd7e14"},children:e.overdue}),(0,B.jsx)("div",{style:{fontSize:"14px",color:"#8a4a00",fontWeight:500},children:"Overdue"})]})})})]})}),(0,B.jsxs)("div",{style:{background:"#fff",border:"1px solid #e8e9ea",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)"},children:[(0,B.jsx)("div",{style:{padding:"20px 24px",borderBottom:"1px solid #e8e9ea",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,B.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,B.jsx)(s.A,{style:{color:"#495057",fontSize:"16px"}}),(0,B.jsx)("span",{style:{fontSize:"16px",fontWeight:600,color:"#1a1a1a"},children:"Workflows"}),(0,B.jsx)("span",{style:{fontSize:"14px",color:"#6c757d",background:"#f8f9fa",padding:"2px 8px",borderRadius:"12px",fontWeight:500},children:_.length})]})}),(0,B.jsx)(A.A,{columns:de,dataSource:_,rowKey:"id",loading:z,pagination:{pageSize:k.Bq.LARGE_PAGE_SIZE,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`,style:{padding:"16px 24px",borderTop:"1px solid #e8e9ea"}},size:"middle",onRow:e=>({onClick:()=>{c(e.id),I(e),T(!0)},style:{cursor:"pointer"}})})]})]})})()},"dashboard"),(0,B.jsx)($,{tab:(0,B.jsxs)("span",{children:[(0,B.jsx)(o.A,{}),"Queries"]}),children:(0,B.jsx)(m.A,{gutter:[16,16],children:(0,B.jsx)(y.A,{span:24,children:(0,B.jsx)(M,{workflowId:l,userRole:te})})})},"queries")]})}),(0,B.jsx)(E.A,{title:(0,B.jsxs)(g.A,{children:[(0,B.jsx)(a.A,{}),"Workflow Details",x&&(0,B.jsx)(v.A,{count:x.id,style:{backgroundColor:"#1890ff"}})]}),open:P,onCancel:ae,footer:[(0,B.jsx)(f.Ay,{onClick:ae,children:"Close"},"close"),x&&(0,B.jsx)(f.Ay,{type:"primary",icon:(0,B.jsx)(s.A,{}),onClick:()=>{ie(x.id),ae()},children:"Open Questionnaire"},"questionnaire"),x&&(0,B.jsx)(f.Ay,{type:"default",style:{backgroundColor:"#52c41a",borderColor:"#52c41a",color:"white"},onClick:()=>{oe(x.id),ae()},children:"Download Excel Report"},"excel-report")],width:800,children:x&&(0,B.jsxs)(C.A,{column:2,bordered:!0,size:"small",children:[(0,B.jsx)(C.A.Item,{label:"Workflow ID",children:x.id}),(0,B.jsx)(C.A.Item,{label:"Status",children:(0,B.jsx)(p.A,{color:"blue",children:x.state})}),(0,B.jsx)(C.A.Item,{label:"Material Code",children:x.materialCode}),(0,B.jsx)(C.A.Item,{label:"Material Name",children:x.materialName||"Not available"}),(0,B.jsx)(C.A.Item,{label:"Project Code",children:x.projectCode}),(0,B.jsx)(C.A.Item,{label:"Assigned Plant",children:(0,B.jsx)(p.A,{color:"green",children:x.assignedPlant})}),(0,B.jsx)(C.A.Item,{label:"Days Pending",children:(0,B.jsxs)(p.A,{color:(x.daysPending||0)>7?"red":"green",children:[x.daysPending||0," days"]})}),(0,B.jsx)(C.A.Item,{label:"Initiated By",children:x.initiatedBy}),(0,B.jsx)(C.A.Item,{label:"Created At",children:x.createdAt?new Date(x.createdAt).toLocaleString():"N/A"})]})}),(0,B.jsx)(E.A,{title:"QRMFG Questionnaire Viewer",open:R,onCancel:()=>N(!1),footer:null,width:"90%",style:{top:20},bodyStyle:{padding:0,height:"calc(100vh - 200px)",overflow:"hidden"},children:D&&(0,B.jsx)("div",{style:{height:"100%",overflow:"auto"},children:(0,B.jsx)(G.default,{workflowId:D,onClose:()=>N(!1)})})})]})}}}]);
//# sourceMappingURL=664.85e7ae19.chunk.js.map