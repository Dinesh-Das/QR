"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[862],{5123:(e,t,a)=>{a.d(t,{hm:()=>n});var s=a(5043),o=a(3719),l=a(4642);const n=()=>{const[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)(!0),[i,r]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{if(!(0,o.wR)())return t(null),void n(!1);try{n(!0),r(null);const e=await l.A.getUserAccessSummary();t(e)}catch(e){console.warn("Failed to load access summary, using fallback:",e),r(e);const a=l.A.getFallbackAccessSummary();t(a)}finally{n(!1)}},[]);(0,s.useEffect)(()=>{d()},[d]);const c=(0,s.useCallback)(async e=>{try{return await l.A.hasScreenAccess(e)}catch(i){return console.warn("Screen access check failed, using fallback:",i),l.A.getFallbackScreenAccess(e)}},[]),u=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await l.A.hasDataAccess(e,t)}catch(i){return console.warn("Data access check failed, using fallback:",i),l.A.getFallbackDataAccess(e,t)}},[]),p=(0,s.useCallback)(async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await l.A.hasPlantDataAccess(e,t,a)}catch(i){return console.warn("Plant data access check failed, using fallback:",i),l.A.getFallbackPlantDataAccess(e,t,a)}},[]),m=(0,s.useCallback)(async function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{return await l.A.makeAccessDecision(e,t,a,s)}catch(i){return console.warn("Access decision failed, using fallback:",i),l.A.getFallbackAccessDecision(e,t,a,s)}},[]),h=(0,s.useCallback)((e,t)=>l.A.filterDataByPlantAccess(e,t),[]);return{loading:a,error:i,isAuthenticated:(0,o.wR)(),currentUser:(0,o.HW)(),primaryRole:(0,o.Jv)(),userPlants:(0,o.nT)(),primaryPlant:(0,o.bN)(),isAdmin:(0,o.qc)(),isJvcUser:(0,o.bV)(),isCqsUser:(0,o.po)(),isTechUser:(0,o.C9)(),isPlantUser:(0,o.X9)(),isViewer:(0,o.Z$)(),accessSummary:e,hasRole:e=>(0,o.hf)(e),hasAnyRole:e=>e.some(e=>(0,o.hf)(e)),hasAllRoles:e=>e.every(e=>(0,o.hf)(e)),checkScreenAccess:c,checkDataAccess:u,checkPlantDataAccess:p,makeAccessDecision:m,filterByPlantAccess:h,refresh:d}}},6274:(e,t,a)=>{a.d(t,{Ay:()=>h,eS:()=>c,lE:()=>m,wS:()=>u});var s=a(9098),o=a(5444),l=a(6569),n=a(5043),i=a(599),r=a(579);const{TextArea:d}=o.A,c=n.memo(e=>{let{value:t,onChange:a,validationType:s="text",componentName:d="SecureInput",fieldName:c="input",onValidationChange:u,...p}=e;const{validateInput:m}=(0,i.j8)(),[h,f]=(0,n.useState)({isValid:!0,errors:[],wasModified:!1}),g=(0,n.useCallback)(e=>{const t=e.target.value,o=m(t,s);f(o),o.wasModified&&(i.qp.logXSSAttempt(t,o.sanitizedValue,d,c),l.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:o.sanitizedValue}}),u&&u(o)},[a,s,d,c,u,m]);return(0,r.jsx)(o.A,{...p,value:t,onChange:g,status:h.isValid?"":"error",title:h.errors.join(", ")})}),u=n.memo(e=>{let{value:t,onChange:a,validationType:s="richtext",componentName:o="SecureTextArea",fieldName:c="textarea",onValidationChange:u,...p}=e;const{validateInput:m}=(0,i.j8)(),[h,f]=(0,n.useState)({isValid:!0,errors:[],wasModified:!1}),g=(0,n.useCallback)(e=>{const t=e.target.value,n=m(t,s);f(n),n.wasModified&&(i.qp.logXSSAttempt(t,n.sanitizedValue,o,c),l.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:n.sanitizedValue}}),u&&u(n)},[a,s,o,c,u,m]);return(0,r.jsx)(d,{...p,value:t,onChange:g,status:h.isValid?"":"error",title:h.errors.join(", ")})}),p=n.memo(e=>{let{children:t,onFinish:a,componentName:o="SecureForm",enableSecurityLogging:d=!0,...c}=e;const[u,p]=(0,n.useState)([]),m=(0,n.useCallback)(async e=>{try{const t={},s=[];Object.keys(e).forEach(a=>{const o=e[a];if("string"===typeof o){const e=i.SR.sanitizeText(o);t[a]=e,e!==o&&s.push({field:a,originalValue:o.substring(0,50),sanitizedValue:e.substring(0,50)})}else t[a]=o}),s.length>0&&d&&(s.forEach(e=>{i.qp.logXSSAttempt(e.originalValue,e.sanitizedValue,o,e.field)}),l.Ay.warning(`${s.length} field(s) were sanitized for security`)),a&&await a(t)}catch(t){throw console.error("SecureForm submission error:",t),l.Ay.error("Form submission failed"),t}},[a,o,d]);return(0,n.useEffect)(()=>{if(d){const e=i.qp.getRecentEvents();p(e.slice(-10))}},[d]),(0,r.jsxs)(s.A,{...c,onFinish:m,validateTrigger:["onChange","onBlur"],children:[t,!1]})}),m=n.memo(e=>{let{children:t,validationType:a="text",name:o,rules:l=[],...d}=e;const c=n.useMemo(()=>{let e=[];switch(a){case"username":e=i.PT.username;break;case"email":e=i.PT.email;break;case"password":e=i.PT.password;break;case"projectCode":e=i.PT.projectCode;break;case"materialCode":e=i.PT.materialCode;break;case"plantCode":e=i.PT.plantCode;break;case"text":e=i.PT.text(!1,0,255);break;case"richtext":e=i.PT.richText(!1,0,1e3);break;default:e=[]}return[...e,...l]},[a,l]);return(0,r.jsx)(s.A.Item,{...d,name:o,rules:c,children:t})});c.displayName="SecureInput",u.displayName="SecureTextArea",p.displayName="SecureForm",m.displayName="SecureFormItem";const h=p},7258:(e,t,a)=>{a.d(t,{EO:()=>l,Jl:()=>o,L$:()=>s});const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};let t=0,a=0;((arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||[{title:"General",fields:[{name:"msds_available",isCqsAutoPopulated:!1},{name:"missing_info",isCqsAutoPopulated:!1},{name:"sourcing_asked",isCqsAutoPopulated:!1},{name:"cas_available",isCqsAutoPopulated:!1},{name:"mixture_ingredients",isCqsAutoPopulated:!1},{name:"composition_percentage",isCqsAutoPopulated:!1},{name:"total_percentage_1",isCqsAutoPopulated:!1},{name:"total_percentage",isCqsAutoPopulated:!1}]},{title:"Physical",fields:[{name:"is_corrosive",isCqsAutoPopulated:!0},{name:"corrosive_storage",isCqsAutoPopulated:!1},{name:"highly_toxic",isCqsAutoPopulated:!0},{name:"toxic_powder_handling",isCqsAutoPopulated:!1},{name:"crushing_facilities",isCqsAutoPopulated:!1},{name:"heating_facilities",isCqsAutoPopulated:!1},{name:"paste_preparation",isCqsAutoPopulated:!1}]},{title:"Flammability and Explosivity",fields:[{name:"flash_point_65",isCqsAutoPopulated:!0},{name:"petroleum_class",isCqsAutoPopulated:!0},{name:"storage_license",isCqsAutoPopulated:!1},{name:"ccoe_license",isCqsAutoPopulated:!1},{name:"flash_point_21",isCqsAutoPopulated:!0},{name:"flammable_infrastructure",isCqsAutoPopulated:!1}]},{title:"Toxicity",fields:[{name:"ld50_oral",isCqsAutoPopulated:!0},{name:"ld50_dermal",isCqsAutoPopulated:!0},{name:"lc50_inhalation",isCqsAutoPopulated:!0},{name:"exposure_minimization",isCqsAutoPopulated:!1},{name:"carcinogenic",isCqsAutoPopulated:!0},{name:"carcinogenic_control",isCqsAutoPopulated:!1}]},{title:"Process Safety Management",fields:[{name:"psm_tier1_outdoor",isCqsAutoPopulated:!0},{name:"psm_tier1_indoor",isCqsAutoPopulated:!0},{name:"psm_tier2_outdoor",isCqsAutoPopulated:!0},{name:"psm_tier2_indoor",isCqsAutoPopulated:!0}]},{title:"Storage and Handling",fields:[{name:"storage_conditions_stores",isCqsAutoPopulated:!1},{name:"storage_conditions_floor",isCqsAutoPopulated:!1},{name:"closed_loop_required",isCqsAutoPopulated:!1},{name:"work_permit_available",isCqsAutoPopulated:!1},{name:"procedures_details",isCqsAutoPopulated:!1}]},{title:"PPE",fields:[{name:"recommended_ppe",isCqsAutoPopulated:!0},{name:"ppe_in_use",isCqsAutoPopulated:!1},{name:"ppe_procurement_date",isCqsAutoPopulated:!1}]},{title:"First Aid",fields:[{name:"is_poisonous",isCqsAutoPopulated:!0},{name:"antidote_specified",isCqsAutoPopulated:!0},{name:"antidote_available",isCqsAutoPopulated:!1},{name:"antidote_source",isCqsAutoPopulated:!1},{name:"first_aid_capability",isCqsAutoPopulated:!1}]},{title:"Statutory",fields:[{name:"cmvr_listed",isCqsAutoPopulated:!0},{name:"msihc_listed",isCqsAutoPopulated:!0},{name:"factories_act_listed",isCqsAutoPopulated:!0},{name:"permissible_concentration",isCqsAutoPopulated:!1},{name:"monitoring_details",isCqsAutoPopulated:!1}]},{title:"Others",fields:[{name:"plant_inputs_required",isCqsAutoPopulated:!1},{name:"gaps_identified",isCqsAutoPopulated:!1},{name:"additional_input_1",isCqsAutoPopulated:!1},{name:"additional_input_2",isCqsAutoPopulated:!1}]}]).forEach(s=>{const o=s.fields||[];t+=o.length;const l=o.filter(t=>{const a=e[t.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});a+=l.length});const s=t>0?Math.round(a/t*100):0;return{totalFields:t,completedFields:a,completionPercentage:s,totalUserEditableFields:t,completedUserEditableFields:a}},o=function(){let e=0,t=0,a=0;return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||[{title:"General",fields:[{name:"msds_available",isCqsAutoPopulated:!1},{name:"missing_info",isCqsAutoPopulated:!1},{name:"sourcing_asked",isCqsAutoPopulated:!1},{name:"cas_available",isCqsAutoPopulated:!1},{name:"mixture_ingredients",isCqsAutoPopulated:!1},{name:"composition_percentage",isCqsAutoPopulated:!1},{name:"total_percentage_1",isCqsAutoPopulated:!1},{name:"total_percentage",isCqsAutoPopulated:!1}]},{title:"Physical",fields:[{name:"is_corrosive",isCqsAutoPopulated:!0},{name:"corrosive_storage",isCqsAutoPopulated:!1},{name:"highly_toxic",isCqsAutoPopulated:!0},{name:"toxic_powder_handling",isCqsAutoPopulated:!1},{name:"crushing_facilities",isCqsAutoPopulated:!1},{name:"heating_facilities",isCqsAutoPopulated:!1},{name:"paste_preparation",isCqsAutoPopulated:!1}]},{title:"Flammability and Explosivity",fields:[{name:"flash_point_65",isCqsAutoPopulated:!0},{name:"petroleum_class",isCqsAutoPopulated:!0},{name:"storage_license",isCqsAutoPopulated:!1},{name:"ccoe_license",isCqsAutoPopulated:!1},{name:"flash_point_21",isCqsAutoPopulated:!0},{name:"flammable_infrastructure",isCqsAutoPopulated:!1}]},{title:"Toxicity",fields:[{name:"ld50_oral",isCqsAutoPopulated:!0},{name:"ld50_dermal",isCqsAutoPopulated:!0},{name:"lc50_inhalation",isCqsAutoPopulated:!0},{name:"exposure_minimization",isCqsAutoPopulated:!1},{name:"carcinogenic",isCqsAutoPopulated:!0},{name:"carcinogenic_control",isCqsAutoPopulated:!1}]},{title:"Process Safety Management",fields:[{name:"psm_tier1_outdoor",isCqsAutoPopulated:!0},{name:"psm_tier1_indoor",isCqsAutoPopulated:!0},{name:"psm_tier2_outdoor",isCqsAutoPopulated:!0},{name:"psm_tier2_indoor",isCqsAutoPopulated:!0}]},{title:"Storage and Handling",fields:[{name:"storage_conditions_stores",isCqsAutoPopulated:!1},{name:"storage_conditions_floor",isCqsAutoPopulated:!1},{name:"closed_loop_required",isCqsAutoPopulated:!1},{name:"work_permit_available",isCqsAutoPopulated:!1},{name:"procedures_details",isCqsAutoPopulated:!1}]},{title:"PPE",fields:[{name:"recommended_ppe",isCqsAutoPopulated:!0},{name:"ppe_in_use",isCqsAutoPopulated:!1},{name:"ppe_procurement_date",isCqsAutoPopulated:!1}]},{title:"First Aid",fields:[{name:"is_poisonous",isCqsAutoPopulated:!0},{name:"antidote_specified",isCqsAutoPopulated:!0},{name:"antidote_available",isCqsAutoPopulated:!1},{name:"antidote_source",isCqsAutoPopulated:!1},{name:"first_aid_capability",isCqsAutoPopulated:!1}]},{title:"Statutory",fields:[{name:"cmvr_listed",isCqsAutoPopulated:!0},{name:"msihc_listed",isCqsAutoPopulated:!0},{name:"factories_act_listed",isCqsAutoPopulated:!0},{name:"permissible_concentration",isCqsAutoPopulated:!1},{name:"monitoring_details",isCqsAutoPopulated:!1}]},{title:"Others",fields:[{name:"plant_inputs_required",isCqsAutoPopulated:!1},{name:"gaps_identified",isCqsAutoPopulated:!1},{name:"additional_input_1",isCqsAutoPopulated:!1},{name:"additional_input_2",isCqsAutoPopulated:!1}]}]).forEach(s=>{const o=s.fields||[];e+=o.length,o.forEach(e=>{e.isCqsAutoPopulated||e.disabled?a++:t++})}),{totalFields:e,totalUserEditableFields:t,totalCqsFields:a}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const{totalFields:a,completedFields:o,completionPercentage:l}=s(t);return{...e,totalFields:a,completedFields:o,completionPercentage:l}}const{totalFields:a}=o(),l=e.completedFields||0,n=a>0?Math.round(l/a*100):0;return{...e,totalFields:a,completionPercentage:n}}},8348:(e,t,a)=>{a.d(t,{E:()=>l});var s=a(6649),o=a(3719);const l={getUserPlantAssignments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(console.log("Getting plant assignments for user:",e),console.log("Is authenticated:",(0,o.wR)()),!(0,o.wR)())return console.warn("User is not authenticated, cannot get plant assignments"),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1};const r=(0,o.gf)();if(console.log("Retrieved token:",r?"Token found":"No token found"),r)try{const e=await s.default.post("/auth/validate",{token:r},t);if(console.log("Token validation response:",e),console.log("Plant codes in token:",e.plantCodes),console.log("Primary plant in token:",e.primaryPlant),console.log("Is plant user:",e.isPlantUser),e.valid){if(e.plantCodes&&e.plantCodes.length>0)return console.log("Plant assignments from token:",e),{assignedPlants:e.plantCodes||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||e.plantCodes&&e.plantCodes[0]||null,isPlantUser:e.isPlantUser||!1};if(e.primaryPlant&&e.isPlantUser)return console.log("User has primary plant but empty plantCodes, using primary plant as assigned plant:",e.primaryPlant),{assignedPlants:[e.primaryPlant],primaryPlant:e.primaryPlant,effectivePlant:e.primaryPlant,isPlantUser:e.isPlantUser||!1};console.log("Token is valid but no plant data found in token")}}catch(l){console.warn("Failed to validate token for plant assignments:",l)}const d=["userData","qrmfg_user_data","user_info"];for(const e of d){const t=localStorage.getItem(e)||sessionStorage.getItem(e);if(t)try{const e=JSON.parse(t);if(e.plantCodes||e.assignedPlants)return console.log("Plant assignments from stored data:",e),{assignedPlants:e.plantCodes||e.assignedPlants||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||(e.plantCodes||e.assignedPlants)&&(e.plantCodes||e.assignedPlants)[0]||null,isPlantUser:e.isPlantUser||!1}}catch(n){console.warn(`Failed to parse stored user data from ${e}:`,n)}}try{const l=(0,o.gf)(),n=await s.default.post("/auth/validate",{token:l},t);if(n.valid&&n.isAdmin){var a;console.log("User appears to be admin, trying admin endpoints...");const o=null===(a=(await s.default.get("/admin/users",t)).users)||void 0===a?void 0:a.find(t=>t.username===e);if(o&&o.assignedPlants)return console.log("Admin endpoint: Using user details for plant assignments:",o),{assignedPlants:o.assignedPlants||[],primaryPlant:o.primaryPlant||null,effectivePlant:o.primaryPlant||o.assignedPlants&&o.assignedPlants[0]||null,isPlantUser:o.assignedPlants&&o.assignedPlants.length>0||!1}}}catch(i){console.warn("Admin endpoints not accessible (expected for non-admin users):",i.message)}return console.warn("No plant assignment data available for user:",e),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}catch(r){return console.error("Error getting user plant assignments:",r),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}},updateUserPlantAssignments:(e,t)=>s.default.put(`/admin/users/${encodeURIComponent(e)}/plants`,t),checkUserPlantAssignment:(e,t)=>s.default.get(`/admin/users/${encodeURIComponent(e)}/plants/${encodeURIComponent(t)}/check`),getUserById:e=>s.default.get(`/admin/users/${e}`),getAllUsers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.default.get("/admin/users",{cacheTTL:3e5,...e})},getAllUsersRealTime:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.default.get("/admin/users",{useCache:!1,...e})}}},9394:(e,t,a)=>{a.d(t,{S:()=>o});var s=a(6649);const o={getDashboardSummary:()=>s.default.get("/dashboard/summary"),getOverdueWorkflows:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return s.default.get(`/workflows/overdue?days=${e}`)},getRecentActivity:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/created?days=${e}`)},getWorkflowCountsByState:()=>s.default.get("/dashboard/counts-by-state"),getWorkflowsByPlant:e=>s.default.get(`/workflows/plant/${encodeURIComponent(e)}`),createWorkflow:e=>s.default.post("/workflows",e),getWorkflow:e=>s.default.get(`/workflows/${e}`),updateWorkflow:(e,t)=>s.default.put(`/workflows/${e}`,t),deleteWorkflow:e=>s.default.delete(`/workflows/${e}`),transitionWorkflowState:(e,t,a)=>s.default.put(`/workflows/${e}/transition`,{newState:t,comment:a}),extendWorkflow:(e,t)=>s.default.put(`/workflows/${e}/extend`,t),completeWorkflow:(e,t)=>s.default.put(`/workflows/${e}/complete`,t),extendToMultiplePlantsSmartly:async e=>{try{const t=await s.default.withRetry(()=>s.default.post("/workflows/extend-to-plants",e),3,1e3);return{...t,documentReuse:t.documentReuse||{totalReusedDocuments:0,reusedDocuments:[],reuseStrategy:"NONE",sourceDescription:"No documents available for reuse"}}}catch(t){throw console.error("[WorkflowAPI] Smart extension failed:",t),{...t,context:"SMART_PLANT_EXTENSION",extensionData:e}}},searchWorkflows:e=>s.default.post("/workflows/search",e),getWorkflowsByState:e=>s.default.get(`/workflows/state/${e}`),getWorkflowsByUser:e=>s.default.get(`/workflows/initiated-by/${encodeURIComponent(e)}`),canTransitionTo:(e,t)=>s.default.get(`/workflows/${e}/can-transition/${t}`),isReadyForCompletion:e=>s.default.get(`/workflows/${e}/ready-for-completion`),checkWorkflowExists:(e,t,a)=>s.default.get(`/workflows/check-exists?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}`),getWorkflowStats:e=>s.default.get(`/workflows/stats?range=${e}`),getCompletionRateByPlant:()=>s.default.get("/workflows/completion-rate-by-plant"),getWorkflowCompletionTrend:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return s.default.get(`/workflows/completion-trend?months=${e}`)},getPendingWorkflows:()=>s.default.get("/workflows/pending"),getWorkflowsWithOpenQueries:()=>s.default.get("/workflows/with-open-queries"),getCountByState:e=>s.default.get(`/workflows/stats/count-by-state/${e}`),getOverdueCount:()=>s.default.get("/workflows/stats/overdue-count"),getWorkflowsWithOpenQueriesCount:()=>s.default.get("/workflows/stats/with-open-queries-count"),getRecentlyCreated:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/created?days=${e}`)},getRecentlyCompleted:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return s.default.get(`/workflows/recent/completed?days=${e}`)},saveDraftResponses:(e,t)=>s.default.post(`/workflows/${e}/draft-responses`,t),getDraftResponses:e=>s.default.get(`/workflows/${e}/draft-responses`),submitQuestionnaire:(e,t)=>s.default.post(`/workflows/${e}/submit-questionnaire`,t),getWorkflowDocuments:e=>s.default.get(`/workflows/${e}/documents`),getAllWorkflowRelatedDocuments:async e=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/${e}/documents/all`),2,500)}catch(t){throw console.error(`[WorkflowAPI] Failed to get all documents for workflow ${e}:`,t),{...t,context:"GET_ALL_WORKFLOW_DOCUMENTS",workflowId:e}}},exportWorkflowDocuments:async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{return await s.default.withRetry(()=>s.default.download(`/workflows/${e}/documents/export?includeQueryDocuments=${t}`),2,1e3)}catch(a){throw console.error(`[WorkflowAPI] Failed to export documents for workflow ${e}:`,a),{...a,context:"EXPORT_WORKFLOW_DOCUMENTS",workflowId:e,includeQueryDocuments:t}}},searchUnifiedDocuments:async e=>{try{return await s.default.withRetry(()=>s.default.post("/documents/search/unified",e),2,500)}catch(t){throw console.error("[WorkflowAPI] Unified document search failed:",t),{...t,context:"UNIFIED_DOCUMENT_SEARCH",searchParams:e}}},getUnifiedDocumentInfo:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/documents/unified-info?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get unified document info for ${e}/${t}:`,a),{...a,context:"GET_UNIFIED_DOCUMENT_INFO",projectCode:e,materialCode:t}}},getReusableDocuments:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/documents/reusable?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get reusable documents for ${e}/${t}:`,a),{...a,context:"GET_REUSABLE_DOCUMENTS",projectCode:e,materialCode:t}}},downloadDocument:async e=>{try{return await s.default.withRetry(()=>s.default.download(`/workflows/documents/${e}/download`),3,1e3)}catch(t){throw console.error(`[WorkflowAPI] Failed to download document ${e}:`,t),{...t,context:"DOWNLOAD_DOCUMENT",documentId:e}}},uploadDocument:async(e,t,a)=>{try{return await s.default.withRetry(()=>s.default.upload(`/workflows/${e}/documents`,t,{metadata:JSON.stringify(a)}),2,1e3)}catch(o){throw console.error(`[WorkflowAPI] Failed to upload document to workflow ${e}:`,o),{...o,context:"UPLOAD_DOCUMENT",workflowId:e,fileName:(null===t||void 0===t?void 0:t.name)||"unknown"}}},uploadMultipleDocuments:async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=[],l=[];for(const i of t)try{const t=await o.uploadDocument(e,i,a);s.push({file:i.name,result:t,success:!0})}catch(n){console.error(`[WorkflowAPI] Failed to upload ${i.name}:`,n),l.push({file:i.name,error:n,success:!1})}return{successful:s,failed:l,totalFiles:t.length,successCount:s.length,failureCount:l.length}},retryDocumentOperation:async function(e,t){let a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;for(let n=1;n<=s;n++)try{switch(e){case"UPLOAD":return await o.uploadDocument(t.workflowId,t.file,t.metadata);case"DOWNLOAD":return await o.downloadDocument(t.documentId);case"GET_DOCUMENTS":return await o.getAllWorkflowRelatedDocuments(t.workflowId);default:throw new Error(`Unknown operation type: ${e}`)}}catch(l){if(a=l,console.warn(`[WorkflowAPI] Retry attempt ${n}/${s} failed for ${e}:`,l),n<s){const e=1e3*Math.pow(2,n);await new Promise(t=>setTimeout(t,e))}}throw{...a,context:"RETRY_OPERATION_FAILED",operationType:e,maxRetries:s,finalAttempt:!0}},updateAllMaterialNamesFromProjectItemMaster:()=>s.default.post("/workflows/update-material-names"),updateMaterialNameFromProjectItemMaster:e=>s.default.post(`/workflows/${e}/update-material-name`),getQuestionnaireTemplate:e=>{let{materialCode:t,plantCode:a,templateType:o="PLANT_QUESTIONNAIRE"}=e;return s.default.get(`/plant-questionnaire/template?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}&templateType=${encodeURIComponent(o)}`)},getCqsData:e=>{let{materialCode:t,plantCode:a}=e;return s.default.get(`/plant-questionnaire/cqs-data?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}`)},getQuestionnaireData:e=>s.default.get(`/api/v1/questionnaire/${e}`),getQuestionnaireForEdit:e=>s.default.get(`/api/v1/questionnaire/${e}/edit`),getPlantSpecificData:e=>{let{plantCode:t,materialCode:a}=e;return s.default.get(`/plant-questionnaire/plant-data?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(a)}`)},getOrCreatePlantSpecificData:e=>{let{plantCode:t,materialCode:a,workflowId:o}=e;return s.default.post(`/plant-questionnaire/plant-data/init?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(a)}&workflowId=${o}`)},savePlantSpecificData:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SYSTEM";return s.default.post(`/plant-questionnaire/plant-data/save?modifiedBy=${encodeURIComponent(t)}`,e)},saveDraftPlantResponses:(e,t)=>s.default.post(`/plant-questionnaire/draft?workflowId=${e}`,t),submitPlantQuestionnaire:(e,t)=>s.default.post(`/plant-questionnaire/submit?workflowId=${e}`,t),getPlantQuestionnaireStats:e=>{let{plantCode:t,materialCode:a}=e;const o=new URLSearchParams({plantCode:t});return a&&o.append("materialCode",a),s.default.get(`/plant-questionnaire/stats?${o.toString()}`)},getPlantDashboardData:e=>s.default.get(`/plant-questionnaire/dashboard?plantCode=${encodeURIComponent(e)}`),initializeSamplePlantData:e=>s.default.post(`/plant-questionnaire/init-sample-data?plantCode=${encodeURIComponent(e)}`),getDocumentReuseStats:async(e,t)=>{try{return await s.default.withRetry(()=>s.default.get(`/workflows/documents/reuse-stats?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get document reuse stats for ${e}/${t}:`,a),{...a,context:"GET_DOCUMENT_REUSE_STATS",projectCode:e,materialCode:t}}},validateDocumentReuse:async(e,t,a)=>{try{return await s.default.withRetry(()=>s.default.post("/workflows/documents/validate-reuse",{projectCode:e,materialCode:t,plantCodes:a}),2,500)}catch(o){throw console.error(`[WorkflowAPI] Failed to validate document reuse for ${e}/${t}:`,o),{...o,context:"VALIDATE_DOCUMENT_REUSE",projectCode:e,materialCode:t,plantCodes:a}}},getDocumentAuditLog:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const a=new URLSearchParams(t).toString();return await s.default.withRetry(()=>s.default.get(`/workflows/${e}/documents/audit-log?${a}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get document audit log for workflow ${e}:`,a),{...a,context:"GET_DOCUMENT_AUDIT_LOG",workflowId:e,options:t}}},handleDocumentError:(e,t)=>{const a={originalError:e,operation:t,timestamp:(new Date).toISOString(),userMessage:"An error occurred with document operation",technicalMessage:e.message,recoveryActions:[],retryable:!1};switch(e.context){case"UPLOAD_DOCUMENT":a.userMessage="Failed to upload document. Please check file size and format.",a.recoveryActions=["Verify file is under 25MB","Check file format is supported (PDF, DOCX, XLSX, JPG, PNG)","Try uploading again","Contact support if problem persists"],a.retryable=!0;break;case"DOWNLOAD_DOCUMENT":a.userMessage="Failed to download document. Please try again.",a.recoveryActions=["Check your internet connection","Try downloading again","Contact support if document is corrupted"],a.retryable=!0;break;case"GET_ALL_WORKFLOW_DOCUMENTS":a.userMessage="Failed to load workflow documents.",a.recoveryActions=["Refresh the page","Check your internet connection","Contact support if problem persists"],a.retryable=!0;break;case"SMART_PLANT_EXTENSION":a.userMessage="Failed to extend workflow to plants. Some documents may not have been reused.",a.recoveryActions=["Check if workflows were created successfully","Manually upload documents if needed","Try the extension again","Contact support for assistance"],a.retryable=!0;break;case"UNIFIED_DOCUMENT_SEARCH":a.userMessage="Document search failed. Please try again.",a.recoveryActions=["Simplify your search terms","Try searching again","Use individual document lists instead"],a.retryable=!0;break;default:"NETWORK"===e.type?(a.userMessage="Network error occurred. Please check your connection.",a.retryable=!0):"TIMEOUT"===e.type?(a.userMessage="Operation timed out. Please try again.",a.retryable=!0):413===e.status?(a.userMessage="File is too large. Please use a smaller file.",a.retryable=!1):415===e.status&&(a.userMessage="File type not supported. Please use PDF, DOCX, XLSX, JPG, or PNG.",a.retryable=!1)}return a}}},9799:(e,t,a)=>{a.d(t,{B:()=>o});var s=a(6649);const o={getAllLocations:async()=>{try{return await s.default.get("/master-data/locations")}catch(e){console.warn("Main locations endpoint failed, trying fallback:",e);try{return await s.default.get("/master-data/locations/fallback")}catch(t){console.warn("Fallback endpoint failed, trying simple endpoint:",t);try{return await s.default.get("/simple-locations")}catch(a){throw console.error("All locations endpoints failed:",a),a}}}},getLocationByCode:e=>s.default.get(`/master-data/locations/${encodeURIComponent(e)}`),searchLocations:e=>s.default.get(`/master-data/locations/search?term=${encodeURIComponent(e)}`),createLocation:e=>s.default.post("/master-data/locations",e),updateLocation:(e,t)=>s.default.put(`/master-data/locations/${encodeURIComponent(e)}`,t),deleteLocation:e=>s.default.delete(`/master-data/locations/${encodeURIComponent(e)}`),getAllProjectItems:()=>s.default.get("/master-data/project-items"),getItemsByProject:e=>s.default.get(`/master-data/project-items/projects/${encodeURIComponent(e)}`),getProjectsByItem:e=>s.default.get(`/master-data/project-items/items/${encodeURIComponent(e)}`),getAllProjectCodes:()=>s.default.get("/master-data/project-codes"),getAllItemCodes:()=>s.default.get("/master-data/item-codes"),getItemCodesByProject:e=>s.default.get(`/master-data/project-codes/${encodeURIComponent(e)}/items`),testLocationMaster:()=>s.default.get("/master-data/locations/test"),testSimpleLocation:()=>s.default.get("/simple-locations/test"),diagnosticLocationMaster:()=>s.default.get("/master-data/locations/diagnostic"),getSimpleLocationCount:()=>s.default.get("/simple-locations/count")}},9862:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Qe});var s=a(3927),o=a(6553),l=a(6569),n=a(5206),i=a(6051),r=a(2751),d=a(5043),c=a(3795),u=a(579);const p=e=>{let{children:t,plantCode:a}=e;return(0,u.jsx)(c.SD,{routeName:"Plant Dashboard",errorContext:{plantCode:a,feature:"plant-workflow-management",level:"plant"},children:t})};var m=a(119),h=a(9470),f=a(6237),g=a(1199),y=a(2261),x=a(7419),v=a(1645),A=a(9073),b=a(6612),C=a(7692);const j=d.memo(e=>{let{dashboardStats:t,loading:a,error:s,currentPlant:o,onRefresh:l}=e;const n=(0,d.useMemo)(()=>e=>e>=80?"#52c41a":e>=60?"#1890ff":e>=40?"#faad14":e>=20?"#fa8c16":"#ff4d4f",[]),i=(0,d.useMemo)(()=>{const{totalWorkflows:e,completedCount:a,inProgressCount:s,draftCount:o}=t;return 0===e?{completionRate:0,inProgressRate:0,draftRate:0}:{completionRate:Math.round(a/e*100),inProgressRate:Math.round(s/e*100),draftRate:Math.round(o/e*100)}},[t]),r=(0,d.useMemo)(()=>e=>({total:"#1890ff",inProgress:"#fa8c16",completed:"#52c41a",average:"#52c41a"}[e]||"#1890ff"),[]);return s?(0,u.jsx)(y.A,{message:"Dashboard Error",description:`Failed to load dashboard data: ${s}`,type:"error",showIcon:!0,style:{marginBottom:24},action:l&&(0,u.jsx)("button",{onClick:l,style:{border:"none",background:"none",color:"#1890ff",cursor:"pointer"},children:"Retry"})}):(0,u.jsxs)("div",{style:{marginBottom:24},children:[(0,u.jsxs)(x.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,u.jsx)(v.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(A.A,{loading:a,children:(0,u.jsx)(b.A,{title:"Total Materials",value:t.totalWorkflows||0,prefix:(0,u.jsx)(m.A,{}),valueStyle:{color:r("total")}})})}),(0,u.jsx)(v.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(A.A,{loading:a,children:(0,u.jsx)(b.A,{title:"In Progress",value:t.inProgressCount||0,prefix:(0,u.jsx)(h.A,{}),valueStyle:{color:r("inProgress")}})})}),(0,u.jsx)(v.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(A.A,{loading:a,children:(0,u.jsx)(b.A,{title:"Completed",value:t.completedCount||0,prefix:(0,u.jsx)(f.A,{}),valueStyle:{color:r("completed")}})})}),(0,u.jsx)(v.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(A.A,{loading:a,children:(0,u.jsx)(b.A,{title:"Average Progress",value:t.averageCompletion||0,suffix:"%",prefix:(0,u.jsx)(g.A,{}),valueStyle:{color:r("average")}})})})]}),(0,u.jsxs)(x.A,{gutter:[16,16],children:[(0,u.jsx)(v.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(A.A,{title:"Completion Rate",loading:a,size:"small",children:[(0,u.jsx)(C.A,{type:"circle",percent:i.completionRate,strokeColor:n(i.completionRate),format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.completedCount," of ",t.totalWorkflows," completed"]})]})}),(0,u.jsx)(v.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(A.A,{title:"In Progress Rate",loading:a,size:"small",children:[(0,u.jsx)(C.A,{type:"circle",percent:i.inProgressRate,strokeColor:"#fa8c16",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.inProgressCount," workflows active"]})]})}),(0,u.jsx)(v.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(A.A,{title:"Draft Rate",loading:a,size:"small",children:[(0,u.jsx)(C.A,{type:"circle",percent:i.draftRate,strokeColor:"#ff4d4f",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.draftCount," not started"]})]})})]}),o&&(0,u.jsx)(y.A,{message:`Plant Dashboard - ${o}`,description:"Overview of all assigned materials and their completion status for the selected plant.",type:"info",showIcon:!0,style:{marginTop:16}})]})});j.displayName="PlantDashboard",j.defaultProps={loading:!1,error:null,currentPlant:null,onRefresh:null};const w=j;var P=a(2058),S=a(8174),q=a(5444),k=a(6399),_=a(3217),I=a(2868);const N=d.memo(e=>{let{workflows:t,loading:a,onStartQuestionnaire:s,onRefresh:o}=e;const l=(0,d.useCallback)(e=>({DRAFT:"default",IN_PROGRESS:"processing",COMPLETED:"success"}[e]||"default"),[]),r=(0,d.useCallback)(e=>100===e?"#52c41a":e>=75?"#1890ff":e>=50?"#faad14":e>=25?"#fa8c16":"#ff4d4f",[]),c=(0,d.useCallback)(e=>{if(!e)return 0;const t=new Date,a=new Date(e),s=Math.abs(t-a);return Math.ceil(s/864e5)},[]),p=(0,d.useCallback)(e=>{s&&s(e)},[s]),m=(0,d.useMemo)(()=>[{title:"Material Code",dataIndex:"materialCode",key:"materialCode",width:140,sorter:(e,t)=>e.materialCode.localeCompare(t.materialCode),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:a,confirm:s,clearFilters:o}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(q.A,{placeholder:"Search Material Code",value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>s(),icon:(0,u.jsx)(P.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(n.Ay,{onClick:()=>o(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(P.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>t.materialCode.toLowerCase().includes(e.toLowerCase()),render:(e,t)=>(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold"},children:e}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:t.materialName||t.itemDescription||"Material Name"})]})},{title:"Plant Code",dataIndex:"plantCode",key:"plantCode",width:120,sorter:(e,t)=>(e.plantCode||"").localeCompare(t.plantCode||""),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:a,confirm:s,clearFilters:o}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(q.A,{placeholder:"Search Plant Code",value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>s(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>s(),icon:(0,u.jsx)(P.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(n.Ay,{onClick:()=>o(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(P.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>(t.plantCode||"").toLowerCase().includes(e.toLowerCase()),render:e=>(0,u.jsx)(k.A,{color:"blue",style:{fontWeight:"bold"},children:e||"N/A"})},{title:"Status",dataIndex:"completionStatus",key:"completionStatus",width:120,filters:[{text:"Draft",value:"DRAFT"},{text:"In Progress",value:"IN_PROGRESS"},{text:"Completed",value:"COMPLETED"}],onFilter:(e,t)=>t.completionStatus===e,render:e=>(0,u.jsx)(k.A,{color:l(e),children:e.replace("_"," ")})},{title:"Progress",key:"progress",width:150,sorter:(e,t)=>e.completionPercentage-t.completionPercentage,render:(e,t)=>{const a=t.completionPercentage||0;return(0,u.jsxs)("div",{children:[(0,u.jsx)(C.A,{percent:a,size:"small",strokeColor:r(a),format:()=>`${a}%`}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:2},children:[t.completedFields||0," / ",t.totalFields||0," fields"]})]})}},{title:"Days Pending",key:"daysPending",width:100,sorter:(e,t)=>c(e.lastModified)-c(t.lastModified),render:(e,t)=>{const a=c(t.lastModified);return(0,u.jsx)("span",{style:{color:a>3?"#ff4d4f":"inherit"},children:a})}},{title:"Open Queries",dataIndex:"openQueries",key:"openQueries",width:100,sorter:(e,t)=>(e.openQueries||0)-(t.openQueries||0),render:e=>e>0?(0,u.jsx)(k.A,{color:"red",children:e}):(0,u.jsx)(k.A,{color:"green",children:"0"})},{title:"Actions",key:"actions",width:150,render:(e,t)=>(0,u.jsx)(i.A,{children:(0,u.jsx)(n.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(S.A,{}),onClick:()=>p(t),disabled:t.isSubmitted||"COMPLETED"===t.completionStatus,children:t.completionPercentage>0?"Continue":"Start"})})}],[l,r,c,p]),h=(0,d.useCallback)(e=>c(e.lastModified)>3?"overdue-row":"",[c]),f=(0,d.useMemo)(()=>({pageSize:I.Bq.DEFAULT_PAGE_SIZE,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} materials`,pageSizeOptions:["10","20","50","100"]}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(_.A,{dataSource:t,columns:m,loading:a,rowKey:"id",pagination:f,rowClassName:h,scroll:{x:1200},size:"small",bordered:!0,title:()=>(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("span",{style:{fontWeight:"bold"},children:["Assigned Materials (",t.length,")"]}),o&&(0,u.jsx)(n.Ay,{onClick:o,loading:a,size:"small",children:"Refresh"})]})}),(0,u.jsx)("style",{children:"\n        .overdue-row {\n          background-color: #fff2f0;\n        }\n        .overdue-row:hover {\n          background-color: #ffebe6 !important;\n        }\n        .ant-table-tbody > tr.overdue-row > td {\n          border-bottom: 1px solid #ffccc7;\n        }\n      "})]})});N.displayName="WorkflowTable",N.defaultProps={loading:!1,onStartQuestionnaire:null,onRefresh:null};const D=N;var E=a(6091),R=a(1334),T=a(1814),F=a(9760),M=a(2115),O=a(3382),$=a(4524),z=a(6886),L=a(3357),U=a(7302),W=a(1306),Q=a(2878),B=a(6840),V=a(8143),G=a(1919),Y=a(5920),H=a(8600),J=a(6502),K=a(9098),X=a(349),Z=a(6651),ee=a(6603),te=a(2513),ae=a(1686),se=a(5964),oe=a(7490),le=a(8677),ne=a(6263),ie=a(2428),re=a(3661),de=a(9394),ce=a(4786);const{Text:ue,Title:pe}=s.A,me=e=>{var t;let{field:a,cqsData:s,cqsFieldMapping:o={},showDetails:l=!1,compact:n=!1}=e;const r=null===s||void 0===s||null===(t=s.cqsData)||void 0===t?void 0:t[a.name],d=null!==r&&void 0!==r&&""!==r,c=o[a.name]||a.label||a.name,p=a.isCqsAutoPopulated?d?"populated":"pending":"plant-input",m={populated:{color:"success",icon:(0,u.jsx)(f.A,{}),text:"Auto-Populated",description:"Value automatically populated from CQS system"},pending:{color:"warning",icon:(0,u.jsx)(h.A,{}),text:"Pending CQS",description:"Waiting for CQS system to provide value"},"plant-input":{color:"processing",icon:(0,u.jsx)(ce.A,{}),text:"Plant Input",description:"Value to be provided by plant personnel"}}[p];return n?(0,u.jsxs)(i.A,{size:"small",children:[a.isCqsAutoPopulated&&(0,u.jsx)(Z.A,{title:`${m.description}${d?` - Value: ${r}`:""}`,children:(0,u.jsxs)(k.A,{color:m.color,icon:m.icon,size:"small",style:{fontWeight:"bold",borderRadius:"12px"},children:["CQS ",d?"\u2713":"\u23f3"]})}),d&&(0,u.jsx)(ue,{strong:!0,style:{color:"#52c41a",background:"#f6ffed",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:r})]}):l||a.isCqsAutoPopulated?(0,u.jsx)(A.A,{size:"small",className:`cqs-field-card ${p}`,style:{marginBottom:8},children:(0,u.jsxs)(x.A,{gutter:[16,8],align:"middle",children:[(0,u.jsx)(v.A,{flex:"auto",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)(i.A,{children:[(0,u.jsx)(Z.A,{title:m.description,children:(0,u.jsx)(k.A,{color:m.color,icon:m.icon,children:m.text})}),(0,u.jsx)(ue,{strong:!0,children:c})]}),l&&(0,u.jsxs)(ue,{type:"secondary",style:{fontSize:"12px"},children:["Field: ",a.name]})]})}),(0,u.jsx)(v.A,{children:(0,u.jsx)(i.A,{direction:"vertical",align:"end",size:"small",children:d?(0,u.jsx)(ue,{strong:!0,style:{color:"#52c41a"},children:r}):a.isCqsAutoPopulated?(0,u.jsx)(ue,{type:"secondary",italic:!0,children:"Pending"}):(0,u.jsx)(ue,{type:"secondary",children:"Plant Input Required"})})})]})}):null};var he=a(8818),fe=a(1210),ge=a(5240),ye=a(9330),xe=a(7326),ve=a(691),Ae=a(8354);const{Panel:be}=xe.A,{Text:Ce}=s.A,je=e=>{let{workflowData:t}=e;const[a,s]=(0,d.useState)(!1),[o,r]=(0,d.useState)([]),[c,p]=(0,d.useState)(["basic","workflow","jvc-data"]),m=(0,d.useCallback)(async()=>{try{if(s(!0),null!==t&&void 0!==t&&t.projectCode&&null!==t&&void 0!==t&&t.materialCode){const e=await de.S.getReusableDocuments(t.projectCode,t.materialCode);r(e||[])}else{const e=await de.S.getWorkflowDocuments(t.id);r(e||[])}}catch(e){console.error("Failed to load JVC documents:",e),r([])}finally{s(!1)}},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode]);(0,d.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&m()},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode,m]);const h=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";if(!t)return(0,u.jsx)(A.A,{title:"Material Context",style:{height:"fit-content"},children:(0,u.jsx)(y.A,{message:"No Material Data",description:"Material context will appear here once a workflow is selected.",type:"info",showIcon:!0})});const f=(e=>{if(!e)return 0;const t=new Date,a=new Date(e),s=Math.abs(t-a);return Math.ceil(s/864e5)})(t.lastModified),g=f>3;return(0,u.jsxs)(A.A,{title:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ce.A,{}),"Material Context",g&&(0,u.jsx)(oe.A,{status:"error",text:`${f} days`})]}),style:{height:"fit-content",position:"sticky",top:24},size:"small",children:[(0,u.jsxs)(xe.A,{activeKey:c,onChange:p,ghost:!0,size:"small",children:[(0,u.jsx)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(E.A,{}),(0,u.jsx)("strong",{children:"Basic Information"})]}),children:(0,u.jsxs)(ve.A,{column:1,size:"small",children:[(0,u.jsx)(ve.A.Item,{label:"Material Code",children:(0,u.jsx)(Ce,{strong:!0,children:t.materialCode})}),(0,u.jsx)(ve.A.Item,{label:"Material Name",children:t.materialName||"Not specified"}),(0,u.jsx)(ve.A.Item,{label:"Assigned Plant",children:(0,u.jsx)(k.A,{color:"blue",children:t.assignedPlant})}),(0,u.jsx)(ve.A.Item,{label:"Initiated By",children:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(he.A,{}),t.initiatedBy]})}),(0,u.jsx)(ve.A.Item,{label:"Created",children:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(fe.A,{}),h(t.createdAt)]})})]})},"basic"),(0,u.jsx)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(he.A,{}),(0,u.jsx)("strong",{children:"Workflow Status"}),g&&(0,u.jsx)(ge.A,{style:{color:"#ff4d4f"}})]}),children:(0,u.jsxs)(i.A,{direction:"vertical",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,children:"Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(k.A,{color:(x=t.state,{JVC_PENDING:"blue",PLANT_PENDING:"orange",CQS_PENDING:"purple",TECH_PENDING:"cyan",COMPLETED:"green"}[x]||"default"),children:(e=>({JVC_PENDING:"JVC Pending",PLANT_PENDING:"Plant Pending",CQS_PENDING:"CQS Pending",TECH_PENDING:"Tech Pending",COMPLETED:"Completed"}[e]||e))(t.state)})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,children:"Time in Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(Ce,{style:{color:g?"#ff4d4f":"inherit"},children:[f," day",1!==f?"s":"",g&&" (Overdue)"]})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,children:"Last Modified:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(Ce,{type:"secondary",children:h(t.lastModified)})})]}),t.totalQueries>0&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,children:"Queries:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(i.A,{children:[(0,u.jsxs)(k.A,{color:"red",children:[t.openQueries||0," Open"]}),(0,u.jsxs)(k.A,{color:"green",children:[(t.totalQueries||0)-(t.openQueries||0)," Resolved"]})]})})]}),void 0!==t.completionPercentage&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,children:"Completion Progress:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(C.A,{percent:t.completionPercentage,size:"small",status:100===t.completionPercentage?"success":"active"})})]})]})},"workflow"),(0,u.jsx)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(E.A,{}),(0,u.jsx)("strong",{children:"JVC Documents"}),(0,u.jsx)(oe.A,{count:o.length,size:"small"})]}),children:a?(0,u.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,u.jsx)(ae.A,{size:"small"})}):o.length>0?(0,u.jsx)(i.A,{direction:"vertical",style:{width:"100%"},children:o.map((e,t)=>{var a;return(0,u.jsxs)(A.A,{size:"small",style:{marginBottom:8},styles:{body:{padding:"8px 12px"}},children:[(0,u.jsx)("div",{style:{marginBottom:4},children:(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"12px"},children:e.originalFileName||e.fileName||`Document ${t+1}`})}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)(Ce,{type:"secondary",style:{fontSize:"11px"},children:e.sourceDescription||`${e.documentSource||"Document"} \u2022 ${(null===(a=e.fileType)||void 0===a?void 0:a.toUpperCase())||"File"} \u2022 ${e.fileSize?`${(e.fileSize/1024/1024).toFixed(1)} MB`:"Unknown size"} \u2022 Uploaded by ${e.uploadedBy||"Unknown"}`})}),(0,u.jsx)("div",{style:{textAlign:"right"},children:(0,u.jsx)(Z.A,{title:"Download document",children:(0,u.jsx)(n.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(ye.A,{}),onClick:()=>(async(e,t)=>{try{console.log("Downloading document:",{documentId:e,filename:t});const a=await de.S.downloadDocument(e);console.log("Download blob received:",a);const s=window.URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=t||`document_${e}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s),l.Ay.success(`Downloaded ${t||"document"}`)}catch(a){console.error("Failed to download document:",a),l.Ay.error(`Failed to download document: ${a.message||"Unknown error"}`)}})(e.id,e.originalFileName||e.fileName),children:"Download"})})})]},e.id||t)})}):(0,u.jsx)(y.A,{message:"No Documents",description:"No documents have been provided by the JVC team for this material.",type:"info",showIcon:!0,size:"small"})},"documents"),(0,u.jsxs)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ce.A,{}),(0,u.jsx)("strong",{children:"JVC Material Data"}),(0,u.jsx)(Z.A,{title:"Information provided by JVC team for questionnaire completion",children:(0,u.jsx)(ce.A,{style:{fontSize:"12px",color:"#1890ff"}})})]}),children:[(0,u.jsxs)(ve.A,{column:1,size:"small",children:[(0,u.jsx)(ve.A.Item,{label:"Material Category",children:(0,u.jsx)(k.A,{color:"blue",children:t.materialCategory||"Not specified"})}),(0,u.jsx)(ve.A.Item,{label:"Supplier Information",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Supplier Name:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierName||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Supplier Code:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierCode||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Contact Info:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierContact||"Not provided"})]})]})}),(0,u.jsx)(ve.A.Item,{label:"Purchase Information",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Purchase Order:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.purchaseOrder||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Quantity Ordered:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.quantityOrdered||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Expected Delivery:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedDelivery?h(t.expectedDelivery):"Not specified"})]})]})}),(0,u.jsx)(ve.A.Item,{label:"Usage & Application",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Expected Usage:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedUsage||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Application Area:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.applicationArea||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Process Requirements:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.processRequirements||"Standard processing"})]})]})}),(0,u.jsx)(ve.A.Item,{label:"Regulatory Requirements",children:(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",fontSize:"12px"},children:t.regulatoryRequirements||"Standard compliance required"})}),(0,u.jsx)(ve.A.Item,{label:"Special Instructions",children:t.specialInstructions?(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px"},children:t.specialInstructions}):(0,u.jsx)(Ce,{type:"secondary",style:{fontSize:"12px"},children:"None"})}),(0,u.jsx)(ve.A.Item,{label:"Priority & Impact",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Urgency Level:"}),(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsx)(k.A,{color:"HIGH"===t.urgencyLevel?"red":"MEDIUM"===t.urgencyLevel?"orange":"green",children:t.urgencyLevel||"NORMAL"})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Business Impact:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.businessImpact||"Standard processing"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"11px"},children:"Cost Center:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.costCenter||"Not specified"})]})]})})]}),t.jvcNotes&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"12px"},children:"JVC Notes:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:t.jvcNotes})]}),t.knownProperties&&Object.keys(t.knownProperties).length>0&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Ce,{strong:!0,style:{fontSize:"12px"},children:"Known Properties:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f0f5ff",border:"1px solid #adc6ff",borderRadius:"4px",fontSize:"11px"},children:Object.entries(t.knownProperties).map(e=>{let[t,a]=e;return(0,u.jsxs)("div",{style:{marginBottom:2},children:[(0,u.jsxs)("strong",{children:[t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),":"]})," ",a]},t)})})]}),(0,u.jsx)(Ae.A,{style:{margin:"12px 0 8px 0"}}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:[(0,u.jsx)(Ce,{strong:!0,children:"For Plant Team Reference:"}),(0,u.jsxs)("ul",{style:{margin:"4px 0 0 16px",padding:0},children:[(0,u.jsx)("li",{children:"Review all JVC-provided information before starting questionnaire"}),(0,u.jsx)("li",{children:"Use this context when raising queries to other teams"}),(0,u.jsx)("li",{children:"Reference material ID and supplier details in communications"}),(0,u.jsx)("li",{children:"Contact JVC team for clarification on any provided data"}),(0,u.jsx)("li",{children:"Consider regulatory requirements when completing safety sections"})]})]})]},"jvc-data"),t.specifications&&(0,u.jsx)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ce.A,{}),(0,u.jsx)("strong",{children:"Technical Specifications"})]}),children:(0,u.jsx)(ve.A,{column:1,size:"small",children:Object.entries(t.specifications).map(e=>{let[t,a]=e;return(0,u.jsx)(ve.A.Item,{label:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),children:"object"===typeof a?JSON.stringify(a):String(a)},t)})})},"specifications"),t.safetyNotes&&(0,u.jsx)(be,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ge.A,{}),(0,u.jsx)("strong",{children:"Safety Notes"})]}),children:(0,u.jsx)(y.A,{message:"Important Safety Information",description:t.safetyNotes,type:"warning",showIcon:!0,size:"small"})},"safety")]}),(0,u.jsx)(Ae.A,{style:{margin:"12px 0"}})]});var x};var we=a(6833),Pe=a(7933),Se=a(6274);const{TextArea:qe}=q.A,{Option:ke}=o.A,_e=e=>{let{open:t,visible:a,onCancel:s,onSubmit:c,workflowId:p,fieldContext:m}=e;const[f]=K.A.useForm(),[g,x]=(0,d.useState)(!1),[v,A]=(0,d.useState)([]),[b,C]=(0,d.useState)(null);console.log("QueryRaisingModal props:",{open:t,visible:a,workflowId:p,fieldContext:m});const j=()=>{f.resetFields(),A([]),C(null),s()},w=e=>({LOW:"green",MEDIUM:"blue",HIGH:"orange",URGENT:"red"}[e]||"default");return(0,u.jsxs)(r.A,{title:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(Q.A,{}),"Raise Query"]}),open:t||a,onCancel:j,footer:b?[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>{const e=v.length>0?` with ${v.length} document(s) attached`:"";l.Ay.success(`Query completed${e}`),f.resetFields(),A([]);const t={id:b,documents:v};C(null),x(!1),c&&c(t)},children:"Done"},"done")]:[(0,u.jsx)(n.Ay,{onClick:j,children:"Cancel"},"cancel"),(0,u.jsx)(n.Ay,{type:"primary",loading:g,onClick:()=>f.submit(),children:"Create Query"},"submit")],width:600,destroyOnClose:!0,children:[m&&(0,u.jsx)(y.A,{message:"Field Context",description:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Step:"})," ",m.stepTitle]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Field:"})," ",m.label]}),m.placeholder&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Expected:"})," ",m.placeholder]})]}),type:"info",icon:(0,u.jsx)(ce.A,{}),style:{marginBottom:16}}),(0,u.jsxs)(Se.Ay,{form:f,layout:"vertical",onFinish:async e=>{try{x(!0);const t={question:e.question,assignedTeam:e.assignedTeam,priorityLevel:e.priority||"MEDIUM",fieldName:null===m||void 0===m?void 0:m.name,stepNumber:null===m||void 0===m?void 0:m.stepNumber,stepTitle:null===m||void 0===m?void 0:m.stepTitle,queryCategory:e.category||"GENERAL"},a=await re.B.createQuery(p,t);C(a.id),l.Ay.success("Query created successfully! You can now attach documents if needed.")}catch(t){console.error("Failed to create query:",t),l.Ay.error("Failed to raise query. Please try again."),x(!1)}},initialValues:{priority:"MEDIUM",fieldContext:null===m||void 0===m?void 0:m.label},componentName:"QueryRaisingModal",enableSecurityLogging:!0,disabled:null!==b,children:[m&&(0,u.jsx)(y.A,{message:"Recommended Team",description:(e=>{var t,a;if(!e||!e.name)return null;const s=e.name.toLowerCase(),o=(null===(t=e.stepTitle)||void 0===t?void 0:t.toLowerCase())||"",l=(null===(a=e.label)||void 0===a?void 0:a.toLowerCase())||"";let n=0;["hazard","safety","precautionary","environmental","toxic","corrosive","flammable","classification","ghs","signal","statement"].forEach(e=>{(s.includes(e)||o.includes(e)||l.includes(e))&&(n+=1)});let i=0;["physical","boiling","melting","technical","properties","temperature","state","color","odor","specification"].forEach(e=>{(s.includes(e)||o.includes(e)||l.includes(e))&&(i+=1)});let r=0;["material","supplier","cas","basic","information","name","identification","type"].forEach(e=>{(s.includes(e)||o.includes(e)||l.includes(e))&&(r+=1)});const d=Math.max(n,i,r);let c="CQS",p="Medium";0===d?p="Low":d>=3&&(p="High"),n===d?c="CQS":i===d?c="TECH":r===d&&(c="JVC");return(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{marginBottom:8},children:[(0,u.jsxs)("strong",{style:{color:"High"===p?"#52c41a":"Medium"===p?"#1890ff":"#faad14"},children:[c," Team"]})," ","is recommended (",p," confidence)"]}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:8},children:{CQS:"Chemical Quality & Safety team - handles safety data, hazard classifications, and regulatory compliance",TECH:"Technical team - handles technical specifications, physical properties, and process-related questions",JVC:"JVC team - handles material identification, supplier information, and general material questions"}[c]}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#999"},children:['Based on field: "',(0,u.jsx)("em",{children:e.label}),'" in step: "',(0,u.jsx)("em",{children:e.stepTitle}),'"']}),"Low"===p&&(0,u.jsx)("div",{style:{fontSize:"11px",color:"#fa8c16",marginTop:4},children:"\ud83d\udca1 Consider the nature of your question when selecting the team"})]})})(m),type:"info",style:{marginBottom:16},showIcon:!0}),(0,u.jsx)(K.A.Item,{name:"assignedTeam",label:"Assign to Team",rules:[{required:!0,message:"Please select a team to assign this query to"}],help:"Choose the most appropriate team based on your question type. Consider the field context and question nature.",children:(0,u.jsxs)(o.A,{placeholder:"Select team to handle this query",size:"large",showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.children.props.children[0].props.children.toLowerCase().indexOf(e.toLowerCase())>=0,children:[(0,u.jsx)(ke,{value:"CQS",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#722ed1"},children:"CQS Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Safety data, hazard classifications, regulatory compliance"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Safety measures, hazard statements, environmental impact"})]})}),(0,u.jsx)(ke,{value:"TECH",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#13c2c2"},children:"Technical Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Technical specs, physical properties, processes"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Physical properties, technical specifications, processes"})]})}),(0,u.jsx)(ke,{value:"JVC",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#1890ff"},children:"JVC Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Material identification, supplier info, general questions"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Material details, supplier information, general clarifications"})]})})]})}),(0,u.jsx)(Se.lE,{name:"fieldContext",label:"Field Context",help:"Specify which field or section this query relates to",validationType:"text",children:(0,u.jsx)(Se.eS,{placeholder:"e.g., Material Name, Safety Classification, Storage Conditions",prefix:(0,u.jsx)(ce.A,{}),validationType:"text",componentName:"QueryRaisingModal",fieldName:"fieldContext"})}),(0,u.jsx)(K.A.Item,{name:"category",label:"Query Category",help:"Categorize your query for better tracking and resolution",children:(0,u.jsxs)(o.A,{placeholder:"Select query category",size:"large",allowClear:!0,children:[(0,u.jsx)(ke,{value:"GENERAL",children:"General Question"}),(0,u.jsx)(ke,{value:"TECHNICAL",children:"Technical Specification"}),(0,u.jsx)(ke,{value:"SAFETY",children:"Safety & Compliance"}),(0,u.jsx)(ke,{value:"REGULATORY",children:"Regulatory Information"}),(0,u.jsx)(ke,{value:"ENVIRONMENTAL",children:"Environmental Impact"}),(0,u.jsx)(ke,{value:"TRANSPORTATION",children:"Transportation & Storage"}),(0,u.jsx)(ke,{value:"SUPPLIER",children:"Supplier Information"}),(0,u.jsx)(ke,{value:"CLARIFICATION",children:"Clarification Request"})]})}),(0,u.jsx)(K.A.Item,{name:"priority",label:"Priority Level",help:"Select the urgency level for this query",children:(0,u.jsx)(ee.Ay.Group,{children:(0,u.jsxs)(i.A,{direction:"vertical",children:[(0,u.jsxs)(ee.Ay,{value:"LOW",children:[(0,u.jsx)(k.A,{color:w("LOW"),children:"LOW"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"General information, non-blocking"})]}),(0,u.jsxs)(ee.Ay,{value:"MEDIUM",children:[(0,u.jsx)(k.A,{color:w("MEDIUM"),children:"MEDIUM"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Standard clarification needed"})]}),(0,u.jsxs)(ee.Ay,{value:"HIGH",children:[(0,u.jsx)(k.A,{color:w("HIGH"),children:"HIGH"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Important for completion"})]}),(0,u.jsxs)(ee.Ay,{value:"URGENT",children:[(0,u.jsx)(k.A,{color:w("URGENT"),children:"URGENT"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Blocking progress, needs immediate attention"})]})]})})}),(0,u.jsx)(Ae.A,{}),(0,u.jsx)(Se.lE,{name:"question",label:"Your Question",validationType:"richtext",help:"Be specific and provide context to help the assigned team understand your question",children:(0,u.jsx)(Se.wS,{rows:6,placeholder:"Describe your question in detail. Include:\n\u2022 What specific information you need\n\u2022 Why you need this information\n\u2022 Any relevant context or background\n\u2022 What you've already tried or researched",showCount:!0,maxLength:1e3,validationType:"richtext",componentName:"QueryRaisingModal",fieldName:"question"})}),b?(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsx)(y.A,{message:"Query Created Successfully!",description:"Your query has been created. You can now attach supporting documents if needed, or click 'Done' to finish.",type:"success",showIcon:!0,style:{marginBottom:16}}),(0,u.jsx)(Pe.A,{queryId:b,context:"query",onUploadComplete:e=>{A(t=>[...t,...e]),l.Ay.success(`${e.length} document(s) uploaded successfully`)},maxFiles:5,disabled:!1})]}):(0,u.jsx)(xe.A,{size:"small",ghost:!0,items:[{key:"documents",label:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(we.A,{}),(0,u.jsx)("span",{children:"Supporting Documents"}),(0,u.jsx)(k.A,{color:"blue",children:"Available after query creation"})]}),children:(0,u.jsx)(y.A,{message:"Document Attachment",description:"After creating your query, you'll be able to attach supporting documents to provide additional context. Documents help the assigned team better understand your question.",type:"info",showIcon:!0})}]}),(0,u.jsx)(Ae.A,{}),(0,u.jsx)(y.A,{message:"Query Guidelines",description:(0,u.jsxs)("ul",{style:{margin:0,paddingLeft:20},children:[(0,u.jsx)("li",{children:"Be specific and clear in your question"}),(0,u.jsx)("li",{children:"Include relevant context and background information"}),(0,u.jsx)("li",{children:"Mention any documentation or resources you've already checked"}),(0,u.jsx)("li",{children:"For urgent queries, explain why immediate attention is needed"}),(0,u.jsx)("li",{children:"Use appropriate technical terminology when relevant"})]}),type:"info",showIcon:!0,icon:(0,u.jsx)(h.A,{})})]})]})},{TextArea:Ie}=q.A,{Option:Ne}=o.A,{Text:De,Title:Ee,Paragraph:Re}=s.A,Te=e=>{let{workflowId:t,onComplete:a,onSaveDraft:s}=e;const[c]=K.A.useForm(),[p,m]=(0,d.useState)(0),[g,b]=(0,d.useState)(!0),[j,w]=(0,d.useState)(!1),[P,S]=(0,d.useState)(!1),[_,N]=(0,d.useState)(null),[D,ce]=(0,d.useState)({}),[ue,pe]=(0,d.useState)(new Set),[he,fe]=(0,d.useState)(!1),[ge,ye]=(0,d.useState)(null),[xe,ve]=(0,d.useState)([]),[Ae,be]=(0,d.useState)(!0),[Ce,we]=(0,d.useState)(!navigator.onLine),[Pe,Se]=(0,d.useState)(!1),[qe,ke]=(0,d.useState)(!1),[Te,Fe]=(0,d.useState)(!1),[Me,Oe]=(0,d.useState)(0),{isMobile:$e}=(()=>{const[e,t]=(0,d.useState)({isMobile:window.innerWidth<=I.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>I.EW.MOBILE_BREAKPOINT&&window.innerWidth<=I.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>I.EW.TABLET_BREAKPOINT});return(0,d.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=I.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>I.EW.MOBILE_BREAKPOINT&&window.innerWidth<=I.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>I.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),[ze,Le]=(0,d.useState)([]),[Ue,We]=(0,d.useState)(!0),[Qe,Be]=(0,d.useState)({}),[Ve,Ge]=(0,d.useState)({}),[Ye,He]=(0,d.useState)({}),Je={General:(0,u.jsx)(E.A,{}),Physical:(0,u.jsx)(R.A,{}),"Flammability and Explosivity":(0,u.jsx)(T.A,{}),Toxicity:(0,u.jsx)(F.A,{}),"Storage and Handling":(0,u.jsx)(M.A,{}),PPE:(0,u.jsx)(F.A,{}),"First Aid":(0,u.jsx)(O.A,{}),Statutory:(0,u.jsx)(M.A,{}),Others:(0,u.jsx)($.A,{}),Safety:(0,u.jsx)(F.A,{}),Environmental:(0,u.jsx)(z.A,{}),Quality:(0,u.jsx)(L.A,{})},Ke=(0,d.useCallback)(async()=>{try{var e;if(We(!0),null===_||void 0===_||!_.materialCode||null===_||void 0===_||!_.assignedPlant)return console.warn("Missing required data for template loading:",{materialCode:null===_||void 0===_?void 0:_.materialCode,assignedPlant:null===_||void 0===_?void 0:_.assignedPlant}),void Le(Xe());console.log("Loading questionnaire template for:",{materialCode:_.materialCode,plantCode:_.assignedPlant});const s=await de.S.getQuestionnaireTemplate({materialCode:_.materialCode,plantCode:_.assignedPlant,templateType:"PLANT_QUESTIONNAIRE"});if(console.log("Received template:",s),!s||!s.steps||!Array.isArray(s.steps))throw console.error("Invalid template structure:",s),new Error("Invalid template structure received from backend");let o={};try{o=await de.S.getCqsData({materialCode:null===_||void 0===_?void 0:_.materialCode,plantCode:null===_||void 0===_?void 0:_.assignedPlant}),console.log("CQS Response:",o),Be(o||{})}catch(a){console.error("Failed to load CQS data:",a)}const l=s.steps.map(e=>({...e,title:e.title||e.stepTitle||`Step ${e.stepNumber||"Unknown"}`,description:e.description||"",fields:(e.fields||[]).map(e=>{var t;const a=e.cqsAutoPopulated||e.isCqsAutoPopulated||!1;let s=null;return a&&null!==(t=o)&&void 0!==t&&t.cqsData&&o.cqsData[e.name]&&(s=o.cqsData[e.name]),{...e,isCqsAutoPopulated:a,cqsValue:s,disabled:a&&null!==s&&void 0!==s,placeholder:a&&s?`Auto-populated by CQS: ${s}`:a?"CQS data not available - manual input required":e.placeholder}})}));console.log("Processed steps:",l),Le(l);const n={};null!==(e=o)&&void 0!==e&&e.cqsData&&Object.entries(o.cqsData).forEach(e=>{let[t,a]=e;if(null!==a&&void 0!==a&&""!==a){const e=l.flatMap(e=>e.fields||[]).find(e=>e.name===t);e&&(e.cqsAutoPopulated||e.isCqsAutoPopulated)&&(n[t]=a)}}),He(n),Object.keys(n).length>0&&(console.log("Setting CQS form data:",n),ce(e=>({...e,...n})),c.setFieldsValue(n));try{const e=await de.S.getOrCreatePlantSpecificData({plantCode:null===_||void 0===_?void 0:_.assignedPlant,materialCode:null===_||void 0===_?void 0:_.materialCode,workflowId:t});if(Ge(e||{}),null!==e&&void 0!==e&&e.plantInputs){const t={...e.plantInputs,...n};ce(e=>({...e,...t})),c.setFieldsValue(t)}else Object.keys(n).length>0&&c.setFieldsValue(n)}catch(a){console.error("Failed to load plant-specific data:",a),Object.keys(n).length>0&&c.setFieldsValue(n)}}catch(a){console.error("Failed to load questionnaire template:",a),l.Ay.error(`Failed to load questionnaire template: ${a.message}`),console.log("Using fallback template"),Le(Xe())}finally{We(!1)}},[_,t,c]),Xe=()=>[{title:"General",description:"General information about MSDS availability and completeness",fields:[{name:"msds_available",label:"Is 16 Section MSDS of the raw material available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"missing_info",label:"Which information in any one of the 16 sections is not available in full?",type:"textarea",required:!1,placeholder:"Describe missing information"},{name:"sourcing_asked",label:"Has the identified missing / more information required from the supplier asked thru Sourcing?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"cas_available",label:"Is CAS number of the raw material based on the pure substance available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"mixture_ingredients",label:"For mixtures, are ingredients of mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"composition_percentage",label:"Is % age composition substances in the mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage_1",label:"Is the total %age of all substances in the mixture equal to 100?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage",label:"If not what is the % of substances not available?",type:"textarea",required:!1,placeholder:"Provide details about percentage composition"}]},{title:"Physical",description:"Physical properties and handling requirements",fields:[{name:"is_corrosive",label:"Is the material corrosive?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"corrosive_storage",label:"Does the plant have acid and alkali proof storage facilities to store a corrosive raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"highly_toxic",label:"Is the material highly toxic?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"toxic_powder_handling",label:"Does the plant have facilities to handle fine powder of highly toxic raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"crushing_facilities",label:"Does the plant have facilities to crush the stone like solid raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"heating_facilities",label:"Does the plant have facilities to heat/melt the raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"paste_preparation",label:"Does the plant have facilities to prepare paste of raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Flammability and Explosivity",description:"Flammability, explosivity and fire safety measures",fields:[{name:"flash_point_65",label:"Is Flash point of the raw material given and less than or equal to 65 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"petroleum_class",label:"Is the raw material is to be catgorised as ClassC / Class B / Class A substance as per Petroleum Act / Rules?",type:"select",required:!1,isCqsAutoPopulated:!0,options:[{value:"class_a",label:"Class A"},{value:"class_b",label:"Class B"},{value:"class_c",label:"Class C"},{value:"na",label:"N/A"}]},{name:"storage_license",label:"Does all the plants have the capacity and license to store the raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"ccoe_license",label:"If no, has the plant applied for CCoE license and by when expected to receive the license?",type:"textarea",required:!1,placeholder:"Provide details about CCoE license application"},{name:"flash_point_21",label:"Is Flash point of the raw material given is less than 21 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"flammable_infrastructure",label:"If yes, does plant have infrastructure to comply State Factories Rule for handling 'Flammable liquids'?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Toxicity",description:"Toxicity assessment and exposure control",fields:[{name:"ld50_oral",label:"Is LD 50 (oral) value available and higher than the threshold limit of 200 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"ld50_dermal",label:"Is LD 50 (Dermal) value available and higher than 1000 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"lc50_inhalation",label:"Is LC50 Inhalation value available and higher than 10 mg/L?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"exposure_minimization",label:"If no, in any of the above three cases (where avaialble) then does the plant have facilities and /or procedure to minmise the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe exposure minimization procedures"},{name:"carcinogenic",label:"Is the RM a suspect Carcinogenic?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"carcinogenic_control",label:"If yes, plant has adequate facilities and /or procedure to minimse the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe carcinogenic exposure control measures"}]},{title:"Process Safety Management",description:"Process safety management thresholds (CQS auto-populated)",fields:[{name:"psm_tier1_outdoor",label:"PSM Tier I Outdoor - Threshold quantity (kgs)",type:"input",required:!1,isCqsAutoPopulated:!0},{name:"psm_tier1_indoor",label:"PSM Tier I Indoor - Threshold quantity (kgs)",type:"input",required:!1,isCqsAutoPopulated:!0},{name:"psm_tier2_outdoor",label:"PSM Tier II Outdoor - Threshold quantity (kgs)",type:"input",required:!1,isCqsAutoPopulated:!0},{name:"psm_tier2_indoor",label:"PSM Tier II Indoor - Threshold quantity (kgs)",type:"input",required:!1,isCqsAutoPopulated:!0}]},{title:"Storage and Handling",description:"Storage and handling procedures",fields:[{name:"storage_conditions_stores",label:"Are any storage conditions required and available in the plant stores?",type:"textarea",required:!1,placeholder:"Describe storage conditions in plant stores"},{name:"storage_conditions_floor",label:"Are any storage conditions required and available in the shop floor?",type:"textarea",required:!1,placeholder:"Describe storage conditions on shop floor"},{name:"closed_loop_required",label:"Does it require closed loop handling system during charging?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"work_permit_available",label:"Does the plant have required Work permit and /or WI/SOP to handle the raw material adequately?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"procedures_details",label:"If, yes specify the procedures",type:"textarea",required:!1,placeholder:"Specify the procedures and work permits"}]},{title:"PPE",description:"Personal protective equipment requirements",fields:[{name:"recommended_ppe",label:"Recommended specific PPEs based on MSDS",type:"textarea",required:!1,isCqsAutoPopulated:!0},{name:"ppe_in_use",label:"Are recommended PPE as per MSDS to handle the RM is already in use at the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"partial",label:"Partially"}]},{name:"ppe_procurement_date",label:"If no, by when the plant can procure the require PPE?",type:"input",required:!1,placeholder:"Enter expected procurement date"}]},{title:"First Aid",description:"First aid measures and emergency response",fields:[{name:"is_poisonous",label:"Is the raw material poisonous as per the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"antidote_specified",label:"Is the name of antidote required to counter the impact of the material given in the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_available",label:"Is the above specified antidote available in the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_source",label:"If the specified antidote is not available then what is source and who will obtain the antidote in the plant?",type:"textarea",required:!1,placeholder:"Describe antidote source and procurement plan"},{name:"first_aid_capability",label:"Does the plant has capability to provide the first aid mentioned in the MSDS with the existing control measures?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]}]},{title:"Statutory",description:"Statutory compliance and regulatory requirements",fields:[{name:"cmvr_listed",label:"Is the RM or any of its ingredient listed in Table 3 of Rule 137 (CMVR)",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"msihc_listed",label:"Is the RM or any of its ingredient listed in part II of Schedule I of MSIHC Rule",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"factories_act_listed",label:"Is the RM or any of its ingredients listed in Schedule II of Factories Act",type:"radio",required:!1,isCqsAutoPopulated:!0,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"permissible_concentration",label:"With the current infrastructure, is the concentration of RM / ingredients listed in Schedule II of Factories Act within permissible concentrations as per Factories Act in the work area.",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"monitoring_details",label:"Mention details of work area monitoring results and describe infrastructure used for handling",type:"textarea",required:!1,placeholder:"Provide monitoring details and infrastructure description"}]},{title:"Others",description:"Additional inputs and gap analysis",fields:[{name:"plant_inputs_required",label:"Inputs required from plants based on the above assessment?",type:"textarea",required:!1,placeholder:"Describe inputs required from plants"},{name:"gaps_identified",label:"Gaps identified vis-\xe0-vis existing controls / protocols",type:"textarea",required:!1,placeholder:"Identify gaps in existing controls and protocols"},{name:"additional_input_1",label:"Additional Input 1",type:"textarea",required:!1,placeholder:"Additional input field 1"},{name:"additional_input_2",label:"Additional Input 2",type:"textarea",required:!1,placeholder:"Additional input field 2"}]}],Ze=(0,d.useCallback)(()=>{if(!ze||0===ze.length||!c)return 0;let e=0,t=0;try{const a=c.getFieldsValue(),s={...D,...a,...Ye};ze.forEach((a,o)=>{const l=a.fields||[];e+=l.length;const n=l.filter(e=>{const t=s[e.name];if(e.isCqsAutoPopulated||e.cqsAutoPopulated){const t=Ye[e.name],a=s[e.name]||t;return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a&&"Data not available"!==a}return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=n.length});const o=e>0?Math.round(t/e*100):0;return console.log(`  - Completed fields: ${t}`),console.log(`  - Completion percentage: ${o}%`),console.log(`  - CQS form data size: ${Object.keys(Ye).length}`),console.log(`  - Current form data size: ${Object.keys(s).length}`),o}catch(a){return console.error("Error calculating overall completion:",a),0}},[ze,D,c,Ye]),et=(0,d.useCallback)(async()=>{try{if(null===_||void 0===_||!_.assignedPlant||null===_||void 0===_||!_.materialCode)return void console.warn("Missing plant or material code for loading plant data");console.log("Loading plant-specific data for:",{plantCode:_.assignedPlant,materialCode:_.materialCode,workflowId:t});const e=await de.S.getPlantSpecificData({plantCode:_.assignedPlant,materialCode:_.materialCode});e&&e.plantInputs&&Object.keys(e.plantInputs).length>0?(console.log("Found existing plant data:",e.plantInputs),e.materialCode===_.materialCode?(ce(t=>({...t,...e.plantInputs})),c.setFieldsValue(e.plantInputs),e.submittedAt&&(Fe(!0),l.Ay.info("This questionnaire has been submitted and is read-only"))):(console.warn("Plant data material mismatch - not loading data"),ce({}),c.resetFields(),Fe(!1))):(console.log("No existing plant data found - starting fresh"),ce({}),c.resetFields(),Fe(!1))}catch(e){console.error("Failed to load plant-specific data:",e),ce({}),c.resetFields()}},[_,t,c]),tt=(0,d.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{w(!0);const n=c.getFieldsValue(),i={...D,...n},r={};Object.entries(i).forEach(e=>{let[t,a]=e;null!==a&&void 0!==a&&""!==a&&(r[t]=a)});const d=`plant_questionnaire_draft_${t}_${null===_||void 0===_?void 0:_.materialCode}_${null===_||void 0===_?void 0:_.assignedPlant}`,u={formData:r,currentStep:p,timestamp:Date.now(),completedSteps:Array.from(ue),version:"2.0",materialCode:null===_||void 0===_?void 0:_.materialCode,materialName:null===_||void 0===_?void 0:_.materialName,assignedPlant:null===_||void 0===_?void 0:_.assignedPlant,workflowId:t,lastSyncAttempt:Date.now(),syncStatus:Ce?"pending":"synced",totalFields:Object.keys(r).length,completionPercentage:Ze(),sessionId:Date.now()};try{localStorage.setItem(d,JSON.stringify(u))}catch(a){console.warn("Failed to save draft to local storage:",a)}if(Ce)Se(!0),e||l.Ay.info("Draft saved locally. Will sync when online.");else try{const a={plantCode:null===_||void 0===_?void 0:_.assignedPlant,materialCode:null===_||void 0===_?void 0:_.materialCode,responses:r,currentStep:p,completedSteps:Array.from(ue),modifiedBy:"current_user"};console.log("PlantQuestionnaire: Saving draft with data:",{plantCode:a.plantCode,materialCode:a.materialCode,responseCount:Object.keys(a.responses||{}).length,workflowId:t});const s=await de.S.saveDraftPlantResponses(t,a);console.log("PlantQuestionnaire: Draft save response:",s),e||(s.success?s.hasChanges?l.Ay.success(`Draft saved successfully (${s.savedFields||0} fields)`):console.log("No changes detected - draft not saved"):l.Ay.warning(s.message||"Draft save may have failed"))}catch(o){console.error("Failed to save draft to server:",o),Se(!0),e||(o.response&&o.response.data&&o.response.data.message?l.Ay.error(`Draft save failed: ${o.response.data.message}`):l.Ay.warning("Draft saved locally. Will sync when connection is restored."))}ce(i),s&&s(i)}catch(n){console.error("Failed to save draft:",n),e||l.Ay.error("Failed to save draft. Please try again.")}finally{w(!1)}},[c,D,t,s,p,ue,Ce,_,Ze]),at=(0,d.useCallback)(async()=>{if(p<ze.length-1)try{const e=c.getFieldsValue(),t={...D,...e};ce(t),await tt(!0),m(p+1)}catch(e){console.error("Failed to save data before moving to next step:",e),l.Ay.warning("Failed to save current data. Please try again.")}},[p,ze.length,c,D,tt]),st=(0,d.useCallback)(async()=>{if(p>0)try{const e=c.getFieldsValue(),t={...D,...e};ce(t),await tt(!0),m(p-1)}catch(e){console.error("Failed to save data before moving to previous step:",e),l.Ay.warning("Failed to save current data. Please try again.")}},[p,c,D,tt]),ot=(0,d.useCallback)(async e=>{if(e>=0&&e<ze.length)try{const t=c.getFieldsValue(),a={...D,...t};ce(a),await tt(!0),m(e)}catch(t){console.error("Failed to save data before changing step:",t),l.Ay.warning("Failed to save current data. Please try again.")}},[ze.length,c,D,tt]),lt=(0,d.useCallback)(()=>{if(!ze||0===ze.length||!c)return{total:0,populated:0};let e=0,t=0;try{const a=c.getFieldsValue(),s={...D,...a};return ze.forEach(a=>{const o=a.fields||[];e+=o.length;const l=o.filter(e=>{const t=s[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=l.length}),{total:e,populated:t}}catch(a){return console.error("Error calculating total fields populated:",a),{total:0,populated:0}}},[ze,D,c]);(0,d.useEffect)(()=>{const e=()=>{we(!1),X.Ay.success({message:"Connection Restored",description:"You are back online. Syncing your changes...",icon:(0,u.jsx)(U.A,{style:{color:"#52c41a"}}),duration:3}),Pe&&(tt(!0),Se(!1))},t=()=>{we(!0),X.Ay.warning({message:"Connection Lost",description:"You are offline. Changes will be saved locally and synced when connection is restored.",icon:(0,u.jsx)(W.A,{style:{color:"#fa8c16"}}),duration:5})};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[Pe,tt]),(0,d.useEffect)(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),tt()),(e.ctrlKey||e.metaKey)&&"ArrowRight"===e.key&&(e.preventDefault(),p<ze.length-1&&at()),(e.ctrlKey||e.metaKey)&&"ArrowLeft"===e.key&&(e.preventDefault(),p>0&&st()),"F1"===e.key&&(e.preventDefault(),r.A.info({title:"Keyboard Shortcuts",content:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + S:"})," Save draft"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2192:"})," Next step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2190:"})," Previous step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Tab:"})," Navigate between fields"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Enter:"})," Submit form or proceed"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Esc:"})," Close modals"]})]})}))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[p,ze.length,at,st,tt]);const nt=(0,d.useCallback)(async()=>{try{b(!0);const e=await de.S.getWorkflow(t);N(e);const a={};if(e.materialName&&(a.materialName=e.materialName),e.responses&&e.responses.length>0){const t={...a},s=new Set;e.responses.forEach(e=>{t[e.fieldName]=e.fieldValue,s.add(e.stepNumber)}),ce(e=>{const a={...t,...e};return c.setFieldsValue(a),a}),pe(s)}else ce(e=>{const t={...a,...e};return c.setFieldsValue(t),t})}catch(e){console.error("Failed to load workflow data:",e),l.Ay.error("Failed to load workflow data")}finally{b(!1)}},[t,c]),it=(0,d.useCallback)(async()=>{try{const e=await re.B.getQueriesByWorkflow(t);ve(e)}catch(e){console.error("Failed to load queries:",e)}},[t]);(0,d.useEffect)(()=>{t&&(nt(),it())},[t,nt,it]),(0,d.useEffect)(()=>{_&&_.materialCode&&_.assignedPlant&&(Ke(),et())},[_,Ke,et]),(0,d.useEffect)(()=>{if(Ae&&Object.keys(D).length>0){const e=setTimeout(()=>{tt(!0)},I.aZ.INTERVAL);return()=>clearTimeout(e)}},[D,Ae,tt]),(0,d.useEffect)(()=>{if(Ae&&Object.keys(D).length>0){const e=setTimeout(()=>{tt(!0)},I.aZ.DEBOUNCE_DELAY);return()=>clearTimeout(e)}},[D,Ae,tt]),(0,d.useEffect)(()=>{if(Object.keys(Ye).length>0){console.log("Applying CQS form data from useEffect:",Ye);const e={...c.getFieldsValue(),...Ye};c.setFieldsValue(e),ce(e=>({...e,...Ye}))}},[Ye,c]),(0,d.useEffect)(()=>{if(ze.length>0){const e=new Set,t=c.getFieldsValue(),a={...D,...t};ze.forEach((t,s)=>{const o=(t.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled),l=o.filter(e=>e.required),n=l.filter(e=>{const t=a[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});if(l.length>0)n.length===l.length&&e.add(s);else{const t=o.filter(e=>{const t=a[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});(o.length>0?t.length/o.length*100:0)>=50&&e.add(s)}}),pe(e)}},[D,ze,c]);(0,d.useEffect)(()=>{t&&!_&&(()=>{try{const e=`plant_questionnaire_draft_${t}_${null===_||void 0===_?void 0:_.materialCode}_${null===_||void 0===_?void 0:_.assignedPlant}`,a=localStorage.getItem(e);if(a){const s=JSON.parse(a),o=s.timestamp,l=Date.now();if(s.materialCode!==(null===_||void 0===_?void 0:_.materialCode)||s.assignedPlant!==(null===_||void 0===_?void 0:_.assignedPlant)||s.workflowId!==t)return console.warn("Draft data mismatch - clearing invalid draft:",{draftMaterial:s.materialCode,currentMaterial:null===_||void 0===_?void 0:_.materialCode,draftPlant:s.assignedPlant,currentPlant:null===_||void 0===_?void 0:_.assignedPlant}),void localStorage.removeItem(e);if(l-o<6048e5)if(s.formData&&"object"===typeof s.formData){const e={};Object.entries(s.formData).forEach(t=>{let[a,s]=t;null!==s&&void 0!==s&&""!==s&&(e[a]=s)}),ce(t=>({...t,...e})),c.setFieldsValue(e),"number"===typeof s.currentStep&&s.currentStep>=0&&s.currentStep<ze.length&&m(s.currentStep),Array.isArray(s.completedSteps)&&pe(new Set(s.completedSteps)),"pending"===s.syncStatus&&Se(!0);const t=Object.keys(e).length,a=Math.round((l-o)/36e5);X.Ay.success({message:"Draft Recovered",description:`${t} fields restored from ${a} hours ago. Your progress has been preserved.`,duration:6,placement:"topRight"})}else localStorage.removeItem(e),X.Ay.warning({message:"Draft Recovery Failed",description:"Previous draft data was corrupted and has been cleared.",duration:4});else{localStorage.removeItem(e);const t=Math.round((l-o)/864e5);X.Ay.info({message:"Old Draft Cleared",description:`Draft from ${t} days ago was automatically removed.`,duration:3})}}}catch(e){console.error("Failed to recover draft data:",e);try{const e=`plant_questionnaire_draft_${t}_${null===_||void 0===_?void 0:_.materialCode}_${null===_||void 0===_?void 0:_.assignedPlant}`;localStorage.removeItem(e),X.Ay.error({message:"Draft Recovery Error",description:"Failed to recover previous draft. Starting fresh.",duration:4})}catch(a){console.error("Failed to remove corrupted draft:",a)}}})()},[t,_,c,ze.length]);const rt=(0,d.useCallback)(e=>{if(!ze[e]||!ze[e].fields)return{total:0,required:0,optional:0,completed:0,requiredCompleted:0,optionalCompleted:0,isComplete:!1,hasOpenQueries:!1,hasResolvedQueries:!1,openQueriesCount:0,resolvedQueriesCount:0,completionPercentage:0,requiredCompletionPercentage:0};const t=ze[e].fields.filter(e=>!e.isCqsAutoPopulated&&!e.disabled),a=t.filter(e=>e.required),s=t.filter(e=>!e.required),o=c.getFieldsValue(),l={...D,...o},n=a.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),i=s.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),r=xe.filter(t=>t.stepNumber===e),d=r.filter(e=>"OPEN"===e.status),u=r.filter(e=>"RESOLVED"===e.status);return{total:t.length,required:a.length,optional:s.length,completed:n.length+i.length,requiredCompleted:n.length,optionalCompleted:i.length,isComplete:a.length>0?n.length===a.length:t.length>0&&(n.length+i.length)/t.length>=.5,hasOpenQueries:d.length>0,hasResolvedQueries:u.length>0,openQueriesCount:d.length,resolvedQueriesCount:u.length,completionPercentage:t.length>0?Math.round((n.length+i.length)/t.length*100):100,requiredCompletionPercentage:a.length>0?Math.round(n.length/a.length*100):100}},[ze,D,c,xe]),dt=(0,d.useCallback)(e=>{setTimeout(()=>{const t=document.querySelector(`[data-field-name="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),t.style.transition="background-color 0.3s ease",t.style.backgroundColor="#f6ffed",setTimeout(()=>{t.style.backgroundColor=""},2e3))},100)},[]);(0,d.useEffect)(()=>{if(xe.length>0){const e=xe.filter(e=>e.stepNumber===p&&"RESOLVED"===e.status&&!e.hasBeenViewed);if(e.length>0){const t=e.sort((e,t)=>new Date(t.resolvedAt)-new Date(e.resolvedAt))[0];dt(t.fieldName),X.Ay.success({message:"Query Resolved",description:`Your query about "${t.fieldName}" has been resolved. Check the field for the response.`,duration:5,placement:"topRight"})}}},[xe,p,dt]);const ct=async()=>{const e=ze.flatMap(e=>e.fields.filter(e=>e.required).map(e=>e.name));await c.validateFields(e);const s=c.getFieldsValue(),o=Ze();if(o<80){if(!await new Promise(e=>{r.A.confirm({title:"Incomplete Questionnaire",content:`Your questionnaire is only ${o}% complete. Are you sure you want to submit?`,okText:"Submit",cancelText:"Continue Editing",onOk:()=>e(!0),onCancel:()=>e(!1)})}))return}const n={plantCode:null===_||void 0===_?void 0:_.assignedPlant,materialCode:null===_||void 0===_?void 0:_.materialCode,responses:s,completionPercentage:o,submittedBy:"current_user",totalQueries:xe.length,openQueries:xe.filter(e=>"OPEN"===e.status).length},i=await de.S.submitPlantQuestionnaire(t,n);console.log("Submission result:",i);try{const e=`plant_questionnaire_draft_${t}_${null===_||void 0===_?void 0:_.materialCode}_${null===_||void 0===_?void 0:_.assignedPlant}`;localStorage.removeItem(e),console.log("Cleared draft data for submitted questionnaire:",e)}catch(d){console.warn("Failed to clear draft data:",d)}i.success?(Fe(!0),l.Ay.success("Questionnaire submitted successfully and marked as completed"),setTimeout(()=>{window.location.reload()},2e3),a&&a(s)):l.Ay.error(i.message||"Submission failed - please try again")},ut=e=>{var t,a,s;const l=xe.filter(t=>t.fieldName===e.name&&t.stepNumber===p),r=l.some(e=>"OPEN"===e.status),d=l.some(e=>"RESOLVED"===e.status),m=l.find(e=>"RESOLVED"===e.status),h=D[e.name]&&""!==D[e.name],g=(0,u.jsxs)("div",{className:"modern-field-label",children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",flexWrap:"wrap",marginBottom:"4px"},children:[(0,u.jsx)("span",{style:{flex:1,minWidth:0,lineHeight:"1.5"},children:e.label}),e.required&&(0,u.jsx)("span",{style:{color:"#ef4444",flexShrink:0},children:"*"}),e.isCqsAutoPopulated&&(0,u.jsx)(me,{field:e,cqsData:Qe,cqsFieldMapping:(null===_||void 0===_?void 0:_.cqsFieldMapping)||{},compact:!0}),h&&(0,u.jsx)(Z.A,{title:"Field completed",children:(0,u.jsx)(f.A,{style:{color:"#10b981",fontSize:"14px",flexShrink:0}})})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"4px",flexWrap:"wrap"},children:[(0,u.jsx)(n.Ay,{type:"text",size:"small",icon:(0,u.jsx)(Q.A,{}),onClick:()=>(e=>{console.log("handleRaiseQuery called with fieldName:",e);const t=ze[p].fields.find(t=>t.name===e),a=D[e]||c.getFieldValue(e);console.log("Found field:",t),console.log("Current value:",a),ye({...t,stepNumber:p,stepTitle:ze[p].title,currentValue:a,materialContext:{materialCode:null===_||void 0===_?void 0:_.materialCode,materialName:null===_||void 0===_?void 0:_.materialName,materialType:D.materialType||(null===_||void 0===_?void 0:_.materialType),supplierName:D.supplierName||(null===_||void 0===_?void 0:_.supplierName)}}),console.log("Setting queryModalVisible to true"),fe(!0)})(e.name),style:{color:"#667eea",padding:"2px 6px",height:"auto",fontSize:"12px"},children:"Query"}),r&&(0,u.jsx)(k.A,{color:"red",size:"small",children:"Query Open"}),d&&!r&&(0,u.jsx)(k.A,{color:"green",size:"small",children:"Query Resolved"})]})]}),y=(e=>{const t=[];switch(e.required&&t.push({required:!0,message:`${e.label} is required for MSDS completion`}),e.name){case"casNumber":t.push({pattern:/^\d{1,7}-\d{2}-\d$/,message:"Please enter a valid CAS number format (e.g., 64-17-5). If unknown, raise a query to the Technical team."});break;case"boilingPoint":case"meltingPoint":t.push({pattern:/^-?\d+(\.\d+)?$/,message:"Please enter a valid temperature in Celsius (e.g., 100.5 or -10)"});break;case"materialName":t.push({min:2,message:"Material name must be at least 2 characters"}),t.push({max:200,message:"Material name cannot exceed 200 characters"});break;case"supplierName":t.push({min:2,message:"Supplier name must be at least 2 characters"}),t.push({max:100,message:"Supplier name cannot exceed 100 characters"});break;case"missing_info":case"exposure_minimization":case"carcinogenic_control":case"storage_conditions_stores":case"storage_conditions_floor":case"procedures_details":case"antidote_source":case"monitoring_details":case"plant_inputs_required":case"gaps_identified":case"additional_input_1":case"additional_input_2":t.push({min:10,message:`${e.label} must be at least 10 characters for regulatory compliance`}),t.push({max:2e3,message:`${e.label} cannot exceed 2000 characters`})}return t})(e),x=m?(0,u.jsxs)("div",{style:{marginTop:8,padding:"12px 16px",background:"linear-gradient(135deg, #f0fdf4, #dcfce7)",border:"1px solid #bbf7d0",borderRadius:"8px",fontSize:"12px"},children:[(0,u.jsx)("div",{style:{marginBottom:6},children:(0,u.jsx)(De,{strong:!0,style:{color:"#059669"},children:"Query Response:"})}),(0,u.jsx)("div",{style:{marginBottom:6,color:"#374151"},children:m.response}),(0,u.jsxs)("div",{style:{fontSize:"10px",color:"#6b7280"},children:["Resolved by ",m.resolvedBy," on"," ",new Date(m.resolvedAt).toLocaleDateString()]})]}):(e=>({msds_available:"Material Safety Data Sheet with all 16 sections as per regulatory requirements",cas_available:"Chemical Abstracts Service number - unique identifier for chemical substances",is_corrosive:"Corrosive materials can cause damage to skin, eyes, and respiratory system",highly_toxic:"Materials with high toxicity require special handling and safety measures",flash_point_65:"Flash point indicates fire hazard - materials with flash point \u226465\xb0C are flammable",petroleum_class:"Classification under Petroleum Act determines storage and handling requirements",ld50_oral:"Lethal Dose 50 (oral) - dose that kills 50% of test animals when ingested",ld50_dermal:"Lethal Dose 50 (dermal) - dose that kills 50% of test animals through skin contact",lc50_inhalation:"Lethal Concentration 50 (inhalation) - concentration that kills 50% through inhalation",carcinogenic:"Materials suspected to cause cancer require enhanced safety protocols",recommended_ppe:"Personal Protective Equipment recommendations based on material hazards",is_poisonous:"Poisonous materials require specific antidotes and first aid procedures",cmvr_listed:"Chemical Manufacture and Verification Rules listing affects regulatory compliance",msihc_listed:"Manufacture, Storage and Import of Hazardous Chemical Rules listing",factories_act_listed:"Factories Act Schedule II listing requires workplace monitoring"}[e.name]||e.help))(e),v={name:e.name,label:g,rules:y,help:x,"data-field-name":e.name},A=e.isCqsAutoPopulated&&null!==Qe&&void 0!==Qe&&Qe.cqsData?Qe.cqsData[e.name]:null;if(e.isCqsAutoPopulated&&A){var b,C;const t=("radio"===e.type||"select"===e.type)&&(null===(b=e.options)||void 0===b||null===(C=b.find(e=>e.value===A))||void 0===C?void 0:C.label)||A;return(0,u.jsx)(K.A.Item,{...v,children:(0,u.jsxs)("div",{className:"cqs-readonly-field",children:[(0,u.jsx)("div",{className:"cqs-value-display",children:t}),(0,u.jsx)("div",{className:"cqs-readonly-note",children:(0,u.jsx)(De,{type:"secondary",style:{fontSize:"12px",fontStyle:"italic"},children:"Auto-populated by CQS system"})})]})})}const j=e.disabled||Te||!1,w={className:"modern-input "+(e.isCqsAutoPopulated?"cqs-auto-populated":""),disabled:j,placeholder:e.placeholder||`Enter ${e.label.toLowerCase()}`};switch(e.type){case"input":default:return(0,u.jsx)(K.A.Item,{...v,children:(0,u.jsx)(q.A,{...w})});case"textarea":return(0,u.jsx)(K.A.Item,{...v,children:(0,u.jsx)(Ie,{...w,rows:4,autoSize:{minRows:3,maxRows:6}})});case"select":return(0,u.jsx)(K.A.Item,{...v,children:(0,u.jsx)(o.A,{...w,placeholder:`Select ${e.label.toLowerCase()}`,showSearch:!0,optionFilterProp:"children",children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,u.jsx)(Ne,{value:e.value,children:e.label},e.value))})});case"radio":return(0,u.jsx)(K.A.Item,{...v,children:(0,u.jsx)(ee.Ay.Group,{className:"modern-radio-group "+(e.isCqsAutoPopulated?"cqs-auto-populated":""),disabled:j,children:(0,u.jsx)(i.A,{direction:"vertical",size:"small",children:null===(a=e.options)||void 0===a?void 0:a.map(e=>(0,u.jsx)(ee.Ay,{value:e.value,children:e.label},e.value))})})});case"checkbox":return(0,u.jsx)(K.A.Item,{...v,valuePropName:"checked",children:(0,u.jsx)(te.A.Group,{className:"modern-checkbox-group "+(e.isCqsAutoPopulated?"cqs-auto-populated":""),disabled:j,children:(0,u.jsx)(i.A,{direction:"vertical",size:"small",children:null===(s=e.options)||void 0===s?void 0:s.map(e=>(0,u.jsx)(te.A,{value:e.value,children:e.label},e.value))})})})}};if(g)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(E.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Ee,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Questionnaire"}),(0,u.jsx)(De,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your workflow data..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ae.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"30%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!_)return(0,u.jsx)(y.A,{message:"Workflow Not Found",description:"The requested workflow could not be loaded.",type:"error",showIcon:!0});if(Ue)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(R.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Ee,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Template"}),(0,u.jsx)(De,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your plant-specific questionnaire template..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ae.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"60%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!ze||0===ze.length)return(0,u.jsx)(y.A,{message:"Template Not Available",description:"The questionnaire template could not be loaded. Please try refreshing the page.",type:"error",showIcon:!0,action:(0,u.jsx)(n.Ay,{size:"small",onClick:()=>window.location.reload(),children:"Refresh"})});const pt=ze[p]||{title:"Loading...",description:"",fields:[]};return(0,u.jsxs)("div",{className:"plant-questionnaire-container "+(Te?"read-only":""),children:[(0,u.jsx)("div",{className:"plant-questionnaire-header",children:(0,u.jsxs)("div",{className:"plant-questionnaire-header-content",children:[(0,u.jsxs)("div",{className:"plant-questionnaire-title",children:[(0,u.jsx)(se.A,{size:40,style:{background:"linear-gradient(135deg, #667eea, #764ba2)"},children:(0,u.jsx)(B.A,{})}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Ee,{level:3,style:{margin:0,color:"#1e293b"},children:"Plant Questionnaire"}),(0,u.jsxs)(De,{type:"secondary",style:{fontSize:"14px"},children:[null===_||void 0===_?void 0:_.materialCode," \u2022 ",null===_||void 0===_?void 0:_.assignedPlant]})]})]}),(0,u.jsxs)("div",{className:"plant-questionnaire-stats",children:[(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ze()},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("defs",{children:(0,u.jsxs)("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#4f46e5"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#7c3aed"})]})}),(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"30",cy:"30",r:"26"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"30",cy:"30",r:"26"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"600",color:"#1e293b"},children:[Ze(),"%"]})]}),(0,u.jsx)("div",{style:{textAlign:"center",marginTop:8},children:(0,u.jsx)(De,{style:{fontSize:"11px",color:"#64748b"},children:"Overall Progress"})})]}),(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,u.jsx)(oe.A,{count:xe.filter(e=>"OPEN"===e.status).length,style:{backgroundColor:xe.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"},children:(0,u.jsx)(se.A,{icon:(0,u.jsx)(Q.A,{}),style:{backgroundColor:xe.filter(e=>"OPEN"===e.status).length>0?"#fef2f2":"#f0fdf4",color:xe.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"}})})}),(0,u.jsx)(De,{style:{fontSize:"11px",color:"#64748b",display:"block",textAlign:"center"},children:"Open Queries"})]}),(0,u.jsx)("div",{className:"modern-stats-card",children:(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsxs)("div",{className:"modern-completion-badge "+(Ze()>=80?"high":Ze()>=50?"medium":"low"),children:["Step ",p+1,"/",ze.length]}),(0,u.jsx)(De,{style:{fontSize:"11px",color:"#64748b",display:"block",marginTop:4},children:"Current Step"})]})}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(V.A,{}),onClick:()=>tt(),loading:j,disabled:Te,children:Te?"Read Only":"Save Draft"}),$e&&(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(G.A,{}),onClick:()=>ke(!0),children:"Steps"})]})]})]})}),Te&&(0,u.jsx)(y.A,{message:"Questionnaire Submitted",description:"This questionnaire has been submitted and is now read-only. No further changes can be made.",type:"info",showIcon:!0,style:{margin:"16px 0"},banner:!0}),(0,u.jsxs)("div",{className:"plant-questionnaire-main",children:[!$e&&(0,u.jsxs)("div",{className:"plant-questionnaire-sidebar",children:[(0,u.jsxs)(A.A,{className:"modern-steps-card",children:[(0,u.jsxs)("div",{className:"modern-steps-header",children:[(0,u.jsx)(Ee,{level:4,style:{margin:0,color:"#1e293b"},children:"Questionnaire Steps"}),(0,u.jsxs)(De,{type:"secondary",style:{fontSize:"12px",display:"block",marginBottom:"4px"},children:[ue.size," of ",ze.length," steps completed"]}),(0,u.jsx)(De,{type:"secondary",style:{fontSize:"11px",display:"block",marginTop:"2px"},children:(()=>{const e=lt();return`${e.populated} of ${e.total} fields populated`})()})]}),(0,u.jsx)("div",{className:"modern-steps-list",children:ze.map((e,t)=>{const a=rt(t),s=xe.some(e=>e.stepNumber===t&&"OPEN"===e.status),o=t===p,l=a.isComplete;return(0,u.jsxs)("div",{className:`modern-step-item ${o?"active":""} ${l?"completed":""}`,onClick:()=>ot(t),children:[(0,u.jsx)("div",{className:"step-completion-ring "+(l?"completed":""),style:{"--completion-angle":a.requiredCompleted/Math.max(a.required,1)*360+"deg",background:o?"#4f46e5":l?"#10b981":"#f1f5f9",color:o||l?"white":"#64748b"},children:l?(0,u.jsx)(f.A,{}):s?(0,u.jsx)(h.A,{}):Je[e.title]||(0,u.jsx)(E.A,{})}),(0,u.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,u.jsx)("div",{style:{fontWeight:o?600:400,color:"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:2},children:[a.completed,"/",a.total," fields (",a.requiredCompleted,"/",a.required," required)",s&&(0,u.jsxs)(k.A,{color:"red",size:"small",style:{marginLeft:4},children:[xe.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})]},t)})})]}),(0,u.jsx)("div",{style:{marginTop:16},children:(0,u.jsx)(je,{workflowData:_})})]}),(0,u.jsx)("div",{className:"plant-questionnaire-content",children:(0,u.jsxs)(A.A,{className:"modern-form-card",children:[(0,u.jsxs)("div",{className:"modern-form-header",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Ee,{level:2,style:{margin:0,color:"white"},children:pt.title}),(0,u.jsx)(Re,{style:{margin:"8px 0 0 0",color:"rgba(255, 255, 255, 0.8)"},children:pt.description})]}),(0,u.jsxs)("div",{className:"modern-progress-container",children:[(0,u.jsx)(C.A,{className:"modern-progress",percent:(()=>{const e=rt(p);return e.required>0?Math.round(e.requiredCompleted/e.required*100):100})(),showInfo:!1,strokeColor:"rgba(255, 255, 255, 0.9)",trailColor:"rgba(255, 255, 255, 0.2)"}),(0,u.jsxs)(De,{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"12px"},children:["Step Progress:"," ",(()=>{const e=rt(p);return`${e.requiredCompleted}/${e.required} required fields`})()]})]})]}),Ce&&(0,u.jsx)(y.A,{className:"modern-alert modern-alert-warning",message:"Offline Mode",description:"You are currently offline. Changes will be saved locally and synced when connection is restored.",type:"warning",showIcon:!0,style:{margin:"16px 32px"},closable:!0}),(0,u.jsx)("div",{className:"modern-form-content "+(p%2===0?"slide-in-from-right":"slide-in-from-left"),children:(0,u.jsx)(K.A,{form:c,layout:"vertical",onValuesChange:(e,t)=>{ce(e=>({...e,...t})),Se(!0),Oe(e=>e+1),setTimeout(()=>{if(ze.length>0){const e=new Set;ze.forEach((a,s)=>{const o=(a.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled),l=o.filter(e=>e.required),n=l.filter(e=>{const a=t[e.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});if(l.length>0)n.length===l.length&&e.add(s);else{const a=o.filter(e=>{const a=t[e.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});(o.length>0?a.length/o.length*100:0)>=50&&e.add(s)}}),pe(e)}},100)},children:(0,u.jsx)(x.A,{gutter:[24,24],children:(pt.fields||[]).map((e,t)=>(0,u.jsx)(v.A,{xs:24,sm:"textarea"===e.type?24:12,md:"textarea"===e.type?24:12,children:(0,u.jsx)("div",{className:`modern-field-group ${e.required?"required":""} ${e.isCqsAutoPopulated?"cqs-populated":""} fade-in-up`,style:{animationDelay:.1*t+"s"},children:(0,u.jsxs)("div",{className:"modern-field-header",children:[(0,u.jsx)("div",{style:{flex:1,minWidth:0},children:ut(e)}),(0,u.jsx)("div",{className:"modern-field-actions",children:e.isCqsAutoPopulated&&(0,u.jsx)(Z.A,{title:"CQS Auto-populated",children:(0,u.jsx)("div",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"500"},children:"CQS"})})})]})})},e.name))})})}),(0,u.jsxs)("div",{className:"modern-navigation",children:[(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(Y.A,{}),onClick:st,disabled:0===p,style:{opacity:0===p?.5:1,cursor:0===p?"not-allowed":"pointer"},children:"Previous"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsx)(De,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Step Progress"}),(0,u.jsxs)(De,{style:{fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:[p+1," of ",ze.length]})]}),Pe&&(0,u.jsx)("div",{style:{padding:"4px 8px",background:"#fef3c7",border:"1px solid #fde68a",borderRadius:"6px",fontSize:"11px",color:"#92400e"},children:"Unsaved changes"}),p===ze.length-1?(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-primary "+(100===Ze()?"pulse-glow":""),onClick:async()=>{try{S(!0);const e=xe.filter(e=>"OPEN"===e.status);if(e.length>0)return void r.A.confirm({title:"Open Queries Detected",content:`You have ${e.length} open queries. Are you sure you want to submit the questionnaire? It's recommended to resolve all queries before submission.`,okText:"Submit Anyway",cancelText:"Cancel",onOk:()=>ct()});await ct()}catch(e){console.error("Failed to submit questionnaire:",e),400===e.status?l.Ay.error("Please complete all required fields before submitting"):401===e.status?l.Ay.error("Session expired. Please log in again."):l.Ay.error("Failed to submit questionnaire. Please try again.")}finally{S(!1)}},loading:P,disabled:Te,size:"large",style:{minWidth:"160px"},children:Te?"Submitted":P?"Submitting...":"Submit Questionnaire"})}):(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-primary",icon:(0,u.jsx)(H.A,{}),onClick:at,style:{minWidth:"120px"},children:"Next Step"})]})]})]})})]}),(0,u.jsx)(le.A,{className:"modern-drawer",title:"Questionnaire Steps",placement:"left",onClose:()=>ke(!1),open:qe,width:320,children:(0,u.jsx)("div",{className:"modern-timeline",children:(0,u.jsx)(ne.A,{children:ze.map((e,t)=>{const a=rt(t),s=xe.some(e=>e.stepNumber===t&&"OPEN"===e.status),o=t===p,l=a.isComplete;return(0,u.jsx)(ne.A.Item,{color:l?"#10b981":o?"#667eea":"#cbd5e1",dot:l?(0,u.jsx)(f.A,{style:{color:"#10b981"}}):s?(0,u.jsx)(h.A,{style:{color:"#ef4444"}}):Je[e.title]||(0,u.jsx)(E.A,{}),children:(0,u.jsxs)("div",{onClick:()=>{ot(t),ke(!1)},style:{cursor:"pointer",padding:"8px 0"},children:[(0,u.jsx)(De,{strong:o,style:{color:o?"#667eea":"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:4},children:[a.completed,"/",a.total," fields completed (",a.requiredCompleted,"/",a.required," required)",s&&(0,u.jsxs)(k.A,{color:"red",size:"small",style:{marginLeft:4},children:[xe.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})},t)})})})}),!$e&&(0,u.jsxs)("div",{className:"modern-floating-indicator",children:[(0,u.jsx)("div",{style:{textAlign:"center",marginBottom:12},children:(0,u.jsx)(De,{strong:!0,style:{color:"#1e293b",fontSize:"14px"},children:"Questionnaire Progress"})}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ze(),width:"40px",height:"40px"},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"20",cy:"20",r:"16"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"20",cy:"20",r:"16"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"600",color:"#1e293b"},children:[Ze(),"%"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#1e293b",fontWeight:"500",marginBottom:"4px"},children:[ue.size," of ",ze.length," steps"]}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#64748b",marginBottom:"2px"},children:(()=>{const e=lt();return`${e.populated}/${e.total} fields`})()}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#64748b"},children:[xe.filter(e=>"OPEN"===e.status).length," open queries"]})]})]}),(0,u.jsx)("div",{style:{height:"2px",background:"#e2e8f0",borderRadius:"1px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:`${Ze()}%`,background:"linear-gradient(135deg, #4f46e5, #7c3aed)",transition:"width 0.5s ease"}})})]}),(0,u.jsx)("div",{className:"modern-floating-actions",children:(0,u.jsxs)(ie.A.Group,{trigger:"hover",type:"primary",style:{right:24},icon:(0,u.jsx)($.A,{}),children:[(0,u.jsx)(ie.A,{icon:(0,u.jsx)(V.A,{}),tooltip:Te?"Read Only":"Save Draft",onClick:()=>tt(),disabled:Te}),(0,u.jsx)(ie.A,{icon:(0,u.jsx)(B.A,{}),tooltip:"Summary",onClick:()=>{const e=ze.map((e,t)=>{const a=rt(t),s=xe.filter(e=>e.stepNumber===t);return{step:t+1,title:e.title,completed:a.requiredCompleted,required:a.required,percentage:a.required>0?Math.round(a.requiredCompleted/a.required*100):100,openQueries:s.filter(e=>"OPEN"===e.status).length,resolvedQueries:s.filter(e=>"RESOLVED"===e.status).length}});r.A.info({title:"Questionnaire Summary",width:600,content:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{marginBottom:16},children:(0,u.jsxs)(De,{strong:!0,children:["Overall Progress: ",Ze(),"%"]})}),e.map(e=>(0,u.jsxs)("div",{style:{marginBottom:12,padding:"12px 16px",background:100===e.percentage?"linear-gradient(135deg, #f0fdf4, #dcfce7)":"linear-gradient(135deg, #fffbeb, #fef3c7)",border:"1px solid "+(100===e.percentage?"#bbf7d0":"#fde68a"),borderRadius:"8px"},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)(De,{strong:!0,children:["Step ",e.step,": ",e.title]}),(0,u.jsxs)(k.A,{color:100===e.percentage?"green":"orange",children:[e.percentage,"%"]})]}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:[e.completed,"/",e.required," required fields completed",e.openQueries>0&&(0,u.jsxs)("span",{style:{color:"#ef4444",marginLeft:8},children:["\u2022 ",e.openQueries," open queries"]}),e.resolvedQueries>0&&(0,u.jsxs)("span",{style:{color:"#10b981",marginLeft:8},children:["\u2022 ",e.resolvedQueries," resolved queries"]})]})]},e.step))]})})}}),(0,u.jsx)(ie.A,{icon:Ae?(0,u.jsx)(J.A,{}):(0,u.jsx)(W.A,{}),tooltip:Ae?"Auto-save ON":"Auto-save OFF",onClick:()=>be(!Ae)})]})}),(0,u.jsx)(_e,{open:he,onCancel:()=>{fe(!1),ye(null)},onSubmit:e=>{fe(!1),ye(null),it(),l.Ay.success("Query raised successfully")},workflowId:t,fieldContext:ge})]})};var Fe=a(5423),Me=a(3719),Oe=a(7258);var $e=a(5123),ze=a(9799),Le=a(8348);const{Title:Ue}=s.A,{Option:We}=o.A,Qe=()=>{const[e,t]=(0,d.useState)(null),[a,s]=(0,d.useState)(!1),[c,m]=(0,d.useState)(null),[h,f]=(0,d.useState)(null),[g,y]=(0,d.useState)([]),{isPlantUser:x,isAdmin:v,userPlants:A,primaryPlant:b,filterByPlantAccess:C}=(0,$e.hm)(),{workflows:j,loading:P,error:S,dashboardStats:q,refreshWorkflows:k}=((e,t)=>{const[a,s]=(0,d.useState)([]),[o,n]=(0,d.useState)(!0),[i,r]=(0,d.useState)(null),[c,u]=(0,d.useState)({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),p=(0,d.useCallback)(()=>{const e=localStorage.getItem("userPlant"),t=localStorage.getItem("username");return console.log("Plant detection:",{storedPlant:e,storedUser:t,localStorage:Object.keys(localStorage)}),e||"1102"},[]),m=(0,d.useCallback)(async t=>{try{n(!0),r(null);const l=e||p();if(!l)return console.warn("No plant code available for loading workflows"),s([]),void u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0});let i;console.log("Loading workflows for plant:",l);let d=[];try{i=await de.S.getPlantDashboardData(l,{signal:t}),console.log("Received dashboard data:",i),d=i.workflows.filter(e=>e.plantCode===l).map(e=>{const t=(0,Oe.EO)(e,e.plantInputs);let a;return a=e.isSubmitted||100===t.completionPercentage?"COMPLETED":t.completionPercentage>0?"IN_PROGRESS":"DRAFT",{id:e.workflowId,materialCode:e.materialCode,plantCode:e.plantCode,currentState:e.isSubmitted?I.Fv.COMPLETED:I.sB.PLANT_PENDING,completionStatus:a,completionPercentage:t.completionPercentage,totalFields:t.totalFields,completedFields:t.completedFields,requiredFields:e.requiredFields||0,completedRequiredFields:e.completedRequiredFields||0,lastModified:e.lastModified,submittedAt:e.submittedAt,submittedBy:e.submittedBy,isSubmitted:e.isSubmitted,isCompleted:e.isCompleted,openQueries:e.openQueries||0,assignedPlant:e.plantCode,materialName:e.materialName,itemDescription:e.itemDescription}})}catch(a){console.warn("Failed to load plant-specific data, falling back to regular workflows:",a);try{const e=await de.S.getWorkflowsByPlant(l,{signal:t});console.log("Fallback: Loaded plant workflows:",e);const{totalFields:a}=(0,Oe.Jl)();d=e.filter(e=>(e.plantCode||e.assignedPlant)===l).map(e=>{var t;const s=e.plantInputs||(null===(t=e.plantData)||void 0===t?void 0:t.plantInputs)||{},{completionPercentage:o,completedFields:l}=(0,Oe.L$)(s);let n;const i=e.isSubmitted||e.submittedAt;return n=i||100===o?"COMPLETED":o>0?"IN_PROGRESS":"DRAFT",{id:e.id,materialCode:e.materialCode,plantCode:e.plantCode||e.assignedPlant,currentState:e.currentState||e.state,completionStatus:n,completionPercentage:o,totalFields:a,completedFields:l,requiredFields:50,completedRequiredFields:0,lastModified:e.lastModified,submittedAt:e.submittedAt||null,submittedBy:e.submittedBy||null,isSubmitted:i,isCompleted:e.isCompleted||!1,openQueries:e.openQueries||0,assignedPlant:e.plantCode||e.assignedPlant,materialName:e.materialName,itemDescription:e.itemDescription}}),console.log("Fallback: Processed workflows:",d)}catch(o){console.error("Fallback also failed:",o),d=[]}i={totalWorkflows:d.length,completedCount:0,inProgressCount:0,draftCount:d.length,averageCompletion:0}}s(d),u({totalWorkflows:i.totalWorkflows||0,completedCount:i.completedCount||0,inProgressCount:i.inProgressCount||0,draftCount:i.draftCount||0,averageCompletion:i.averageCompletion||0,completedToday:0})}catch(i){console.error("Failed to load plant workflows:",i),r(i.message),l.Ay.error("Failed to load workflows"),s([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0})}finally{n(!1)}},[e,p]),h=(0,d.useCallback)(async()=>{const e=new AbortController;await m(e.signal)},[m]);return(0,d.useEffect)(()=>{const a=new AbortController;return(async()=>{if(t&&e)try{await m(a.signal)}catch(i){a.signal.aborted||console.error("Error loading plant workflows:",i)}else s([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),n(!1)})(),()=>{a.abort()}},[t,e,m]),{workflows:a,loading:o,error:i,dashboardStats:c,loadPlantWorkflows:m,refreshWorkflows:h}})(c,h);(0,d.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await _(e.signal)}catch(S){e.signal.aborted||console.error("Error loading user plant data:",S)}})(),()=>{e.abort()}},[]);const _=async e=>{try{if(!(0,Me.wR)())return console.warn("User is not authenticated"),void l.Ay.error("You are not logged in. Please log in to access the plant dashboard.");const t=(0,Me.HW)();if(!t)return console.warn("No current user found"),void l.Ay.error("Unable to identify current user. Please log in again.");console.log("Loading plant data for user:",t);const[a,s]=await Promise.all([Le.E.getUserPlantAssignments(t,{signal:e}),ze.B.getAllLocations({signal:e})]);console.log("User plant data received:",a),console.log("Assigned plants:",null===a||void 0===a?void 0:a.assignedPlants),console.log("Primary plant:",null===a||void 0===a?void 0:a.primaryPlant),f(a);const o=a.primaryPlant||a.assignedPlants&&a.assignedPlants[0];if(o&&a.assignedPlants&&a.assignedPlants.includes(o))m(o),localStorage.setItem("userPlant",o),console.log("Set current plant to primary/effective plant:",o);else if(a.assignedPlants&&a.assignedPlants.length>0){const e=a.assignedPlants[0];m(e),localStorage.setItem("userPlant",e),console.log("Set current plant to first assigned plant:",e)}if(a.assignedPlants&&a.assignedPlants.length>0){const e=a.assignedPlants.map(e=>{const t=s.find(t=>t.locationCode===e),o=e===a.primaryPlant;return{value:e,label:t?`${e} - ${t.description}${o?" (Primary)":""}`:`${e}${o?" (Primary)":""}`}});y(e),console.log("Available plants set:",e)}}catch(S){console.error("Failed to load user plant data:",S),f({assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}),y([]),m(null),l.Ay.error("Unable to load plant assignments. Please contact administrator to assign plants to your user.")}},N=(0,d.useCallback)(e=>{!h||h.assignedPlants.includes(e)?(localStorage.setItem("userPlant",e),m(e),l.Ay.success(`Switched to plant: ${e}`)):l.Ay.error(`You are not assigned to plant: ${e}`)},[h]),E=(0,d.useCallback)(e=>{t(e),s(!0)},[]),R=(0,d.useCallback)(e=>{s(!1),t(null),k(),l.Ay.success("Questionnaire completed successfully!")},[k]),T=(0,d.useCallback)(e=>{l.Ay.success("Draft saved successfully")},[]);return(0,Me.wR)()?null===h?(0,u.jsx)(Fe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ue,{level:3,children:"Loading Plant Assignments..."}),(0,u.jsx)("p",{children:"Please wait while we load your plant assignments."})]})}):!h||h.assignedPlants&&0!==h.assignedPlants.length?(0,u.jsx)(Fe.yE,{children:(0,u.jsx)(p,{plantCode:c,children:(0,u.jsxs)("div",{style:{padding:24},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[(0,u.jsx)(Ue,{level:2,style:{margin:0},children:"Plant Dashboard"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)("span",{style:{fontSize:"14px",fontWeight:"500"},children:"Plant:"}),(0,u.jsx)(o.A,{value:c,onChange:N,style:{width:250},size:"small",disabled:!h||g.length<=1,showSearch:!0,filterOption:(e,t)=>{var a;return null===t||void 0===t||null===(a=t.children)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase())},placeholder:"Select assigned plant",children:g.map(e=>(0,u.jsx)(We,{value:e.value,children:e.label},e.value))})]}),(0,u.jsx)(i.A,{children:(0,u.jsx)(n.Ay,{onClick:k,loading:P,children:"Refresh Data"})})]})]}),c?(0,u.jsx)(w,{dashboardStats:q,loading:P,error:S,currentPlant:c,onRefresh:k}):(0,u.jsxs)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:[(0,u.jsx)(Ue,{level:4,children:"Select a Plant"}),(0,u.jsx)("p",{children:"Please select a plant from the dropdown above to view the dashboard and assigned materials."})]}),c&&(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(D,{workflows:j,loading:P,onStartQuestionnaire:E,onRefresh:k})}),(0,u.jsx)(r.A,{title:`Material Questionnaire - ${null===e||void 0===e?void 0:e.materialCode}`,open:a,onCancel:()=>{s(!1),t(null)},footer:null,width:"95%",style:{top:20},destroyOnClose:!0,children:e&&(0,u.jsx)(Te,{workflowId:e.id,onComplete:R,onSaveDraft:T})})]})})}):(0,u.jsx)(Fe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ue,{level:3,children:"No Plant Assignments"}),(0,u.jsx)("p",{children:"You are not assigned to any plants. Please contact your administrator to assign plants to your user account."}),(0,u.jsxs)("div",{style:{marginTop:16,padding:16,background:"#f5f5f5",borderRadius:4},children:[(0,u.jsx)("p",{children:(0,u.jsx)("strong",{children:"Debug Info:"})}),(0,u.jsxs)("p",{children:["Current User: ",(0,Me.HW)()]}),(0,u.jsxs)("p",{children:["Is Authenticated: ",(0,Me.wR)().toString()]}),(0,u.jsxs)("p",{children:["User Plant Data: ",JSON.stringify(h,null,2)]}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{onClick:()=>{console.log("Current user:",(0,Me.HW)()),console.log("User plant data:",h),console.log("Available plants:",g),_()},children:"Debug & Retry"}),(0,u.jsx)(n.Ay,{type:"primary",onClick:async()=>{try{const e=(0,Me.HW)();if(!e)return void l.Ay.error("No current user found");const t="1102",a=[t];await Le.E.updateUserPlantAssignments(e,{assignedPlants:a,primaryPlant:t}),l.Ay.success("Plant assignments fixed! Please refresh the page or log out and log back in."),await _()}catch(S){console.error("Failed to assign plants:",S),403===S.status?l.Ay.error("You need admin permissions to assign plants. Please ask an administrator to assign plants to your user account."):l.Ay.error(`Failed to assign plants: ${S.message}`)}},children:"Fix Plant Assignments (Admin Required)"}),(0,u.jsx)(n.Ay,{onClick:()=>{l.Ay.info("Logging out to refresh token..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/qrmfg/login"},children:"Logout & Re-login"})]})]})]})}):(0,u.jsx)(Fe.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ue,{level:3,children:"Authentication Required"}),(0,u.jsx)("p",{children:"You need to be logged in to access the plant dashboard."}),(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>window.location.href="/qrmfg/login",children:"Go to Login"})]})})}}}]);
//# sourceMappingURL=862.8f3d5c1e.chunk.js.map