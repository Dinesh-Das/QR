"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[285],{3285:(e,s,r)=>{r.r(s),r.d(s,{default:()=>W});var t=r(6237),i=r(119),l=r(9470),a=r(3889),n=r(3117),o=r(617),c=r(2261),d=r(5206),u=r(9073),h=r(1645),A=r(7419),x=r(6051),y=r(6612),m=r(8918),f=r(3927),j=r(5043),g=r(6649),w=r(8365),p=r(173),v=r(5423),k=r(5661),b=r(2868),E=r(5123),S=r(579);const{Title:T}=f.A,{TabPane:P}=m.A,W=()=>{const[e,s]=(0,j.useState)({totalQueries:0,openQueries:0,resolvedToday:0,overdueQueries:0,avgResolutionTime:0,highPriorityQueries:0}),{isTechUser:r,isAdmin:f}=(0,E.hm)();(0,j.useEffect)(()=>{const e=new AbortController;return W(e.signal),()=>{e.abort()}},[]);const W=async e=>{try{const[r,t,i,l,a]=await Promise.all([g.default.get("/queries/stats/count-open/TECH",{signal:e}).catch(()=>0),g.default.get("/queries/stats/resolved-today",{signal:e}).catch(()=>0),g.default.get("/queries/overdue",{signal:e}).then(e=>Array.isArray(e)?e.filter(e=>e.assignedTeam===b.r0.TECH).length:0).catch(()=>0),g.default.get("/queries/stats/avg-resolution-time/TECH",{signal:e}).catch(()=>0),g.default.get("/queries/high-priority",{signal:e}).then(e=>Array.isArray(e)?e.filter(e=>e.assignedTeam===b.r0.TECH).length:0).catch(()=>0)]);s({totalQueries:r+t,openQueries:r,resolvedToday:t,overdueQueries:i,avgResolutionTime:l,highPriorityQueries:a})}catch(r){console.error("Failed to load dashboard stats:",r)}};return(0,S.jsx)(v.PK,{children:(0,S.jsxs)("div",{style:{padding:24},children:[(0,S.jsx)(T,{level:2,children:"Tech Dashboard"}),(0,S.jsxs)(A.A,{gutter:16,style:{marginBottom:16},children:[(0,S.jsx)(h.A,{span:6,children:(0,S.jsx)(u.A,{children:(0,S.jsx)(y.A,{title:"Open Queries",value:e.openQueries,prefix:(0,S.jsx)(n.A,{}),valueStyle:{color:"#cf1322"}})})}),(0,S.jsx)(h.A,{span:6,children:(0,S.jsx)(u.A,{children:(0,S.jsx)(y.A,{title:"Resolved Today",value:e.resolvedToday,prefix:(0,S.jsx)(t.A,{}),valueStyle:{color:"#3f8600"}})})}),(0,S.jsx)(h.A,{span:6,children:(0,S.jsx)(u.A,{children:(0,S.jsx)(y.A,{title:"Overdue",value:e.overdueQueries,prefix:(0,S.jsx)(l.A,{}),valueStyle:{color:e.overdueQueries>0?"#cf1322":"#3f8600"}})})}),(0,S.jsx)(h.A,{span:6,children:(0,S.jsx)(u.A,{children:(0,S.jsx)(y.A,{title:"Avg Resolution",value:e.avgResolutionTime,precision:1,suffix:"hrs",prefix:(0,S.jsx)(i.A,{})})})})]}),e.overdueQueries>0&&(0,S.jsx)(c.A,{message:`${e.overdueQueries} queries are overdue (>3 days)`,description:"These queries require immediate attention to maintain SLA compliance.",type:"error",showIcon:!0,style:{marginBottom:16},action:(0,S.jsx)(d.Ay,{size:"small",danger:!0,children:"View Overdue"})}),e.highPriorityQueries>0&&(0,S.jsx)(c.A,{message:`${e.highPriorityQueries} high priority queries pending`,description:"These queries have been marked as high priority and need urgent resolution.",type:"warning",showIcon:!0,style:{marginBottom:16},action:(0,S.jsx)(d.Ay,{size:"small",type:"primary",children:"View High Priority"})}),(0,S.jsxs)(m.A,{defaultActiveKey:"queries",size:"large",tabBarExtraContent:(0,S.jsx)(x.A,{children:(0,S.jsx)(d.Ay,{icon:(0,S.jsx)(o.A,{}),onClick:W,size:"small",children:"Refresh Stats"})}),children:[(0,S.jsx)(P,{tab:(0,S.jsxs)(x.A,{children:[(0,S.jsx)(n.A,{}),(0,S.jsx)("span",{children:"Query Inbox"}),e.openQueries>0&&(0,S.jsx)("span",{style:{background:"#ff4d4f",color:"white",borderRadius:"10px",padding:"2px 6px",fontSize:"12px"},children:e.openQueries})]}),children:(0,S.jsx)(p.A,{team:"TECH",userRole:"TECH_USER"})},"queries"),(0,S.jsx)(P,{tab:(0,S.jsxs)(x.A,{children:[(0,S.jsx)(i.A,{}),(0,S.jsx)("span",{children:"Workflow Dashboard"})]}),children:(0,S.jsx)(k.A,{userRole:"TECH_USER"})},"dashboard"),(0,S.jsx)(P,{tab:(0,S.jsxs)(x.A,{children:[(0,S.jsx)(a.A,{}),(0,S.jsx)("span",{children:"Query History"})]}),children:(0,S.jsx)(w.A,{})},"history")]})]})})}},5123:(e,s,r)=>{r.d(s,{hm:()=>a});var t=r(5043),i=r(3719),l=r(4642);const a=()=>{const[e,s]=(0,t.useState)(null),[r,a]=(0,t.useState)(!0),[n,o]=(0,t.useState)(null),c=(0,t.useCallback)(async()=>{if(!(0,i.wR)())return s(null),void a(!1);try{a(!0),o(null);const e=await l.A.getUserAccessSummary();s(e)}catch(e){console.warn("Failed to load access summary, using fallback:",e),o(e);const r=l.A.getFallbackAccessSummary();s(r)}finally{a(!1)}},[]);(0,t.useEffect)(()=>{c()},[c]);const d=(0,t.useCallback)(async e=>{try{return await l.A.hasScreenAccess(e)}catch(n){return console.warn("Screen access check failed, using fallback:",n),l.A.getFallbackScreenAccess(e)}},[]),u=(0,t.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await l.A.hasDataAccess(e,s)}catch(n){return console.warn("Data access check failed, using fallback:",n),l.A.getFallbackDataAccess(e,s)}},[]),h=(0,t.useCallback)(async function(e,s){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await l.A.hasPlantDataAccess(e,s,r)}catch(n){return console.warn("Plant data access check failed, using fallback:",n),l.A.getFallbackPlantDataAccess(e,s,r)}},[]),A=(0,t.useCallback)(async function(e,s,r){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{return await l.A.makeAccessDecision(e,s,r,t)}catch(n){return console.warn("Access decision failed, using fallback:",n),l.A.getFallbackAccessDecision(e,s,r,t)}},[]),x=(0,t.useCallback)((e,s)=>l.A.filterDataByPlantAccess(e,s),[]);return{loading:r,error:n,isAuthenticated:(0,i.wR)(),currentUser:(0,i.HW)(),primaryRole:(0,i.Jv)(),userPlants:(0,i.nT)(),primaryPlant:(0,i.bN)(),isAdmin:(0,i.qc)(),isJvcUser:(0,i.bV)(),isCqsUser:(0,i.po)(),isTechUser:(0,i.C9)(),isPlantUser:(0,i.X9)(),isViewer:(0,i.Z$)(),accessSummary:e,hasRole:e=>(0,i.hf)(e),hasAnyRole:e=>e.some(e=>(0,i.hf)(e)),hasAllRoles:e=>e.every(e=>(0,i.hf)(e)),checkScreenAccess:d,checkDataAccess:u,checkPlantDataAccess:h,makeAccessDecision:A,filterByPlantAccess:x,refresh:c}}},5661:(e,s,r)=>{r.d(s,{A:()=>k});var t=r(1210),i=r(6237),l=r(119),a=r(9470),n=r(6091),o=r(8818),c=r(2261),d=r(5206),u=r(9073),h=r(1645),A=r(7419),x=r(6051),y=r(1686),m=r(6612),f=r(3217),j=r(6399),g=r(5043),w=r(2868),p=r(9394),v=r(579);const k=e=>{let{onWorkflowSelect:s}=e;const[r,k]=(0,g.useState)(!0),[b,E]=(0,g.useState)({summary:{},overdueWorkflows:[],recentActivity:[],workflowsByState:{}}),[S,T]=(0,g.useState)(null),{isMobile:P}=(()=>{const[e,s]=(0,g.useState)({isMobile:window.innerWidth<=w.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>w.EW.MOBILE_BREAKPOINT&&window.innerWidth<=w.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>w.EW.TABLET_BREAKPOINT});return(0,g.useEffect)(()=>{const e=()=>{s({isMobile:window.innerWidth<=w.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>w.EW.MOBILE_BREAKPOINT&&window.innerWidth<=w.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>w.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})();(0,g.useEffect)(()=>{W()},[]);const W=async()=>{try{k(!0);const[e,s,r,t]=await Promise.all([p.S.getDashboardSummary(),p.S.getOverdueWorkflows(3),p.S.getRecentActivity(7),p.S.getWorkflowCountsByState()]);E({summary:e,overdueWorkflows:s,recentActivity:r,workflowsByState:t})}catch(e){T("Failed to load dashboard data"),console.error("Dashboard error:",e)}finally{k(!1)}},C=e=>({JVC_PENDING:"blue",PLANT_PENDING:"orange",CQS_PENDING:"purple",TECH_PENDING:"cyan",COMPLETED:"green"}[e]||"default"),R=()=>[{title:"Material Code",dataIndex:"materialCode",key:"materialCode",width:P?120:140,fixed:!!P&&"left",render:(e,s)=>(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{fontWeight:"bold"},children:e}),s.itemDescription&&(0,v.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:s.itemDescription})]})},{title:"State",dataIndex:"currentState",key:"currentState",width:P?80:100,render:e=>(0,v.jsx)(j.A,{color:C(e),size:P?"small":"default",children:P?e.split("_")[0]:e.replace("_"," ")})},{title:"Plant",dataIndex:"assignedPlant",key:"assignedPlant",width:100,responsive:["lg"]},{title:"Days",dataIndex:"daysPending",key:"daysPending",width:P?60:100,render:e=>(0,v.jsx)("span",{style:{color:e>3?"#ff4d4f":"inherit"},children:e})},{title:"Queries",key:"queries",width:P?70:80,responsive:["sm"],render:(e,s)=>(0,v.jsxs)("span",{children:[s.openQueries>0&&(0,v.jsx)(j.A,{color:"red",size:"small",children:s.openQueries}),!P&&(0,v.jsxs)("small",{children:[s.totalQueries," total"]})]})},{title:"Actions",key:"actions",width:P?80:100,fixed:!!P&&"right",render:(e,r)=>(0,v.jsx)(x.A,{children:(0,v.jsx)(d.Ay,{size:"small",type:"link",onClick:()=>s&&s(r.id),children:"View"})})}];return r?(0,v.jsx)("div",{style:{textAlign:"center",padding:"50px"},children:(0,v.jsx)(y.A,{size:"large"})}):S?(0,v.jsx)(c.A,{message:"Error",description:S,type:"error",showIcon:!0,action:(0,v.jsx)(d.Ay,{size:"small",onClick:W,children:"Retry"})}):(0,v.jsxs)("div",{children:[(0,v.jsxs)(A.A,{gutter:[16,16],style:{marginBottom:24},className:"workflow-dashboard-stats",children:[(0,v.jsx)(h.A,{xs:12,sm:12,md:6,lg:6,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Total Workflows",value:b.summary.totalWorkflows||0,prefix:(0,v.jsx)(n.A,{})})})}),(0,v.jsx)(h.A,{xs:12,sm:12,md:6,lg:6,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Active Workflows",value:b.summary.activeWorkflows||0,prefix:(0,v.jsx)(l.A,{}),valueStyle:{color:"#1890ff"}})})}),(0,v.jsx)(h.A,{xs:12,sm:12,md:6,lg:6,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Overdue",value:b.summary.overdueWorkflows||0,prefix:(0,v.jsx)(a.A,{}),valueStyle:{color:"#ff4d4f"}})})}),(0,v.jsx)(h.A,{xs:12,sm:12,md:6,lg:6,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Completed",value:b.summary.completedWorkflows||0,prefix:(0,v.jsx)(i.A,{}),valueStyle:{color:"#52c41a"}})})})]}),(0,v.jsxs)(A.A,{gutter:[16,16],style:{marginBottom:24},className:"workflow-dashboard-stats",children:[(0,v.jsx)(h.A,{xs:24,sm:8,md:8,lg:8,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Open Queries",value:b.summary.openQueries||0,prefix:(0,v.jsx)(o.A,{}),valueStyle:{color:"#fa8c16"}})})}),(0,v.jsx)(h.A,{xs:12,sm:8,md:8,lg:8,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Avg Resolution Time",value:Math.round(b.summary.avgResolutionTimeHours||0),suffix:P?"hrs":"hours",prefix:(0,v.jsx)(t.A,{})})})}),(0,v.jsx)(h.A,{xs:12,sm:8,md:8,lg:8,children:(0,v.jsx)(u.A,{children:(0,v.jsx)(m.A,{title:"Recent Workflows",value:b.summary.recentWorkflows||0,prefix:(0,v.jsx)(n.A,{}),valueStyle:{color:"#722ed1"}})})})]}),b.overdueWorkflows.length>0&&(0,v.jsx)(u.A,{title:"Overdue Workflows",style:{marginBottom:24},extra:(0,v.jsx)(d.Ay,{type:"primary",size:"small",children:"View All"}),children:(0,v.jsx)(f.A,{dataSource:b.overdueWorkflows,columns:R(),pagination:{pageSize:w.Bq.SMALL_PAGE_SIZE},size:"small",rowKey:"id",scroll:P?{x:600}:void 0,className:P?"workflow-table-mobile touch-friendly-table":""})}),(0,v.jsx)(u.A,{title:"Recent Activity",extra:(0,v.jsx)(d.Ay,{type:"primary",size:"small",children:"View All"}),children:(0,v.jsx)(f.A,{dataSource:b.recentActivity,columns:R(),pagination:{pageSize:P?5:10},size:"small",rowKey:"id",scroll:P?{x:600}:void 0,className:P?"workflow-table-mobile touch-friendly-table":""})})]})}}}]);
//# sourceMappingURL=285.32699160.chunk.js.map