"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[454],{2868:(e,t,r)=>{r.d(t,{aZ:()=>u,lX:()=>h,rb:()=>i,Bq:()=>x,fz:()=>n,cS:()=>a,pZ:()=>d,tS:()=>g,r0:()=>c,EW:()=>s,sB:()=>o,Fv:()=>l});const s={MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:1024,PAGE_SIZE:10,DEBOUNCE_DELAY:300},l={INITIATED:"INITIATED",IN_PROGRESS:"IN_PROGRESS",PENDING_REVIEW:"PENDING_REVIEW",APPROVED:"APPROVED",REJECTED:"REJECTED",COMPLETED:"COMPLETED"},n={LOW:"LOW",MEDIUM:"MEDIUM",HIGH:"HIGH",URGENT:"URGENT",CRITICAL:"CRITICAL"},i=(l.INITIATED,l.IN_PROGRESS,l.PENDING_REVIEW,l.APPROVED,l.REJECTED,l.COMPLETED,n.LOW,n.MEDIUM,n.HIGH,n.URGENT,n.CRITICAL,{MAX_UPLOAD_SIZE:26214400,BYTES_PER_KB:1024,BYTES_PER_MB:1048576,BYTES_PER_GB:1073741824}),o={JVC_PENDING:"JVC_PENDING",PLANT_PENDING:"PLANT_PENDING",CQS_PENDING:"CQS_PENDING",TECH_PENDING:"TECH_PENDING",DRAFT:"DRAFT",IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED"},a={OPEN:"OPEN",RESOLVED:"RESOLVED",CLOSED:"CLOSED"},d={ACTIVE:["OPEN"],INACTIVE:["RESOLVED","CLOSED"]},c={CQS:"CQS",TECH:"TECH",JVC:"JVC",PLANT:"PLANT"},u={INTERVAL:4e4,DEBOUNCE_DELAY:15e3},x={DEFAULT_PAGE_SIZE:10,SMALL_PAGE_SIZE:5,LARGE_PAGE_SIZE:15,SHOW_SIZE_CHANGER:!0,SHOW_QUICK_JUMPER:!0},h={ALL:"all",COMPLETED:"completed",IN_PROGRESS:"in-progress",NOT_STARTED:"not-started"},g={INITIATE:"initiate",PENDING:"pending",COMPLETED:"completed",QUERIES:"queries",HISTORY:"history"}},3661:(e,t,r)=>{r.d(t,{B:()=>l});var s=r(6649);const l={createQuery:(e,t)=>s.default.post(`/queries/workflow/${e}`,t),getQuery:e=>s.default.get(`/queries/${e}`),updateQuery:(e,t)=>s.default.put(`/queries/${e}`,t),deleteQuery:e=>s.default.delete(`/queries/${e}`),resolveQuery:(e,t)=>s.default.post(`/queries/${e}/resolve`,t),reopenQuery:(e,t)=>s.default.post(`/queries/${e}/reopen`,{reason:t}),assignQuery:(e,t)=>s.default.post(`/queries/${e}/assign`,t),reassignQuery:(e,t,r)=>s.default.put(`/queries/${e}/assign`,{team:t,reason:r}),getQueriesByWorkflow:e=>s.default.get(`/queries/workflow/${e}`),getQueriesByTeam:e=>s.default.get(`/queries/team/${e}`),getQueriesByStatus:e=>s.default.get(`/queries/status/${e}`),getQueriesByUser:e=>s.default.get("/queries/my-raised"),searchQueries:e=>{const t=new URLSearchParams(e).toString();return s.default.get(`/queries/search?${t}`)},getQueryStats:e=>s.default.get(`/queries/recent?days=${e}`),getQueryCountsByTeam:e=>s.default.get(`/queries/stats/count-open/${e}`),getAvgResolutionTimeByTeam:e=>s.default.get(`/queries/stats/avg-resolution-time/${e}`),getOverdueQueries:function(){return s.default.get("/queries/overdue")},getOverdueQueriesCountByTeam:e=>s.default.get(`/queries/stats/overdue-count/${e}`),getQueriesResolvedTodayByTeam:e=>s.default.get(`/queries/stats/resolved-today/${e}`),getQuerySLAStatus:e=>s.default.get(`/queries/${e}/is-overdue`),getQueriesNearingSLA:function(){return s.default.get("/queries/needing-attention")},addQueryComment:(e,t)=>s.default.post(`/queries/${e}/comments`,{comment:t}),getQueryComments:e=>s.default.get(`/queries/${e}/comments`),updateQueryPriority:(e,t)=>s.default.put(`/queries/${e}/priority`,{priority:t}),escalateQuery:(e,t)=>s.default.put(`/queries/${e}/priority`,{priorityLevel:"HIGH"}),uploadQueryDocuments:(e,t)=>s.default.upload(`/queries/${e}/documents`,t),uploadResponseDocuments:(e,t,r)=>s.default.upload(`/queries/${e}/responses/${t}/documents`,r),getQueryDocuments:e=>s.default.get(`/queries/${e}/documents`),downloadQueryDocument:(e,t)=>s.default.download(`/queries/${e}/documents/${t}/download`),deleteQueryDocument:(e,t)=>s.default.delete(`/queries/${e}/documents/${t}`),closeQuery:(e,t)=>s.default.post(`/queries/${e}/close`,{reason:t}),canPlantEditForm:e=>s.default.get(`/queries/workflow/${e}/can-edit`),getQueryStatusSummary:e=>s.default.get(`/queries/workflow/${e}/status-summary`)}},4454:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ne});var s=r(6091),l=r(617),n=r(8463),i=r(6840),o=r(2878),a=r(3889),d=r(4786),c=r(8918),u=r(3927),x=r(6553),h=r(487),g=r(6569),p=r(6399),y=r(6051),f=r(5206),m=r(7490),A=r(7419),E=r(1645),j=r(9073),w=r(3217),b=r(2751),S=r(691),C=r(5043),T=r(3216),v=r(6649),I=r(6237),D=r(7407),k=r(119),P=r(3117),R=r(3722),N=r(7326),L=r(1686),_=r(2261),O=r(6263);const B=e=>v.default.get(`/audit/workflow/${e}`),Q=e=>v.default.get(`/audit/query/${e}`),W=e=>v.default.get(`/audit/workflow/${e}/complete`);var z=r(579);const{Panel:q}=N.A,M=e=>{let{workflowId:t,entityType:r="workflow"}=e;const[l,n]=(0,C.useState)(!0),[i,o]=(0,C.useState)([]),[a,d]=(0,C.useState)(null),[c,u]=(0,C.useState)(new Set),{isMobile:x}=(()=>{const[e,t]=(0,C.useState)({isMobile:window.innerWidth<=768,isTablet:window.innerWidth>768&&window.innerWidth<=1024,isDesktop:window.innerWidth>1024});return(0,C.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=768,isTablet:window.innerWidth>768&&window.innerWidth<=1024,isDesktop:window.innerWidth>1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})();(0,C.useEffect)(()=>{t&&h()},[t,r,h]);const h=(0,C.useCallback)(async()=>{try{let e;switch(n(!0),r){case"workflow":default:e=await B(t);break;case"query":e=await Q(t);break;case"complete":e=await W(t)}o(g(e))}catch(e){d("Failed to load audit history"),console.error("Audit history error:",e)}finally{n(!1)}},[t,r,g]),g=(0,C.useCallback)(e=>e.map((e,t)=>({id:t,timestamp:e.timestamp||e.revisionDate,user:e.username||e.modifiedBy||"System",action:e.revisionType||e.action||"UPDATE",entityType:e.entityType||"MaterialWorkflow",entityId:e.entityId||e.id,changes:e.changes||[],description:e.description||m(e),details:e.details||e})),[]),m=e=>{const t=e.revisionType||e.action,r=e.entityType||"workflow";switch(t){case"ADD":case"CREATE":return`Created new ${r.toLowerCase()}`;case"MOD":case"UPDATE":return`Updated ${r.toLowerCase()}`;case"DEL":case"DELETE":return`Deleted ${r.toLowerCase()}`;case"STATE_CHANGE":return`Changed workflow state to ${e.newState}`;case"QUERY_CREATED":return"Created new query";case"QUERY_RESOLVED":return"Resolved query";default:return`Modified ${r.toLowerCase()}`}},A=e=>{switch(e){case"ADD":case"CREATE":return(0,z.jsx)(I.A,{style:{color:"#52c41a"}});case"MOD":case"UPDATE":return(0,z.jsx)(D.A,{style:{color:"#1890ff"}});case"DEL":case"DELETE":return(0,z.jsx)(k.A,{style:{color:"#ff4d4f"}});case"STATE_CHANGE":return(0,z.jsx)(s.A,{style:{color:"#722ed1"}});case"QUERY_CREATED":case"QUERY_RESOLVED":return(0,z.jsx)(P.A,{style:{color:"#fa8c16"}});default:return(0,z.jsx)(k.A,{style:{color:"#d9d9d9"}})}},E=e=>{switch(e){case"ADD":case"CREATE":return"green";case"MOD":case"UPDATE":return"blue";case"DEL":case"DELETE":return"red";case"STATE_CHANGE":return"purple";case"QUERY_CREATED":case"QUERY_RESOLVED":return"orange";default:return"default"}},w=e=>{if(!e)return"Unknown time";return new Date(e).toLocaleString()};return l?(0,z.jsx)(j.A,{children:(0,z.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,z.jsx)(L.A,{size:"large","data-testid":"loading-spinner"})})}):a?(0,z.jsx)(j.A,{children:(0,z.jsx)(_.A,{message:"Error",description:a,type:"error",showIcon:!0,action:(0,z.jsx)(f.Ay,{size:"small",onClick:h,children:"Retry"})})}):(0,z.jsx)(j.A,{title:"Audit Timeline",extra:(0,z.jsx)(y.A,{children:(0,z.jsx)(f.Ay,{size:"small",onClick:h,children:"Refresh"})}),children:0===i.length?(0,z.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"No audit history available"}):(0,z.jsx)(O.A,{mode:"left",className:x?"audit-timeline-mobile":"",children:i.map(e=>{return(0,z.jsx)(O.A.Item,{dot:A(e.action),children:(0,z.jsxs)("div",{children:[(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:x?4:8,marginBottom:4,flexWrap:x?"wrap":"nowrap"},children:[(0,z.jsx)(p.A,{color:E(e.action),size:x?"small":"default",children:x&&e.action.length>6?e.action.substring(0,6):e.action}),(0,z.jsx)("span",{style:{fontWeight:"bold",fontSize:x?"13px":"14px"},children:e.description})]}),(0,z.jsxs)("div",{style:{fontSize:x?"11px":"12px",color:"#666",marginBottom:8,display:"flex",alignItems:"center",gap:4,flexWrap:x?"wrap":"nowrap"},children:[(0,z.jsx)(R.A,{}),(0,z.jsx)("span",{children:e.user}),(0,z.jsx)("span",{children:"\u2022"}),(0,z.jsx)("span",{children:x?w(e.timestamp).split(",")[0]:w(e.timestamp)})]}),e.changes&&e.changes.length>0&&(0,z.jsxs)("div",{children:[(0,z.jsxs)(f.Ay,{type:"link",size:"small",onClick:()=>(e=>{const t=new Set(c);t.has(e)?t.delete(e):t.add(e),u(t)})(e.id),style:{padding:0,height:"auto",fontSize:x?"12px":"14px"},children:[c.has(e.id)?"Hide":"Show"," Details"]}),c.has(e.id)&&(0,z.jsx)(N.A,{ghost:!0,children:(0,z.jsxs)(q,{header:"",showArrow:!1,children:[(t=e.changes,t&&0!==t.length?(0,z.jsxs)("div",{style:{marginTop:8},children:[(0,z.jsx)("strong",{children:"Changes:"}),(0,z.jsx)("ul",{style:{marginTop:4,marginBottom:0},children:t.map((e,t)=>(0,z.jsxs)("li",{children:[(0,z.jsxs)("strong",{children:[e.field,":"]})," ",e.oldValue," \u2192 ",e.newValue]},t))})]}):null),e.details&&(0,z.jsxs)("div",{style:{marginTop:8},children:[(0,z.jsx)("strong",{children:"Additional Details:"}),(0,z.jsx)("pre",{style:{fontSize:x?"10px":"11px",background:"#f5f5f5",padding:x?"6px":"8px",borderRadius:"4px",marginTop:"4px",overflow:"auto",maxHeight:x?"150px":"200px"},children:JSON.stringify(e.details,null,2)})]})]},"1")})]})]})},e.id);var t})})})};var G=r(5337),$=r(5444),V=r(9098),F=r(2868),U=r(3661);const{TabPane:H}=c.A,{TextArea:K}=$.A,{Option:J}=x.A,Y=e=>{let{workflowId:t,userRole:r}=e;const[s,l]=(0,C.useState)(!1),[n,i]=(0,C.useState)({all:[],open:[],resolved:[],myQueries:[]}),[o,a]=(0,C.useState)(!1),[d,u]=(0,C.useState)(!1),[h,g]=(0,C.useState)(null),[A]=V.A.useForm(),[E]=V.A.useForm(),{isMobile:S}=(()=>{const[e,t]=(0,C.useState)({isMobile:window.innerWidth<=F.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>F.EW.MOBILE_BREAKPOINT&&window.innerWidth<=F.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>F.EW.TABLET_BREAKPOINT});return(0,C.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=F.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>F.EW.MOBILE_BREAKPOINT&&window.innerWidth<=F.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>F.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})();(0,C.useEffect)(()=>{if(t){const e=new AbortController;return(async()=>{try{l(!0);const r=await U.B.getQueriesByWorkflow(t,{signal:e.signal});e.signal.aborted||i({all:r,open:r.filter(e=>F.pZ.ACTIVE.includes(e.status)),resolved:r.filter(e=>F.pZ.INACTIVE.includes(e.status)),myQueries:r.filter(e=>e.createdBy===v())})}catch(r){e.signal.aborted||console.error("Failed to load queries:",r)}finally{e.signal.aborted||l(!1)}})(),()=>{e.abort()}}},[t]);const T=(0,C.useCallback)(async e=>{try{l(!0);const r=await U.B.getQueriesByWorkflow(t,{signal:e});null!==e&&void 0!==e&&e.aborted||i({all:r,open:r.filter(e=>F.pZ.ACTIVE.includes(e.status)),resolved:r.filter(e=>F.pZ.INACTIVE.includes(e.status)),myQueries:r.filter(e=>e.createdBy===v())})}catch(r){null!==e&&void 0!==e&&e.aborted||console.error("Failed to load queries:",r)}finally{null!==e&&void 0!==e&&e.aborted||l(!1)}},[t]),v=()=>localStorage.getItem("username")||"current_user",I=e=>({[F.cS.OPEN]:"red",[F.cS.RESOLVED]:"green",[F.cS.CLOSED]:"gray"}[e]||"default"),D=e=>({CQS:"blue",TECH:"purple",PLANT:"orange",JVC:"cyan"}[e]||"default"),k=()=>[{title:"ID",dataIndex:"id",key:"id",width:S?50:60,fixed:!!S&&"left"},{title:"Question",dataIndex:"question",key:"question",ellipsis:!0,render:e=>(0,z.jsx)("span",{title:e,children:S&&e.length>30?`${e.substring(0,30)}...`:e})},{title:"Team",dataIndex:"assignedTeam",key:"assignedTeam",width:S?60:80,render:e=>(0,z.jsx)(p.A,{color:D(e),size:S?"small":"default",children:e})},{title:"Status",dataIndex:"status",key:"status",width:S?60:80,render:e=>{const t={[F.cS.OPEN]:"Open",[F.cS.RESOLVED]:"Resolved",[F.cS.CLOSED]:"Closed"};return(0,z.jsx)(p.A,{color:I(e),size:S?"small":"default",children:t[e]||e})}},{title:"Context",dataIndex:"fieldContext",key:"fieldContext",width:120,ellipsis:!0,responsive:["md"]},{title:"Created",dataIndex:"createdAt",key:"createdAt",width:S?80:100,responsive:["sm"],render:e=>{if(!e)return"-";const t=new Date(e);return S?t.toLocaleDateString("en-US",{month:"short",day:"numeric"}):t.toLocaleDateString()}},{title:"Actions",key:"actions",width:S?70:120,fixed:!!S&&"right",render:(e,t)=>(0,z.jsxs)(y.A,{children:[t.status===F.cS.OPEN&&P(t)&&(0,z.jsx)(f.Ay,{size:"small",type:"primary",onClick:()=>{g(t),u(!0)},children:"Resolve"}),F.pZ.INACTIVE.includes(t.status)&&(0,z.jsx)(f.Ay,{size:"small",type:"link",onClick:()=>{g(t),u(!0)},children:"View"})]})}],P=e=>e.assignedTeam===r||"ADMIN"===r,R=e=>e.length>0?e.length:null;return(0,z.jsxs)(j.A,{title:"Queries",extra:[F.r0.PLANT,F.r0.JVC].includes(r)&&(0,z.jsx)(f.Ay,{type:"primary",icon:(0,z.jsx)(G.A,{}),onClick:()=>a(!0),children:"Raise Query"}),children:[(0,z.jsxs)(c.A,{defaultActiveKey:"all",className:S?"query-widget-mobile":"",size:S?"small":"default",children:[(0,z.jsx)(H,{tab:(0,z.jsx)(m.A,{count:R(n.all),size:"small",children:(0,z.jsx)("span",{children:"All Queries"})}),children:(0,z.jsx)(w.A,{dataSource:n.all,columns:k(),loading:s,pagination:{pageSize:S?5:10},size:"small",rowKey:"id",scroll:S?{x:500}:void 0,className:S?"touch-friendly-table":""})},"all"),(0,z.jsx)(H,{tab:(0,z.jsx)(m.A,{count:R(n.open),size:"small",children:(0,z.jsx)("span",{style:{color:"#ff4d4f"},children:"Open"})}),children:(0,z.jsx)(w.A,{dataSource:n.open,columns:k(),loading:s,pagination:{pageSize:S?5:10},size:"small",rowKey:"id",scroll:S?{x:500}:void 0,className:S?"touch-friendly-table":""})},"open"),(0,z.jsx)(H,{tab:(0,z.jsx)(m.A,{count:R(n.resolved),size:"small",children:(0,z.jsx)("span",{style:{color:"#52c41a"},children:"Resolved"})}),children:(0,z.jsx)(w.A,{dataSource:n.resolved,columns:k(),loading:s,pagination:{pageSize:S?5:10},size:"small",rowKey:"id",scroll:S?{x:500}:void 0,className:S?"touch-friendly-table":""})},"resolved"),(0,z.jsx)(H,{tab:(0,z.jsx)(m.A,{count:R(n.myQueries),size:"small",children:(0,z.jsx)("span",{children:"My Queries"})}),children:(0,z.jsx)(w.A,{dataSource:n.myQueries,columns:k(),loading:s,pagination:{pageSize:S?5:10},size:"small",rowKey:"id",scroll:S?{x:500}:void 0,className:S?"touch-friendly-table":""})},"my")]}),(0,z.jsx)(b.A,{title:"Raise New Query",open:o,onCancel:()=>{a(!1),A.resetFields()},onOk:()=>A.submit(),width:600,children:(0,z.jsxs)(V.A,{form:A,layout:"vertical",onFinish:async e=>{try{await U.B.createQuery({workflowId:t,...e,createdBy:v()}),a(!1),A.resetFields(),T()}catch(r){console.error("Failed to create query:",r)}},children:[(0,z.jsx)(V.A.Item,{name:"assignedTeam",label:"Assign to Team",rules:[{required:!0,message:"Please select a team"}],children:(0,z.jsxs)(x.A,{placeholder:"Select team",children:[(0,z.jsx)(J,{value:"CQS",children:"CQS Team"}),(0,z.jsx)(J,{value:"TECH",children:"Tech Team"}),(0,z.jsx)(J,{value:"JVC",children:"JVC Team"})]})}),(0,z.jsx)(V.A.Item,{name:"fieldContext",label:"Field Context",help:"Which field or section is this query about?",children:(0,z.jsx)($.A,{placeholder:"e.g., Material Name, Safety Data, etc."})}),(0,z.jsx)(V.A.Item,{name:"question",label:"Question",rules:[{required:!0,message:"Please enter your question"}],children:(0,z.jsx)(K,{rows:4,placeholder:"Describe your question or issue in detail..."})}),(0,z.jsx)(V.A.Item,{name:"priority",label:"Priority",initialValue:"MEDIUM",children:(0,z.jsxs)(x.A,{children:[(0,z.jsx)(J,{value:"LOW",children:"Low"}),(0,z.jsx)(J,{value:"MEDIUM",children:"Medium"}),(0,z.jsx)(J,{value:"HIGH",children:"High"}),(0,z.jsx)(J,{value:"URGENT",children:"Urgent"})]})})]})}),(0,z.jsx)(b.A,{title:`Resolve Query #${null===h||void 0===h?void 0:h.id}`,open:d,onCancel:()=>{u(!1),E.resetFields(),g(null)},onOk:()=>E.submit(),width:600,children:h&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)("div",{style:{marginBottom:16,padding:12,background:"#f5f5f5",borderRadius:4},children:[(0,z.jsx)("strong",{children:"Question:"})," ",h.question,h.fieldContext&&(0,z.jsxs)("div",{children:[(0,z.jsx)("strong",{children:"Field Context:"})," ",h.fieldContext]})]}),(0,z.jsx)(V.A,{form:E,layout:"vertical",onFinish:async e=>{try{await U.B.resolveQuery(h.id,{resolution:e.resolution,resolvedBy:v()}),u(!1),E.resetFields(),g(null),T()}catch(t){console.error("Failed to resolve query:",t)}},children:(0,z.jsx)(V.A.Item,{name:"resolution",label:"Resolution",rules:[{required:!0,message:"Please provide a resolution"}],children:(0,z.jsx)(K,{rows:6,placeholder:"Provide detailed resolution or answer to the query..."})})})]})})]})};var Z=r(3719),X=r(6174);const{TabPane:ee}=c.A,{Title:te,Text:re}=u.A,{Option:se}=x.A,{RangePicker:le}=h.A,ne=()=>{(0,T.Zp)();const[e,t]=(0,C.useState)("dashboard"),[r,u]=(0,C.useState)(null),[h,I]=(0,C.useState)(null),[D,k]=(0,C.useState)(!1),[P,R]=(0,C.useState)(!1),[N,L]=(0,C.useState)(null),[_,O]=(0,C.useState)([]),[B,Q]=(0,C.useState)([]),[W,q]=(0,C.useState)(!1),[G,$]=(0,C.useState)("current_month"),[V,U]=(0,C.useState)(null),H=(0,Z.HW)(),K=(0,Z.uG)();console.log("WorkflowPage - currentUser:",H),console.log("WorkflowPage - userRole:",K);const J=(0,C.useCallback)((e,t,r)=>{const s=Array.isArray(e)?e:[],l=new Date;let n;switch(t){case"current_month":n=new Date(l.getFullYear(),l.getMonth(),1);break;case"past_3_months":n=new Date(l.getFullYear(),l.getMonth()-3,1);break;case"past_6_months":n=new Date(l.getFullYear(),l.getMonth()-6,1);break;case"past_12_months":n=new Date(l.getFullYear(),l.getMonth()-12,1);break;case"custom":if(r&&2===r.length){n=r[0].toDate();const e=r[1].toDate(),t=s.filter(t=>{const r=new Date(t.createdAt);return r>=n&&r<=e});return void Q(t)}break;default:return void Q(s)}if(n){const e=s.filter(e=>new Date(e.createdAt)>=n);Q(e)}else Q(s)},[]),ne=(0,C.useCallback)(async e=>{q(!0);try{const t=await v.default.get("/workflows",{signal:e});if(null===e||void 0===e||!e.aborted){const e=Array.isArray(t)?t:[];O(e),J(e,G,V)}}catch(t){null!==e&&void 0!==e&&e.aborted||(console.error("Error fetching workflows:",t),g.Ay.error("Failed to fetch workflows"),O([]),Q([]))}finally{null!==e&&void 0!==e&&e.aborted||q(!1)}},[G,V,J]),ie=e=>{$(e),"custom"!==e&&U(null),J(_,e,V)},oe=e=>{U(e),e&&2===e.length&&J(_,"custom",e)};(0,C.useEffect)(()=>{const e=new AbortController;return ne(e.signal),()=>{e.abort()}},[ne]),(0,C.useEffect)(()=>{_.length>0&&J(_,G,V)},[G,V,_,J]);const ae=e=>{L(e),R(!0)},de=async e=>{try{const t=await v.default.get(`/workflows/${e}/excel-report`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t])),s=document.createElement("a");s.href=r,s.download=`QRMFG_Report_Workflow_${e}.xlsx`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s),g.Ay.success("Excel report downloaded successfully")}catch(t){g.Ay.error("Failed to download Excel report")}},ce=()=>{k(!1),I(null)},ue=[{title:"ID",dataIndex:"id",key:"id",width:80,render:e=>(0,z.jsxs)(re,{style:{fontFamily:"monospace",fontSize:"13px",fontWeight:600,color:"#495057",padding:"4px 8px",background:"#f8f9fa",borderRadius:"4px",border:"1px solid #e9ecef"},children:["#",e]})},{title:"Project",dataIndex:"projectCode",key:"projectCode",width:80,render:e=>(0,z.jsx)(re,{strong:!0,children:e})},{title:"Material",dataIndex:"materialCode",key:"materialCode",width:90,render:e=>(0,z.jsx)(re,{code:!0,children:e})},{title:"Description",dataIndex:"materialName",key:"materialName",width:100,ellipsis:!0,render:e=>e||"No description"},{title:"Plant",dataIndex:"assignedPlant",key:"assignedPlant",width:70,render:e=>(0,z.jsx)(p.A,{color:"green",children:e})},{title:"Status",dataIndex:"state",key:"state",width:100,render:e=>{const t={JVC_PENDING:{color:"orange",text:"JVC"},PLANT_PENDING:{color:"blue",text:"Plant"},CQS_PENDING:{color:"purple",text:"CQS"},TECH_PENDING:{color:"cyan",text:"Tech"},[F.Fv.COMPLETED]:{color:"green",text:"Done"}}[e]||{color:"default",text:e};return(0,z.jsx)(p.A,{color:t.color,children:t.text})}},{title:"Start Date",dataIndex:"createdAt",key:"createdAt",width:90,render:e=>e?new Date(e).toLocaleDateString("en-GB"):"N/A"},{title:"Actions",key:"actions",width:180,render:(e,t)=>(0,z.jsxs)(y.A,{size:"small",children:[(0,z.jsx)(f.Ay,{size:"small",icon:(0,z.jsx)(s.A,{}),onClick:()=>ae(t.id),title:"Open Questionnaire",children:"Quest."}),(0,z.jsx)(f.Ay,{size:"small",type:"default",style:{backgroundColor:"#52c41a",borderColor:"#52c41a",color:"white"},onClick:()=>de(t.id),title:"Download Excel Report",children:"Excel"})]})}];return(0,z.jsxs)("div",{style:{padding:"0",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",minHeight:"100vh"},children:[(0,z.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",padding:"32px 40px",marginBottom:"0",color:"#333",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"},children:(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsxs)("div",{children:[(0,z.jsx)(te,{level:2,style:{color:"#1a1a1a",margin:0,fontWeight:700,fontSize:"28px"},children:"MSDS Workflow Management"}),(0,z.jsx)(re,{style:{color:"#666",fontSize:"16px",marginTop:"4px"},children:"Comprehensive workflow tracking and management system"})]}),(0,z.jsxs)("div",{style:{textAlign:"right",padding:"16px 24px",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)",borderRadius:"12px",border:"1px solid rgba(102, 126, 234, 0.2)",backdropFilter:"blur(5px)"},children:[(0,z.jsx)(re,{style:{color:"#666",fontSize:"13px",display:"block"},children:"Welcome back"}),(0,z.jsxs)(re,{style:{color:"#1a1a1a",fontSize:"15px",fontWeight:600},children:[H," (",K,")"]})]})]})}),(0,z.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",marginBottom:"32px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.05)"},children:(0,z.jsxs)(c.A,{activeKey:e,onChange:e=>{t(e)},size:"large",style:{margin:0},tabBarStyle:{margin:0,padding:"0 32px",background:"transparent",borderBottom:"none"},children:[(0,z.jsx)(ee,{tab:(0,z.jsxs)("span",{children:[(0,z.jsx)(i.A,{}),"Dashboard",B.length>0&&(0,z.jsx)(m.A,{count:B.length,style:{backgroundColor:"#1890ff",marginLeft:8}})]}),children:(()=>{const e={total:(t=B).length,completed:t.filter(e=>e.state===F.Fv.COMPLETED).length,jvcPending:t.filter(e=>"JVC_PENDING"===e.state).length,plantPending:t.filter(e=>"PLANT_PENDING"===e.state).length,cqsPending:t.filter(e=>"CQS_PENDING"===e.state).length,techPending:t.filter(e=>"TECH_PENDING"===e.state).length,overdue:t.filter(e=>(e.daysPending||0)>7).length};var t;return(0,z.jsxs)("div",{children:[(0,z.jsxs)("div",{style:{marginBottom:16},children:[(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,z.jsxs)(te,{level:3,style:{margin:0},children:["Workflow Analytics",(0,z.jsx)(m.A,{count:B.length,style:{backgroundColor:"#1890ff",marginLeft:12}})]}),(0,z.jsx)(f.Ay,{icon:(0,z.jsx)(l.A,{}),onClick:()=>{const e=new AbortController;ne(e.signal)},loading:W,children:"Refresh"})]}),(0,z.jsx)("div",{style:{padding:"20px 32px",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)"},children:(0,z.jsxs)(y.A,{align:"center",children:[(0,z.jsx)(n.A,{style:{color:"#495057"}}),(0,z.jsx)(re,{strong:!0,style:{color:"#495057",fontSize:"14px"},children:"Filter by:"}),(0,z.jsxs)(x.A,{value:G,onChange:ie,size:"middle",style:{width:160},children:[(0,z.jsx)(se,{value:"current_month",children:"Current Month"}),(0,z.jsx)(se,{value:"past_3_months",children:"Past 3 Months"}),(0,z.jsx)(se,{value:"past_6_months",children:"Past 6 Months"}),(0,z.jsx)(se,{value:"past_12_months",children:"Past 12 Months"}),(0,z.jsx)(se,{value:"custom",children:"Custom Range"})]}),"custom"===G&&(0,z.jsx)(le,{value:V,onChange:oe,size:"middle",style:{width:260}})]})})]}),(0,z.jsx)("div",{style:{padding:"0 40px",marginBottom:"40px"},children:(0,z.jsxs)(A.A,{gutter:[20,16],children:[(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #e8e9ea",boxShadow:"none",background:"#ffffff"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#1a1a1a"},children:e.total}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#666",fontWeight:500},children:"Total Projects"})]})})}),(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #d4edda",boxShadow:"none",background:"#f8fff9"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#28a745"},children:e.completed}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#155724",fontWeight:500},children:"Completed"})]})})}),(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #f5c6cb",boxShadow:"none",background:"#fdf2f2"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#dc3545"},children:e.jvcPending}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#721c24",fontWeight:500},children:"JVC Pending"})]})})}),(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #bee5eb",boxShadow:"none",background:"#f1f9fa"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#17a2b8"},children:e.plantPending}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#0c5460",fontWeight:500},children:"Plant Pending"})]})})}),(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #d1ecf1",boxShadow:"none",background:"#f8f9fa"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#6c757d"},children:e.cqsPending}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#495057",fontWeight:500},children:"CQS Pending"})]})})}),(0,z.jsx)(E.A,{xs:24,sm:12,md:8,lg:6,xl:4,children:(0,z.jsx)(j.A,{style:{borderRadius:"8px",border:"1px solid #ffeaa7",boxShadow:"none",background:"#fffbf0"},bodyStyle:{padding:"24px 20px"},children:(0,z.jsxs)("div",{style:{textAlign:"center"},children:[(0,z.jsx)("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#fd7e14"},children:e.overdue}),(0,z.jsx)("div",{style:{fontSize:"14px",color:"#8a4a00",fontWeight:500},children:"Overdue"})]})})})]})}),(0,z.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"16px",margin:"0 40px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"},children:[(0,z.jsxs)("div",{style:{padding:"24px 32px",background:"linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.3)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,z.jsx)(s.A,{style:{color:"#495057",fontSize:"18px"}}),(0,z.jsx)("span",{style:{fontSize:"18px",fontWeight:600,color:"#1a1a1a"},children:"Workflow Analytics"}),(0,z.jsx)(m.A,{count:B.length,style:{backgroundColor:"#495057"},showZero:!0})]}),(0,z.jsx)(f.Ay,{icon:(0,z.jsx)(l.A,{}),onClick:()=>{const e=new AbortController;ne(e.signal)},loading:W,type:"default",children:"Refresh"})]}),(0,z.jsx)(w.A,{columns:ue,dataSource:B,rowKey:"id",loading:W,pagination:{pageSize:F.Bq.LARGE_PAGE_SIZE,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} workflows`,style:{padding:"16px 24px",borderTop:"1px solid #e8e9ea"}},size:"middle",onRow:e=>({onClick:()=>{u(e.id),I(e),k(!0)},style:{cursor:"pointer",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f8f9fa"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"}})})]})]})})()},"dashboard"),(0,z.jsx)(ee,{tab:(0,z.jsxs)("span",{children:[(0,z.jsx)(o.A,{}),"Queries",r&&(0,z.jsx)(m.A,{count:r,style:{backgroundColor:"#52c41a",marginLeft:8}})]}),children:(0,z.jsx)(A.A,{gutter:[16,16],children:(0,z.jsx)(E.A,{span:24,children:(0,z.jsx)(Y,{workflowId:r,userRole:K})})})},"queries"),(0,z.jsx)(ee,{tab:(0,z.jsxs)("span",{children:[(0,z.jsx)(a.A,{}),"Audit Trail"]}),children:(0,z.jsx)(A.A,{gutter:[16,16],children:(0,z.jsx)(E.A,{span:24,children:r?(0,z.jsx)(M,{workflowId:r,entityType:"complete"}):(0,z.jsx)(j.A,{children:(0,z.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#999"},children:[(0,z.jsx)(a.A,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,z.jsx)("h3",{children:"Select a Workflow"}),(0,z.jsx)("p",{children:"Choose a workflow from the dashboard to view its audit trail"})]})})})})},"audit")]})}),(0,z.jsx)(b.A,{title:(0,z.jsxs)(y.A,{children:[(0,z.jsx)(d.A,{}),"Workflow Details",h&&(0,z.jsx)(m.A,{count:h.id,style:{backgroundColor:"#1890ff"}})]}),open:D,onCancel:ce,footer:[(0,z.jsx)(f.Ay,{onClick:ce,children:"Close"},"close"),h&&(0,z.jsx)(f.Ay,{type:"primary",icon:(0,z.jsx)(s.A,{}),onClick:()=>{ae(h.id),ce()},children:"Open Questionnaire"},"questionnaire"),h&&(0,z.jsx)(f.Ay,{type:"default",style:{backgroundColor:"#52c41a",borderColor:"#52c41a",color:"white"},onClick:()=>{de(h.id),ce()},children:"Download Excel Report"},"excel-report")],width:800,children:h&&(0,z.jsxs)(S.A,{column:2,bordered:!0,size:"small",children:[(0,z.jsx)(S.A.Item,{label:"Workflow ID",children:h.id}),(0,z.jsx)(S.A.Item,{label:"Status",children:(0,z.jsx)(p.A,{color:"blue",children:h.state})}),(0,z.jsx)(S.A.Item,{label:"Material Code",children:h.materialCode}),(0,z.jsx)(S.A.Item,{label:"Material Name",children:h.materialName||"Not available"}),(0,z.jsx)(S.A.Item,{label:"Project Code",children:h.projectCode}),(0,z.jsx)(S.A.Item,{label:"Assigned Plant",children:(0,z.jsx)(p.A,{color:"green",children:h.assignedPlant})}),(0,z.jsx)(S.A.Item,{label:"Days Pending",children:(0,z.jsxs)(p.A,{color:(h.daysPending||0)>7?"red":"green",children:[h.daysPending||0," days"]})}),(0,z.jsx)(S.A.Item,{label:"Initiated By",children:h.initiatedBy}),(0,z.jsx)(S.A.Item,{label:"Created At",children:h.createdAt?new Date(h.createdAt).toLocaleString():"N/A"})]})}),(0,z.jsx)(b.A,{title:"QRMFG Questionnaire Viewer",open:P,onCancel:()=>R(!1),footer:null,width:"90%",style:{top:20},bodyStyle:{padding:0,height:"calc(100vh - 200px)",overflow:"hidden"},children:N&&(0,z.jsx)("div",{style:{height:"100%",overflow:"auto"},children:(0,z.jsx)(X.default,{workflowId:N,onClose:()=>R(!1)})})})]})}}}]);
//# sourceMappingURL=454.d5fa55ae.chunk.js.map