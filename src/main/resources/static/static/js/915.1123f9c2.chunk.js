"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[915],{4296:(e,t,a)=>{a.r(t),a.d(t,{default:()=>He});var l=a(3927),s=a(6553),o=a(6569),n=a(5206),i=a(6051),r=a(2751),d=a(5043),c=a(3795),u=a(579);const p=e=>{let{children:t,plantCode:a}=e;return(0,u.jsx)(c.SD,{routeName:"Plant Dashboard",errorContext:{plantCode:a,feature:"plant-workflow-management",level:"plant"},children:t})};var m=a(8463),h=a(8143),g=a(3310),f=a(2058),y=a(5444),x=a(9073),v=a(6399),A=a(7419),b=a(1645),C=a(8354);const{Search:j}=y.A,{Option:w}=s.A,P=d.memo(e=>{let{searchText:t,statusFilter:a,completionFilter:l,onSearchTextChange:o,onStatusFilterChange:r,onCompletionFilterChange:c,onClearFilters:p,onApplyPreset:y,onSaveFilters:P,filterPresets:S,filterSummary:k}=e;const q=(0,d.useCallback)(e=>{o&&o(e)},[o]),I=(0,d.useCallback)(e=>{r&&r(e)},[r]),N=(0,d.useCallback)(e=>{c&&c(e)},[c]),_=(0,d.useCallback)(()=>{p&&p()},[p]),E=(0,d.useCallback)(e=>{y&&y(e)},[y]),T=(0,d.useCallback)(()=>{P&&P()},[P]);return(0,u.jsxs)(x.A,{title:(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)(m.A,{}),(0,u.jsx)("span",{children:"Filters"}),(null===k||void 0===k?void 0:k.hasActiveFilters)&&(0,u.jsxs)(v.A,{color:"blue",style:{marginLeft:8},children:[k.activeFilters.length," active"]})]}),size:"small",style:{marginBottom:16},extra:(0,u.jsxs)(i.A,{children:[P&&(0,u.jsx)(n.Ay,{size:"small",icon:(0,u.jsx)(h.A,{}),onClick:T,disabled:!(null!==k&&void 0!==k&&k.hasActiveFilters),children:"Save"}),(0,u.jsx)(n.Ay,{size:"small",icon:(0,u.jsx)(g.A,{}),onClick:_,disabled:!(null!==k&&void 0!==k&&k.hasActiveFilters),children:"Clear All"})]}),children:[(0,u.jsxs)(A.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,u.jsxs)(b.A,{xs:24,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Search Materials"}),(0,u.jsx)(j,{placeholder:"Search by Material Code or Plant",value:t,onChange:e=>q(e.target.value),style:{width:"100%"},allowClear:!0,enterButton:(0,u.jsx)(f.A,{})})]}),(0,u.jsxs)(b.A,{xs:12,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Status Filter"}),(0,u.jsxs)(s.A,{placeholder:"Filter by Status",value:a,onChange:I,style:{width:"100%"},allowClear:!0,children:[(0,u.jsx)(w,{value:"all",children:"All Statuses"}),(0,u.jsx)(w,{value:"DRAFT",children:"Draft"}),(0,u.jsx)(w,{value:"IN_PROGRESS",children:"In Progress"}),(0,u.jsx)(w,{value:"COMPLETED",children:"Completed"}),(0,u.jsx)(w,{value:"SUBMITTED",children:"Submitted"})]})]}),(0,u.jsxs)(b.A,{xs:12,sm:8,md:8,lg:8,children:[(0,u.jsx)("div",{style:{marginBottom:4,fontSize:"12px",fontWeight:"500",color:"#666"},children:"Completion Filter"}),(0,u.jsxs)(s.A,{placeholder:"Filter by Completion",value:l,onChange:N,style:{width:"100%"},allowClear:!0,children:[(0,u.jsx)(w,{value:"all",children:"All Progress"}),(0,u.jsx)(w,{value:"not-started",children:"Not Started (0%)"}),(0,u.jsx)(w,{value:"in-progress",children:"In Progress (1-99%)"}),(0,u.jsx)(w,{value:"completed",children:"Completed (100%)"})]})]})]}),S&&S.length>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)("span",{style:{fontSize:"12px",fontWeight:"500",color:"#666"},children:"Quick Filters:"})}),(0,u.jsx)(i.A,{wrap:!0,children:S.map(e=>(0,u.jsx)(n.Ay,{size:"small",type:"default",onClick:()=>E(e.name),style:{fontSize:"12px"},children:e.name},e.name))})]}),(null===k||void 0===k?void 0:k.hasActiveFilters)&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)("span",{style:{fontSize:"12px",fontWeight:"500",color:"#666"},children:"Active Filters:"})}),(0,u.jsx)(i.A,{wrap:!0,children:k.activeFilters.map((e,t)=>(0,u.jsx)(v.A,{color:"blue",style:{fontSize:"11px"},children:e},t))}),(0,u.jsxs)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:["Showing ",k.totalFiltered," of ",k.totalOriginal," workflows"]})]}),!(null!==k&&void 0!==k&&k.hasActiveFilters)&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.A,{style:{margin:"12px 0"}}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#999",textAlign:"center"},children:"No filters applied - showing all workflows"})]})]})});P.displayName="FilterPanel",P.defaultProps={searchText:"",statusFilter:"all",completionFilter:"all",onSearchTextChange:null,onStatusFilterChange:null,onCompletionFilterChange:null,onClearFilters:null,onApplyPreset:null,onSaveFilters:null,filterPresets:[],filterSummary:null};const S=P;var k=a(119),q=a(9470),I=a(6237),N=a(1199),_=a(2261),E=a(6612),T=a(7692);const F=d.memo(e=>{let{dashboardStats:t,loading:a,error:l,currentPlant:s,onRefresh:o}=e;const n=(0,d.useMemo)(()=>e=>e>=80?"#52c41a":e>=60?"#1890ff":e>=40?"#faad14":e>=20?"#fa8c16":"#ff4d4f",[]),i=(0,d.useMemo)(()=>{const{totalWorkflows:e,completedCount:a,inProgressCount:l,draftCount:s}=t;return 0===e?{completionRate:0,inProgressRate:0,draftRate:0}:{completionRate:Math.round(a/e*100),inProgressRate:Math.round(l/e*100),draftRate:Math.round(s/e*100)}},[t]),r=(0,d.useMemo)(()=>e=>({total:"#1890ff",inProgress:"#fa8c16",completed:"#52c41a",average:"#52c41a"}[e]||"#1890ff"),[]);return l?(0,u.jsx)(_.A,{message:"Dashboard Error",description:`Failed to load dashboard data: ${l}`,type:"error",showIcon:!0,style:{marginBottom:24},action:o&&(0,u.jsx)("button",{onClick:o,style:{border:"none",background:"none",color:"#1890ff",cursor:"pointer"},children:"Retry"})}):(0,u.jsxs)("div",{style:{marginBottom:24},children:[(0,u.jsxs)(A.A,{gutter:[16,16],style:{marginBottom:16},children:[(0,u.jsx)(b.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(x.A,{loading:a,children:(0,u.jsx)(E.A,{title:"Total Materials",value:t.totalWorkflows||0,prefix:(0,u.jsx)(k.A,{}),valueStyle:{color:r("total")}})})}),(0,u.jsx)(b.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(x.A,{loading:a,children:(0,u.jsx)(E.A,{title:"In Progress",value:t.inProgressCount||0,prefix:(0,u.jsx)(q.A,{}),valueStyle:{color:r("inProgress")}})})}),(0,u.jsx)(b.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(x.A,{loading:a,children:(0,u.jsx)(E.A,{title:"Completed",value:t.completedCount||0,prefix:(0,u.jsx)(I.A,{}),valueStyle:{color:r("completed")}})})}),(0,u.jsx)(b.A,{xs:12,sm:6,md:6,lg:6,children:(0,u.jsx)(x.A,{loading:a,children:(0,u.jsx)(E.A,{title:"Average Progress",value:t.averageCompletion||0,suffix:"%",prefix:(0,u.jsx)(N.A,{}),valueStyle:{color:r("average")}})})})]}),(0,u.jsxs)(A.A,{gutter:[16,16],children:[(0,u.jsx)(b.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(x.A,{title:"Completion Rate",loading:a,size:"small",children:[(0,u.jsx)(T.A,{type:"circle",percent:i.completionRate,strokeColor:n(i.completionRate),format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.completedCount," of ",t.totalWorkflows," completed"]})]})}),(0,u.jsx)(b.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(x.A,{title:"In Progress Rate",loading:a,size:"small",children:[(0,u.jsx)(T.A,{type:"circle",percent:i.inProgressRate,strokeColor:"#fa8c16",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.inProgressCount," workflows active"]})]})}),(0,u.jsx)(b.A,{xs:24,sm:12,md:8,lg:8,children:(0,u.jsxs)(x.A,{title:"Draft Rate",loading:a,size:"small",children:[(0,u.jsx)(T.A,{type:"circle",percent:i.draftRate,strokeColor:"#ff4d4f",format:e=>`${e}%`,size:80}),(0,u.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:"12px",color:"#666"},children:[t.draftCount," not started"]})]})})]}),s&&(0,u.jsx)(_.A,{message:`Plant Dashboard - ${s}`,description:"Overview of all assigned materials and their completion status for the selected plant.",type:"info",showIcon:!0,style:{marginTop:16}})]})});F.displayName="PlantDashboard",F.defaultProps={loading:!1,error:null,currentPlant:null,onRefresh:null};const D=F;var R=a(8174),M=a(6191),O=a(3217),z=a(2868);const L=d.memo(e=>{let{workflows:t,loading:a,onStartQuestionnaire:l,onViewWorkflow:s,onRefresh:o}=e;const r=(0,d.useCallback)(e=>({DRAFT:"default",IN_PROGRESS:"processing",COMPLETED:"success",SUBMITTED:"success"}[e]||"default"),[]),c=(0,d.useCallback)(e=>100===e?"#52c41a":e>=75?"#1890ff":e>=50?"#faad14":e>=25?"#fa8c16":"#ff4d4f",[]),p=(0,d.useCallback)(e=>{if(!e)return 0;const t=new Date,a=new Date(e),l=Math.abs(t-a);return Math.ceil(l/864e5)},[]),m=(0,d.useCallback)(e=>{l&&l(e)},[l]),h=(0,d.useCallback)(e=>{s?s(e):console.log("View workflow:",e.id)},[s]),g=(0,d.useMemo)(()=>[{title:"Material Code",dataIndex:"materialCode",key:"materialCode",width:140,sorter:(e,t)=>e.materialCode.localeCompare(t.materialCode),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:a,confirm:l,clearFilters:s}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(y.A,{placeholder:"Search Material Code",value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>l(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>l(),icon:(0,u.jsx)(f.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(n.Ay,{onClick:()=>s(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(f.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>t.materialCode.toLowerCase().includes(e.toLowerCase()),render:(e,t)=>(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold"},children:e}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:t.materialName||t.itemDescription||"Material Name"})]})},{title:"Plant Code",dataIndex:"plantCode",key:"plantCode",width:120,sorter:(e,t)=>(e.plantCode||"").localeCompare(t.plantCode||""),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:a,confirm:l,clearFilters:s}=e;return(0,u.jsxs)("div",{style:{padding:8},children:[(0,u.jsx)(y.A,{placeholder:"Search Plant Code",value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>l(),style:{width:188,marginBottom:8,display:"block"}}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>l(),icon:(0,u.jsx)(f.A,{}),size:"small",style:{width:90},children:"Search"}),(0,u.jsx)(n.Ay,{onClick:()=>s(),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,u.jsx)(f.A,{style:{color:e?"#1890ff":void 0}}),onFilter:(e,t)=>(t.plantCode||"").toLowerCase().includes(e.toLowerCase()),render:e=>(0,u.jsx)(v.A,{color:"blue",style:{fontWeight:"bold"},children:e||"N/A"})},{title:"Status",dataIndex:"completionStatus",key:"completionStatus",width:120,filters:[{text:"Draft",value:"DRAFT"},{text:"In Progress",value:"IN_PROGRESS"},{text:"Completed",value:"COMPLETED"},{text:"Submitted",value:"SUBMITTED"}],onFilter:(e,t)=>t.completionStatus===e,render:e=>(0,u.jsx)(v.A,{color:r(e),children:e.replace("_"," ")})},{title:"Progress",key:"progress",width:150,sorter:(e,t)=>e.completionPercentage-t.completionPercentage,render:(e,t)=>{const a=t.completionPercentage||0;return(0,u.jsxs)("div",{children:[(0,u.jsx)(T.A,{percent:a,size:"small",strokeColor:c(a),format:()=>`${a}%`}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:2},children:[t.completedFields||0," / ",t.totalFields||0," fields"]})]})}},{title:"Days Pending",key:"daysPending",width:100,sorter:(e,t)=>p(e.lastModified)-p(t.lastModified),render:(e,t)=>{const a=p(t.lastModified);return(0,u.jsx)("span",{style:{color:a>3?"#ff4d4f":"inherit"},children:a})}},{title:"Open Queries",dataIndex:"openQueries",key:"openQueries",width:100,sorter:(e,t)=>(e.openQueries||0)-(t.openQueries||0),render:e=>e>0?(0,u.jsx)(v.A,{color:"red",children:e}):(0,u.jsx)(v.A,{color:"green",children:"0"})},{title:"Actions",key:"actions",width:150,render:(e,t)=>(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(R.A,{}),onClick:()=>m(t),disabled:t.isSubmitted,children:t.completionPercentage>0?"Continue":"Start"}),(0,u.jsx)(n.Ay,{size:"small",icon:(0,u.jsx)(M.A,{}),onClick:()=>h(t),children:"View"})]})}],[r,c,p,m,h]),x=(0,d.useCallback)(e=>p(e.lastModified)>3?"overdue-row":"",[p]),A=(0,d.useMemo)(()=>({pageSize:z.Bq.DEFAULT_PAGE_SIZE,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} materials`,pageSizeOptions:["10","20","50","100"]}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(O.A,{dataSource:t,columns:g,loading:a,rowKey:"id",pagination:A,rowClassName:x,scroll:{x:1200},size:"small",bordered:!0,title:()=>(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("span",{style:{fontWeight:"bold"},children:["Assigned Materials (",t.length,")"]}),o&&(0,u.jsx)(n.Ay,{onClick:o,loading:a,size:"small",children:"Refresh"})]})}),(0,u.jsx)("style",{children:"\n        .overdue-row {\n          background-color: #fff2f0;\n        }\n        .overdue-row:hover {\n          background-color: #ffebe6 !important;\n        }\n        .ant-table-tbody > tr.overdue-row > td {\n          border-bottom: 1px solid #ffccc7;\n        }\n      "})]})});L.displayName="WorkflowTable",L.defaultProps={loading:!1,onStartQuestionnaire:null,onViewWorkflow:null,onRefresh:null};const U=L;var $=a(6091),W=a(1334),B=a(1814),Q=a(9760),V=a(2115),G=a(3382),Y=a(4524),H=a(6886),J=a(3357),K=a(7302),X=a(1306),Z=a(2878),ee=a(6840),te=a(1919),ae=a(5920),le=a(8600),se=a(6502),oe=a(9098),ne=a(349),ie=a(6651),re=a(6603),de=a(2513),ce=a(1686),ue=a(5964),pe=a(7490),me=a(8677),he=a(6263),ge=a(2428),fe=a(3661),ye=a(9394),xe=a(4786),ve=a(8818),Ae=a(1210),be=a(5240),Ce=a(9330),je=a(7326),we=a(691);const{Panel:Pe}=je.A,{Text:Se}=l.A,ke=e=>{let{workflowData:t}=e;const[a,l]=(0,d.useState)(!1),[s,r]=(0,d.useState)([]),[c,p]=(0,d.useState)(["basic","workflow","jvc-data"]),m=(0,d.useCallback)(async()=>{try{if(l(!0),null!==t&&void 0!==t&&t.projectCode&&null!==t&&void 0!==t&&t.materialCode){const e=await ye.S.getReusableDocuments(t.projectCode,t.materialCode);r(e||[])}else{const e=await ye.S.getWorkflowDocuments(t.id);r(e||[])}}catch(e){console.error("Failed to load JVC documents:",e),r([])}finally{l(!1)}},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode]);(0,d.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&m()},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.projectCode,null===t||void 0===t?void 0:t.materialCode,m]);const h=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";if(!t)return(0,u.jsx)(x.A,{title:"Material Context",style:{height:"fit-content"},children:(0,u.jsx)(_.A,{message:"No Material Data",description:"Material context will appear here once a workflow is selected.",type:"info",showIcon:!0})});const g=(e=>{if(!e)return 0;const t=new Date,a=new Date(e),l=Math.abs(t-a);return Math.ceil(l/864e5)})(t.lastModified),f=g>3;return(0,u.jsxs)(x.A,{title:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(xe.A,{}),"Material Context",f&&(0,u.jsx)(pe.A,{status:"error",text:`${g} days`})]}),style:{height:"fit-content",position:"sticky",top:24},size:"small",children:[(0,u.jsxs)(je.A,{activeKey:c,onChange:p,ghost:!0,size:"small",children:[(0,u.jsx)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)($.A,{}),(0,u.jsx)("strong",{children:"Basic Information"})]}),children:(0,u.jsxs)(we.A,{column:1,size:"small",children:[(0,u.jsx)(we.A.Item,{label:"Material Code",children:(0,u.jsx)(Se,{strong:!0,children:t.materialCode})}),(0,u.jsx)(we.A.Item,{label:"Material Name",children:t.materialName||"Not specified"}),(0,u.jsx)(we.A.Item,{label:"Assigned Plant",children:(0,u.jsx)(v.A,{color:"blue",children:t.assignedPlant})}),(0,u.jsx)(we.A.Item,{label:"Initiated By",children:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ve.A,{}),t.initiatedBy]})}),(0,u.jsx)(we.A.Item,{label:"Created",children:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(Ae.A,{}),h(t.createdAt)]})})]})},"basic"),(0,u.jsx)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(ve.A,{}),(0,u.jsx)("strong",{children:"Workflow Status"}),f&&(0,u.jsx)(be.A,{style:{color:"#ff4d4f"}})]}),children:(0,u.jsxs)(i.A,{direction:"vertical",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,children:"Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(v.A,{color:(y=t.state,{JVC_PENDING:"blue",PLANT_PENDING:"orange",CQS_PENDING:"purple",TECH_PENDING:"cyan",COMPLETED:"green"}[y]||"default"),children:(e=>({JVC_PENDING:"JVC Pending",PLANT_PENDING:"Plant Pending",CQS_PENDING:"CQS Pending",TECH_PENDING:"Tech Pending",COMPLETED:"Completed"}[e]||e))(t.state)})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,children:"Time in Current State:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(Se,{style:{color:f?"#ff4d4f":"inherit"},children:[g," day",1!==g?"s":"",f&&" (Overdue)"]})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,children:"Last Modified:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(Se,{type:"secondary",children:h(t.lastModified)})})]}),t.totalQueries>0&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,children:"Queries:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsxs)(i.A,{children:[(0,u.jsxs)(v.A,{color:"red",children:[t.openQueries||0," Open"]}),(0,u.jsxs)(v.A,{color:"green",children:[(t.totalQueries||0)-(t.openQueries||0)," Resolved"]})]})})]}),void 0!==t.completionPercentage&&(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,children:"Completion Progress:"}),(0,u.jsx)("div",{style:{marginTop:4},children:(0,u.jsx)(T.A,{percent:t.completionPercentage,size:"small",status:100===t.completionPercentage?"success":"active"})})]})]})},"workflow"),(0,u.jsx)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)($.A,{}),(0,u.jsx)("strong",{children:"JVC Documents"}),(0,u.jsx)(pe.A,{count:s.length,size:"small"})]}),children:a?(0,u.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,u.jsx)(ce.A,{size:"small"})}):s.length>0?(0,u.jsx)(i.A,{direction:"vertical",style:{width:"100%"},children:s.map((e,t)=>{var a;return(0,u.jsxs)(x.A,{size:"small",style:{marginBottom:8},styles:{body:{padding:"8px 12px"}},children:[(0,u.jsx)("div",{style:{marginBottom:4},children:(0,u.jsx)(Se,{strong:!0,style:{fontSize:"12px"},children:e.originalFileName||e.fileName||`Document ${t+1}`})}),(0,u.jsx)("div",{style:{marginBottom:8},children:(0,u.jsx)(Se,{type:"secondary",style:{fontSize:"11px"},children:e.sourceDescription||`${e.documentSource||"Document"} \u2022 ${(null===(a=e.fileType)||void 0===a?void 0:a.toUpperCase())||"File"} \u2022 ${e.fileSize?`${(e.fileSize/1024/1024).toFixed(1)} MB`:"Unknown size"} \u2022 Uploaded by ${e.uploadedBy||"Unknown"}`})}),(0,u.jsx)("div",{style:{textAlign:"right"},children:(0,u.jsx)(ie.A,{title:"Download document",children:(0,u.jsx)(n.Ay,{type:"primary",size:"small",icon:(0,u.jsx)(Ce.A,{}),onClick:()=>(async(e,t)=>{try{console.log("Downloading document:",{documentId:e,filename:t});const a=await ye.S.downloadDocument(e);console.log("Download blob received:",a);const l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=t||`document_${e}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(l),o.Ay.success(`Downloaded ${t||"document"}`)}catch(a){console.error("Failed to download document:",a),o.Ay.error(`Failed to download document: ${a.message||"Unknown error"}`)}})(e.id,e.originalFileName||e.fileName),children:"Download"})})})]},e.id||t)})}):(0,u.jsx)(_.A,{message:"No Documents",description:"No documents have been provided by the JVC team for this material.",type:"info",showIcon:!0,size:"small"})},"documents"),(0,u.jsxs)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(xe.A,{}),(0,u.jsx)("strong",{children:"JVC Material Data"}),(0,u.jsx)(ie.A,{title:"Information provided by JVC team for questionnaire completion",children:(0,u.jsx)(xe.A,{style:{fontSize:"12px",color:"#1890ff"}})})]}),children:[(0,u.jsxs)(we.A,{column:1,size:"small",children:[(0,u.jsx)(we.A.Item,{label:"Material Category",children:(0,u.jsx)(v.A,{color:"blue",children:t.materialCategory||"Not specified"})}),(0,u.jsx)(we.A.Item,{label:"Supplier Information",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Supplier Name:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierName||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Supplier Code:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierCode||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Contact Info:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.supplierContact||"Not provided"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Purchase Information",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Purchase Order:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.purchaseOrder||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Quantity Ordered:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.quantityOrdered||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Expected Delivery:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedDelivery?h(t.expectedDelivery):"Not specified"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Usage & Application",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Expected Usage:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.expectedUsage||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Application Area:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.applicationArea||"Not specified"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Process Requirements:"}),(0,u.jsx)("div",{style:{fontSize:"12px"},children:t.processRequirements||"Standard processing"})]})]})}),(0,u.jsx)(we.A.Item,{label:"Regulatory Requirements",children:(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",fontSize:"12px"},children:t.regulatoryRequirements||"Standard compliance required"})}),(0,u.jsx)(we.A.Item,{label:"Special Instructions",children:t.specialInstructions?(0,u.jsx)("div",{style:{padding:"6px 8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px"},children:t.specialInstructions}):(0,u.jsx)(Se,{type:"secondary",style:{fontSize:"12px"},children:"None"})}),(0,u.jsx)(we.A.Item,{label:"Priority & Impact",children:(0,u.jsxs)(i.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Urgency Level:"}),(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsx)(v.A,{color:"HIGH"===t.urgencyLevel?"red":"MEDIUM"===t.urgencyLevel?"orange":"green",children:t.urgencyLevel||"NORMAL"})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Business Impact:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.businessImpact||"Standard processing"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"11px"},children:"Cost Center:"}),(0,u.jsx)("div",{style:{fontSize:"12px",marginTop:2},children:t.costCenter||"Not specified"})]})]})})]}),t.jvcNotes&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"12px"},children:"JVC Notes:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:t.jvcNotes})]}),t.knownProperties&&Object.keys(t.knownProperties).length>0&&(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)(Se,{strong:!0,style:{fontSize:"12px"},children:"Known Properties:"}),(0,u.jsx)("div",{style:{marginTop:4,padding:"8px",backgroundColor:"#f0f5ff",border:"1px solid #adc6ff",borderRadius:"4px",fontSize:"11px"},children:Object.entries(t.knownProperties).map(e=>{let[t,a]=e;return(0,u.jsxs)("div",{style:{marginBottom:2},children:[(0,u.jsxs)("strong",{children:[t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),":"]})," ",a]},t)})})]}),(0,u.jsx)(C.A,{style:{margin:"12px 0 8px 0"}}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:[(0,u.jsx)(Se,{strong:!0,children:"For Plant Team Reference:"}),(0,u.jsxs)("ul",{style:{margin:"4px 0 0 16px",padding:0},children:[(0,u.jsx)("li",{children:"Review all JVC-provided information before starting questionnaire"}),(0,u.jsx)("li",{children:"Use this context when raising queries to other teams"}),(0,u.jsx)("li",{children:"Reference material ID and supplier details in communications"}),(0,u.jsx)("li",{children:"Contact JVC team for clarification on any provided data"}),(0,u.jsx)("li",{children:"Consider regulatory requirements when completing safety sections"})]})]})]},"jvc-data"),t.specifications&&(0,u.jsx)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(xe.A,{}),(0,u.jsx)("strong",{children:"Technical Specifications"})]}),children:(0,u.jsx)(we.A,{column:1,size:"small",children:Object.entries(t.specifications).map(e=>{let[t,a]=e;return(0,u.jsx)(we.A.Item,{label:t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),children:"object"===typeof a?JSON.stringify(a):String(a)},t)})})},"specifications"),t.safetyNotes&&(0,u.jsx)(Pe,{header:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(be.A,{}),(0,u.jsx)("strong",{children:"Safety Notes"})]}),children:(0,u.jsx)(_.A,{message:"Important Safety Information",description:t.safetyNotes,type:"warning",showIcon:!0,size:"small"})},"safety")]}),(0,u.jsx)(C.A,{style:{margin:"12px 0"}})]});var y};var qe=a(6833),Ie=a(7933),Ne=a(6274);const{TextArea:_e}=y.A,{Option:Ee}=s.A,Te=e=>{let{open:t,visible:a,onCancel:l,onSubmit:c,workflowId:p,fieldContext:m}=e;const[h]=oe.A.useForm(),[g,f]=(0,d.useState)(!1),[y,x]=(0,d.useState)([]),[A,b]=(0,d.useState)(null);console.log("QueryRaisingModal props:",{open:t,visible:a,workflowId:p,fieldContext:m});const j=()=>{h.resetFields(),x([]),b(null),l()},w=e=>({LOW:"green",MEDIUM:"blue",HIGH:"orange",URGENT:"red"}[e]||"default");return(0,u.jsxs)(r.A,{title:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(Z.A,{}),"Raise Query"]}),open:t||a,onCancel:j,footer:A?[(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>{const e=y.length>0?` with ${y.length} document(s) attached`:"";o.Ay.success(`Query completed${e}`),h.resetFields(),x([]);const t={id:A,documents:y};b(null),f(!1),c&&c(t)},children:"Done"},"done")]:[(0,u.jsx)(n.Ay,{onClick:j,children:"Cancel"},"cancel"),(0,u.jsx)(n.Ay,{type:"primary",loading:g,onClick:()=>h.submit(),children:"Create Query"},"submit")],width:600,destroyOnClose:!0,children:[m&&(0,u.jsx)(_.A,{message:"Field Context",description:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Step:"})," ",m.stepTitle]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Field:"})," ",m.label]}),m.placeholder&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Expected:"})," ",m.placeholder]})]}),type:"info",icon:(0,u.jsx)(xe.A,{}),style:{marginBottom:16}}),(0,u.jsxs)(Ne.Ay,{form:h,layout:"vertical",onFinish:async e=>{try{f(!0);const t={question:e.question,assignedTeam:e.assignedTeam,priorityLevel:e.priority||"MEDIUM",fieldName:null===m||void 0===m?void 0:m.name,stepNumber:null===m||void 0===m?void 0:m.stepNumber,stepTitle:null===m||void 0===m?void 0:m.stepTitle,queryCategory:e.category||"GENERAL"},a=await fe.B.createQuery(p,t);b(a.id),o.Ay.success("Query created successfully! You can now attach documents if needed.")}catch(t){console.error("Failed to create query:",t),o.Ay.error("Failed to raise query. Please try again."),f(!1)}},initialValues:{priority:"MEDIUM",fieldContext:null===m||void 0===m?void 0:m.label},componentName:"QueryRaisingModal",enableSecurityLogging:!0,disabled:null!==A,children:[m&&(0,u.jsx)(_.A,{message:"Recommended Team",description:(e=>{var t,a;if(!e||!e.name)return null;const l=e.name.toLowerCase(),s=(null===(t=e.stepTitle)||void 0===t?void 0:t.toLowerCase())||"",o=(null===(a=e.label)||void 0===a?void 0:a.toLowerCase())||"";let n=0;["hazard","safety","precautionary","environmental","toxic","corrosive","flammable","classification","ghs","signal","statement"].forEach(e=>{(l.includes(e)||s.includes(e)||o.includes(e))&&(n+=1)});let i=0;["physical","boiling","melting","technical","properties","temperature","state","color","odor","specification"].forEach(e=>{(l.includes(e)||s.includes(e)||o.includes(e))&&(i+=1)});let r=0;["material","supplier","cas","basic","information","name","identification","type"].forEach(e=>{(l.includes(e)||s.includes(e)||o.includes(e))&&(r+=1)});const d=Math.max(n,i,r);let c="CQS",p="Medium";0===d?p="Low":d>=3&&(p="High"),n===d?c="CQS":i===d?c="TECH":r===d&&(c="JVC");return(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{marginBottom:8},children:[(0,u.jsxs)("strong",{style:{color:"High"===p?"#52c41a":"Medium"===p?"#1890ff":"#faad14"},children:[c," Team"]})," ","is recommended (",p," confidence)"]}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:8},children:{CQS:"Chemical Quality & Safety team - handles safety data, hazard classifications, and regulatory compliance",TECH:"Technical team - handles technical specifications, physical properties, and process-related questions",JVC:"JVC team - handles material identification, supplier information, and general material questions"}[c]}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#999"},children:['Based on field: "',(0,u.jsx)("em",{children:e.label}),'" in step: "',(0,u.jsx)("em",{children:e.stepTitle}),'"']}),"Low"===p&&(0,u.jsx)("div",{style:{fontSize:"11px",color:"#fa8c16",marginTop:4},children:"\ud83d\udca1 Consider the nature of your question when selecting the team"})]})})(m),type:"info",style:{marginBottom:16},showIcon:!0}),(0,u.jsx)(oe.A.Item,{name:"assignedTeam",label:"Assign to Team",rules:[{required:!0,message:"Please select a team to assign this query to"}],help:"Choose the most appropriate team based on your question type. Consider the field context and question nature.",children:(0,u.jsxs)(s.A,{placeholder:"Select team to handle this query",size:"large",showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.children.props.children[0].props.children.toLowerCase().indexOf(e.toLowerCase())>=0,children:[(0,u.jsx)(Ee,{value:"CQS",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#722ed1"},children:"CQS Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Safety data, hazard classifications, regulatory compliance"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Safety measures, hazard statements, environmental impact"})]})}),(0,u.jsx)(Ee,{value:"TECH",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#13c2c2"},children:"Technical Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Technical specs, physical properties, processes"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Physical properties, technical specifications, processes"})]})}),(0,u.jsx)(Ee,{value:"JVC",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{fontWeight:"bold",color:"#1890ff"},children:"JVC Team"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:"Material identification, supplier info, general questions"}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#999"},children:"Best for: Material details, supplier information, general clarifications"})]})})]})}),(0,u.jsx)(Ne.lE,{name:"fieldContext",label:"Field Context",help:"Specify which field or section this query relates to",validationType:"text",children:(0,u.jsx)(Ne.eS,{placeholder:"e.g., Material Name, Safety Classification, Storage Conditions",prefix:(0,u.jsx)(xe.A,{}),validationType:"text",componentName:"QueryRaisingModal",fieldName:"fieldContext"})}),(0,u.jsx)(oe.A.Item,{name:"category",label:"Query Category",help:"Categorize your query for better tracking and resolution",children:(0,u.jsxs)(s.A,{placeholder:"Select query category",size:"large",allowClear:!0,children:[(0,u.jsx)(Ee,{value:"GENERAL",children:"General Question"}),(0,u.jsx)(Ee,{value:"TECHNICAL",children:"Technical Specification"}),(0,u.jsx)(Ee,{value:"SAFETY",children:"Safety & Compliance"}),(0,u.jsx)(Ee,{value:"REGULATORY",children:"Regulatory Information"}),(0,u.jsx)(Ee,{value:"ENVIRONMENTAL",children:"Environmental Impact"}),(0,u.jsx)(Ee,{value:"TRANSPORTATION",children:"Transportation & Storage"}),(0,u.jsx)(Ee,{value:"SUPPLIER",children:"Supplier Information"}),(0,u.jsx)(Ee,{value:"CLARIFICATION",children:"Clarification Request"})]})}),(0,u.jsx)(oe.A.Item,{name:"priority",label:"Priority Level",help:"Select the urgency level for this query",children:(0,u.jsx)(re.Ay.Group,{children:(0,u.jsxs)(i.A,{direction:"vertical",children:[(0,u.jsxs)(re.Ay,{value:"LOW",children:[(0,u.jsx)(v.A,{color:w("LOW"),children:"LOW"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"General information, non-blocking"})]}),(0,u.jsxs)(re.Ay,{value:"MEDIUM",children:[(0,u.jsx)(v.A,{color:w("MEDIUM"),children:"MEDIUM"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Standard clarification needed"})]}),(0,u.jsxs)(re.Ay,{value:"HIGH",children:[(0,u.jsx)(v.A,{color:w("HIGH"),children:"HIGH"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Important for completion"})]}),(0,u.jsxs)(re.Ay,{value:"URGENT",children:[(0,u.jsx)(v.A,{color:w("URGENT"),children:"URGENT"}),(0,u.jsx)("span",{style:{marginLeft:8},children:"Blocking progress, needs immediate attention"})]})]})})}),(0,u.jsx)(C.A,{}),(0,u.jsx)(Ne.lE,{name:"question",label:"Your Question",validationType:"richtext",help:"Be specific and provide context to help the assigned team understand your question",children:(0,u.jsx)(Ne.wS,{rows:6,placeholder:"Describe your question in detail. Include:\n\u2022 What specific information you need\n\u2022 Why you need this information\n\u2022 Any relevant context or background\n\u2022 What you've already tried or researched",showCount:!0,maxLength:1e3,validationType:"richtext",componentName:"QueryRaisingModal",fieldName:"question"})}),A?(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsx)(_.A,{message:"Query Created Successfully!",description:"Your query has been created. You can now attach supporting documents if needed, or click 'Done' to finish.",type:"success",showIcon:!0,style:{marginBottom:16}}),(0,u.jsx)(Ie.A,{queryId:A,context:"query",onUploadComplete:e=>{x(t=>[...t,...e]),o.Ay.success(`${e.length} document(s) uploaded successfully`)},maxFiles:5,disabled:!1})]}):(0,u.jsx)(je.A,{size:"small",ghost:!0,items:[{key:"documents",label:(0,u.jsxs)(i.A,{children:[(0,u.jsx)(qe.A,{}),(0,u.jsx)("span",{children:"Supporting Documents"}),(0,u.jsx)(v.A,{color:"blue",children:"Available after query creation"})]}),children:(0,u.jsx)(_.A,{message:"Document Attachment",description:"After creating your query, you'll be able to attach supporting documents to provide additional context. Documents help the assigned team better understand your question.",type:"info",showIcon:!0})}]}),(0,u.jsx)(C.A,{}),(0,u.jsx)(_.A,{message:"Query Guidelines",description:(0,u.jsxs)("ul",{style:{margin:0,paddingLeft:20},children:[(0,u.jsx)("li",{children:"Be specific and clear in your question"}),(0,u.jsx)("li",{children:"Include relevant context and background information"}),(0,u.jsx)("li",{children:"Mention any documentation or resources you've already checked"}),(0,u.jsx)("li",{children:"For urgent queries, explain why immediate attention is needed"}),(0,u.jsx)("li",{children:"Use appropriate technical terminology when relevant"})]}),type:"info",showIcon:!0,icon:(0,u.jsx)(q.A,{})})]})]})},{TextArea:Fe}=y.A,{Option:De}=s.A,{Text:Re,Title:Me,Paragraph:Oe}=l.A,ze=e=>{let{workflowId:t,onComplete:a,onSaveDraft:l}=e;const[c]=oe.A.useForm(),[p,m]=(0,d.useState)(0),[g,f]=(0,d.useState)(!0),[C,j]=(0,d.useState)(!1),[w,P]=(0,d.useState)(!1),[S,k]=(0,d.useState)(null),[N,E]=(0,d.useState)({}),[F,D]=(0,d.useState)(new Set),[R,M]=(0,d.useState)(!1),[O,L]=(0,d.useState)(null),[U,xe]=(0,d.useState)([]),[ve,Ae]=(0,d.useState)(!0),[be,Ce]=(0,d.useState)(!navigator.onLine),[je,we]=(0,d.useState)(!1),[Pe,Se]=(0,d.useState)(!1),[qe,Ie]=(0,d.useState)(0),{isMobile:Ne}=(()=>{const[e,t]=(0,d.useState)({isMobile:window.innerWidth<=z.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>z.EW.MOBILE_BREAKPOINT&&window.innerWidth<=z.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>z.EW.TABLET_BREAKPOINT});return(0,d.useEffect)(()=>{const e=()=>{t({isMobile:window.innerWidth<=z.EW.MOBILE_BREAKPOINT,isTablet:window.innerWidth>z.EW.MOBILE_BREAKPOINT&&window.innerWidth<=z.EW.TABLET_BREAKPOINT,isDesktop:window.innerWidth>z.EW.TABLET_BREAKPOINT})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),[_e,Ee]=(0,d.useState)([]),[ze,Le]=(0,d.useState)(!0),[Ue,$e]=(0,d.useState)({}),[We,Be]=(0,d.useState)({}),Qe={General:(0,u.jsx)($.A,{}),Physical:(0,u.jsx)(W.A,{}),"Flammability and Explosivity":(0,u.jsx)(B.A,{}),Toxicity:(0,u.jsx)(Q.A,{}),"Storage and Handling":(0,u.jsx)(V.A,{}),PPE:(0,u.jsx)(Q.A,{}),"First Aid":(0,u.jsx)(G.A,{}),Statutory:(0,u.jsx)(V.A,{}),Others:(0,u.jsx)(Y.A,{}),Safety:(0,u.jsx)(Q.A,{}),Environmental:(0,u.jsx)(H.A,{}),Quality:(0,u.jsx)(J.A,{})},Ve=(0,d.useCallback)(async()=>{try{if(Le(!0),null===S||void 0===S||!S.materialCode||null===S||void 0===S||!S.assignedPlant)return console.warn("Missing required data for template loading:",{materialCode:null===S||void 0===S?void 0:S.materialCode,assignedPlant:null===S||void 0===S?void 0:S.assignedPlant}),void Ee(Ge());console.log("Loading questionnaire template for:",{materialCode:S.materialCode,plantCode:S.assignedPlant});const a=await ye.S.getQuestionnaireTemplate({materialCode:S.materialCode,plantCode:S.assignedPlant,templateType:"PLANT_QUESTIONNAIRE"});if(console.log("Received template:",a),!a||!a.steps||!Array.isArray(a.steps))throw console.error("Invalid template structure:",a),new Error("Invalid template structure received from backend");const l=a.steps.map(e=>({...e,title:e.title||e.stepTitle||`Step ${e.stepNumber||"Unknown"}`,description:e.description||"",fields:(e.fields||[]).map(e=>({...e,isCqsAutoPopulated:e.cqsAutoPopulated||e.isCqsAutoPopulated||!1,cqsValue:e.cqsAutoPopulated||e.isCqsAutoPopulated?"Pending IMP":null,disabled:e.cqsAutoPopulated||e.isCqsAutoPopulated||e.disabled||!1,placeholder:e.cqsAutoPopulated||e.isCqsAutoPopulated?"Auto-populated by CQS (Pending Implementation)":e.placeholder}))}));console.log("Processed steps:",l),Ee(l);try{const e=await ye.S.getCqsData({materialCode:null===S||void 0===S?void 0:S.materialCode,plantCode:null===S||void 0===S?void 0:S.assignedPlant});$e(e.data||{});const t={};Object.entries(e.data||{}).forEach(e=>{let[a,l]=e;l&&"Pending IMP"!==l&&(t[a]=l)}),Object.keys(t).length>0&&(E(e=>({...e,...t})),c.setFieldsValue(t))}catch(e){console.error("Failed to load CQS data:",e)}try{const e=await ye.S.getOrCreatePlantSpecificData({plantCode:null===S||void 0===S?void 0:S.assignedPlant,materialCode:null===S||void 0===S?void 0:S.materialCode,workflowId:t});Be(e||{}),null!==e&&void 0!==e&&e.plantInputs&&(E(t=>({...t,...e.plantInputs})),c.setFieldsValue(e.plantInputs))}catch(e){console.error("Failed to load plant-specific data:",e)}}catch(e){console.error("Failed to load questionnaire template:",e),o.Ay.error(`Failed to load questionnaire template: ${e.message}`),console.log("Using fallback template"),Ee(Ge())}finally{Le(!1)}},[S,t,c]),Ge=()=>[{title:"General",description:"General information about MSDS availability and completeness",fields:[{name:"msds_available",label:"Is 16 Section MSDS of the raw material available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"missing_info",label:"Which information in any one of the 16 sections is not available in full?",type:"textarea",required:!1,placeholder:"Describe missing information"},{name:"sourcing_asked",label:"Has the identified missing / more information required from the supplier asked thru Sourcing?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"cas_available",label:"Is CAS number of the raw material based on the pure substance available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"mixture_ingredients",label:"For mixtures, are ingredients of mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"composition_percentage",label:"Is % age composition substances in the mixture available?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage_1",label:"Is the total %age of all substances in the mixture equal to 100?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"total_percentage",label:"If not what is the % of substances not available?",type:"textarea",required:!1,placeholder:"Provide details about percentage composition"}]},{title:"Physical",description:"Physical properties and handling requirements",fields:[{name:"is_corrosive",label:"Is the material corrosive?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"corrosive_storage",label:"Does the plant have acid and alkali proof storage facilities to store a corrosive raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"highly_toxic",label:"Is the material highly toxic?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"toxic_powder_handling",label:"Does the plant have facilities to handle fine powder of highly toxic raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"crushing_facilities",label:"Does the plant have facilities to crush the stone like solid raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"heating_facilities",label:"Does the plant have facilities to heat/melt the raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"paste_preparation",label:"Does the plant have facilities to prepare paste of raw material if required for charging the same in a batch?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Flammability and Explosivity",description:"Flammability, explosivity and fire safety measures",fields:[{name:"flash_point_65",label:"Is Flash point of the raw material given and less than or equal to 65 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"petroleum_class",label:"Is the raw material is to be catgorised as ClassC / Class B / Class A substance as per Petroleum Act / Rules?",type:"select",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"class_a",label:"Class A"},{value:"class_b",label:"Class B"},{value:"class_c",label:"Class C"},{value:"na",label:"N/A"}]},{name:"storage_license",label:"Does all the plants have the capacity and license to store the raw material?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"ccoe_license",label:"If no, has the plant applied for CCoE license and by when expected to receive the license?",type:"textarea",required:!1,placeholder:"Provide details about CCoE license application"},{name:"flash_point_21",label:"Is Flash point of the raw material given is less than 21 degree C?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"flammable_infrastructure",label:"If yes, does plant have infrastructure to comply State Factories Rule for handling 'Flammable liquids'?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]}]},{title:"Toxicity",description:"Toxicity assessment and exposure control",fields:[{name:"ld50_oral",label:"Is LD 50 (oral) value available and higher than the threshold limit of 200 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"ld50_dermal",label:"Is LD 50 (Dermal) value available and higher than 1000 mg/Kg BW?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"lc50_inhalation",label:"Is LC50 Inhalation value available and higher than 10 mg/L?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"exposure_minimization",label:"If no, in any of the above three cases (where avaialble) then does the plant have facilities and /or procedure to minmise the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe exposure minimization procedures"},{name:"carcinogenic",label:"Is the RM a suspect Carcinogenic?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"carcinogenic_control",label:"If yes, plant has adequate facilities and /or procedure to minimse the exposure of workman?",type:"textarea",required:!1,placeholder:"Describe carcinogenic exposure control measures"}]},{title:"Storage and Handling",description:"Storage and handling procedures",fields:[{name:"storage_conditions_stores",label:"Are any storage conditions required and available in the plant stores?",type:"textarea",required:!1,placeholder:"Describe storage conditions in plant stores"},{name:"storage_conditions_floor",label:"Are any storage conditions required and available in the shop floor?",type:"textarea",required:!1,placeholder:"Describe storage conditions on shop floor"},{name:"closed_loop_required",label:"Does it require closed loop handling system during charging?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"work_permit_available",label:"Does the plant have required Work permit and /or WI/SOP to handle the raw material adequately?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"procedures_details",label:"If, yes specify the procedures",type:"textarea",required:!1,placeholder:"Specify the procedures and work permits"}]},{title:"PPE",description:"Personal protective equipment requirements",fields:[{name:"recommended_ppe",label:"Recommended specific PPEs based on MSDS",type:"textarea",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)"},{name:"ppe_in_use",label:"Are recommended PPE as per MSDS to handle the RM is already in use at the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"partial",label:"Partially"}]},{name:"ppe_procurement_date",label:"If no, by when the plant can procure the require PPE?",type:"input",required:!1,placeholder:"Enter expected procurement date"}]},{title:"First Aid",description:"First aid measures and emergency response",fields:[{name:"is_poisonous",label:"Is the raw material poisonous as per the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"antidote_specified",label:"Is the name of antidote required to counter the impact of the material given in the MSDS?",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_available",label:"Is the above specified antidote available in the plants?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"antidote_source",label:"If the specified antidote is not available then what is source and who will obtain the antidote in the plant?",type:"textarea",required:!1,placeholder:"Describe antidote source and procurement plan"},{name:"first_aid_capability",label:"Does the plant has capability to provide the first aid mentioned in the MSDS with the existing control measures?",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]}]},{title:"Statutory",description:"Statutory compliance and regulatory requirements",fields:[{name:"cmvr_listed",label:"Is the RM or any of its ingredient listed in Table 3 of Rule 137 (CMVR)",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"msihc_listed",label:"Is the RM or any of its ingredient listed in part II of Schedule I of MSIHC Rule",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"factories_act_listed",label:"Is the RM or any of its ingredients listed in Schedule II of Factories Act",type:"radio",required:!1,isCqsAutoPopulated:!0,disabled:!0,cqsValue:"Pending IMP",placeholder:"Auto-populated by CQS (Pending Implementation)",options:[{value:"yes",label:"Yes"},{value:"no",label:"No"}]},{name:"permissible_concentration",label:"With the current infrastructure, is the concentration of RM / ingredients listed in Schedule II of Factories Act within permissible concentrations as per Factories Act in the work area.",type:"radio",required:!1,options:[{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}]},{name:"monitoring_details",label:"Mention details of work area monitoring results and describe infrastructure used for handling",type:"textarea",required:!1,placeholder:"Provide monitoring details and infrastructure description"}]},{title:"Others",description:"Additional inputs and gap analysis",fields:[{name:"plant_inputs_required",label:"Inputs required from plants based on the above assessment?",type:"textarea",required:!1,placeholder:"Describe inputs required from plants"},{name:"gaps_identified",label:"Gaps identified vis-\xe0-vis existing controls / protocols",type:"textarea",required:!1,placeholder:"Identify gaps in existing controls and protocols"},{name:"additional_input_1",label:"Additional Input 1",type:"textarea",required:!1,placeholder:"Additional input field 1"},{name:"additional_input_2",label:"Additional Input 2",type:"textarea",required:!1,placeholder:"Additional input field 2"}]}],Ye=(0,d.useCallback)(()=>{if(!_e||0===_e.length||!c)return 0;let e=0,t=0;try{const a=c.getFieldsValue(),l={...N,...a};_e.forEach((a,s)=>{const o=(a.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled);e+=o.length;const n=o.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=n.length});return e>0?Math.round(t/e*100):0}catch(a){return console.error("Error calculating overall completion:",a),0}},[_e,N,c]),He=(0,d.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{j(!0);const n=c.getFieldsValue(),i={...N,...n},r={};Object.entries(i).forEach(e=>{let[t,a]=e;null!==a&&void 0!==a&&""!==a&&(r[t]=a)});const d=`plant_questionnaire_draft_${t}`,u={formData:r,currentStep:p,timestamp:Date.now(),completedSteps:Array.from(F),version:"2.0",materialCode:null===S||void 0===S?void 0:S.materialCode,materialName:null===S||void 0===S?void 0:S.materialName,assignedPlant:null===S||void 0===S?void 0:S.assignedPlant,lastSyncAttempt:Date.now(),syncStatus:be?"pending":"synced",totalFields:Object.keys(r).length,completionPercentage:Ye(),sessionId:Date.now()};try{localStorage.setItem(d,JSON.stringify(u))}catch(a){console.warn("Failed to save draft to local storage:",a)}if(be)we(!0),e||o.Ay.info("Draft saved locally. Will sync when online.");else try{const a={plantCode:null===S||void 0===S?void 0:S.assignedPlant,materialCode:null===S||void 0===S?void 0:S.materialCode,responses:i,currentStep:p,completedSteps:Array.from(F),modifiedBy:"current_user"};await ye.S.saveDraftPlantResponses(t,a),e||o.Ay.success("Draft saved successfully")}catch(s){console.error("Failed to save draft to server:",s),we(!0),e||o.Ay.warning("Draft saved locally. Will sync when connection is restored.")}E(i),l&&l(i)}catch(n){console.error("Failed to save draft:",n),e||o.Ay.error("Failed to save draft. Please try again.")}finally{j(!1)}},[c,N,t,l,p,F,be,S,Ye]),Je=(0,d.useCallback)(async()=>{if(p<_e.length-1)try{const e=c.getFieldsValue(),t={...N,...e};E(t),await He(!0),m(p+1)}catch(e){console.error("Failed to save data before moving to next step:",e),o.Ay.warning("Failed to save current data. Please try again.")}},[p,_e.length,c,N,He]),Ke=(0,d.useCallback)(async()=>{if(p>0)try{const e=c.getFieldsValue(),t={...N,...e};E(t),await He(!0),m(p-1)}catch(e){console.error("Failed to save data before moving to previous step:",e),o.Ay.warning("Failed to save current data. Please try again.")}},[p,c,N,He]),Xe=(0,d.useCallback)(async e=>{if(e>=0&&e<_e.length)try{const t=c.getFieldsValue(),a={...N,...t};E(a),await He(!0),m(e)}catch(t){console.error("Failed to save data before changing step:",t),o.Ay.warning("Failed to save current data. Please try again.")}},[_e.length,c,N,He]),Ze=(0,d.useCallback)(()=>{if(!_e||0===_e.length||!c)return{total:0,populated:0};let e=0,t=0;try{const a=c.getFieldsValue(),l={...N,...a};return _e.forEach(a=>{const s=(a.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled);e+=s.length;const o=s.filter(e=>{const t=l[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});t+=o.length}),{total:e,populated:t}}catch(a){return console.error("Error calculating total fields populated:",a),{total:0,populated:0}}},[_e,N,c]);(0,d.useEffect)(()=>{const e=()=>{Ce(!1),ne.Ay.success({message:"Connection Restored",description:"You are back online. Syncing your changes...",icon:(0,u.jsx)(K.A,{style:{color:"#52c41a"}}),duration:3}),je&&(He(!0),we(!1))},t=()=>{Ce(!0),ne.Ay.warning({message:"Connection Lost",description:"You are offline. Changes will be saved locally and synced when connection is restored.",icon:(0,u.jsx)(X.A,{style:{color:"#fa8c16"}}),duration:5})};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[je,He]),(0,d.useEffect)(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),He()),(e.ctrlKey||e.metaKey)&&"ArrowRight"===e.key&&(e.preventDefault(),p<_e.length-1&&Je()),(e.ctrlKey||e.metaKey)&&"ArrowLeft"===e.key&&(e.preventDefault(),p>0&&Ke()),"F1"===e.key&&(e.preventDefault(),r.A.info({title:"Keyboard Shortcuts",content:(0,u.jsxs)("div",{children:[(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + S:"})," Save draft"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2192:"})," Next step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Ctrl/Cmd + \u2190:"})," Previous step"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Tab:"})," Navigate between fields"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Enter:"})," Submit form or proceed"]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Esc:"})," Close modals"]})]})}))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[p,_e.length,Je,Ke,He]);const et=(0,d.useCallback)(async()=>{try{f(!0);const e=await ye.S.getWorkflow(t);k(e);const a={};if(e.materialName&&(a.materialName=e.materialName),e.responses&&e.responses.length>0){const t={...a},l=new Set;e.responses.forEach(e=>{t[e.fieldName]=e.fieldValue,l.add(e.stepNumber)}),E(t),D(l),c.setFieldsValue(t)}else E(a),c.setFieldsValue(a)}catch(e){console.error("Failed to load workflow data:",e),o.Ay.error("Failed to load workflow data")}finally{f(!1)}},[t,c]),tt=(0,d.useCallback)(async()=>{try{const e=await fe.B.getQueriesByWorkflow(t);xe(e)}catch(e){console.error("Failed to load queries:",e)}},[t]);(0,d.useEffect)(()=>{t&&(et(),tt())},[t,et,tt]),(0,d.useEffect)(()=>{S&&S.materialCode&&S.assignedPlant&&Ve()},[S,Ve]),(0,d.useEffect)(()=>{if(ve&&Object.keys(N).length>0){const e=setTimeout(()=>{He(!0)},z.aZ.INTERVAL);return()=>clearTimeout(e)}},[N,ve,He]),(0,d.useEffect)(()=>{if(ve&&Object.keys(N).length>0){const e=setTimeout(()=>{He(!0)},z.aZ.DEBOUNCE_DELAY);return()=>clearTimeout(e)}},[N,ve,He]),(0,d.useEffect)(()=>{if(_e.length>0){const e=new Set,t=c.getFieldsValue(),a={...N,...t};_e.forEach((t,l)=>{const s=(t.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled),o=s.filter(e=>e.required),n=o.filter(e=>{const t=a[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});if(o.length>0)n.length===o.length&&e.add(l);else{const t=s.filter(e=>{const t=a[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t});(s.length>0?t.length/s.length*100:0)>=50&&e.add(l)}}),D(e)}},[N,_e,c]);(0,d.useEffect)(()=>{t&&!S&&(()=>{try{const e=`plant_questionnaire_draft_${t}`,a=localStorage.getItem(e);if(a){const t=JSON.parse(a),l=t.timestamp,s=Date.now();if(s-l<6048e5)if(t.formData&&"object"===typeof t.formData){const e={};Object.entries(t.formData).forEach(t=>{let[a,l]=t;null!==l&&void 0!==l&&""!==l&&(e[a]=l)}),E(t=>({...t,...e})),c.setFieldsValue(e),"number"===typeof t.currentStep&&t.currentStep>=0&&t.currentStep<_e.length&&m(t.currentStep),Array.isArray(t.completedSteps)&&D(new Set(t.completedSteps)),"pending"===t.syncStatus&&we(!0);const a=Object.keys(e).length,o=Math.round((s-l)/36e5);ne.Ay.success({message:"Draft Recovered",description:`${a} fields restored from ${o} hours ago. Your progress has been preserved.`,duration:6,placement:"topRight"})}else localStorage.removeItem(e),ne.Ay.warning({message:"Draft Recovery Failed",description:"Previous draft data was corrupted and has been cleared.",duration:4});else{localStorage.removeItem(e);const t=Math.round((s-l)/864e5);ne.Ay.info({message:"Old Draft Cleared",description:`Draft from ${t} days ago was automatically removed.`,duration:3})}}}catch(e){console.error("Failed to recover draft data:",e);try{localStorage.removeItem(`plant_questionnaire_draft_${t}`),ne.Ay.error({message:"Draft Recovery Error",description:"Failed to recover previous draft. Starting fresh.",duration:4})}catch(a){console.error("Failed to remove corrupted draft:",a)}}})()},[t,S,c,_e.length]);const at=(0,d.useCallback)(e=>{if(!_e[e]||!_e[e].fields)return{total:0,required:0,optional:0,completed:0,requiredCompleted:0,optionalCompleted:0,isComplete:!1,hasOpenQueries:!1,hasResolvedQueries:!1,openQueriesCount:0,resolvedQueriesCount:0,completionPercentage:0,requiredCompletionPercentage:0};const t=_e[e].fields.filter(e=>!e.isCqsAutoPopulated&&!e.disabled),a=t.filter(e=>e.required),l=t.filter(e=>!e.required),s=c.getFieldsValue(),o={...N,...s},n=a.filter(e=>{const t=o[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),i=l.filter(e=>{const t=o[e.name];return Array.isArray(t)?t.length>0:t&&""!==t&&null!==t&&void 0!==t}),r=U.filter(t=>t.stepNumber===e),d=r.filter(e=>"OPEN"===e.status),u=r.filter(e=>"RESOLVED"===e.status);return{total:t.length,required:a.length,optional:l.length,completed:n.length+i.length,requiredCompleted:n.length,optionalCompleted:i.length,isComplete:a.length>0?n.length===a.length:t.length>0&&(n.length+i.length)/t.length>=.5,hasOpenQueries:d.length>0,hasResolvedQueries:u.length>0,openQueriesCount:d.length,resolvedQueriesCount:u.length,completionPercentage:t.length>0?Math.round((n.length+i.length)/t.length*100):100,requiredCompletionPercentage:a.length>0?Math.round(n.length/a.length*100):100}},[_e,N,c,U]),lt=(0,d.useCallback)(e=>{setTimeout(()=>{const t=document.querySelector(`[data-field-name="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),t.style.transition="background-color 0.3s ease",t.style.backgroundColor="#f6ffed",setTimeout(()=>{t.style.backgroundColor=""},2e3))},100)},[]);(0,d.useEffect)(()=>{if(U.length>0){const e=U.filter(e=>e.stepNumber===p&&"RESOLVED"===e.status&&!e.hasBeenViewed);if(e.length>0){const t=e.sort((e,t)=>new Date(t.resolvedAt)-new Date(e.resolvedAt))[0];lt(t.fieldName),ne.Ay.success({message:"Query Resolved",description:`Your query about "${t.fieldName}" has been resolved. Check the field for the response.`,duration:5,placement:"topRight"})}}},[U,p,lt]);const st=async()=>{const e=_e.flatMap(e=>e.fields.filter(e=>e.required).map(e=>e.name));await c.validateFields(e);const l=c.getFieldsValue(),s=Ye();if(s<80){if(!await new Promise(e=>{r.A.confirm({title:"Incomplete Questionnaire",content:`Your questionnaire is only ${s}% complete. Are you sure you want to submit?`,okText:"Submit",cancelText:"Continue Editing",onOk:()=>e(!0),onCancel:()=>e(!1)})}))return}const n={plantCode:null===S||void 0===S?void 0:S.assignedPlant,materialCode:null===S||void 0===S?void 0:S.materialCode,responses:l,completionPercentage:s,submittedBy:"current_user",totalQueries:U.length,openQueries:U.filter(e=>"OPEN"===e.status).length};await ye.S.submitPlantQuestionnaire(t,n);try{localStorage.removeItem(`plant_questionnaire_draft_${t}`)}catch(i){console.warn("Failed to clear draft data:",i)}o.Ay.success("Questionnaire submitted successfully"),a&&a(l)},ot=e=>{var t,a,l;const o=U.filter(t=>t.fieldName===e.name&&t.stepNumber===p),r=o.some(e=>"OPEN"===e.status),d=o.some(e=>"RESOLVED"===e.status),m=o.find(e=>"RESOLVED"===e.status),h=N[e.name]&&""!==N[e.name],g=(0,u.jsxs)("div",{className:"modern-field-label",children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",flexWrap:"wrap",marginBottom:"4px"},children:[(0,u.jsx)("span",{style:{flex:1,minWidth:0,lineHeight:"1.5"},children:e.label}),e.required&&(0,u.jsx)("span",{style:{color:"#ef4444",flexShrink:0},children:"*"}),e.isCqsAutoPopulated&&(0,u.jsx)("span",{className:"cqs-badge",children:"CQS"}),h&&(0,u.jsx)(ie.A,{title:"Field completed",children:(0,u.jsx)(I.A,{style:{color:"#10b981",fontSize:"14px",flexShrink:0}})})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"4px",flexWrap:"wrap"},children:[(0,u.jsx)(n.Ay,{type:"text",size:"small",icon:(0,u.jsx)(Z.A,{}),onClick:()=>(e=>{console.log("handleRaiseQuery called with fieldName:",e);const t=_e[p].fields.find(t=>t.name===e),a=N[e]||c.getFieldValue(e);console.log("Found field:",t),console.log("Current value:",a),L({...t,stepNumber:p,stepTitle:_e[p].title,currentValue:a,materialContext:{materialCode:null===S||void 0===S?void 0:S.materialCode,materialName:null===S||void 0===S?void 0:S.materialName,materialType:N.materialType||(null===S||void 0===S?void 0:S.materialType),supplierName:N.supplierName||(null===S||void 0===S?void 0:S.supplierName)}}),console.log("Setting queryModalVisible to true"),M(!0)})(e.name),style:{color:"#667eea",padding:"2px 6px",height:"auto",fontSize:"12px"},children:"Query"}),r&&(0,u.jsx)(v.A,{color:"red",size:"small",children:"Query Open"}),d&&!r&&(0,u.jsx)(v.A,{color:"green",size:"small",children:"Query Resolved"})]})]}),f=(e=>{const t=[];switch(e.required&&t.push({required:!0,message:`${e.label} is required for MSDS completion`}),e.name){case"casNumber":t.push({pattern:/^\d{1,7}-\d{2}-\d$/,message:"Please enter a valid CAS number format (e.g., 64-17-5). If unknown, raise a query to the Technical team."});break;case"boilingPoint":case"meltingPoint":t.push({pattern:/^-?\d+(\.\d+)?$/,message:"Please enter a valid temperature in Celsius (e.g., 100.5 or -10)"});break;case"materialName":t.push({min:2,message:"Material name must be at least 2 characters"}),t.push({max:200,message:"Material name cannot exceed 200 characters"});break;case"supplierName":t.push({min:2,message:"Supplier name must be at least 2 characters"}),t.push({max:100,message:"Supplier name cannot exceed 100 characters"});break;case"missing_info":case"exposure_minimization":case"carcinogenic_control":case"storage_conditions_stores":case"storage_conditions_floor":case"procedures_details":case"antidote_source":case"monitoring_details":case"plant_inputs_required":case"gaps_identified":case"additional_input_1":case"additional_input_2":t.push({min:10,message:`${e.label} must be at least 10 characters for regulatory compliance`}),t.push({max:2e3,message:`${e.label} cannot exceed 2000 characters`})}return t})(e),x=m?(0,u.jsxs)("div",{style:{marginTop:8,padding:"12px 16px",background:"linear-gradient(135deg, #f0fdf4, #dcfce7)",border:"1px solid #bbf7d0",borderRadius:"8px",fontSize:"12px"},children:[(0,u.jsx)("div",{style:{marginBottom:6},children:(0,u.jsx)(Re,{strong:!0,style:{color:"#059669"},children:"Query Response:"})}),(0,u.jsx)("div",{style:{marginBottom:6,color:"#374151"},children:m.response}),(0,u.jsxs)("div",{style:{fontSize:"10px",color:"#6b7280"},children:["Resolved by ",m.resolvedBy," on"," ",new Date(m.resolvedAt).toLocaleDateString()]})]}):(e=>({msds_available:"Material Safety Data Sheet with all 16 sections as per regulatory requirements",cas_available:"Chemical Abstracts Service number - unique identifier for chemical substances",is_corrosive:"Corrosive materials can cause damage to skin, eyes, and respiratory system",highly_toxic:"Materials with high toxicity require special handling and safety measures",flash_point_65:"Flash point indicates fire hazard - materials with flash point \u226465\xb0C are flammable",petroleum_class:"Classification under Petroleum Act determines storage and handling requirements",ld50_oral:"Lethal Dose 50 (oral) - dose that kills 50% of test animals when ingested",ld50_dermal:"Lethal Dose 50 (dermal) - dose that kills 50% of test animals through skin contact",lc50_inhalation:"Lethal Concentration 50 (inhalation) - concentration that kills 50% through inhalation",carcinogenic:"Materials suspected to cause cancer require enhanced safety protocols",recommended_ppe:"Personal Protective Equipment recommendations based on material hazards",is_poisonous:"Poisonous materials require specific antidotes and first aid procedures",cmvr_listed:"Chemical Manufacture and Verification Rules listing affects regulatory compliance",msihc_listed:"Manufacture, Storage and Import of Hazardous Chemical Rules listing",factories_act_listed:"Factories Act Schedule II listing requires workplace monitoring"}[e.name]||e.help))(e),A={name:e.name,label:g,rules:f,help:x,"data-field-name":e.name},b={className:"modern-input",disabled:e.disabled||e.isCqsAutoPopulated,placeholder:e.placeholder||`Enter ${e.label.toLowerCase()}`};switch(e.type){case"input":default:return(0,u.jsx)(oe.A.Item,{...A,children:(0,u.jsx)(y.A,{...b})});case"textarea":return(0,u.jsx)(oe.A.Item,{...A,children:(0,u.jsx)(Fe,{...b,rows:4,autoSize:{minRows:3,maxRows:6}})});case"select":return(0,u.jsx)(oe.A.Item,{...A,children:(0,u.jsx)(s.A,{...b,placeholder:`Select ${e.label.toLowerCase()}`,showSearch:!0,optionFilterProp:"children",children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,u.jsx)(De,{value:e.value,children:e.label},e.value))})});case"radio":return(0,u.jsx)(oe.A.Item,{...A,children:(0,u.jsx)(re.Ay.Group,{className:"modern-radio-group",disabled:e.disabled||e.isCqsAutoPopulated,children:(0,u.jsx)(i.A,{direction:"vertical",size:"small",children:null===(a=e.options)||void 0===a?void 0:a.map(e=>(0,u.jsx)(re.Ay,{value:e.value,children:e.label},e.value))})})});case"checkbox":return(0,u.jsx)(oe.A.Item,{...A,valuePropName:"checked",children:(0,u.jsx)(de.A.Group,{className:"modern-checkbox-group",disabled:e.disabled||e.isCqsAutoPopulated,children:(0,u.jsx)(i.A,{direction:"vertical",size:"small",children:null===(l=e.options)||void 0===l?void 0:l.map(e=>(0,u.jsx)(de.A,{value:e.value,children:e.label},e.value))})})})}};if(g)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)($.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Questionnaire"}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your workflow data..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ce.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"30%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!S)return(0,u.jsx)(_.A,{message:"Workflow Not Found",description:"The requested workflow could not be loaded.",type:"error",showIcon:!0});if(ze)return(0,u.jsx)("div",{className:"plant-questionnaire-container",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",gap:"24px"},children:(0,u.jsxs)("div",{style:{background:"white",padding:"48px",borderRadius:"16px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",textAlign:"center",maxWidth:"400px"},children:[(0,u.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,u.jsx)("div",{style:{width:"60px",height:"60px",margin:"0 auto 16px",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(W.A,{style:{fontSize:"24px",color:"white"}})}),(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Loading Template"}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"14px"},children:"Preparing your plant-specific questionnaire template..."})]}),(0,u.jsx)("div",{style:{marginBottom:"16px"},children:(0,u.jsx)(ce.A,{size:"large"})}),(0,u.jsx)("div",{style:{height:"4px",background:"#e2e8f0",borderRadius:"2px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:"60%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",borderRadius:"2px",animation:"slideInFromLeft 2s ease-in-out infinite"}})})]})});if(!_e||0===_e.length)return(0,u.jsx)(_.A,{message:"Template Not Available",description:"The questionnaire template could not be loaded. Please try refreshing the page.",type:"error",showIcon:!0,action:(0,u.jsx)(n.Ay,{size:"small",onClick:()=>window.location.reload(),children:"Refresh"})});const nt=_e[p]||{title:"Loading...",description:"",fields:[]};return(0,u.jsxs)("div",{className:"plant-questionnaire-container",children:[(0,u.jsx)("div",{className:"plant-questionnaire-header",children:(0,u.jsxs)("div",{className:"plant-questionnaire-header-content",children:[(0,u.jsxs)("div",{className:"plant-questionnaire-title",children:[(0,u.jsx)(ue.A,{size:40,style:{background:"linear-gradient(135deg, #667eea, #764ba2)"},children:(0,u.jsx)(ee.A,{})}),(0,u.jsxs)("div",{children:[(0,u.jsx)(Me,{level:3,style:{margin:0,color:"#1e293b"},children:"Plant Questionnaire"}),(0,u.jsxs)(Re,{type:"secondary",style:{fontSize:"14px"},children:[null===S||void 0===S?void 0:S.materialCode," \u2022 ",null===S||void 0===S?void 0:S.assignedPlant]})]})]}),(0,u.jsxs)("div",{className:"plant-questionnaire-stats",children:[(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ye()},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("defs",{children:(0,u.jsxs)("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,u.jsx)("stop",{offset:"0%",stopColor:"#4f46e5"}),(0,u.jsx)("stop",{offset:"100%",stopColor:"#7c3aed"})]})}),(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"30",cy:"30",r:"26"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"30",cy:"30",r:"26"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"600",color:"#1e293b"},children:[Ye(),"%"]})]}),(0,u.jsx)("div",{style:{textAlign:"center",marginTop:8},children:(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b"},children:"Overall Progress"})})]}),(0,u.jsxs)("div",{className:"modern-stats-card",children:[(0,u.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,u.jsx)(pe.A,{count:U.filter(e=>"OPEN"===e.status).length,style:{backgroundColor:U.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"},children:(0,u.jsx)(ue.A,{icon:(0,u.jsx)(Z.A,{}),style:{backgroundColor:U.filter(e=>"OPEN"===e.status).length>0?"#fef2f2":"#f0fdf4",color:U.filter(e=>"OPEN"===e.status).length>0?"#ef4444":"#10b981"}})})}),(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b",display:"block",textAlign:"center"},children:"Open Queries"})]}),(0,u.jsx)("div",{className:"modern-stats-card",children:(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsxs)("div",{className:"modern-completion-badge "+(Ye()>=80?"high":Ye()>=50?"medium":"low"),children:["Step ",p+1,"/",_e.length]}),(0,u.jsx)(Re,{style:{fontSize:"11px",color:"#64748b",display:"block",marginTop:4},children:"Current Step"})]})}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(h.A,{}),onClick:()=>He(),loading:C,children:"Save Draft"}),Ne&&(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(te.A,{}),onClick:()=>Se(!0),children:"Steps"})]})]})]})}),(0,u.jsxs)("div",{className:"plant-questionnaire-main",children:[!Ne&&(0,u.jsxs)("div",{className:"plant-questionnaire-sidebar",children:[(0,u.jsxs)(x.A,{className:"modern-steps-card",children:[(0,u.jsxs)("div",{className:"modern-steps-header",children:[(0,u.jsx)(Me,{level:4,style:{margin:0,color:"#1e293b"},children:"Questionnaire Steps"}),(0,u.jsxs)(Re,{type:"secondary",style:{fontSize:"12px",display:"block",marginBottom:"4px"},children:[F.size," of ",_e.length," steps completed"]}),(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"11px",display:"block",marginTop:"2px"},children:(()=>{const e=Ze();return`${e.populated} of ${e.total} fields populated`})()})]}),(0,u.jsx)("div",{className:"modern-steps-list",children:_e.map((e,t)=>{const a=at(t),l=U.some(e=>e.stepNumber===t&&"OPEN"===e.status),s=t===p,o=a.isComplete;return(0,u.jsxs)("div",{className:`modern-step-item ${s?"active":""} ${o?"completed":""}`,onClick:()=>Xe(t),children:[(0,u.jsx)("div",{className:"step-completion-ring "+(o?"completed":""),style:{"--completion-angle":a.requiredCompleted/Math.max(a.required,1)*360+"deg",background:s?"#4f46e5":o?"#10b981":"#f1f5f9",color:s||o?"white":"#64748b"},children:o?(0,u.jsx)(I.A,{}):l?(0,u.jsx)(q.A,{}):Qe[e.title]||(0,u.jsx)($.A,{})}),(0,u.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,u.jsx)("div",{style:{fontWeight:s?600:400,color:"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:2},children:[a.completed,"/",a.total," fields (",a.requiredCompleted,"/",a.required," required)",l&&(0,u.jsxs)(v.A,{color:"red",size:"small",style:{marginLeft:4},children:[U.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})]},t)})})]}),(0,u.jsx)("div",{style:{marginTop:16},children:(0,u.jsx)(ke,{workflowData:S})})]}),(0,u.jsx)("div",{className:"plant-questionnaire-content",children:(0,u.jsxs)(x.A,{className:"modern-form-card",children:[(0,u.jsxs)("div",{className:"modern-form-header",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Me,{level:2,style:{margin:0,color:"white"},children:nt.title}),(0,u.jsx)(Oe,{style:{margin:"8px 0 0 0",color:"rgba(255, 255, 255, 0.8)"},children:nt.description})]}),(0,u.jsxs)("div",{className:"modern-progress-container",children:[(0,u.jsx)(T.A,{className:"modern-progress",percent:(()=>{const e=at(p);return e.required>0?Math.round(e.requiredCompleted/e.required*100):100})(),showInfo:!1,strokeColor:"rgba(255, 255, 255, 0.9)",trailColor:"rgba(255, 255, 255, 0.2)"}),(0,u.jsxs)(Re,{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"12px"},children:["Step Progress:"," ",(()=>{const e=at(p);return`${e.requiredCompleted}/${e.required} required fields`})()]})]})]}),be&&(0,u.jsx)(_.A,{className:"modern-alert modern-alert-warning",message:"Offline Mode",description:"You are currently offline. Changes will be saved locally and synced when connection is restored.",type:"warning",showIcon:!0,style:{margin:"16px 32px"},closable:!0}),(0,u.jsx)("div",{className:"modern-form-content "+(p%2===0?"slide-in-from-right":"slide-in-from-left"),children:(0,u.jsx)(oe.A,{form:c,layout:"vertical",onValuesChange:(e,t)=>{E(e=>({...e,...t})),we(!0),Ie(e=>e+1),setTimeout(()=>{if(_e.length>0){const e=new Set;_e.forEach((a,l)=>{const s=(a.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled),o=s.filter(e=>e.required),n=o.filter(e=>{const a=t[e.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});if(o.length>0)n.length===o.length&&e.add(l);else{const a=s.filter(e=>{const a=t[e.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});(s.length>0?a.length/s.length*100:0)>=50&&e.add(l)}}),D(e)}},100)},children:(0,u.jsx)(A.A,{gutter:[24,24],children:(nt.fields||[]).map((e,t)=>(0,u.jsx)(b.A,{xs:24,sm:"textarea"===e.type?24:12,md:"textarea"===e.type?24:12,children:(0,u.jsx)("div",{className:`modern-field-group ${e.required?"required":""} ${e.isCqsAutoPopulated?"cqs-populated":""} fade-in-up`,style:{animationDelay:.1*t+"s"},children:(0,u.jsxs)("div",{className:"modern-field-header",children:[(0,u.jsx)("div",{style:{flex:1,minWidth:0},children:ot(e)}),(0,u.jsx)("div",{className:"modern-field-actions",children:e.isCqsAutoPopulated&&(0,u.jsx)(ie.A,{title:"CQS Auto-populated",children:(0,u.jsx)("div",{style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",fontWeight:"500"},children:"CQS"})})})]})})},e.name))})})}),(0,u.jsxs)("div",{className:"modern-navigation",children:[(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-secondary",icon:(0,u.jsx)(ae.A,{}),onClick:Ke,disabled:0===p,style:{opacity:0===p?.5:1,cursor:0===p?"not-allowed":"pointer"},children:"Previous"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{textAlign:"center"},children:[(0,u.jsx)(Re,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Step Progress"}),(0,u.jsxs)(Re,{style:{fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:[p+1," of ",_e.length]})]}),je&&(0,u.jsx)("div",{style:{padding:"4px 8px",background:"#fef3c7",border:"1px solid #fde68a",borderRadius:"6px",fontSize:"11px",color:"#92400e"},children:"Unsaved changes"}),p===_e.length-1?(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-primary "+(100===Ye()?"pulse-glow":""),onClick:async()=>{try{P(!0);const e=U.filter(e=>"OPEN"===e.status);if(e.length>0)return void r.A.confirm({title:"Open Queries Detected",content:`You have ${e.length} open queries. Are you sure you want to submit the questionnaire? It's recommended to resolve all queries before submission.`,okText:"Submit Anyway",cancelText:"Cancel",onOk:()=>st()});await st()}catch(e){console.error("Failed to submit questionnaire:",e),400===e.status?o.Ay.error("Please complete all required fields before submitting"):401===e.status?o.Ay.error("Session expired. Please log in again."):o.Ay.error("Failed to submit questionnaire. Please try again.")}finally{P(!1)}},loading:w,size:"large",style:{minWidth:"160px"},children:w?"Submitting...":"Submit Questionnaire"}):(0,u.jsx)(n.Ay,{className:"modern-btn modern-btn-primary",icon:(0,u.jsx)(le.A,{}),onClick:Je,style:{minWidth:"120px"},children:"Next Step"})]})]})]})})]}),(0,u.jsx)(me.A,{className:"modern-drawer",title:"Questionnaire Steps",placement:"left",onClose:()=>Se(!1),open:Pe,width:320,children:(0,u.jsx)("div",{className:"modern-timeline",children:(0,u.jsx)(he.A,{children:_e.map((e,t)=>{const a=at(t),l=U.some(e=>e.stepNumber===t&&"OPEN"===e.status),s=t===p,o=a.isComplete;return(0,u.jsx)(he.A.Item,{color:o?"#10b981":s?"#667eea":"#cbd5e1",dot:o?(0,u.jsx)(I.A,{style:{color:"#10b981"}}):l?(0,u.jsx)(q.A,{style:{color:"#ef4444"}}):Qe[e.title]||(0,u.jsx)($.A,{}),children:(0,u.jsxs)("div",{onClick:()=>{Xe(t),Se(!1)},style:{cursor:"pointer",padding:"8px 0"},children:[(0,u.jsx)(Re,{strong:s,style:{color:s?"#667eea":"#1e293b"},children:e.title}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b",marginTop:4},children:[a.completed,"/",a.total," fields completed (",a.requiredCompleted,"/",a.required," required)",l&&(0,u.jsxs)(v.A,{color:"red",size:"small",style:{marginLeft:4},children:[U.filter(e=>e.stepNumber===t&&"OPEN"===e.status).length," ","queries"]})]})]})},t)})})})}),!Ne&&(0,u.jsxs)("div",{className:"modern-floating-indicator",children:[(0,u.jsx)("div",{style:{textAlign:"center",marginBottom:12},children:(0,u.jsx)(Re,{strong:!0,style:{color:"#1e293b",fontSize:"14px"},children:"Questionnaire Progress"})}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[(0,u.jsxs)("div",{className:"modern-progress-ring",style:{"--progress":Ye(),width:"40px",height:"40px"},children:[(0,u.jsxs)("svg",{children:[(0,u.jsx)("circle",{className:"progress-circle progress-background",cx:"20",cy:"20",r:"16"}),(0,u.jsx)("circle",{className:"progress-circle progress-foreground",cx:"20",cy:"20",r:"16"})]}),(0,u.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"600",color:"#1e293b"},children:[Ye(),"%"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#1e293b",fontWeight:"500",marginBottom:"4px"},children:[F.size," of ",_e.length," steps"]}),(0,u.jsx)("div",{style:{fontSize:"11px",color:"#64748b",marginBottom:"2px"},children:(()=>{const e=Ze();return`${e.populated}/${e.total} fields`})()}),(0,u.jsxs)("div",{style:{fontSize:"11px",color:"#64748b"},children:[U.filter(e=>"OPEN"===e.status).length," open queries"]})]})]}),(0,u.jsx)("div",{style:{height:"2px",background:"#e2e8f0",borderRadius:"1px",overflow:"hidden"},children:(0,u.jsx)("div",{style:{height:"100%",width:`${Ye()}%`,background:"linear-gradient(135deg, #4f46e5, #7c3aed)",transition:"width 0.5s ease"}})})]}),(0,u.jsx)("div",{className:"modern-floating-actions",children:(0,u.jsxs)(ge.A.Group,{trigger:"hover",type:"primary",style:{right:24},icon:(0,u.jsx)(Y.A,{}),children:[(0,u.jsx)(ge.A,{icon:(0,u.jsx)(h.A,{}),tooltip:"Save Draft",onClick:()=>He()}),(0,u.jsx)(ge.A,{icon:(0,u.jsx)(ee.A,{}),tooltip:"Summary",onClick:()=>{const e=_e.map((e,t)=>{const a=at(t),l=U.filter(e=>e.stepNumber===t);return{step:t+1,title:e.title,completed:a.requiredCompleted,required:a.required,percentage:a.required>0?Math.round(a.requiredCompleted/a.required*100):100,openQueries:l.filter(e=>"OPEN"===e.status).length,resolvedQueries:l.filter(e=>"RESOLVED"===e.status).length}});r.A.info({title:"Questionnaire Summary",width:600,content:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{marginBottom:16},children:(0,u.jsxs)(Re,{strong:!0,children:["Overall Progress: ",Ye(),"%"]})}),e.map(e=>(0,u.jsxs)("div",{style:{marginBottom:12,padding:"12px 16px",background:100===e.percentage?"linear-gradient(135deg, #f0fdf4, #dcfce7)":"linear-gradient(135deg, #fffbeb, #fef3c7)",border:"1px solid "+(100===e.percentage?"#bbf7d0":"#fde68a"),borderRadius:"8px"},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)(Re,{strong:!0,children:["Step ",e.step,": ",e.title]}),(0,u.jsxs)(v.A,{color:100===e.percentage?"green":"orange",children:[e.percentage,"%"]})]}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:[e.completed,"/",e.required," required fields completed",e.openQueries>0&&(0,u.jsxs)("span",{style:{color:"#ef4444",marginLeft:8},children:["\u2022 ",e.openQueries," open queries"]}),e.resolvedQueries>0&&(0,u.jsxs)("span",{style:{color:"#10b981",marginLeft:8},children:["\u2022 ",e.resolvedQueries," resolved queries"]})]})]},e.step))]})})}}),(0,u.jsx)(ge.A,{icon:ve?(0,u.jsx)(se.A,{}):(0,u.jsx)(X.A,{}),tooltip:ve?"Auto-save ON":"Auto-save OFF",onClick:()=>Ae(!ve)})]})}),(0,u.jsx)(Te,{open:R,onCancel:()=>{M(!1),L(null)},onSubmit:e=>{M(!1),L(null),tt(),o.Ay.success("Query raised successfully")},workflowId:t,fieldContext:O})]})};var Le=a(5423),Ue=a(3719),$e=a(7258);var We=a(5123),Be=a(5475);var Qe=a(9799),Ve=a(8348);const{Title:Ge}=l.A,{Option:Ye}=s.A,He=()=>{const[e,t]=(0,d.useState)(null),[a,l]=(0,d.useState)(!1),[c,m]=(0,d.useState)(null),[h,g]=(0,d.useState)(null),[f,y]=(0,d.useState)([]),{isPlantUser:x,isAdmin:v,userPlants:A,primaryPlant:b,filterByPlantAccess:C}=(0,We.hm)(),{workflows:j,loading:w,error:P,dashboardStats:k,refreshWorkflows:q}=((e,t)=>{const[a,l]=(0,d.useState)([]),[s,n]=(0,d.useState)(!0),[i,r]=(0,d.useState)(null),[c,u]=(0,d.useState)({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),p=(0,d.useCallback)(()=>{const e=localStorage.getItem("userPlant"),t=localStorage.getItem("username");return console.log("Plant detection:",{storedPlant:e,storedUser:t,localStorage:Object.keys(localStorage)}),e||"1102"},[]),m=(0,d.useCallback)(async t=>{try{n(!0),r(null);const o=e||p();if(!o)return console.warn("No plant code available for loading workflows"),l([]),void u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0});let i;console.log("Loading workflows for plant:",o);let d=[];try{i=await ye.S.getPlantDashboardData(o,{signal:t}),console.log("Received dashboard data:",i),d=i.workflows.filter(e=>e.plantCode===o).map(e=>{const t=(0,$e.EO)(e,e.plantInputs);let a;return a=e.isSubmitted?"SUBMITTED":100===t.completionPercentage?"COMPLETED":t.completionPercentage>0?"IN_PROGRESS":"DRAFT",{id:e.workflowId,materialCode:e.materialCode,plantCode:e.plantCode,currentState:e.isSubmitted?z.Fv.COMPLETED:z.sB.PLANT_PENDING,completionStatus:a,completionPercentage:t.completionPercentage,totalFields:t.totalFields,completedFields:t.completedFields,requiredFields:e.requiredFields||0,completedRequiredFields:e.completedRequiredFields||0,lastModified:e.lastModified,submittedAt:e.submittedAt,submittedBy:e.submittedBy,isSubmitted:e.isSubmitted,isCompleted:e.isCompleted,openQueries:e.openQueries||0,assignedPlant:e.plantCode,materialName:e.materialName,itemDescription:e.itemDescription}})}catch(a){console.warn("Failed to load plant-specific data, falling back to regular workflows:",a);try{const e=await ye.S.getWorkflowsByPlant(o,{signal:t});console.log("Fallback: Loaded plant workflows:",e);const{totalUserEditableFields:a}=(0,$e.Jl)();d=e.filter(e=>(e.plantCode||e.assignedPlant)===o).map(e=>{var t;const l=e.plantInputs||(null===(t=e.plantData)||void 0===t?void 0:t.plantInputs)||{},{completionPercentage:s,completedFields:o}=(0,$e.L$)(l);let n;const i=e.isSubmitted||e.submittedAt;return n=i?"SUBMITTED":100===s?"COMPLETED":s>0?"IN_PROGRESS":"DRAFT",{id:e.id,materialCode:e.materialCode,plantCode:e.plantCode||e.assignedPlant,currentState:e.currentState||e.state,completionStatus:n,completionPercentage:s,totalFields:a,completedFields:o,requiredFields:50,completedRequiredFields:0,lastModified:e.lastModified,submittedAt:e.submittedAt||null,submittedBy:e.submittedBy||null,isSubmitted:i,isCompleted:e.isCompleted||!1,openQueries:e.openQueries||0,assignedPlant:e.plantCode||e.assignedPlant,materialName:e.materialName,itemDescription:e.itemDescription}}),console.log("Fallback: Processed workflows:",d)}catch(s){console.error("Fallback also failed:",s),d=[]}i={totalWorkflows:d.length,completedCount:0,inProgressCount:0,draftCount:d.length,averageCompletion:0}}l(d),u({totalWorkflows:i.totalWorkflows||0,completedCount:i.completedCount||0,inProgressCount:i.inProgressCount||0,draftCount:i.draftCount||0,averageCompletion:i.averageCompletion||0,completedToday:0})}catch(i){console.error("Failed to load plant workflows:",i),r(i.message),o.Ay.error("Failed to load workflows"),l([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0})}finally{n(!1)}},[e,p]),h=(0,d.useCallback)(async()=>{const e=new AbortController;await m(e.signal)},[m]);return(0,d.useEffect)(()=>{const a=new AbortController;return(async()=>{if(t&&e)try{await m(a.signal)}catch(i){a.signal.aborted||console.error("Error loading plant workflows:",i)}else l([]),u({totalWorkflows:0,completedCount:0,inProgressCount:0,draftCount:0,averageCompletion:0,completedToday:0}),n(!1)})(),()=>{a.abort()}},[t,e,m]),{workflows:a,loading:s,error:i,dashboardStats:c,loadPlantWorkflows:m,refreshWorkflows:h}})(c,h),{filteredWorkflows:I,searchText:N,statusFilter:_,completionFilter:E,updateSearchText:T,updateStatusFilter:F,updateCompletionFilter:R,clearAllFilters:M,applyPreset:O,saveFilters:L,filterPresets:$,filterSummary:W}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const[t,a]=(0,Be.ok)(),[l,s]=(0,d.useState)(t.get("search")||""),[o,n]=(0,d.useState)(t.get("status")||"all"),[i,r]=(0,d.useState)(t.get("completion")||"all"),c=(0,d.useMemo)(()=>{let t=[...e];if(l){const e=l.toLowerCase();t=t.filter(t=>{var a,l,s,o;return(null===(a=t.materialCode)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(l=t.plantCode)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(s=t.materialName)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(o=t.itemDescription)||void 0===o?void 0:o.toLowerCase().includes(e))})}return"all"!==o&&(t=t.filter(e=>e.completionStatus===o)),"all"!==i&&(i===z.lX.COMPLETED?t=t.filter(e=>100===e.completionPercentage):i===z.lX.IN_PROGRESS?t=t.filter(e=>e.completionPercentage>0&&e.completionPercentage<100):i===z.lX.NOT_STARTED&&(t=t.filter(e=>0===e.completionPercentage))),t},[e,l,o,i]),u=(0,d.useCallback)(e=>{s(e)},[]),p=(0,d.useCallback)(e=>{n(e)},[]),m=(0,d.useCallback)(e=>{r(e)},[]),h=(0,d.useCallback)(()=>{s(""),n("all"),r("all")},[]),g=(0,d.useCallback)(e=>{void 0!==e.searchText&&s(e.searchText),void 0!==e.statusFilter&&n(e.statusFilter),void 0!==e.completionFilter&&r(e.completionFilter)},[]),f=(0,d.useMemo)(()=>[{name:"All Workflows",filters:{searchText:"",statusFilter:"all",completionFilter:"all"}},{name:"In Progress",filters:{searchText:"",statusFilter:"IN_PROGRESS",completionFilter:"in-progress"}},{name:"Completed",filters:{searchText:"",statusFilter:"COMPLETED",completionFilter:"completed"}},{name:"Not Started",filters:{searchText:"",statusFilter:"DRAFT",completionFilter:"not-started"}},{name:"Overdue",filters:{searchText:"",statusFilter:"all",completionFilter:"all"}}],[]),y=(0,d.useCallback)(e=>{const t=f.find(t=>t.name===e);t&&g(t.filters)},[f,g]),x=(0,d.useMemo)(()=>{const t=[];return l&&t.push(`Search: "${l}"`),"all"!==o&&t.push(`Status: ${o.replace("_"," ")}`),"all"!==i&&t.push(`Completion: ${i.replace("-"," ")}`),{activeFilters:t,hasActiveFilters:t.length>0,totalFiltered:c.length,totalOriginal:e.length}},[l,o,i,c.length,e.length]),v=(0,d.useCallback)(()=>{const e={searchText:l,statusFilter:o,completionFilter:i};localStorage.setItem("workflowFilters",JSON.stringify(e))},[l,o,i]),A=(0,d.useCallback)(()=>{try{const e=localStorage.getItem("workflowFilters");if(e){const t=JSON.parse(e);g(t)}}catch(P){console.warn("Failed to load saved filters:",P)}},[g]);return(0,d.useEffect)(()=>{const e=new URLSearchParams;l&&e.set("search",l),"all"!==o&&e.set("status",o),"all"!==i&&e.set("completion",i),a(e,{replace:!0})},[l,o,i,a]),{searchText:l,statusFilter:o,completionFilter:i,filteredWorkflows:c,updateSearchText:u,updateStatusFilter:p,updateCompletionFilter:m,clearAllFilters:h,applyFilters:g,filterPresets:f,applyPreset:y,saveFilters:v,loadSavedFilters:A,filterSummary:x}}(j);(0,d.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await B(e.signal)}catch(P){e.signal.aborted||console.error("Error loading user plant data:",P)}})(),()=>{e.abort()}},[]);const B=async e=>{try{if(!(0,Ue.wR)())return console.warn("User is not authenticated"),void o.Ay.error("You are not logged in. Please log in to access the plant dashboard.");const t=(0,Ue.HW)();if(!t)return console.warn("No current user found"),void o.Ay.error("Unable to identify current user. Please log in again.");console.log("Loading plant data for user:",t);const[a,l]=await Promise.all([Ve.E.getUserPlantAssignments(t,{signal:e}),Qe.B.getAllLocations({signal:e})]);console.log("User plant data received:",a),console.log("Assigned plants:",null===a||void 0===a?void 0:a.assignedPlants),console.log("Primary plant:",null===a||void 0===a?void 0:a.primaryPlant),g(a);const s=a.primaryPlant||a.assignedPlants&&a.assignedPlants[0];if(s&&a.assignedPlants&&a.assignedPlants.includes(s))m(s),localStorage.setItem("userPlant",s),console.log("Set current plant to primary/effective plant:",s);else if(a.assignedPlants&&a.assignedPlants.length>0){const e=a.assignedPlants[0];m(e),localStorage.setItem("userPlant",e),console.log("Set current plant to first assigned plant:",e)}if(a.assignedPlants&&a.assignedPlants.length>0){const e=a.assignedPlants.map(e=>{const t=l.find(t=>t.locationCode===e),s=e===a.primaryPlant;return{value:e,label:t?`${e} - ${t.description}${s?" (Primary)":""}`:`${e}${s?" (Primary)":""}`}});y(e),console.log("Available plants set:",e)}}catch(P){console.error("Failed to load user plant data:",P),g({assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}),y([]),m(null),o.Ay.error("Unable to load plant assignments. Please contact administrator to assign plants to your user.")}},Q=(0,d.useCallback)(e=>{!h||h.assignedPlants.includes(e)?(localStorage.setItem("userPlant",e),m(e),o.Ay.success(`Switched to plant: ${e}`)):o.Ay.error(`You are not assigned to plant: ${e}`)},[h]),V=(0,d.useCallback)(e=>{t(e),l(!0)},[]),G=(0,d.useCallback)(e=>{l(!1),t(null),q(),o.Ay.success("Questionnaire completed successfully!")},[q]),Y=(0,d.useCallback)(e=>{o.Ay.success("Draft saved successfully")},[]);return(0,Ue.wR)()?null===h?(0,u.jsx)(Le.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ge,{level:3,children:"Loading Plant Assignments..."}),(0,u.jsx)("p",{children:"Please wait while we load your plant assignments."})]})}):!h||h.assignedPlants&&0!==h.assignedPlants.length?(0,u.jsx)(Le.yE,{children:(0,u.jsx)(p,{plantCode:c,children:(0,u.jsxs)("div",{style:{padding:24},children:[(0,u.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[(0,u.jsx)(Ge,{level:2,style:{margin:0},children:"Plant Dashboard"}),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)("span",{style:{fontSize:"14px",fontWeight:"500"},children:"Plant:"}),(0,u.jsx)(s.A,{value:c,onChange:Q,style:{width:250},size:"small",disabled:!h||f.length<=1,showSearch:!0,filterOption:(e,t)=>{var a;return null===t||void 0===t||null===(a=t.children)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase())},placeholder:"Select assigned plant",children:f.map(e=>(0,u.jsx)(Ye,{value:e.value,children:e.label},e.value))})]}),(0,u.jsx)(i.A,{children:(0,u.jsx)(n.Ay,{onClick:q,loading:w,children:"Refresh Data"})})]})]}),c?(0,u.jsx)(D,{dashboardStats:k,loading:w,error:P,currentPlant:c,onRefresh:q}):(0,u.jsxs)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:[(0,u.jsx)(Ge,{level:4,children:"Select a Plant"}),(0,u.jsx)("p",{children:"Please select a plant from the dropdown above to view the dashboard and assigned materials."})]}),c&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(S,{searchText:N,statusFilter:_,completionFilter:E,onSearchTextChange:T,onStatusFilterChange:F,onCompletionFilterChange:R,onClearFilters:M,onApplyPreset:O,onSaveFilters:L,filterPresets:$,filterSummary:W}),(0,u.jsx)(U,{workflows:I,loading:w,onStartQuestionnaire:V,onRefresh:q})]}),(0,u.jsx)(r.A,{title:`Material Questionnaire - ${null===e||void 0===e?void 0:e.materialCode}`,open:a,onCancel:()=>{l(!1),t(null)},footer:null,width:"95%",style:{top:20},destroyOnClose:!0,children:e&&(0,u.jsx)(ze,{workflowId:e.id,onComplete:G,onSaveDraft:Y})})]})})}):(0,u.jsx)(Le.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ge,{level:3,children:"No Plant Assignments"}),(0,u.jsx)("p",{children:"You are not assigned to any plants. Please contact your administrator to assign plants to your user account."}),(0,u.jsxs)("div",{style:{marginTop:16,padding:16,background:"#f5f5f5",borderRadius:4},children:[(0,u.jsx)("p",{children:(0,u.jsx)("strong",{children:"Debug Info:"})}),(0,u.jsxs)("p",{children:["Current User: ",(0,Ue.HW)()]}),(0,u.jsxs)("p",{children:["Is Authenticated: ",(0,Ue.wR)().toString()]}),(0,u.jsxs)("p",{children:["User Plant Data: ",JSON.stringify(h,null,2)]}),(0,u.jsxs)(i.A,{children:[(0,u.jsx)(n.Ay,{onClick:()=>{console.log("Current user:",(0,Ue.HW)()),console.log("User plant data:",h),console.log("Available plants:",f),B()},children:"Debug & Retry"}),(0,u.jsx)(n.Ay,{type:"primary",onClick:async()=>{try{const e=(0,Ue.HW)();if(!e)return void o.Ay.error("No current user found");const t="1102",a=[t];await Ve.E.updateUserPlantAssignments(e,{assignedPlants:a,primaryPlant:t}),o.Ay.success("Plant assignments fixed! Please refresh the page or log out and log back in."),await B()}catch(P){console.error("Failed to assign plants:",P),403===P.status?o.Ay.error("You need admin permissions to assign plants. Please ask an administrator to assign plants to your user account."):o.Ay.error(`Failed to assign plants: ${P.message}`)}},children:"Fix Plant Assignments (Admin Required)"}),(0,u.jsx)(n.Ay,{onClick:()=>{o.Ay.info("Logging out to refresh token..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/qrmfg/login"},children:"Logout & Re-login"})]})]})]})}):(0,u.jsx)(Le.yE,{children:(0,u.jsxs)("div",{style:{padding:24,textAlign:"center"},children:[(0,u.jsx)(Ge,{level:3,children:"Authentication Required"}),(0,u.jsx)("p",{children:"You need to be logged in to access the plant dashboard."}),(0,u.jsx)(n.Ay,{type:"primary",onClick:()=>window.location.href="/qrmfg/login",children:"Go to Login"})]})})}},5123:(e,t,a)=>{a.d(t,{hm:()=>n});var l=a(5043),s=a(3719),o=a(4642);const n=()=>{const[e,t]=(0,l.useState)(null),[a,n]=(0,l.useState)(!0),[i,r]=(0,l.useState)(null),d=(0,l.useCallback)(async()=>{if(!(0,s.wR)())return t(null),void n(!1);try{n(!0),r(null);const e=await o.A.getUserAccessSummary();t(e)}catch(e){console.warn("Failed to load access summary, using fallback:",e),r(e);const a=o.A.getFallbackAccessSummary();t(a)}finally{n(!1)}},[]);(0,l.useEffect)(()=>{d()},[d]);const c=(0,l.useCallback)(async e=>{try{return await o.A.hasScreenAccess(e)}catch(i){return console.warn("Screen access check failed, using fallback:",i),o.A.getFallbackScreenAccess(e)}},[]),u=(0,l.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await o.A.hasDataAccess(e,t)}catch(i){return console.warn("Data access check failed, using fallback:",i),o.A.getFallbackDataAccess(e,t)}},[]),p=(0,l.useCallback)(async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await o.A.hasPlantDataAccess(e,t,a)}catch(i){return console.warn("Plant data access check failed, using fallback:",i),o.A.getFallbackPlantDataAccess(e,t,a)}},[]),m=(0,l.useCallback)(async function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{return await o.A.makeAccessDecision(e,t,a,l)}catch(i){return console.warn("Access decision failed, using fallback:",i),o.A.getFallbackAccessDecision(e,t,a,l)}},[]),h=(0,l.useCallback)((e,t)=>o.A.filterDataByPlantAccess(e,t),[]);return{loading:a,error:i,isAuthenticated:(0,s.wR)(),currentUser:(0,s.HW)(),primaryRole:(0,s.Jv)(),userPlants:(0,s.nT)(),primaryPlant:(0,s.bN)(),isAdmin:(0,s.qc)(),isJvcUser:(0,s.bV)(),isCqsUser:(0,s.po)(),isTechUser:(0,s.C9)(),isPlantUser:(0,s.X9)(),isViewer:(0,s.Z$)(),accessSummary:e,hasRole:e=>(0,s.hf)(e),hasAnyRole:e=>e.some(e=>(0,s.hf)(e)),hasAllRoles:e=>e.every(e=>(0,s.hf)(e)),checkScreenAccess:c,checkDataAccess:u,checkPlantDataAccess:p,makeAccessDecision:m,filterByPlantAccess:h,refresh:d}}},6274:(e,t,a)=>{a.d(t,{Ay:()=>h,eS:()=>c,lE:()=>m,wS:()=>u});var l=a(9098),s=a(5444),o=a(6569),n=a(5043),i=a(599),r=a(579);const{TextArea:d}=s.A,c=n.memo(e=>{let{value:t,onChange:a,validationType:l="text",componentName:d="SecureInput",fieldName:c="input",onValidationChange:u,...p}=e;const{validateInput:m}=(0,i.j8)(),[h,g]=(0,n.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,n.useCallback)(e=>{const t=e.target.value,s=m(t,l);g(s),s.wasModified&&(i.qp.logXSSAttempt(t,s.sanitizedValue,d,c),o.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:s.sanitizedValue}}),u&&u(s)},[a,l,d,c,u,m]);return(0,r.jsx)(s.A,{...p,value:t,onChange:f,status:h.isValid?"":"error",title:h.errors.join(", ")})}),u=n.memo(e=>{let{value:t,onChange:a,validationType:l="richtext",componentName:s="SecureTextArea",fieldName:c="textarea",onValidationChange:u,...p}=e;const{validateInput:m}=(0,i.j8)(),[h,g]=(0,n.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,n.useCallback)(e=>{const t=e.target.value,n=m(t,l);g(n),n.wasModified&&(i.qp.logXSSAttempt(t,n.sanitizedValue,s,c),o.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:n.sanitizedValue}}),u&&u(n)},[a,l,s,c,u,m]);return(0,r.jsx)(d,{...p,value:t,onChange:f,status:h.isValid?"":"error",title:h.errors.join(", ")})}),p=n.memo(e=>{let{children:t,onFinish:a,componentName:s="SecureForm",enableSecurityLogging:d=!0,...c}=e;const[u,p]=(0,n.useState)([]),m=(0,n.useCallback)(async e=>{try{const t={},l=[];Object.keys(e).forEach(a=>{const s=e[a];if("string"===typeof s){const e=i.SR.sanitizeText(s);t[a]=e,e!==s&&l.push({field:a,originalValue:s.substring(0,50),sanitizedValue:e.substring(0,50)})}else t[a]=s}),l.length>0&&d&&(l.forEach(e=>{i.qp.logXSSAttempt(e.originalValue,e.sanitizedValue,s,e.field)}),o.Ay.warning(`${l.length} field(s) were sanitized for security`)),a&&await a(t)}catch(t){throw console.error("SecureForm submission error:",t),o.Ay.error("Form submission failed"),t}},[a,s,d]);return(0,n.useEffect)(()=>{if(d){const e=i.qp.getRecentEvents();p(e.slice(-10))}},[d]),(0,r.jsxs)(l.A,{...c,onFinish:m,validateTrigger:["onChange","onBlur"],children:[t,!1]})}),m=n.memo(e=>{let{children:t,validationType:a="text",name:s,rules:o=[],...d}=e;const c=n.useMemo(()=>{let e=[];switch(a){case"username":e=i.PT.username;break;case"email":e=i.PT.email;break;case"password":e=i.PT.password;break;case"projectCode":e=i.PT.projectCode;break;case"materialCode":e=i.PT.materialCode;break;case"plantCode":e=i.PT.plantCode;break;case"text":e=i.PT.text(!1,0,255);break;case"richtext":e=i.PT.richText(!1,0,1e3);break;default:e=[]}return[...e,...o]},[a,o]);return(0,r.jsx)(l.A.Item,{...d,name:s,rules:c,children:t})});c.displayName="SecureInput",u.displayName="SecureTextArea",p.displayName="SecureForm",m.displayName="SecureFormItem";const h=p},7258:(e,t,a)=>{a.d(t,{EO:()=>o,Jl:()=>s,L$:()=>l});const l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};let t=0,a=0;((arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||[{title:"General",fields:[{name:"msds_available",isCqsAutoPopulated:!1},{name:"missing_info",isCqsAutoPopulated:!1},{name:"sourcing_asked",isCqsAutoPopulated:!1},{name:"cas_available",isCqsAutoPopulated:!1},{name:"mixture_ingredients",isCqsAutoPopulated:!1},{name:"composition_percentage",isCqsAutoPopulated:!1},{name:"total_percentage_1",isCqsAutoPopulated:!1},{name:"total_percentage",isCqsAutoPopulated:!1}]},{title:"Physical",fields:[{name:"is_corrosive",isCqsAutoPopulated:!0},{name:"corrosive_storage",isCqsAutoPopulated:!1},{name:"highly_toxic",isCqsAutoPopulated:!0},{name:"toxic_powder_handling",isCqsAutoPopulated:!1},{name:"crushing_facilities",isCqsAutoPopulated:!1},{name:"heating_facilities",isCqsAutoPopulated:!1},{name:"paste_preparation",isCqsAutoPopulated:!1}]},{title:"Flammability and Explosivity",fields:[{name:"flash_point_65",isCqsAutoPopulated:!0},{name:"petroleum_class",isCqsAutoPopulated:!0},{name:"storage_license",isCqsAutoPopulated:!1},{name:"ccoe_license",isCqsAutoPopulated:!1},{name:"flash_point_21",isCqsAutoPopulated:!0},{name:"flammable_infrastructure",isCqsAutoPopulated:!1}]},{title:"Toxicity",fields:[{name:"ld50_oral",isCqsAutoPopulated:!0},{name:"ld50_dermal",isCqsAutoPopulated:!0},{name:"lc50_inhalation",isCqsAutoPopulated:!0},{name:"exposure_minimization",isCqsAutoPopulated:!1},{name:"carcinogenic",isCqsAutoPopulated:!0},{name:"carcinogenic_control",isCqsAutoPopulated:!1}]},{title:"Storage and Handling",fields:[{name:"storage_conditions_stores",isCqsAutoPopulated:!1},{name:"storage_conditions_floor",isCqsAutoPopulated:!1},{name:"closed_loop_required",isCqsAutoPopulated:!1},{name:"work_permit_available",isCqsAutoPopulated:!1},{name:"procedures_details",isCqsAutoPopulated:!1}]},{title:"PPE",fields:[{name:"recommended_ppe",isCqsAutoPopulated:!0},{name:"ppe_in_use",isCqsAutoPopulated:!1},{name:"ppe_procurement_date",isCqsAutoPopulated:!1}]},{title:"First Aid",fields:[{name:"is_poisonous",isCqsAutoPopulated:!0},{name:"antidote_specified",isCqsAutoPopulated:!0},{name:"antidote_available",isCqsAutoPopulated:!1},{name:"antidote_source",isCqsAutoPopulated:!1},{name:"first_aid_capability",isCqsAutoPopulated:!1}]},{title:"Statutory",fields:[{name:"cmvr_listed",isCqsAutoPopulated:!0},{name:"msihc_listed",isCqsAutoPopulated:!0},{name:"factories_act_listed",isCqsAutoPopulated:!0},{name:"permissible_concentration",isCqsAutoPopulated:!1},{name:"monitoring_details",isCqsAutoPopulated:!1}]},{title:"Others",fields:[{name:"plant_inputs_required",isCqsAutoPopulated:!1},{name:"gaps_identified",isCqsAutoPopulated:!1},{name:"additional_input_1",isCqsAutoPopulated:!1},{name:"additional_input_2",isCqsAutoPopulated:!1}]}]).forEach(l=>{const s=(l.fields||[]).filter(e=>!e.isCqsAutoPopulated&&!e.disabled);t+=s.length;const o=s.filter(t=>{const a=e[t.name];return Array.isArray(a)?a.length>0:a&&""!==a&&null!==a&&void 0!==a});a+=o.length});const l=t>0?Math.round(a/t*100):0;return{totalUserEditableFields:t,completedUserEditableFields:a,completionPercentage:l}},s=function(){let e=0,t=0,a=0;return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||[{title:"General",fields:[{name:"msds_available",isCqsAutoPopulated:!1},{name:"missing_info",isCqsAutoPopulated:!1},{name:"sourcing_asked",isCqsAutoPopulated:!1},{name:"cas_available",isCqsAutoPopulated:!1},{name:"mixture_ingredients",isCqsAutoPopulated:!1},{name:"composition_percentage",isCqsAutoPopulated:!1},{name:"total_percentage_1",isCqsAutoPopulated:!1},{name:"total_percentage",isCqsAutoPopulated:!1}]},{title:"Physical",fields:[{name:"is_corrosive",isCqsAutoPopulated:!0},{name:"corrosive_storage",isCqsAutoPopulated:!1},{name:"highly_toxic",isCqsAutoPopulated:!0},{name:"toxic_powder_handling",isCqsAutoPopulated:!1},{name:"crushing_facilities",isCqsAutoPopulated:!1},{name:"heating_facilities",isCqsAutoPopulated:!1},{name:"paste_preparation",isCqsAutoPopulated:!1}]},{title:"Flammability and Explosivity",fields:[{name:"flash_point_65",isCqsAutoPopulated:!0},{name:"petroleum_class",isCqsAutoPopulated:!0},{name:"storage_license",isCqsAutoPopulated:!1},{name:"ccoe_license",isCqsAutoPopulated:!1},{name:"flash_point_21",isCqsAutoPopulated:!0},{name:"flammable_infrastructure",isCqsAutoPopulated:!1}]},{title:"Toxicity",fields:[{name:"ld50_oral",isCqsAutoPopulated:!0},{name:"ld50_dermal",isCqsAutoPopulated:!0},{name:"lc50_inhalation",isCqsAutoPopulated:!0},{name:"exposure_minimization",isCqsAutoPopulated:!1},{name:"carcinogenic",isCqsAutoPopulated:!0},{name:"carcinogenic_control",isCqsAutoPopulated:!1}]},{title:"Storage and Handling",fields:[{name:"storage_conditions_stores",isCqsAutoPopulated:!1},{name:"storage_conditions_floor",isCqsAutoPopulated:!1},{name:"closed_loop_required",isCqsAutoPopulated:!1},{name:"work_permit_available",isCqsAutoPopulated:!1},{name:"procedures_details",isCqsAutoPopulated:!1}]},{title:"PPE",fields:[{name:"recommended_ppe",isCqsAutoPopulated:!0},{name:"ppe_in_use",isCqsAutoPopulated:!1},{name:"ppe_procurement_date",isCqsAutoPopulated:!1}]},{title:"First Aid",fields:[{name:"is_poisonous",isCqsAutoPopulated:!0},{name:"antidote_specified",isCqsAutoPopulated:!0},{name:"antidote_available",isCqsAutoPopulated:!1},{name:"antidote_source",isCqsAutoPopulated:!1},{name:"first_aid_capability",isCqsAutoPopulated:!1}]},{title:"Statutory",fields:[{name:"cmvr_listed",isCqsAutoPopulated:!0},{name:"msihc_listed",isCqsAutoPopulated:!0},{name:"factories_act_listed",isCqsAutoPopulated:!0},{name:"permissible_concentration",isCqsAutoPopulated:!1},{name:"monitoring_details",isCqsAutoPopulated:!1}]},{title:"Others",fields:[{name:"plant_inputs_required",isCqsAutoPopulated:!1},{name:"gaps_identified",isCqsAutoPopulated:!1},{name:"additional_input_1",isCqsAutoPopulated:!1},{name:"additional_input_2",isCqsAutoPopulated:!1}]}]).forEach(l=>{const s=l.fields||[];e+=s.length,s.forEach(e=>{e.isCqsAutoPopulated||e.disabled?a++:t++})}),{totalFields:e,totalUserEditableFields:t,totalCqsFields:a}},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const{totalUserEditableFields:a,completedUserEditableFields:s,completionPercentage:o}=l(t);return{...e,totalFields:a,completedFields:s,completionPercentage:o}}const{totalUserEditableFields:a}=s(),o=e.completedFields||0,n=a>0?Math.round(o/a*100):0;return{...e,totalFields:a,completionPercentage:n}}},8348:(e,t,a)=>{a.d(t,{E:()=>o});var l=a(6649),s=a(3719);const o={getUserPlantAssignments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(console.log("Getting plant assignments for user:",e),console.log("Is authenticated:",(0,s.wR)()),!(0,s.wR)())return console.warn("User is not authenticated, cannot get plant assignments"),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1};const r=(0,s.gf)();if(console.log("Retrieved token:",r?"Token found":"No token found"),r)try{const e=await l.default.post("/auth/validate",{token:r},t);if(console.log("Token validation response:",e),console.log("Plant codes in token:",e.plantCodes),console.log("Primary plant in token:",e.primaryPlant),console.log("Is plant user:",e.isPlantUser),e.valid){if(e.plantCodes&&e.plantCodes.length>0)return console.log("Plant assignments from token:",e),{assignedPlants:e.plantCodes||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||e.plantCodes&&e.plantCodes[0]||null,isPlantUser:e.isPlantUser||!1};if(e.primaryPlant&&e.isPlantUser)return console.log("User has primary plant but empty plantCodes, using primary plant as assigned plant:",e.primaryPlant),{assignedPlants:[e.primaryPlant],primaryPlant:e.primaryPlant,effectivePlant:e.primaryPlant,isPlantUser:e.isPlantUser||!1};console.log("Token is valid but no plant data found in token")}}catch(o){console.warn("Failed to validate token for plant assignments:",o)}const d=["userData","qrmfg_user_data","user_info"];for(const e of d){const t=localStorage.getItem(e)||sessionStorage.getItem(e);if(t)try{const e=JSON.parse(t);if(e.plantCodes||e.assignedPlants)return console.log("Plant assignments from stored data:",e),{assignedPlants:e.plantCodes||e.assignedPlants||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||(e.plantCodes||e.assignedPlants)&&(e.plantCodes||e.assignedPlants)[0]||null,isPlantUser:e.isPlantUser||!1}}catch(n){console.warn(`Failed to parse stored user data from ${e}:`,n)}}try{const o=(0,s.gf)(),n=await l.default.post("/auth/validate",{token:o},t);if(n.valid&&n.isAdmin){var a;console.log("User appears to be admin, trying admin endpoints...");const s=null===(a=(await l.default.get("/admin/users",t)).users)||void 0===a?void 0:a.find(t=>t.username===e);if(s&&s.assignedPlants)return console.log("Admin endpoint: Using user details for plant assignments:",s),{assignedPlants:s.assignedPlants||[],primaryPlant:s.primaryPlant||null,effectivePlant:s.primaryPlant||s.assignedPlants&&s.assignedPlants[0]||null,isPlantUser:s.assignedPlants&&s.assignedPlants.length>0||!1}}}catch(i){console.warn("Admin endpoints not accessible (expected for non-admin users):",i.message)}return console.warn("No plant assignment data available for user:",e),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}catch(r){return console.error("Error getting user plant assignments:",r),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}},updateUserPlantAssignments:(e,t)=>l.default.put(`/admin/users/${encodeURIComponent(e)}/plants`,t),checkUserPlantAssignment:(e,t)=>l.default.get(`/admin/users/${encodeURIComponent(e)}/plants/${encodeURIComponent(t)}/check`),getUserById:e=>l.default.get(`/admin/users/${e}`),getAllUsers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.default.get("/admin/users",{cacheTTL:3e5,...e})},getAllUsersRealTime:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.default.get("/admin/users",{useCache:!1,...e})}}},9394:(e,t,a)=>{a.d(t,{S:()=>s});var l=a(6649);const s={getDashboardSummary:()=>l.default.get("/dashboard/summary"),getOverdueWorkflows:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return l.default.get(`/workflows/overdue?days=${e}`)},getRecentActivity:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return l.default.get(`/workflows/recent/created?days=${e}`)},getWorkflowCountsByState:()=>l.default.get("/dashboard/counts-by-state"),getWorkflowsByPlant:e=>l.default.get(`/workflows/plant/${encodeURIComponent(e)}`),createWorkflow:e=>l.default.post("/workflows",e),getWorkflow:e=>l.default.get(`/workflows/${e}`),updateWorkflow:(e,t)=>l.default.put(`/workflows/${e}`,t),deleteWorkflow:e=>l.default.delete(`/workflows/${e}`),transitionWorkflowState:(e,t,a)=>l.default.put(`/workflows/${e}/transition`,{newState:t,comment:a}),extendWorkflow:(e,t)=>l.default.put(`/workflows/${e}/extend`,t),completeWorkflow:(e,t)=>l.default.put(`/workflows/${e}/complete`,t),extendToMultiplePlantsSmartly:async e=>{try{const t=await l.default.withRetry(()=>l.default.post("/workflows/extend-to-plants",e),3,1e3);return{...t,documentReuse:t.documentReuse||{totalReusedDocuments:0,reusedDocuments:[],reuseStrategy:"NONE",sourceDescription:"No documents available for reuse"}}}catch(t){throw console.error("[WorkflowAPI] Smart extension failed:",t),{...t,context:"SMART_PLANT_EXTENSION",extensionData:e}}},searchWorkflows:e=>l.default.post("/workflows/search",e),getWorkflowsByState:e=>l.default.get(`/workflows/state/${e}`),getWorkflowsByUser:e=>l.default.get(`/workflows/initiated-by/${encodeURIComponent(e)}`),canTransitionTo:(e,t)=>l.default.get(`/workflows/${e}/can-transition/${t}`),isReadyForCompletion:e=>l.default.get(`/workflows/${e}/ready-for-completion`),checkWorkflowExists:(e,t,a)=>l.default.get(`/workflows/check-exists?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}`),getWorkflowStats:e=>l.default.get(`/workflows/stats?range=${e}`),getCompletionRateByPlant:()=>l.default.get("/workflows/completion-rate-by-plant"),getWorkflowCompletionTrend:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return l.default.get(`/workflows/completion-trend?months=${e}`)},getPendingWorkflows:()=>l.default.get("/workflows/pending"),getWorkflowsWithOpenQueries:()=>l.default.get("/workflows/with-open-queries"),getCountByState:e=>l.default.get(`/workflows/stats/count-by-state/${e}`),getOverdueCount:()=>l.default.get("/workflows/stats/overdue-count"),getWorkflowsWithOpenQueriesCount:()=>l.default.get("/workflows/stats/with-open-queries-count"),getRecentlyCreated:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return l.default.get(`/workflows/recent/created?days=${e}`)},getRecentlyCompleted:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return l.default.get(`/workflows/recent/completed?days=${e}`)},saveDraftResponses:(e,t)=>l.default.post(`/workflows/${e}/draft-responses`,t),getDraftResponses:e=>l.default.get(`/workflows/${e}/draft-responses`),submitQuestionnaire:(e,t)=>l.default.post(`/workflows/${e}/submit-questionnaire`,t),getWorkflowDocuments:e=>l.default.get(`/workflows/${e}/documents`),getAllWorkflowRelatedDocuments:async e=>{try{return await l.default.withRetry(()=>l.default.get(`/workflows/${e}/documents/all`),2,500)}catch(t){throw console.error(`[WorkflowAPI] Failed to get all documents for workflow ${e}:`,t),{...t,context:"GET_ALL_WORKFLOW_DOCUMENTS",workflowId:e}}},exportWorkflowDocuments:async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{return await l.default.withRetry(()=>l.default.download(`/workflows/${e}/documents/export?includeQueryDocuments=${t}`),2,1e3)}catch(a){throw console.error(`[WorkflowAPI] Failed to export documents for workflow ${e}:`,a),{...a,context:"EXPORT_WORKFLOW_DOCUMENTS",workflowId:e,includeQueryDocuments:t}}},searchUnifiedDocuments:async e=>{try{return await l.default.withRetry(()=>l.default.post("/documents/search/unified",e),2,500)}catch(t){throw console.error("[WorkflowAPI] Unified document search failed:",t),{...t,context:"UNIFIED_DOCUMENT_SEARCH",searchParams:e}}},getUnifiedDocumentInfo:async(e,t)=>{try{return await l.default.withRetry(()=>l.default.get(`/documents/unified-info?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get unified document info for ${e}/${t}:`,a),{...a,context:"GET_UNIFIED_DOCUMENT_INFO",projectCode:e,materialCode:t}}},getReusableDocuments:async(e,t)=>{try{return await l.default.withRetry(()=>l.default.get(`/workflows/documents/reusable?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get reusable documents for ${e}/${t}:`,a),{...a,context:"GET_REUSABLE_DOCUMENTS",projectCode:e,materialCode:t}}},downloadDocument:async e=>{try{return await l.default.withRetry(()=>l.default.download(`/workflows/documents/${e}/download`),3,1e3)}catch(t){throw console.error(`[WorkflowAPI] Failed to download document ${e}:`,t),{...t,context:"DOWNLOAD_DOCUMENT",documentId:e}}},uploadDocument:async(e,t,a)=>{try{return await l.default.withRetry(()=>l.default.upload(`/workflows/${e}/documents`,t,{metadata:JSON.stringify(a)}),2,1e3)}catch(s){throw console.error(`[WorkflowAPI] Failed to upload document to workflow ${e}:`,s),{...s,context:"UPLOAD_DOCUMENT",workflowId:e,fileName:(null===t||void 0===t?void 0:t.name)||"unknown"}}},uploadMultipleDocuments:async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=[],o=[];for(const i of t)try{const t=await s.uploadDocument(e,i,a);l.push({file:i.name,result:t,success:!0})}catch(n){console.error(`[WorkflowAPI] Failed to upload ${i.name}:`,n),o.push({file:i.name,error:n,success:!1})}return{successful:l,failed:o,totalFiles:t.length,successCount:l.length,failureCount:o.length}},retryDocumentOperation:async function(e,t){let a,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;for(let n=1;n<=l;n++)try{switch(e){case"UPLOAD":return await s.uploadDocument(t.workflowId,t.file,t.metadata);case"DOWNLOAD":return await s.downloadDocument(t.documentId);case"GET_DOCUMENTS":return await s.getAllWorkflowRelatedDocuments(t.workflowId);default:throw new Error(`Unknown operation type: ${e}`)}}catch(o){if(a=o,console.warn(`[WorkflowAPI] Retry attempt ${n}/${l} failed for ${e}:`,o),n<l){const e=1e3*Math.pow(2,n);await new Promise(t=>setTimeout(t,e))}}throw{...a,context:"RETRY_OPERATION_FAILED",operationType:e,maxRetries:l,finalAttempt:!0}},updateAllMaterialNamesFromProjectItemMaster:()=>l.default.post("/workflows/update-material-names"),updateMaterialNameFromProjectItemMaster:e=>l.default.post(`/workflows/${e}/update-material-name`),getQuestionnaireTemplate:e=>{let{materialCode:t,plantCode:a,templateType:s="PLANT_QUESTIONNAIRE"}=e;return l.default.get(`/plant-questionnaire/template?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}&templateType=${encodeURIComponent(s)}`)},getCqsData:e=>{let{materialCode:t,plantCode:a}=e;return l.default.get(`/plant-questionnaire/cqs-data?materialCode=${encodeURIComponent(t)}&plantCode=${encodeURIComponent(a)}`)},getPlantSpecificData:e=>{let{plantCode:t,materialCode:a}=e;return l.default.get(`/plant-questionnaire/plant-data?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(a)}`)},getOrCreatePlantSpecificData:e=>{let{plantCode:t,materialCode:a,workflowId:s}=e;return l.default.post(`/plant-questionnaire/plant-data/init?plantCode=${encodeURIComponent(t)}&materialCode=${encodeURIComponent(a)}&workflowId=${s}`)},savePlantSpecificData:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SYSTEM";return l.default.post(`/plant-questionnaire/plant-data/save?modifiedBy=${encodeURIComponent(t)}`,e)},saveDraftPlantResponses:(e,t)=>l.default.post(`/plant-questionnaire/draft?workflowId=${e}`,t),submitPlantQuestionnaire:(e,t)=>l.default.post(`/plant-questionnaire/submit?workflowId=${e}`,t),getPlantQuestionnaireStats:e=>{let{plantCode:t,materialCode:a}=e;const s=new URLSearchParams({plantCode:t});return a&&s.append("materialCode",a),l.default.get(`/plant-questionnaire/stats?${s.toString()}`)},getPlantDashboardData:e=>l.default.get(`/plant-questionnaire/dashboard?plantCode=${encodeURIComponent(e)}`),initializeSamplePlantData:e=>l.default.post(`/plant-questionnaire/init-sample-data?plantCode=${encodeURIComponent(e)}`),getDocumentReuseStats:async(e,t)=>{try{return await l.default.withRetry(()=>l.default.get(`/workflows/documents/reuse-stats?projectCode=${encodeURIComponent(e)}&materialCode=${encodeURIComponent(t)}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get document reuse stats for ${e}/${t}:`,a),{...a,context:"GET_DOCUMENT_REUSE_STATS",projectCode:e,materialCode:t}}},validateDocumentReuse:async(e,t,a)=>{try{return await l.default.withRetry(()=>l.default.post("/workflows/documents/validate-reuse",{projectCode:e,materialCode:t,plantCodes:a}),2,500)}catch(s){throw console.error(`[WorkflowAPI] Failed to validate document reuse for ${e}/${t}:`,s),{...s,context:"VALIDATE_DOCUMENT_REUSE",projectCode:e,materialCode:t,plantCodes:a}}},getDocumentAuditLog:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const a=new URLSearchParams(t).toString();return await l.default.withRetry(()=>l.default.get(`/workflows/${e}/documents/audit-log?${a}`),2,500)}catch(a){throw console.error(`[WorkflowAPI] Failed to get document audit log for workflow ${e}:`,a),{...a,context:"GET_DOCUMENT_AUDIT_LOG",workflowId:e,options:t}}},handleDocumentError:(e,t)=>{const a={originalError:e,operation:t,timestamp:(new Date).toISOString(),userMessage:"An error occurred with document operation",technicalMessage:e.message,recoveryActions:[],retryable:!1};switch(e.context){case"UPLOAD_DOCUMENT":a.userMessage="Failed to upload document. Please check file size and format.",a.recoveryActions=["Verify file is under 25MB","Check file format is supported (PDF, DOCX, XLSX, JPG, PNG)","Try uploading again","Contact support if problem persists"],a.retryable=!0;break;case"DOWNLOAD_DOCUMENT":a.userMessage="Failed to download document. Please try again.",a.recoveryActions=["Check your internet connection","Try downloading again","Contact support if document is corrupted"],a.retryable=!0;break;case"GET_ALL_WORKFLOW_DOCUMENTS":a.userMessage="Failed to load workflow documents.",a.recoveryActions=["Refresh the page","Check your internet connection","Contact support if problem persists"],a.retryable=!0;break;case"SMART_PLANT_EXTENSION":a.userMessage="Failed to extend workflow to plants. Some documents may not have been reused.",a.recoveryActions=["Check if workflows were created successfully","Manually upload documents if needed","Try the extension again","Contact support for assistance"],a.retryable=!0;break;case"UNIFIED_DOCUMENT_SEARCH":a.userMessage="Document search failed. Please try again.",a.recoveryActions=["Simplify your search terms","Try searching again","Use individual document lists instead"],a.retryable=!0;break;default:"NETWORK"===e.type?(a.userMessage="Network error occurred. Please check your connection.",a.retryable=!0):"TIMEOUT"===e.type?(a.userMessage="Operation timed out. Please try again.",a.retryable=!0):413===e.status?(a.userMessage="File is too large. Please use a smaller file.",a.retryable=!1):415===e.status&&(a.userMessage="File type not supported. Please use PDF, DOCX, XLSX, JPG, or PNG.",a.retryable=!1)}return a}}},9799:(e,t,a)=>{a.d(t,{B:()=>s});var l=a(6649);const s={getAllLocations:async()=>{try{return await l.default.get("/master-data/locations")}catch(e){console.warn("Main locations endpoint failed, trying fallback:",e);try{return await l.default.get("/master-data/locations/fallback")}catch(t){console.warn("Fallback endpoint failed, trying simple endpoint:",t);try{return await l.default.get("/simple-locations")}catch(a){throw console.error("All locations endpoints failed:",a),a}}}},getLocationByCode:e=>l.default.get(`/master-data/locations/${encodeURIComponent(e)}`),searchLocations:e=>l.default.get(`/master-data/locations/search?term=${encodeURIComponent(e)}`),createLocation:e=>l.default.post("/master-data/locations",e),updateLocation:(e,t)=>l.default.put(`/master-data/locations/${encodeURIComponent(e)}`,t),deleteLocation:e=>l.default.delete(`/master-data/locations/${encodeURIComponent(e)}`),getAllProjectItems:()=>l.default.get("/master-data/project-items"),getItemsByProject:e=>l.default.get(`/master-data/project-items/projects/${encodeURIComponent(e)}`),getProjectsByItem:e=>l.default.get(`/master-data/project-items/items/${encodeURIComponent(e)}`),getAllProjectCodes:()=>l.default.get("/master-data/project-codes"),getAllItemCodes:()=>l.default.get("/master-data/item-codes"),getItemCodesByProject:e=>l.default.get(`/master-data/project-codes/${encodeURIComponent(e)}/items`),testLocationMaster:()=>l.default.get("/master-data/locations/test"),testSimpleLocation:()=>l.default.get("/simple-locations/test"),diagnosticLocationMaster:()=>l.default.get("/master-data/locations/diagnostic"),getSimpleLocationCount:()=>l.default.get("/simple-locations/count")}}}]);
//# sourceMappingURL=915.1123f9c2.chunk.js.map