"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[173],{173:(e,t,s)=>{s.d(t,{A:()=>f});s(6833),s(6191);var r=s(5444),l=s(6553),a=s(3927),o=s(9098),i=s(6569),n=(s(6051),s(6399),s(7692),s(5206),s(5043)),d=s(6649),c=(s(2868),s(1780),s(7326));s(579);const{Panel:u}=c.A,{Text:y}=a.A;s(3661);const{Text:x,Title:A}=a.A;s(7933),s(8365);const{TextArea:v}=r.A,{Option:g}=l.A,{Text:h,Title:p}=a.A,f=e=>{let{team:t}=e;const[s,r]=(0,n.useState)(!1),[l,a]=(0,n.useState)([]),[c,u]=(0,n.useState)([]),[y,x]=(0,n.useState)(null),[A,v]=(0,n.useState)(!1),[g]=o.A.useForm(),[h,p]=(0,n.useState)([]),[f,m]=(0,n.useState)(null),[j,T]=(0,n.useState)([]),[S,C]=(0,n.useState)({status:"all",priority:"all",material:"",daysOpen:"all",project:"",plant:"",assignedTeam:"all",hasAttachments:"all"}),[Q,w]=(0,n.useState)({total:0,open:0,resolved:0,resolvedToday:0,overdue:0,avgResolutionTime:0}),b=(0,n.useCallback)(async e=>{try{r(!0);const s=await d.default.get(`/queries/inbox/${t}`,{signal:e});null!==e&&void 0!==e&&e.aborted||a(s)}catch(s){null!==e&&void 0!==e&&e.aborted||(console.error("Failed to load queries:",s),i.Ay.error("Failed to load queries"))}finally{r(!1)}},[t]),k=(0,n.useCallback)(async e=>{try{const[s,r,l,a,o]=await Promise.all([d.default.get(`/queries/stats/count-open/${t}`,{signal:e}).catch(()=>0),d.default.get(`/queries/stats/count-resolved/${t}`,{signal:e}).catch(()=>0),d.default.get(`/queries/stats/resolved-today/${t}`,{signal:e}).catch(()=>0),d.default.get(`/queries/stats/overdue-count/${t}`,{signal:e}).catch(()=>0),d.default.get(`/queries/stats/avg-resolution-time/${t}`,{signal:e}).catch(()=>0)]);null!==e&&void 0!==e&&e.aborted||w({total:s+r,open:s,resolved:r,resolvedToday:l,overdue:a,avgResolutionTime:o})}catch(s){null!==e&&void 0!==e&&e.aborted||console.error("Failed to load stats:",s)}},[t]),L=(0,n.useCallback)(()=>{let e=[...l];if("all"!==S.status&&(e=e.filter(e=>e.status===S.status)),"all"!==S.priority&&(e=e.filter(e=>e.priorityLevel===S.priority)),S.material&&(e=e.filter(e=>{var t,s;return(null===(t=e.materialCode)||void 0===t?void 0:t.toLowerCase().includes(S.material.toLowerCase()))||(null===(s=e.materialName)||void 0===s?void 0:s.toLowerCase().includes(S.material.toLowerCase()))})),S.project&&(e=e.filter(e=>{var t;return null===(t=e.projectCode)||void 0===t?void 0:t.toLowerCase().includes(S.project.toLowerCase())})),S.plant&&(e=e.filter(e=>{var t;return null===(t=e.plantCode)||void 0===t?void 0:t.toLowerCase().includes(S.plant.toLowerCase())})),"all"!==S.assignedTeam&&(e=e.filter(e=>e.assignedTeam===S.assignedTeam)),"all"!==S.daysOpen){const t=parseInt(S.daysOpen);e=e.filter(e=>e.daysOpen>=t)}"all"!==S.hasAttachments&&("with"===S.hasAttachments?e=e.filter(e=>(e.documentCount||0)>0):"without"===S.hasAttachments&&(e=e.filter(e=>0===(e.documentCount||0)))),u(e)},[l,S]);(0,n.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await Promise.all([b(e.signal),k(e.signal)])}catch(t){e.signal.aborted||console.error("Error loading query inbox data:",t)}})(),()=>{e.abort()}},[t,b,k]),(0,n.useEffect)(()=>{L()},[l,S,L]);(0,n.useCallback)(async e=>{try{const t=await d.default.get(`/queries/${e}/documents`);T(t)}catch(t){console.error("Failed to load query documents:",t),T([])}},[])}},8365:(e,t,s)=>{s.d(t,{A:()=>C});var r=s(6237),l=s(119),a=s(3889),o=s(3117),i=s(3722),n=s(5206),d=s(9073),c=s(1645),u=s(9472),y=s(7419),x=s(6051),A=s(1686),v=s(6612),g=s(6399),h=s(6263),p=s(3927),f=s(5043),m=s(6649),j=s(3719),T=s(579);const{Text:S}=p.A,C=e=>{let{queryId:t,materialCode:s,workflowId:p,compact:C=!1}=e;const[Q,w]=(0,f.useState)(!1),[b,k]=(0,f.useState)([]),[L,R]=(0,f.useState)({totalQueries:0,resolvedQueries:0,avgResolutionTime:0,currentSLA:0}),E=(0,f.useCallback)(async()=>{try{w(!0);const e=(0,j.uG)();console.log("QueryHistoryTracker - userRole:",e);let r="/queries";if(t)r+=`/${t}/history`;else if(p)r+=`/workflow/${p}`;else if(s)r+=`/material/${s}`;else if(e){const t={CQS_USER:"CQS",TECH_USER:"TECH",JVC_USER:"JVC"}[e];console.log("QueryHistoryTracker - mapped team:",t),t?r+=`/resolved/${t}`:(console.warn("QueryHistoryTracker - unknown role, using CQS fallback"),r+="/resolved/CQS")}else r+="/resolved/CQS";console.log("QueryHistoryTracker - endpoint:",r);const l=await m.default.get(r);console.log("QueryHistoryTracker - received data:",l),console.log("QueryHistoryTracker - data type:",typeof l),console.log("QueryHistoryTracker - is array:",Array.isArray(l)),console.log("QueryHistoryTracker - data length:",null===l||void 0===l?void 0:l.length);const a=Array.isArray(l)?l:l?[l]:[];console.log("QueryHistoryTracker - setting history:",a),k(a);const o=Array.isArray(l)?l:l?[l]:[],i=o.filter(e=>"RESOLVED"===e.status),n=i.length>0?i.reduce((e,t)=>e+(t.daysOpen||0),0)/i.length:0;console.log("QueryHistoryTracker - stats calculation:",{dataArray:o.length,resolved:i.length,avgTime:n}),R({totalQueries:o.length,resolvedQueries:i.length,avgResolutionTime:n,currentSLA:o.filter(e=>e.daysOpen>3).length})}catch(e){console.error("Failed to load query history:",e)}finally{w(!1)}},[t,s,p]);(0,f.useEffect)(()=>{E()},[t,s,p,E]);return Q?(0,T.jsx)(d.A,{size:"small",children:(0,T.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,T.jsx)(A.A,{size:"small"}),(0,T.jsx)("div",{style:{marginTop:8},children:"Loading query history..."})]})}):C?(0,T.jsx)(d.A,{size:"small",title:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(a.A,{}),(0,T.jsx)("span",{children:t?"Query History":p?"Workflow Queries":s?"Material Queries":"Team History"})]}),style:{marginBottom:16},children:(0,T.jsxs)(y.A,{gutter:16,children:[(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Total",value:L.totalQueries,prefix:(0,T.jsx)(o.A,{})})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Resolved",value:L.resolvedQueries,prefix:(0,T.jsx)(r.A,{}),valueStyle:{color:"#3f8600"}})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Avg Days",value:L.avgResolutionTime,precision:1,prefix:(0,T.jsx)(l.A,{})})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Overdue",value:L.currentSLA,prefix:(0,T.jsx)(l.A,{}),valueStyle:{color:L.currentSLA>0?"#cf1322":"#3f8600"}})})]})}):(0,T.jsxs)(d.A,{title:(0,T.jsxs)(x.A,{children:[(0,T.jsx)(a.A,{}),(0,T.jsx)("span",{children:t?"Query History":p?"Workflow Query History":s?"Material Query History":"Team Resolved Queries"})]}),size:"small",extra:(0,T.jsx)(n.Ay,{size:"small",icon:(0,T.jsx)(a.A,{}),onClick:E,children:"Refresh"}),children:[(0,T.jsxs)(y.A,{gutter:16,style:{marginBottom:16},children:[(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Total Queries",value:L.totalQueries,prefix:(0,T.jsx)(o.A,{})})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Resolved",value:L.resolvedQueries,prefix:(0,T.jsx)(r.A,{}),valueStyle:{color:"#3f8600"}})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Avg Resolution Time",value:L.avgResolutionTime,precision:1,suffix:"days",prefix:(0,T.jsx)(l.A,{})})}),(0,T.jsx)(c.A,{span:6,children:(0,T.jsx)(v.A,{title:"Overdue Queries",value:L.currentSLA,prefix:(0,T.jsx)(l.A,{}),valueStyle:{color:L.currentSLA>0?"#cf1322":"#3f8600"}})})]}),b.length>0?(0,T.jsx)(h.A,{items:b.map(e=>{const t="RESOLVED"===e.status;return{dot:t?(0,T.jsx)(r.A,{style:{color:"#52c41a"}}):(0,T.jsx)(l.A,{style:{color:"#faad14"}}),color:t?"green":"blue",children:(0,T.jsxs)("div",{children:[(0,T.jsx)("div",{style:{marginBottom:8},children:(0,T.jsxs)(x.A,{wrap:!0,children:[(0,T.jsxs)(S,{strong:!0,children:["Query #",e.id]}),(0,T.jsx)(g.A,{color:(o=e.status,"OPEN"===o?"red":"green"),children:e.status}),(0,T.jsx)(g.A,{color:(a=e.assignedTeam,{CQS:"blue",TECH:"purple",JVC:"orange"}[a]||"default"),children:e.assignedTeam}),e.priorityLevel&&(0,T.jsx)(g.A,{color:(s=e.priorityLevel,{LOW:"blue",MEDIUM:"orange",HIGH:"red",URGENT:"purple"}[s]||"default"),children:e.priorityLevel})]})}),(0,T.jsx)("div",{style:{marginBottom:8},children:(0,T.jsx)(S,{children:e.question})}),e.fieldName&&(0,T.jsxs)("div",{style:{marginBottom:4,fontSize:"12px",color:"#666"},children:["Field: ",e.fieldName," ",e.stepNumber&&`(Step ${e.stepNumber})`]}),(0,T.jsx)("div",{style:{fontSize:"12px",color:"#666",marginBottom:8},children:(0,T.jsxs)(x.A,{children:[(0,T.jsxs)("span",{children:[(0,T.jsx)(i.A,{})," Raised by: ",e.raisedBy]}),(0,T.jsxs)("span",{children:[(0,T.jsx)(l.A,{})," ",e.createdAt&&new Date(e.createdAt).toLocaleString()]}),(0,T.jsxs)("span",{children:["Days open: ",e.daysOpen]})]})}),e.response&&(0,T.jsxs)("div",{style:{marginTop:8,padding:8,background:"#f0f9ff",borderRadius:4,borderLeft:"3px solid #1890ff"},children:[(0,T.jsx)("div",{style:{marginBottom:4},children:(0,T.jsx)(S,{strong:!0,children:"Resolution:"})}),(0,T.jsx)("div",{style:{marginBottom:4},children:(0,T.jsx)(S,{children:e.response})}),(0,T.jsxs)("div",{style:{fontSize:"11px",color:"#666"},children:["Resolved by: ",e.resolvedBy," on"," ",e.resolvedAt&&new Date(e.resolvedAt).toLocaleString()]})]})]})};var s,a,o}),mode:"left"}):(0,T.jsx)(u.A,{description:"No query history available",image:u.A.PRESENTED_IMAGE_SIMPLE})]})}}}]);
//# sourceMappingURL=173.dabf678c.chunk.js.map