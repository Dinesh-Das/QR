"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[985],{4985:(e,t,a)=>{a.r(t),a.d(t,{default:()=>H});var n=a(6569),s=a(2261),l=a(5206),r=a(6051),o=a(5043),i=a(4135),d=a(579);class c extends o.Component{constructor(e){super(e),this.reportError=(e,t,a)=>{console.error("UserErrorBoundary caught an error:",{error:e.message,stack:e.stack,errorInfo:t,context:a,timestamp:(new Date).toISOString()})},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onRetry&&this.props.onRetry()},this.handleGoHome=()=>{window.location.href="/qrmfg"},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.reportError(e,t,{level:"component",component:"UserManagement",context:this.props.context||"user-management"})}render(){return this.state.hasError?(0,d.jsx)(i.Ay,{status:"error",title:"User Management Error",subTitle:"Something went wrong while managing users. Please try again or contact support if the problem persists.",extra:[(0,d.jsx)(l.Ay,{type:"primary",onClick:this.handleRetry,children:"Try Again"},"retry"),(0,d.jsx)(l.Ay,{onClick:this.handleGoHome,children:"Go Home"},"home")],style:{padding:"50px 0"},children:!1}):this.props.children}}c.defaultProps={context:"user-management",onRetry:null};const u=c;var m=a(9098),g=a(2751),p=a(5444),y=a(6553),f=a(8348),h=a(599),b=a(6274),P=a(617),A=a(3927),v=a(8354),w=a(9799);const C=()=>{const[e,t]=(0,o.useState)([]),[a,s]=(0,o.useState)(!1),[l,r]=(0,o.useState)(null),i=(0,o.useCallback)(async e=>{s(!0),r(null);try{const a=await w.B.getAllLocations({signal:e});if(null===e||void 0===e||!e.aborted){const e=a.map(e=>({label:`${e.locationCode} - ${e.description}`,value:e.locationCode,key:e.locationCode}));t(e)}}catch(a){if(null===e||void 0===e||!e.aborted){console.error("Failed to fetch plants:",a),r(a.message),n.Ay.warning("Failed to fetch plants from location master, using fallback data");t([{label:"1107 - Manufacturing Unit 1107",value:"1107",key:"1107"},{label:"1106 - Manufacturing Unit 1106",value:"1106",key:"1106"},{label:"1104 - Manufacturing Unit 1104",value:"1104",key:"1104"},{label:"1103 - Manufacturing Unit 1103",value:"1103",key:"1103"},{label:"1102 - Manufacturing Unit 1102",value:"1102",key:"1102"}])}}finally{null!==e&&void 0!==e&&e.aborted||s(!1)}},[]),d=(0,o.useCallback)(t=>{const a=e.find(e=>e.value===t);return a?a.label:t},[e]),c=(0,o.useCallback)((e,t)=>{const a=[];return e&&0!==e.length||a.push("At least one plant must be assigned"),t&&e&&!e.includes(t)&&a.push("Primary plant must be one of the assigned plants"),a},[]),u=(0,o.useCallback)((e,t)=>{var a;return null===t||void 0===t||null===(a=t.label)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase())},[]),m=(0,o.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>!t.includes(e.value))},[e]);(0,o.useEffect)(()=>{const e=new AbortController;return i(e.signal),()=>{e.abort()}},[i]);const g=(0,o.useMemo)(()=>e.map(e=>({...e,disabled:!1})),[e]);return{availablePlants:e,plantsLoading:a,error:l,fetchPlants:i,getPlantDescription:d,validatePlantAssignments:c,filterPlants:u,getAvailablePlantsForAssignment:m,primaryPlantOptions:g}},{Text:k}=A.A,x=o.memo(e=>{var t,a;let{selectedRoles:n,roles:r,form:i,initialValues:c={}}=e;const{availablePlants:u,plantsLoading:g,error:p,fetchPlants:f,filterPlants:h,validatePlantAssignments:b}=C(),A=(0,o.useMemo)(()=>{if(!n||!r)return!1;const e=r.filter(e=>"ROLE_PLANT_USER"===e.name||"PLANT_USER"===e.name).map(e=>e.id);return n.some(t=>e.includes(t))},[n,r]),w=(0,o.useCallback)(async()=>{const e=new AbortController;await f(e.signal)},[f]),x=(0,o.useCallback)((e,t)=>A?t&&0!==t.length?Promise.resolve():Promise.reject(new Error("Please select at least one plant for plant users!")):Promise.resolve(),[A]),S=(0,o.useCallback)((e,t)=>{if(!A)return Promise.resolve();const a=i.getFieldValue("assignedPlants")||[];return t&&!a.includes(t)?Promise.reject(new Error("Primary plant must be one of the assigned plants!")):Promise.resolve()},[A,i]),j=(0,o.useCallback)(e=>{const t=i.getFieldValue("primaryPlant");t&&!e.includes(t)&&i.setFieldValue("primaryPlant",void 0)},[i]),$=(0,o.useMemo)(()=>{const e=i.getFieldValue("assignedPlants")||[];return u.filter(t=>e.includes(t.value))},[u,i]);return(0,o.useEffect)(()=>{(c.assignedPlants||c.primaryPlant)&&i.setFieldsValue({assignedPlants:c.assignedPlants||[],primaryPlant:c.primaryPlant||null})},[c,i]),A?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(v.A,{}),(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,d.jsx)(k,{strong:!0,style:{color:"#1890ff"},children:"Plant Assignments"}),(0,d.jsx)(l.Ay,{size:"small",icon:(0,d.jsx)(P.A,{}),onClick:w,loading:g,"aria-label":"Refresh plants list","data-testid":"refresh-plants-button",children:"Refresh Plants"})]}),(0,d.jsx)(k,{type:"secondary",style:{display:"block",marginBottom:16,fontSize:"12px"},children:"Plant users need to be assigned to specific plants to access plant-specific data. Plants are loaded from Location Master."}),p&&(0,d.jsx)(s.A,{message:"Plant Loading Error",description:`Failed to load plants: ${p}. Using fallback data.`,type:"warning",showIcon:!0,style:{marginBottom:16},"data-testid":"plant-error-alert"}),(0,d.jsx)(m.A.Item,{name:"assignedPlants",label:"Assigned Plants",rules:[{validator:x}],hasFeedback:!0,tooltip:"Select all plants this user should have access to",children:(0,d.jsx)(y.A,{mode:"multiple",placeholder:"Select plants this user can access",loading:g,options:u,showSearch:!0,filterOption:h,onChange:j,"aria-label":"Assigned plants selection","data-testid":"assigned-plants-select",maxTagCount:"responsive",allowClear:!0})}),(0,d.jsx)(m.A.Item,{name:"primaryPlant",label:"Primary Plant",rules:[{validator:S}],hasFeedback:!0,tooltip:"The default plant that will be selected when the user logs in",children:(0,d.jsx)(y.A,{placeholder:"Select primary plant (optional)",allowClear:!0,loading:g,options:$,showSearch:!0,filterOption:h,"aria-label":"Primary plant selection","data-testid":"primary-plant-select",disabled:!(null!==(t=i.getFieldValue("assignedPlants"))&&void 0!==t&&t.length)})}),(null===(a=i.getFieldValue("assignedPlants"))||void 0===a?void 0:a.length)>0&&(0,d.jsx)("div",{style:{marginTop:-16,marginBottom:16},children:(0,d.jsx)(k,{type:"secondary",style:{fontSize:"11px"},children:"Primary plant will be auto-selected from assigned plants if not specified"})})]}):null});x.displayName="PlantAssignmentForm",x.defaultProps={selectedRoles:[],initialValues:{}};const S=x,j=o.memo(e=>{let{visible:t,editingUser:a,roles:n,onSave:s,onCancel:l,loading:r=!1}=e;const[i]=m.A.useForm(),[c,u]=(0,o.useState)([]),[P,A]=(0,o.useState)({}),v=(0,o.useMemo)(()=>Boolean(a),[a]),w=(0,o.useMemo)(()=>v?"Edit User":"Add User",[v]),C=(0,o.useMemo)(()=>({username:h.PT.username,email:h.PT.email,password:v?[]:h.PT.password,roles:[{required:!0,message:"Please select at least one role!"},{type:"array",min:1,message:"Please select at least one role!"}]}),[v]),k=(0,o.useMemo)(()=>n.map(e=>({label:e.name,value:e.id,key:e.id})),[n]),x=(0,o.useCallback)(async e=>{try{await s(e,a),i.resetFields()}catch(t){console.error("Error saving user:",t)}},[s,a,i]),j=(0,o.useCallback)(()=>{i.resetFields(),l()},[i,l]),$=(0,o.useCallback)(()=>{i.submit()},[i]),U=(0,o.useCallback)(async e=>{try{const t=await f.E.getUserPlantAssignments(e);return A(t||{}),t}catch(t){return console.warn("Could not load plant assignments for user:",t),A({}),{}}},[]);(0,o.useEffect)(()=>{if(t&&a){const e=(a.roles||[]).map(e=>null===e||void 0===e?void 0:e.id).filter(Boolean);u(e),i.setFieldsValue({username:a.username,email:a.email,roles:e}),U(a.username)}else t&&!a&&(u([]),A({}),i.resetFields())},[t,a,i,U]);return(0,d.jsx)(g.A,{title:w,open:t,onOk:$,onCancel:j,confirmLoading:r,destroyOnClose:!0,width:600,maskClosable:!1,"aria-labelledby":"user-modal-title","data-testid":"user-modal",children:(0,d.jsxs)(b.Ay,{form:i,labelCol:{span:6},wrapperCol:{span:18},onFinish:x,preserve:!1,"aria-label":`${w} form`,"data-testid":"user-form",componentName:"UserModal",enableSecurityLogging:!0,children:[(0,d.jsx)(b.lE,{name:"username",label:"Username",validationType:"username",hasFeedback:!0,children:(0,d.jsx)(b.eS,{placeholder:"Enter username",disabled:v,"aria-label":"Username input","data-testid":"username-input",validationType:"username",componentName:"UserModal",fieldName:"username"})}),(0,d.jsx)(b.lE,{name:"email",label:"Email",validationType:"email",hasFeedback:!0,children:(0,d.jsx)(b.eS,{placeholder:"Enter email address","aria-label":"Email input","data-testid":"email-input",validationType:"email",componentName:"UserModal",fieldName:"email"})}),!v&&(0,d.jsx)(b.lE,{name:"password",label:"Password",validationType:"password",hasFeedback:!0,children:(0,d.jsx)(p.A.Password,{placeholder:"Enter password","aria-label":"Password input","data-testid":"password-input"})}),(0,d.jsx)(m.A.Item,{name:"roles",label:"Roles",rules:C.roles,hasFeedback:!0,children:(0,d.jsx)(y.A,{mode:"multiple",placeholder:"Select user roles",options:k,"aria-label":"Roles selection","data-testid":"roles-select",showSearch:!0,filterOption:(e,t)=>{var a;return null===t||void 0===t||null===(a=t.label)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase())},maxTagCount:"responsive",onChange:u})}),(0,d.jsx)(S,{selectedRoles:c,roles:n,form:i,initialValues:P})]})})});j.displayName="UserModal",j.defaultProps={editingUser:null,loading:!1};const $=j;var U=a(7407),E=a(1966),I=a(3217);const T=o.memo(e=>{let{users:t,loading:a,onEdit:n,onDelete:s,availablePlants:r=[]}=e;const i=(0,o.useCallback)(e=>{const t=r.find(t=>t.value===e);return t?t.label:e},[r]),c=(0,o.useMemo)(()=>[{title:"Username",dataIndex:"username",key:"username",sorter:(e,t)=>e.username.localeCompare(t.username),"aria-label":"Username column"},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),"aria-label":"Email column"},{title:"Roles",dataIndex:"roles",key:"roles","aria-label":"Roles column",render:e=>(Array.isArray(e)?e:[]).map(e=>(null===e||void 0===e?void 0:e.name)||e||"").filter(Boolean).join(", ")||"No roles assigned"},{title:"Assigned Plants",key:"plants","aria-label":"Assigned plants column",render:(e,t)=>{let a=[],n=null;if(t.plantAssignments&&(Array.isArray(t.plantAssignments)?a=t.plantAssignments:t.plantAssignments.assignedPlants&&Array.isArray(t.plantAssignments.assignedPlants)&&(a=t.plantAssignments.assignedPlants,n=t.plantAssignments.primaryPlant)),0===a.length&&t.assignedPlants&&(Array.isArray(t.assignedPlants)?a=t.assignedPlants:"string"===typeof t.assignedPlants&&t.assignedPlants.trim()&&(a=t.assignedPlants.split(",").map(e=>e.trim()).filter(Boolean)),n=t.primaryPlant),!a||0===a.length)return(0,d.jsx)("span",{style:{color:"#999"},"aria-label":"No plants assigned",children:"None"});const s=a.map(e=>i(e)).join(", ");return(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{"aria-label":`Assigned plants: ${s}`,children:s}),n&&(0,d.jsxs)("div",{style:{fontSize:"11px",color:"#666"},"aria-label":`Primary plant: ${i(n)}`,children:["Primary: ",i(n)]})]})}},{title:"Actions",key:"actions","aria-label":"Actions column",render:(e,t)=>(0,d.jsxs)("div",{role:"group","aria-label":`Actions for user ${t.username}`,children:[(0,d.jsx)(l.Ay,{type:"link",icon:(0,d.jsx)(U.A,{}),onClick:()=>n(t),"aria-label":`Edit user ${t.username}`,"data-testid":`edit-button-${t.id}`,children:"Edit"}),(0,d.jsx)(l.Ay,{type:"link",danger:!0,icon:(0,d.jsx)(E.A,{}),onClick:()=>s(t.id),"aria-label":`Delete user ${t.username}`,"data-testid":`delete-button-${t.id}`,children:"Delete"})]})}],[n,s,i]),u=(0,o.useMemo)(()=>{const e=Array.isArray(t)?t:[];return{columns:c,dataSource:e,rowKey:"id",loading:a,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} users`,"aria-label":"User table pagination"},scroll:{x:800},size:"middle","aria-label":"Users table","data-testid":"users-table"}},[c,t,a]),m=Array.isArray(t)?t:[];return a||0!==m.length?(0,d.jsx)(I.A,{...u,locale:{emptyText:"No users found"}}):(0,d.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},role:"status","aria-label":"No users found",children:'No users found. Click "Add User" to create the first user.'})});T.displayName="UserTable",T.defaultProps={users:[],loading:!1,availablePlants:[]};const M=T;var R=a(5991);const z=(()=>{try{return a(6649).default}catch(e){return console.warn("API client not available, using mock"),{get:()=>Promise.resolve([]),post:()=>Promise.resolve({}),put:()=>Promise.resolve({}),delete:()=>Promise.resolve({})}}})(),F="SET_LOADING",N="SET_USERS",B="SET_ROLES",L="SET_ERROR",O="SET_MODAL_VISIBLE",V="SET_EDITING_USER",D="RESET_MODAL",_={users:[],roles:[],loading:!1,error:null,modalVisible:!1,editingUser:null},G=(e,t)=>{switch(t.type){case F:return{...e,loading:t.payload};case N:return{...e,users:t.payload,loading:!1,error:null};case B:return{...e,roles:t.payload};case L:return{...e,error:t.payload,loading:!1};case O:return{...e,modalVisible:t.payload};case V:return{...e,editingUser:t.payload};case D:return{...e,modalVisible:!1,editingUser:null};default:return e}};var W=a(3719);const H=()=>{const{users:e,roles:t,loading:i,modalVisible:c,editingUser:m,actions:g}=(()=>{const[e,t]=(0,o.useReducer)(G,_),a=(0,o.useCallback)(async e=>{t({type:F,payload:!0});try{const a=await z.get("/admin/users",{signal:e}),n=(0,R.JB)(a,"users"),s=await Promise.all(n.map(async t=>{try{const a=await f.E.getUserPlantAssignments(t.username,{signal:e});return{...t,roles:(0,R.rt)(t.roles),plantAssignments:(0,R.bj)(a)}}catch(a){return null!==e&&void 0!==e&&e.aborted||console.error("Error loading plant assignments:",a),{...t,roles:(0,R.rt)(t.roles),plantAssignments:(0,R.bj)(null)}}}));null!==e&&void 0!==e&&e.aborted||t({type:N,payload:s})}catch(a){null!==e&&void 0!==e&&e.aborted||(console.error("Error fetching users:",a),t({type:L,payload:a.message}),n.Ay.error("Failed to fetch users"),t({type:N,payload:[]}))}},[]),s=(0,o.useCallback)(async e=>{try{const a=await z.get("/admin/roles",{signal:e});if(null===e||void 0===e||!e.aborted){const e=(0,R.JB)(a,"roles");t({type:B,payload:e})}}catch(a){null!==e&&void 0!==e&&e.aborted||(console.error("Failed to fetch roles:",a),n.Ay.error("Failed to fetch roles"),t({type:B,payload:[]}))}},[]),l=(0,o.useCallback)(async e=>{try{await z.delete(`/admin/users/${e}`),n.Ay.success("User deleted successfully");const t=new AbortController;await a(t.signal)}catch(t){throw n.Ay.error("Failed to delete user"),t}},[a]),r=(0,o.useCallback)(async(e,s)=>{try{const{assignedPlants:r,primaryPlant:o,roles:i,...d}=e;if(s){if(await z.put(`/admin/users/${s.id}`,d),i&&i.length>0)try{await z.post(`/admin/users/${s.id}/roles`,{roleIds:i})}catch(l){console.warn("Failed to update user roles:",l),n.Ay.warning("User updated but roles could not be assigned")}r&&r.length>0&&await f.E.updateUserPlantAssignments(s.username,{assignedPlants:r,primaryPlant:o||r[0]}),n.Ay.success("User updated successfully")}else{const e={...d,roles:i||[],assignedPlants:r||[],primaryPlant:o||(r&&r.length>0?r[0]:null)},t=await z.post("/admin/users",e);console.log("User creation response:",t),"warning"===t.status?n.Ay.warning(t.message):(t.status,n.Ay.success("User created successfully"))}t({type:D});const c=new AbortController;await a(c.signal)}catch(r){throw n.Ay.error("Failed to save user"),r}},[a]),i=(0,o.useCallback)(async e=>{t({type:V,payload:e}),t({type:O,payload:!0})},[]),d=(0,o.useCallback)(()=>{t({type:V,payload:null}),t({type:O,payload:!0})},[]),c=(0,o.useCallback)(()=>{t({type:D})},[]);return(0,o.useEffect)(()=>{const e=new AbortController;return(async()=>{try{await Promise.all([a(e.signal),s(e.signal)])}catch(t){e.signal.aborted||console.error("Error initializing user management data:",t)}})(),()=>{e.abort()}},[a,s]),{...e,actions:{fetchUsers:a,fetchRoles:s,deleteUser:l,saveUser:r,openEditModal:i,openAddModal:d,closeModal:c}}})(),{availablePlants:p}=C(),y=(0,o.useCallback)(async()=>{try{const e=await w.B.testLocationMaster();n.Ay.success(e)}catch(e){n.Ay.error(`Test failed: ${e.message}`)}},[]),h=(0,o.useCallback)(async()=>{try{const e=await w.B.testSimpleLocation();n.Ay.success(e)}catch(e){n.Ay.error(`Simple test failed: ${e.message}`)}},[]),b=(0,o.useCallback)(async()=>{try{const e=await w.B.diagnosticLocationMaster();console.log("Diagnostic result:",e),n.Ay.info("Check console for diagnostic info")}catch(e){n.Ay.error(`Diagnostic failed: ${e.message}`)}},[]),P=(0,o.useCallback)(()=>{const e=new AbortController;g.fetchUsers(e.signal)},[g]),A=(0,o.useCallback)(async()=>{try{const e=(await Promise.resolve().then(a.bind(a,6649))).default,t=await e.get("/admin/test/user-roles");console.log("Test user roles result:",t),n.Ay.success("Test successful! Check console for user roles test data")}catch(e){console.error("Test user roles failed:",e),401===e.status?n.Ay.error("Authentication failed. Please log in first."):n.Ay.error(`Test failed: ${e.message}`)}},[]),v=(0,o.useCallback)(()=>{window.location.href="/qrmfg/login"},[]),k=(0,o.useCallback)(async()=>{try{const e=(await Promise.resolve().then(a.bind(a,6649))).default,t=await e.post("/admin/fix-admin-roles");console.log("Fix admin roles result:",t),n.Ay.success("Admin roles fixed! Refreshing user data...");const s=new AbortController;g.fetchUsers(s.signal)}catch(e){console.error("Fix admin roles failed:",e),n.Ay.error(`Fix failed: ${e.message}`)}},[g]),x=(0,W.HW)(),S=(0,W.Rk)(),j=(0,W.wR)();return(0,d.jsx)(u,{context:"user-management",onRetry:P,children:(0,d.jsxs)("div",{style:{padding:"24px"},children:[(0,d.jsx)(s.A,{message:`Debug Info: User: ${x||"Not logged in"}, Authenticated: ${j}, Roles: ${S.join(", ")||"None"}`,type:j?"info":"warning",style:{marginBottom:16},showIcon:!0,action:!j&&(0,d.jsx)(l.Ay,{size:"small",onClick:v,children:"Go to Login"})}),(0,d.jsx)("div",{style:{marginBottom:16},children:(0,d.jsxs)(r.A,{wrap:!0,children:[(0,d.jsx)(l.Ay,{type:"primary",onClick:g.openAddModal,"data-testid":"add-user-button",children:"Add User"}),(0,d.jsx)(l.Ay,{onClick:y,children:"Test Location API"}),(0,d.jsx)(l.Ay,{onClick:h,children:"Test Simple API"}),(0,d.jsx)(l.Ay,{onClick:b,children:"Diagnostic"}),(0,d.jsx)(l.Ay,{onClick:A,children:"Test User Roles"}),(0,d.jsx)(l.Ay,{onClick:k,type:"dashed",children:"Fix Admin Roles"})]})}),(0,d.jsx)(M,{users:e,loading:i,onEdit:g.openEditModal,onDelete:g.deleteUser,availablePlants:p}),(0,d.jsx)($,{visible:c,editingUser:m,roles:t,onSave:g.saveUser,onCancel:g.closeModal,loading:i})]})})}},5991:(e,t,a)=>{a.d(t,{JB:()=>s,bj:()=>r,eC:()=>n,rt:()=>l});const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:(console.warn("Data is not an array, using fallback:",{data:e,fallback:t}),t)},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return a;if(!t)return n(e,a);const s=t.split(".");let l=e;for(const n of s){if(!l||"object"!==typeof l||!(n in l))return console.warn(`Key '${n}' not found in response:`,e),a;l=l[n]}return n(l,a)},l=e=>n(e).map(e=>"string"===typeof e?{name:e,id:e}:"object"===typeof e&&null!==e?{name:e.name||e.roleName||e.id||"Unknown Role",id:e.id||e.name||e.roleName||Math.random().toString(36),...e}:{name:"Unknown Role",id:Math.random().toString(36)}),r=e=>e?Array.isArray(e)?{assignedPlants:e,primaryPlant:e.length>0?e[0]:null}:"object"===typeof e?{assignedPlants:n(e.assignedPlants||e.plants),primaryPlant:e.primaryPlant||e.primary||null}:{assignedPlants:[],primaryPlant:null}:{assignedPlants:[],primaryPlant:null}},6274:(e,t,a)=>{a.d(t,{Ay:()=>p,eS:()=>c,lE:()=>g,wS:()=>u});var n=a(9098),s=a(5444),l=a(6569),r=a(5043),o=a(599),i=a(579);const{TextArea:d}=s.A,c=r.memo(e=>{let{value:t,onChange:a,validationType:n="text",componentName:d="SecureInput",fieldName:c="input",onValidationChange:u,...m}=e;const{validateInput:g}=(0,o.j8)(),[p,y]=(0,r.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,r.useCallback)(e=>{const t=e.target.value,s=g(t,n);y(s),s.wasModified&&(o.qp.logXSSAttempt(t,s.sanitizedValue,d,c),l.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:s.sanitizedValue}}),u&&u(s)},[a,n,d,c,u,g]);return(0,i.jsx)(s.A,{...m,value:t,onChange:f,status:p.isValid?"":"error",title:p.errors.join(", ")})}),u=r.memo(e=>{let{value:t,onChange:a,validationType:n="richtext",componentName:s="SecureTextArea",fieldName:c="textarea",onValidationChange:u,...m}=e;const{validateInput:g}=(0,o.j8)(),[p,y]=(0,r.useState)({isValid:!0,errors:[],wasModified:!1}),f=(0,r.useCallback)(e=>{const t=e.target.value,r=g(t,n);y(r),r.wasModified&&(o.qp.logXSSAttempt(t,r.sanitizedValue,s,c),l.Ay.warning("Input was sanitized for security reasons")),a&&a({...e,target:{...e.target,value:r.sanitizedValue}}),u&&u(r)},[a,n,s,c,u,g]);return(0,i.jsx)(d,{...m,value:t,onChange:f,status:p.isValid?"":"error",title:p.errors.join(", ")})}),m=r.memo(e=>{let{children:t,onFinish:a,componentName:s="SecureForm",enableSecurityLogging:d=!0,...c}=e;const[u,m]=(0,r.useState)([]),g=(0,r.useCallback)(async e=>{try{const t={},n=[];Object.keys(e).forEach(a=>{const s=e[a];if("string"===typeof s){const e=o.SR.sanitizeText(s);t[a]=e,e!==s&&n.push({field:a,originalValue:s.substring(0,50),sanitizedValue:e.substring(0,50)})}else t[a]=s}),n.length>0&&d&&(n.forEach(e=>{o.qp.logXSSAttempt(e.originalValue,e.sanitizedValue,s,e.field)}),l.Ay.warning(`${n.length} field(s) were sanitized for security`)),a&&await a(t)}catch(t){throw console.error("SecureForm submission error:",t),l.Ay.error("Form submission failed"),t}},[a,s,d]);return(0,r.useEffect)(()=>{if(d){const e=o.qp.getRecentEvents();m(e.slice(-10))}},[d]),(0,i.jsxs)(n.A,{...c,onFinish:g,validateTrigger:["onChange","onBlur"],children:[t,!1]})}),g=r.memo(e=>{let{children:t,validationType:a="text",name:s,rules:l=[],...d}=e;const c=r.useMemo(()=>{let e=[];switch(a){case"username":e=o.PT.username;break;case"email":e=o.PT.email;break;case"password":e=o.PT.password;break;case"projectCode":e=o.PT.projectCode;break;case"materialCode":e=o.PT.materialCode;break;case"plantCode":e=o.PT.plantCode;break;case"text":e=o.PT.text(!1,0,255);break;case"richtext":e=o.PT.richText(!1,0,1e3);break;default:e=[]}return[...e,...l]},[a,l]);return(0,i.jsx)(n.A.Item,{...d,name:s,rules:c,children:t})});c.displayName="SecureInput",u.displayName="SecureTextArea",m.displayName="SecureForm",g.displayName="SecureFormItem";const p=m},8348:(e,t,a)=>{a.d(t,{E:()=>l});var n=a(6649),s=a(3719);const l={getUserPlantAssignments:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(console.log("Getting plant assignments for user:",e),console.log("Is authenticated:",(0,s.wR)()),!(0,s.wR)())return console.warn("User is not authenticated, cannot get plant assignments"),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1};const i=(0,s.gf)();if(console.log("Retrieved token:",i?"Token found":"No token found"),i)try{const e=await n.default.post("/auth/validate",{token:i},t);if(console.log("Token validation response:",e),console.log("Plant codes in token:",e.plantCodes),console.log("Primary plant in token:",e.primaryPlant),console.log("Is plant user:",e.isPlantUser),e.valid){if(e.plantCodes&&e.plantCodes.length>0)return console.log("Plant assignments from token:",e),{assignedPlants:e.plantCodes||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||e.plantCodes&&e.plantCodes[0]||null,isPlantUser:e.isPlantUser||!1};if(e.primaryPlant&&e.isPlantUser)return console.log("User has primary plant but empty plantCodes, using primary plant as assigned plant:",e.primaryPlant),{assignedPlants:[e.primaryPlant],primaryPlant:e.primaryPlant,effectivePlant:e.primaryPlant,isPlantUser:e.isPlantUser||!1};console.log("Token is valid but no plant data found in token")}}catch(l){console.warn("Failed to validate token for plant assignments:",l)}const d=["userData","qrmfg_user_data","user_info"];for(const e of d){const t=localStorage.getItem(e)||sessionStorage.getItem(e);if(t)try{const e=JSON.parse(t);if(e.plantCodes||e.assignedPlants)return console.log("Plant assignments from stored data:",e),{assignedPlants:e.plantCodes||e.assignedPlants||[],primaryPlant:e.primaryPlant||null,effectivePlant:e.primaryPlant||(e.plantCodes||e.assignedPlants)&&(e.plantCodes||e.assignedPlants)[0]||null,isPlantUser:e.isPlantUser||!1}}catch(r){console.warn(`Failed to parse stored user data from ${e}:`,r)}}try{const l=(0,s.gf)(),r=await n.default.post("/auth/validate",{token:l},t);if(r.valid&&r.isAdmin){var a;console.log("User appears to be admin, trying admin endpoints...");const s=null===(a=(await n.default.get("/admin/users",t)).users)||void 0===a?void 0:a.find(t=>t.username===e);if(s&&s.assignedPlants)return console.log("Admin endpoint: Using user details for plant assignments:",s),{assignedPlants:s.assignedPlants||[],primaryPlant:s.primaryPlant||null,effectivePlant:s.primaryPlant||s.assignedPlants&&s.assignedPlants[0]||null,isPlantUser:s.assignedPlants&&s.assignedPlants.length>0||!1}}}catch(o){console.warn("Admin endpoints not accessible (expected for non-admin users):",o.message)}return console.warn("No plant assignment data available for user:",e),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}catch(i){return console.error("Error getting user plant assignments:",i),{assignedPlants:[],primaryPlant:null,effectivePlant:null,isPlantUser:!1}}},updateUserPlantAssignments:(e,t)=>n.default.put(`/admin/users/${encodeURIComponent(e)}/plants`,t),checkUserPlantAssignment:(e,t)=>n.default.get(`/admin/users/${encodeURIComponent(e)}/plants/${encodeURIComponent(t)}/check`),getUserById:e=>n.default.get(`/admin/users/${e}`),getAllUsers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.get("/admin/users",{cacheTTL:3e5,...e})},getAllUsersRealTime:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.get("/admin/users",{useCache:!1,...e})}}},8354:(e,t,a)=>{a.d(t,{A:()=>h});var n=a(5043),s=a(8139),l=a.n(s),r=a(5296),o=a(9122),i=a(3944),d=a(4414),c=a(8855),u=a(8446);const m=e=>{const{componentCls:t}=e;return{[t]:{"&-horizontal":{[`&${t}`]:{"&-sm":{marginBlock:e.marginXS},"&-md":{marginBlock:e.margin}}}}}},g=e=>{const{componentCls:t,sizePaddingEdgeHorizontal:a,colorSplit:n,lineWidth:s,textPaddingInline:l,orientationMargin:r,verticalMarginInline:o}=e;return{[t]:Object.assign(Object.assign({},(0,d.dF)(e)),{borderBlockStart:`${(0,i.zA)(s)} solid ${n}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:o,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${(0,i.zA)(s)} solid ${n}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${(0,i.zA)(e.marginLG)} 0`},[`&-horizontal${t}-with-text`]:{display:"flex",alignItems:"center",margin:`${(0,i.zA)(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${n}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${(0,i.zA)(s)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${t}-with-text-start`]:{"&::before":{width:`calc(${r} * 100%)`},"&::after":{width:`calc(100% - ${r} * 100%)`}},[`&-horizontal${t}-with-text-end`]:{"&::before":{width:`calc(100% - ${r} * 100%)`},"&::after":{width:`calc(${r} * 100%)`}},[`${t}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:l},"&-dashed":{background:"none",borderColor:n,borderStyle:"dashed",borderWidth:`${(0,i.zA)(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:n,borderStyle:"dotted",borderWidth:`${(0,i.zA)(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${t}-with-text-start${t}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${t}-inner-text`]:{paddingInlineStart:a}},[`&-horizontal${t}-with-text-end${t}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:a}}})}},p=(0,c.OF)("Divider",e=>{const t=(0,u.oX)(e,{dividerHorizontalWithTextGutterMargin:e.margin,sizePaddingEdgeHorizontal:0});return[g(t),m(t)]},e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),{unitless:{orientationMargin:!0}});var y=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const f={small:"sm",middle:"md"};const h=e=>{const{getPrefixCls:t,direction:a,className:s,style:i}=(0,r.TP)("divider"),{prefixCls:d,type:c="horizontal",orientation:u="center",orientationMargin:m,className:g,rootClassName:h,children:b,dashed:P,variant:A="solid",plain:v,style:w,size:C}=e,k=y(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style","size"]),x=t("divider",d),[S,j,$]=p(x),U=(0,o.A)(C),E=f[U],I=!!b,T=n.useMemo(()=>"left"===u?"rtl"===a?"end":"start":"right"===u?"rtl"===a?"start":"end":u,[a,u]),M="start"===T&&null!=m,R="end"===T&&null!=m,z=l()(x,s,j,$,`${x}-${c}`,{[`${x}-with-text`]:I,[`${x}-with-text-${T}`]:I,[`${x}-dashed`]:!!P,[`${x}-${A}`]:"solid"!==A,[`${x}-plain`]:!!v,[`${x}-rtl`]:"rtl"===a,[`${x}-no-default-orientation-margin-start`]:M,[`${x}-no-default-orientation-margin-end`]:R,[`${x}-${E}`]:!!E},g,h),F=n.useMemo(()=>"number"===typeof m?m:/^\d+$/.test(m)?Number(m):m,[m]),N={marginInlineStart:M?F:void 0,marginInlineEnd:R?F:void 0};return S(n.createElement("div",Object.assign({className:z,style:Object.assign(Object.assign({},i),w)},k,{role:"separator"}),b&&"vertical"!==c&&n.createElement("span",{className:`${x}-inner-text`,style:N},b)))}},9799:(e,t,a)=>{a.d(t,{B:()=>s});var n=a(6649);const s={getAllLocations:async()=>{try{return await n.default.get("/master-data/locations")}catch(e){console.warn("Main locations endpoint failed, trying fallback:",e);try{return await n.default.get("/master-data/locations/fallback")}catch(t){console.warn("Fallback endpoint failed, trying simple endpoint:",t);try{return await n.default.get("/simple-locations")}catch(a){throw console.error("All locations endpoints failed:",a),a}}}},getLocationByCode:e=>n.default.get(`/master-data/locations/${encodeURIComponent(e)}`),searchLocations:e=>n.default.get(`/master-data/locations/search?term=${encodeURIComponent(e)}`),createLocation:e=>n.default.post("/master-data/locations",e),updateLocation:(e,t)=>n.default.put(`/master-data/locations/${encodeURIComponent(e)}`,t),deleteLocation:e=>n.default.delete(`/master-data/locations/${encodeURIComponent(e)}`),getAllProjectItems:()=>n.default.get("/master-data/project-items"),getItemsByProject:e=>n.default.get(`/master-data/project-items/projects/${encodeURIComponent(e)}`),getProjectsByItem:e=>n.default.get(`/master-data/project-items/items/${encodeURIComponent(e)}`),getAllProjectCodes:()=>n.default.get("/master-data/project-codes"),getAllItemCodes:()=>n.default.get("/master-data/item-codes"),getItemCodesByProject:e=>n.default.get(`/master-data/project-codes/${encodeURIComponent(e)}/items`),testLocationMaster:()=>n.default.get("/master-data/locations/test"),testSimpleLocation:()=>n.default.get("/simple-locations/test"),diagnosticLocationMaster:()=>n.default.get("/master-data/locations/diagnostic"),getSimpleLocationCount:()=>n.default.get("/simple-locations/count")}}}]);
//# sourceMappingURL=985.b23c6e4b.chunk.js.map