"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[184,286,801],{801:(e,s,l)=>{l.r(s),l.d(s,{default:()=>d});var t=l(5206),r=l(3217),a=l(3927),i=l(5043),n=l(6649),o=l(579);const{Title:c}=a.A,d=()=>{const[e,s]=(0,i.useState)([]),[l,a]=(0,i.useState)(!1),d=async e=>{a(!0);try{const l=await n.default.get("/admin/sessions",{signal:e});if(null===e||void 0===e||!e.aborted){const e=Array.isArray(l)?l:[];s(e)}}catch(l){null!==e&&void 0!==e&&e.aborted||(console.error("Failed to fetch sessions:",l),s([]))}finally{null!==e&&void 0!==e&&e.aborted||a(!1)}};(0,i.useEffect)(()=>{const e=new AbortController;return d(e.signal),()=>{e.abort()}},[]);const u=[{title:"Session ID",dataIndex:"id",key:"id"},{title:"User",dataIndex:"user",key:"user"},{title:"Start Time",dataIndex:"startTime",key:"startTime"},{title:"Last Activity",dataIndex:"lastActivity",key:"lastActivity"},{title:"Actions",key:"actions",render:(e,s)=>(0,o.jsx)(t.Ay,{type:"primary",danger:!0,onClick:()=>(async e=>{try{await n.default.delete(`/admin/sessions/${e}`),d()}catch(s){console.error("Failed to terminate session:",s)}})(s.id),children:"Terminate"})}];return(0,o.jsxs)("div",{children:[(0,o.jsx)(c,{level:2,children:"Active Sessions"}),(0,o.jsx)(r.A,{columns:u,dataSource:e,rowKey:"id",loading:l})]})}},2184:(e,s,l)=>{l.r(s),l.d(s,{default:()=>L});var t=l(9126),r=l(5043),a=l(3216),i=l(5475),n=l(8143),o=l(4524),c=l(6191),d=l(3722),u=l(8818),h=l(3927),f=l(9098),A=l(6569),m=l(2261),y=l(7419),x=l(1645),g=l(9073),j=l(2624),p=l(5206),E=l(6051),v=l(8918),R=l(2751),k=l(6649),w=l(579);const{Title:b,Text:S}=h.A,C=()=>{const[e]=f.A.useForm(),[s]=f.A.useForm(),[l]=f.A.useForm(),[t]=f.A.useForm(),[a]=f.A.useForm(),[i,h]=(0,r.useState)(!1),[C,D]=(0,r.useState)({generalDefaults:{},roleBasedDefaults:{}}),[I,T]=(0,r.useState)(!1),[P,N]=(0,r.useState)(null),F=(0,r.useCallback)(async()=>{h(!0);try{const c=await k.default.get("/admin/notification-defaults/config");var r,i,n,o;if(c.success)D(c),e.setFieldsValue(c.generalDefaults||{}),s.setFieldsValue((null===(r=c.roleBasedDefaults)||void 0===r?void 0:r.CQS)||{}),l.setFieldsValue((null===(i=c.roleBasedDefaults)||void 0===i?void 0:i.JVC)||{}),t.setFieldsValue((null===(n=c.roleBasedDefaults)||void 0===n?void 0:n.PLANT)||{}),a.setFieldsValue((null===(o=c.roleBasedDefaults)||void 0===o?void 0:o.TECH)||{}),A.Ay.success("Configuration loaded successfully");else A.Ay.error(`Failed to load configuration: ${c.message}`)}catch(c){console.error("Failed to load notification defaults configuration:",c),A.Ay.error("Failed to load configuration")}finally{h(!1)}},[e,s,l,t,a]);(0,r.useEffect)(()=>{F()},[F]);const O=async(e,s)=>{h(!0);try{const l=await k.default.post(`/admin/notification-defaults/update-role-defaults?role=${e}`,s);l.success?(A.Ay.success(`${e} role defaults saved successfully`),F()):A.Ay.error(`Failed to save ${e} defaults: ${l.message}`)}catch(l){console.error(`Failed to save ${e} defaults:`,l),A.Ay.error(`Failed to save ${e} defaults`)}finally{h(!1)}},_=async e=>{try{const s=await k.default.get(`/admin/notification-defaults/preview?role=${e}`);s.success?(N({role:e,preferences:s.defaultPreferences}),T(!0)):A.Ay.error(`Failed to preview defaults: ${s.message}`)}catch(s){console.error("Failed to preview defaults:",s),A.Ay.error("Failed to preview defaults")}},L=[{key:"WORKFLOW_CREATED",label:"Workflow Created",description:"When a new MSDS workflow is created"},{key:"WORKFLOW_COMPLETED",label:"Workflow Completed",description:"When a workflow is completed"},{key:"WORKFLOW_STATE_CHANGED",label:"Workflow State Changed",description:"When workflow state transitions occur"},{key:"WORKFLOW_OVERDUE",label:"Workflow Overdue",description:"When workflows become overdue"},{key:"QUERY_RAISED",label:"Query Raised",description:"When new queries are raised"},{key:"QUERY_RESOLVED",label:"Query Resolved",description:"When queries are resolved"},{key:"QUERY_ASSIGNED",label:"Query Assigned",description:"When queries are assigned to teams"},{key:"QUERY_OVERDUE",label:"Query Overdue",description:"When queries become overdue"}],U=(e,s,l,t)=>(0,w.jsxs)(f.A,{form:e,layout:"vertical",onFinish:s,children:[(0,w.jsx)(m.A,{message:l,description:t,type:"info",showIcon:!0,style:{marginBottom:16}}),(0,w.jsx)(y.A,{gutter:[16,16],children:L.map(e=>(0,w.jsx)(x.A,{xs:24,sm:12,md:8,children:(0,w.jsx)(g.A,{size:"small",style:{height:"100%"},children:(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsx)(S,{strong:!0,style:{fontSize:"14px"},children:e.label}),(0,w.jsx)("br",{}),(0,w.jsx)(S,{type:"secondary",style:{fontSize:"12px"},children:e.description})]}),(0,w.jsx)("div",{style:{marginTop:12,textAlign:"center"},children:(0,w.jsx)(f.A.Item,{name:e.key,valuePropName:"checked",style:{margin:0},children:(0,w.jsx)(j.A,{checkedChildren:"ON",unCheckedChildren:"OFF",size:"small"})})})]})})},e.key))}),(0,w.jsx)("div",{style:{marginTop:24,textAlign:"center"},children:(0,w.jsx)(p.Ay,{type:"primary",htmlType:"submit",loading:i,icon:(0,w.jsx)(n.A,{}),size:"large",children:"Save Defaults"})})]});return(0,w.jsxs)("div",{style:{padding:"24px"},children:[(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsxs)(b,{level:2,children:[(0,w.jsx)(o.A,{style:{marginRight:"8px"}}),"Default Notification Preferences"]}),(0,w.jsx)(S,{type:"secondary",children:"Configure which notification types are enabled by default when new users are created. Users can later modify their individual preferences."})]}),(0,w.jsx)("div",{style:{marginBottom:16},children:(0,w.jsxs)(E.A,{children:[(0,w.jsx)(p.Ay,{onClick:F,loading:i,icon:(0,w.jsx)(o.A,{}),children:"Reload Configuration"}),(0,w.jsx)(p.Ay,{onClick:()=>_("CQS"),icon:(0,w.jsx)(c.A,{}),children:"Preview CQS Defaults"}),(0,w.jsx)(p.Ay,{onClick:()=>_("JVC"),icon:(0,w.jsx)(c.A,{}),children:"Preview JVC Defaults"})]})}),(0,w.jsx)(v.A,{defaultActiveKey:"general",type:"card",items:[{key:"general",label:(0,w.jsxs)("span",{children:[(0,w.jsx)(d.A,{}),"General Defaults"]}),children:U(e,async e=>{h(!0);try{const s=await k.default.post("/admin/notification-defaults/update-general-defaults",e);s.success?(A.Ay.success("General defaults saved successfully"),F()):A.Ay.error(`Failed to save general defaults: ${s.message}`)}catch(s){console.error("Failed to save general defaults:",s),A.Ay.error("Failed to save general defaults")}finally{h(!1)}},"General Default Preferences","These preferences apply to all new users unless overridden by role-specific settings.")},{key:"cqs",label:(0,w.jsxs)("span",{children:[(0,w.jsx)(u.A,{}),"CQS Role"]}),children:U(s,e=>O("CQS",e),"CQS Role Default Preferences","Default preferences for users with CQS role. These override general defaults.")},{key:"jvc",label:(0,w.jsxs)("span",{children:[(0,w.jsx)(u.A,{}),"JVC Role"]}),children:U(l,e=>O("JVC",e),"JVC Role Default Preferences","Default preferences for users with JVC role. These override general defaults.")},{key:"plant",label:(0,w.jsxs)("span",{children:[(0,w.jsx)(u.A,{}),"Plant Role"]}),children:U(t,e=>O("PLANT",e),"Plant Role Default Preferences","Default preferences for users with Plant role. These override general defaults.")},{key:"tech",label:(0,w.jsxs)("span",{children:[(0,w.jsx)(u.A,{}),"Tech Role"]}),children:U(a,e=>O("TECH",e),"Tech Role Default Preferences","Default preferences for users with Tech role. These override general defaults.")}]}),(0,w.jsx)(R.A,{title:`Preview Default Preferences - ${null===P||void 0===P?void 0:P.role} Role`,visible:I,onCancel:()=>T(!1),footer:[(0,w.jsx)(p.Ay,{onClick:()=>T(!1),children:"Close"},"close")],width:600,children:P&&(0,w.jsxs)("div",{children:[(0,w.jsx)(m.A,{message:`Default preferences for ${P.role} role users`,description:"These are the notification preferences that will be automatically created for new users with this role.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,w.jsx)(y.A,{gutter:[16,8],children:Object.entries(P.preferences).map(e=>{let[s,l]=e;return(0,w.jsx)(x.A,{xs:24,sm:12,children:(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",backgroundColor:l?"#f6ffed":"#fff2f0",border:"1px solid "+(l?"#b7eb8f":"#ffccc7"),borderRadius:"4px"},children:[(0,w.jsx)(S,{children:s.replace(/_/g," ")}),(0,w.jsx)(S,{strong:!0,style:{color:l?"#52c41a":"#ff4d4f"},children:l?"ENABLED":"DISABLED"})]})},s)})})]})})]})};var D=l(5423),I=l(5123),T=l(7286),P=l(8471),N=l(801),F=l(9108),O=l(6039),_=l(1255);const L=()=>{const e=(0,a.zy)(),s=(0,a.Zp)(),l=e.pathname,{isAdmin:n}=(0,I.hm)();return r.useEffect(()=>{"/qrmfg/admin"===l&&s("/qrmfg/admin/users")},[l,s]),(0,w.jsx)(D.ww,{children:(0,w.jsxs)("div",{style:{padding:24},children:[(0,w.jsx)("h2",{children:"Admin Panel"}),(0,w.jsx)(t.A,{mode:"horizontal",selectedKeys:[l],items:[{key:"/qrmfg/admin/users",label:"Users"},{key:"/qrmfg/admin/roles",label:"Roles"},{key:"/qrmfg/admin/auditlogs",label:"Audit Logs"},{key:"/qrmfg/admin/sessions",label:"Sessions"},{key:"/qrmfg/admin/user-role-management",label:"User Role Management"},{key:"/qrmfg/admin/notification-defaults",label:"Notification Defaults"},{key:"/qrmfg/admin/workflow-monitoring",label:"Legacy Monitoring"}].map(e=>({...e,label:(0,w.jsx)(i.N_,{to:e.key,children:e.label})})),style:{marginBottom:24}}),(0,w.jsx)("div",{style:{marginTop:24},children:(0,w.jsxs)(a.BV,{children:[(0,w.jsx)(a.qh,{path:"users",element:(0,w.jsx)(O.default,{})}),(0,w.jsx)(a.qh,{path:"roles",element:(0,w.jsx)(P.default,{})}),(0,w.jsx)(a.qh,{path:"auditlogs",element:(0,w.jsx)(T.default,{})}),(0,w.jsx)(a.qh,{path:"sessions",element:(0,w.jsx)(N.default,{})}),(0,w.jsx)(a.qh,{path:"user-role-management",element:(0,w.jsx)(F.default,{})}),(0,w.jsx)(a.qh,{path:"notification-defaults",element:(0,w.jsx)(C,{})}),(0,w.jsx)(a.qh,{path:"workflow-monitoring",element:(0,w.jsx)(_.default,{})})]})})]})})}},2868:(e,s,l)=>{l.d(s,{aZ:()=>u,rb:()=>i,Bq:()=>h,fz:()=>a,cS:()=>o,pZ:()=>c,tS:()=>f,r0:()=>d,EW:()=>t,sB:()=>n,Fv:()=>r});const t={MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:1024,PAGE_SIZE:10,DEBOUNCE_DELAY:300},r={INITIATED:"INITIATED",IN_PROGRESS:"IN_PROGRESS",PENDING_REVIEW:"PENDING_REVIEW",APPROVED:"APPROVED",REJECTED:"REJECTED",COMPLETED:"COMPLETED"},a={LOW:"LOW",MEDIUM:"MEDIUM",HIGH:"HIGH",URGENT:"URGENT",CRITICAL:"CRITICAL"},i=(r.INITIATED,r.IN_PROGRESS,r.PENDING_REVIEW,r.APPROVED,r.REJECTED,r.COMPLETED,a.LOW,a.MEDIUM,a.HIGH,a.URGENT,a.CRITICAL,{MAX_UPLOAD_SIZE:26214400,BYTES_PER_KB:1024,BYTES_PER_MB:1048576,BYTES_PER_GB:1073741824}),n={JVC_PENDING:"JVC_PENDING",PLANT_PENDING:"PLANT_PENDING",CQS_PENDING:"CQS_PENDING",TECH_PENDING:"TECH_PENDING",DRAFT:"DRAFT",IN_PROGRESS:"IN_PROGRESS",COMPLETED:"COMPLETED"},o={OPEN:"OPEN",RESOLVED:"RESOLVED",CLOSED:"CLOSED"},c={ACTIVE:["OPEN"],INACTIVE:["RESOLVED","CLOSED"]},d={CQS:"CQS",TECH:"TECH",JVC:"JVC",PLANT:"PLANT"},u={INTERVAL:3e4,DEBOUNCE_DELAY:2e3},h={DEFAULT_PAGE_SIZE:10,SMALL_PAGE_SIZE:5,LARGE_PAGE_SIZE:15,SHOW_SIZE_CHANGER:!0,SHOW_QUICK_JUMPER:!0},f={INITIATE:"initiate",PENDING:"pending",COMPLETED:"completed",QUERIES:"queries",HISTORY:"history"}},5123:(e,s,l)=>{l.d(s,{hm:()=>i});var t=l(5043),r=l(3719),a=l(4642);const i=()=>{const[e,s]=(0,t.useState)(null),[l,i]=(0,t.useState)(!0),[n,o]=(0,t.useState)(null),c=(0,t.useCallback)(async()=>{if(!(0,r.wR)())return s(null),void i(!1);try{i(!0),o(null);const e=await a.A.getUserAccessSummary();s(e)}catch(e){console.warn("Failed to load access summary, using fallback:",e),o(e);const l=a.A.getFallbackAccessSummary();s(l)}finally{i(!1)}},[]);(0,t.useEffect)(()=>{c()},[c]);const d=(0,t.useCallback)(async e=>{try{return await a.A.hasScreenAccess(e)}catch(n){return console.warn("Screen access check failed, using fallback:",n),a.A.getFallbackScreenAccess(e)}},[]),u=(0,t.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await a.A.hasDataAccess(e,s)}catch(n){return console.warn("Data access check failed, using fallback:",n),a.A.getFallbackDataAccess(e,s)}},[]),h=(0,t.useCallback)(async function(e,s){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await a.A.hasPlantDataAccess(e,s,l)}catch(n){return console.warn("Plant data access check failed, using fallback:",n),a.A.getFallbackPlantDataAccess(e,s,l)}},[]),f=(0,t.useCallback)(async function(e,s,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{return await a.A.makeAccessDecision(e,s,l,t)}catch(n){return console.warn("Access decision failed, using fallback:",n),a.A.getFallbackAccessDecision(e,s,l,t)}},[]),A=(0,t.useCallback)((e,s)=>a.A.filterDataByPlantAccess(e,s),[]);return{loading:l,error:n,isAuthenticated:(0,r.wR)(),currentUser:(0,r.HW)(),primaryRole:(0,r.Jv)(),userPlants:(0,r.nT)(),primaryPlant:(0,r.bN)(),isAdmin:(0,r.qc)(),isJvcUser:(0,r.bV)(),isCqsUser:(0,r.po)(),isTechUser:(0,r.C9)(),isPlantUser:(0,r.X9)(),isViewer:(0,r.Z$)(),accessSummary:e,hasRole:e=>(0,r.hf)(e),hasAnyRole:e=>e.some(e=>(0,r.hf)(e)),hasAllRoles:e=>e.every(e=>(0,r.hf)(e)),checkScreenAccess:d,checkDataAccess:u,checkPlantDataAccess:h,makeAccessDecision:f,filterByPlantAccess:A,refresh:c}}},5423:(e,s,l)=>{l.d(s,{PK:()=>h,kz:()=>d,m6:()=>u,ww:()=>c,yE:()=>f});var t=l(4135),r=l(1686),a=(l(5043),l(3719)),i=l(1028),n=l(579);const o=e=>{let{children:s,roles:l=[],requireAll:i=!1,fallback:o=null,loading:c=!1,showFallback:d=!0}=e;if(c)return(0,n.jsx)(r.A,{size:"large"});if(!(0,a.wR)())return d?(0,n.jsx)(t.Ay,{status:"warning",title:"Authentication Required",subTitle:"Please log in to access this content."}):null;if(!l||0===l.length)return s;const u=(0,a.qc)(),h=i?l.every(e=>(0,a.hf)(e)):l.some(e=>(0,a.hf)(e));return u||h?s:o||(d?(0,n.jsx)(t.Ay,{status:"403",title:"Access Denied",subTitle:`This content requires one of the following roles: ${l.join(", ")} or ADMIN privileges`}):null)},c=e=>{let{children:s,fallback:l=null,showFallback:r=!0}=e;if(!(0,a.wR)())return r?(0,n.jsx)(t.Ay,{status:"warning",title:"Authentication Required",subTitle:"Please log in to access this content."}):null;const o=(0,a.HW)(),c=(0,a.qc)(),d=(0,a.hf)("ADMIN"),u=(0,a.hf)("admin"),h=(0,a.hf)("ROLE_ADMIN"),f=(0,a.gf)();let A=!1,m=!1;if(f)try{var y,x;const e=i.A.getTokenPayload(f);A=!0===(null===e||void 0===e?void 0:e.isAdmin),m=(null===e||void 0===e||null===(y=e.roles)||void 0===y?void 0:y.includes("ADMIN"))||(null===e||void 0===e||null===(x=e.authorities)||void 0===x?void 0:x.includes("ADMIN"))}catch(j){console.error("Error checking token in AdminOnly:",j)}const g=c||d||u||h||A||m;return console.log("AdminOnly Enhanced Debug:",{currentUser:o,adminStatus:c,hasAdminRole:d,hasAdminRoleLower:u,hasRoleAdmin:h,tokenIsAdmin:A,tokenHasAdminRole:m,finalHasAccess:g,token:f?"present":"missing"}),g?s:l||(r?(0,n.jsx)(t.Ay,{status:"403",title:"Access Denied",subTitle:`This content requires administrator privileges. Debug: user=${o}, isAdmin=${c}, hasRole=${d}, tokenAdmin=${A}`}):null)},d=e=>{let{children:s,fallback:l=null,showFallback:t=!0}=e;return(0,n.jsx)(o,{roles:["JVC_USER","JVC_ROLE","ADMIN"],fallback:l,showFallback:t,children:s})},u=e=>{let{children:s,fallback:l=null,showFallback:t=!0}=e;return(0,n.jsx)(o,{roles:["CQS_USER","CQS_ROLE","ADMIN"],fallback:l,showFallback:t,children:s})},h=e=>{let{children:s,fallback:l=null,showFallback:t=!0}=e;return(0,n.jsx)(o,{roles:["TECH_USER","TECH_ROLE","ADMIN"],fallback:l,showFallback:t,children:s})},f=e=>{let{children:s,fallback:l=null,showFallback:t=!0}=e;return(0,n.jsx)(o,{roles:["PLANT_USER","PLANT_ROLE","ADMIN"],fallback:l,showFallback:t,children:s})}},7286:(e,s,l)=>{l.r(s),l.d(s,{default:()=>x});var t=l(5206),r=l(1645),a=l(487),i=l(9098),n=l(5444),o=l(6569),c=l(7419),d=l(6553),u=l(3217),h=l(3927),f=l(5043),A=l(6649),m=l(579);const{Title:y}=h.A,x=()=>{const[e,s]=(0,f.useState)([]),[l,h]=(0,f.useState)(!1),[x]=i.A.useForm(),[g,j]=(0,f.useState)(!1),p=async e=>{h(!0);try{const l=await A.default.get("/audit/logs",{signal:e});if(null===e||void 0===e||!e.aborted){const e=Array.isArray(l)?l:[];s(e)}}catch(l){null!==e&&void 0!==e&&e.aborted||(o.Ay.error("Failed to fetch audit logs"),console.error("Error fetching audit logs:",l),s([]))}finally{null!==e&&void 0!==e&&e.aborted||h(!1)}};(0,f.useEffect)(()=>{const e=new AbortController;return p(e.signal),()=>{e.abort()}},[]);const E=[{title:"Timestamp",dataIndex:"timestamp",key:"timestamp",sorter:(e,s)=>new Date(e.timestamp)-new Date(s.timestamp)},{title:"User",dataIndex:"user",key:"user",sorter:(e,s)=>e.user.localeCompare(s.user)},{title:"Action",dataIndex:"action",key:"action",sorter:(e,s)=>e.action.localeCompare(s.action)},{title:"Details",dataIndex:"details",key:"details",width:"40%"}];return(0,m.jsxs)("div",{children:[(0,m.jsx)(y,{level:2,children:"Audit Logs"}),(0,m.jsx)(i.A,{form:x,layout:"vertical",onFinish:e=>{j(!0),(async e=>{h(!0);let l="/audit/logs";if(e)if(e.userId)l=`/audit/logs/user/${e.userId}`;else if(e.action)l=`/audit/logs/action/${e.action}`;else if(e.entityType)l=`/audit/logs/entity/${e.entityType}`;else if(e.severity)l=`/audit/logs/severity/${e.severity}`;else if(e.dateRange&&2===e.dateRange.length){const[s,t]=e.dateRange;l=`/audit/logs/date?start=${s.toISOString()}&end=${t.toISOString()}`}try{const e=await A.default.get(l),t=Array.isArray(e)?e:[];s(t)}catch(t){o.Ay.error("Failed to fetch audit logs"),console.error("Error fetching filtered audit logs:",t),s([])}finally{h(!1)}})(e).then(()=>j(!1))},style:{marginBottom:24},children:(0,m.jsxs)(c.A,{gutter:16,children:[(0,m.jsx)(r.A,{span:4,children:(0,m.jsx)(i.A.Item,{name:"userId",label:"User ID",children:(0,m.jsx)(n.A,{placeholder:"User ID"})})}),(0,m.jsx)(r.A,{span:4,children:(0,m.jsx)(i.A.Item,{name:"action",label:"Action",children:(0,m.jsx)(n.A,{placeholder:"Action"})})}),(0,m.jsx)(r.A,{span:4,children:(0,m.jsx)(i.A.Item,{name:"entityType",label:"Entity",children:(0,m.jsx)(n.A,{placeholder:"Entity Type"})})}),(0,m.jsx)(r.A,{span:4,children:(0,m.jsx)(i.A.Item,{name:"severity",label:"Severity",children:(0,m.jsxs)(d.A,{allowClear:!0,placeholder:"Select severity",children:[(0,m.jsx)(d.A.Option,{value:"INFO",children:"INFO"}),(0,m.jsx)(d.A.Option,{value:"WARN",children:"WARN"}),(0,m.jsx)(d.A.Option,{value:"ERROR",children:"ERROR"}),(0,m.jsx)(d.A.Option,{value:"SECURITY",children:"SECURITY"})]})})}),(0,m.jsx)(r.A,{span:6,children:(0,m.jsx)(i.A.Item,{name:"dateRange",label:"Date Range",children:(0,m.jsx)(a.A.RangePicker,{showTime:!0,style:{width:"100%"}})})}),(0,m.jsx)(r.A,{span:2,style:{display:"flex",alignItems:"end"},children:(0,m.jsx)(t.Ay,{type:"primary",htmlType:"submit",loading:g,children:"Filter"})}),(0,m.jsx)(r.A,{span:2,style:{display:"flex",alignItems:"end"},children:(0,m.jsx)(t.Ay,{onClick:()=>{x.resetFields(),p()},children:"Reset"})})]})}),(0,m.jsx)(u.A,{columns:E,dataSource:e,rowKey:"id",loading:l,bordered:!0})]})}},8143:(e,s,l)=>{l.d(s,{A:()=>o});var t=l(8168),r=l(5043);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var i=l(2172),n=function(e,s){return r.createElement(i.A,(0,t.A)({},e,{ref:s,icon:a}))};const o=r.forwardRef(n)},8471:(e,s,l)=>{l.r(s),l.d(s,{default:()=>j});var t=l(1966),r=l(7407),a=l(5337),i=l(5206),n=l(9098),o=l(5444),c=l(6569),d=l(2751),u=l(647),h=l(6051),f=l(3217),A=l(3927),m=l(5043),y=l(6649),x=l(579);const{Title:g}=A.A,j=()=>{const[e,s]=(0,m.useState)([]),[l,A]=(0,m.useState)(!1),[j,p]=(0,m.useState)(!1),[E,v]=(0,m.useState)(null),[R]=n.A.useForm(),k=async e=>{A(!0);try{const l=await y.default.get("/admin/roles",{signal:e});if(null===e||void 0===e||!e.aborted){const e=Array.isArray(l)?l:[];s(e)}}catch(l){null!==e&&void 0!==e&&e.aborted||(c.Ay.error("Failed to fetch roles"),console.error("Error fetching roles:",l),s([]))}finally{null!==e&&void 0!==e&&e.aborted||A(!1)}};(0,m.useEffect)(()=>{const e=new AbortController;return k(e.signal),()=>{e.abort()}},[]);const w=[{title:"Name",dataIndex:"name",key:"name"},{title:"Description",dataIndex:"description",key:"description"},{title:"Actions",key:"actions",render:(e,s)=>(0,x.jsxs)(h.A,{children:[(0,x.jsx)(i.Ay,{icon:(0,x.jsx)(r.A,{}),onClick:()=>{return v(e=s),R.setFieldsValue(e),void p(!0);var e}}),(0,x.jsx)(u.A,{title:"Are you sure you want to delete this role?",onConfirm:()=>(async e=>{try{await y.default.delete(`/admin/roles/${e}`),c.Ay.success("Role deleted successfully"),k()}catch(s){c.Ay.error("Failed to delete role")}})(s.id),okText:"Yes",cancelText:"No",children:(0,x.jsx)(i.Ay,{icon:(0,x.jsx)(t.A,{}),danger:!0})})]})}];return(0,x.jsxs)("div",{children:[(0,x.jsx)(g,{level:2,children:"Roles"}),(0,x.jsx)(i.Ay,{type:"primary",icon:(0,x.jsx)(a.A,{}),onClick:()=>{v(null),R.resetFields(),p(!0)},style:{marginBottom:16},children:"Add Role"}),(0,x.jsx)(f.A,{columns:w,dataSource:e,rowKey:"id",loading:l}),(0,x.jsx)(d.A,{title:E?"Edit Role":"Add Role",open:j,onOk:async()=>{try{const e=await R.validateFields();E?(await y.default.put(`/admin/roles/${E.id}`,e),c.Ay.success("Role updated successfully")):(await y.default.post("/admin/roles",e),c.Ay.success("Role created successfully")),p(!1),R.resetFields(),k()}catch(e){e.errorFields||c.Ay.error("Failed to save role")}},onCancel:()=>p(!1),children:(0,x.jsxs)(n.A,{form:R,layout:"vertical",children:[(0,x.jsx)(n.A.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please input the role name!"}],children:(0,x.jsx)(o.A,{})}),(0,x.jsx)(n.A.Item,{name:"description",label:"Description",rules:[{required:!0,message:"Please input the role description!"}],children:(0,x.jsx)(o.A.TextArea,{})})]})})]})}},9108:(e,s,l)=>{l.r(s),l.d(s,{default:()=>k});var t=l(7407),r=l(8818),a=l(3722),i=l(5206),n=l(9073),o=l(6569),c=l(2751),d=l(6051),u=l(1686),h=l(3217),f=l(8918),A=l(3737),m=l(3927),y=l(5043),x=l(6649),g=l(2868),j=l(5991),p=l(579);const{Title:E,Text:v}=m.A,{TabPane:R}=f.A,k=()=>{const[e,s]=(0,y.useState)(!0),[l,m]=(0,y.useState)([]),[k,w]=(0,y.useState)(!1),[b,S]=(0,y.useState)(null),[C,D]=(0,y.useState)([]),[I,T]=(0,y.useState)([]),[P,N]=(0,y.useState)(!1);(0,y.useEffect)(()=>{const e=new AbortController;return F(e.signal),()=>{e.abort()}},[]);const F=async e=>{s(!0);try{const s=await x.default.get("/admin/monitoring/user-roles",{signal:e});if(null===e||void 0===e||!e.aborted){const e=(0,j.eC)(s);m(e)}}catch(l){null!==e&&void 0!==e&&e.aborted||(o.Ay.error("Failed to load user role assignments"),console.error("Error fetching user roles:",l),m([]))}finally{null!==e&&void 0!==e&&e.aborted||s(!1)}},O=[{title:"Username",dataIndex:"username",key:"username",sorter:(e,s)=>e.username.localeCompare(s.username)},{title:"Email",dataIndex:"email",key:"email"},{title:"Assigned Roles",dataIndex:"assignedRoles",key:"assignedRoles",render:e=>(e||[]).map(e=>e.name).join(", ")},{title:"Actions",key:"actions",render:(e,s)=>(0,p.jsx)(i.Ay,{type:"primary",icon:(0,p.jsx)(t.A,{}),onClick:()=>{return S(e=s),D([...(e.assignedRoles||[]).map(e=>({...e,key:e.id.toString()})),...(e.availableRoles||[]).map(e=>({...e,key:e.id.toString()}))]),T((e.assignedRoles||[]).map(e=>e.id.toString())),void w(!0);var e},children:"Edit Roles"})}];return(0,p.jsxs)("div",{children:[(0,p.jsx)(E,{level:2,children:"User Role Management"}),(0,p.jsxs)(f.A,{defaultActiveKey:"1",children:[(0,p.jsx)(R,{tab:(0,p.jsxs)("span",{children:[(0,p.jsx)(a.A,{}),"User Roles"]}),children:(0,p.jsxs)(n.A,{children:[(0,p.jsx)(i.Ay,{type:"primary",onClick:F,style:{marginBottom:16},children:"Refresh User Roles"}),e?(0,p.jsxs)("div",{style:{textAlign:"center",padding:"50px"},children:[(0,p.jsx)(u.A,{size:"large"}),(0,p.jsx)("p",{children:"Loading user role assignments..."})]}):(0,p.jsx)(h.A,{dataSource:l,columns:O,rowKey:"userId",pagination:{pageSize:g.Bq.DEFAULT_PAGE_SIZE}})]})},"1"),(0,p.jsx)(R,{tab:(0,p.jsxs)("span",{children:[(0,p.jsx)(r.A,{}),"Workflow Permissions"]}),children:(0,p.jsx)(n.A,{children:(0,p.jsxs)("div",{style:{padding:"20px"},children:[(0,p.jsx)(E,{level:4,children:"Workflow Role Permissions"}),(0,p.jsxs)(d.A,{direction:"vertical",style:{width:"100%"},children:[(0,p.jsx)(n.A,{title:"JVC User Permissions",size:"small",children:(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Initiate MSDS workflows for materials"}),(0,p.jsx)("li",{children:"Assign workflows to plant teams"}),(0,p.jsx)("li",{children:"View JVC dashboard with pending extensions"}),(0,p.jsx)("li",{children:"Respond to queries from plant teams"})]})}),(0,p.jsx)(n.A,{title:"Plant User Permissions",size:"small",children:(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Complete multi-step questionnaires"}),(0,p.jsx)("li",{children:"Raise queries to CQS/Tech/JVC teams"}),(0,p.jsx)("li",{children:"View plant dashboard with assigned materials"}),(0,p.jsx)("li",{children:"Mark materials as completed"})]})}),(0,p.jsx)(n.A,{title:"CQS User Permissions",size:"small",children:(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Receive and resolve queries from plant teams"}),(0,p.jsx)("li",{children:"View CQS dashboard with pending queries"}),(0,p.jsx)("li",{children:"Access material context for queries"})]})}),(0,p.jsx)(n.A,{title:"Tech User Permissions",size:"small",children:(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Receive and resolve technical queries from plant teams"}),(0,p.jsx)("li",{children:"View Tech dashboard with pending queries"}),(0,p.jsx)("li",{children:"Access material context for queries"})]})}),(0,p.jsx)(n.A,{title:"Admin Permissions",size:"small",children:(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Access workflow monitoring dashboard"}),(0,p.jsx)("li",{children:"Generate query SLA reports"}),(0,p.jsx)("li",{children:"Manage user roles and permissions"}),(0,p.jsx)("li",{children:"Export audit logs and workflow reports"}),(0,p.jsx)("li",{children:"View all workflows regardless of state"})]})})]}),(0,p.jsx)(v,{type:"secondary",style:{marginTop:16,display:"block"},children:"Note: Users can have multiple roles assigned to them. The permissions are cumulative."})]})})},"2")]}),(0,p.jsx)(c.A,{title:"Edit User Roles",open:k,onOk:async()=>{if(b){N(!0);try{const e=I.map(e=>parseInt(e,10));await x.default.put(`/admin/monitoring/user-roles/${b.userId}`,e),o.Ay.success("User roles updated successfully"),w(!1),F()}catch(e){o.Ay.error("Failed to update user roles"),console.error("Error updating user roles:",e)}finally{N(!1)}}},onCancel:()=>w(!1),width:800,confirmLoading:P,children:b&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("strong",{children:"User:"})," ",b.username," (",b.email,")"]}),(0,p.jsx)("p",{children:"Assign or remove roles using the transfer control below:"}),(0,p.jsx)(A.A,{dataSource:C,titles:["Available Roles","Assigned Roles"],targetKeys:I,onChange:e=>{T(e)},render:e=>e.name,listStyle:{width:350,height:300}})]})})]})}}}]);
//# sourceMappingURL=184.15d7e03b.chunk.js.map